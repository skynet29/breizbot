!function(t){var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=10;function i(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==t?e.maxListeners:n,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=n}function o(t,e){var n="(node) warning: possible EventEmitter memory leak detected. "+t+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+e+"."),"undefined"!=typeof process&&process.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=t,process.emitWarning(i)}else console.error(n),console.trace&&console.trace()}function r(t){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,s.call(this,t)}function a(t,e,n,i){if(!n)return[];var s,o,r,l,c,u,d,p=[],f=e.length,h=e[i],b=e[i+1];if(i===f&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(s=0,o=n._listeners.length;s<o;s++)t&&t.push(n._listeners[s]);return[n]}if("*"===h||"**"===h||n[h]){if("*"===h){for(r in n)"_listeners"!==r&&n.hasOwnProperty(r)&&(p=p.concat(a(t,e,n[r],i+1)));return p}if("**"===h){for(r in(d=i+1===f||i+2===f&&"*"===b)&&n._listeners&&(p=p.concat(a(t,e,n,f))),n)"_listeners"!==r&&n.hasOwnProperty(r)&&("*"===r||"**"===r?(n[r]._listeners&&!d&&(p=p.concat(a(t,e,n[r],f))),p=p.concat(a(t,e,n[r],i))):p=r===b?p.concat(a(t,e,n[r],i+2)):p.concat(a(t,e,n[r],i)));return p}p=p.concat(a(t,e,n[h],i+1))}if((l=n["*"])&&a(t,e,l,i+1),c=n["**"])if(i<f)for(r in c._listeners&&a(t,e,c,f),c)"_listeners"!==r&&c.hasOwnProperty(r)&&(r===b?a(t,e,c[r],i+2):r===h?a(t,e,c[r],i+1):((u={})[r]=c[r],a(t,e,{"**":u},i+1)));else c._listeners?a(t,e,c,f):c["*"]&&c["*"]._listeners&&a(t,e,c["*"],f);return p}r.EventEmitter2=r,r.prototype.delimiter=".",r.prototype.setMaxListeners=function(e){e!==t&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},r.prototype.event="",r.prototype.once=function(t,e){return this._once(t,e,!1)},r.prototype.prependOnceListener=function(t,e){return this._once(t,e,!0)},r.prototype._once=function(t,e,n){return this._many(t,1,e,n),this},r.prototype.many=function(t,e,n){return this._many(t,e,n,!1)},r.prototype.prependMany=function(t,e,n){return this._many(t,e,n,!0)},r.prototype._many=function(t,e,n,i){var s=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function o(){return 0==--e&&s.off(t,o),n.apply(this,arguments)}return o._origin=n,this._on(t,o,i),s},r.prototype.emit=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;var e,n,s,o,r,l=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),l>3)for(e=new Array(l),o=0;o<l;o++)e[o]=arguments[o];for(s=0,n=r.length;s<n;s++)switch(this.event=t,l){case 1:r[s].call(this,t);break;case 2:r[s].call(this,t,arguments[1]);break;case 3:r[s].call(this,t,arguments[1],arguments[2]);break;default:r[s].apply(this,e)}}if(this.wildcard){r=[];var c="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,c,this.listenerTree,0)}else{if("function"==typeof(r=this._events[t])){switch(this.event=t,l){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(e=new Array(l-1),o=1;o<l;o++)e[o-1]=arguments[o];r.apply(this,e)}return!0}r&&(r=r.slice())}if(r&&r.length){if(l>3)for(e=new Array(l-1),o=1;o<l;o++)e[o-1]=arguments[o];for(s=0,n=r.length;s<n;s++)switch(this.event=t,l){case 1:r[s].call(this);break;case 2:r[s].call(this,arguments[1]);break;case 3:r[s].call(this,arguments[1],arguments[2]);break;default:r[s].apply(this,e)}return!0}if(!this._all&&"error"===t)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},r.prototype.emitAsync=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var e,n,s,o,r,l=[],c=arguments.length;if(this._all){if(c>3)for(e=new Array(c),o=1;o<c;o++)e[o]=arguments[o];for(s=0,n=this._all.length;s<n;s++)switch(this.event=t,c){case 1:l.push(this._all[s].call(this,t));break;case 2:l.push(this._all[s].call(this,t,arguments[1]));break;case 3:l.push(this._all[s].call(this,t,arguments[1],arguments[2]));break;default:l.push(this._all[s].apply(this,e))}}if(this.wildcard){r=[];var u="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,u,this.listenerTree,0)}else r=this._events[t];if("function"==typeof r)switch(this.event=t,c){case 1:l.push(r.call(this));break;case 2:l.push(r.call(this,arguments[1]));break;case 3:l.push(r.call(this,arguments[1],arguments[2]));break;default:for(e=new Array(c-1),o=1;o<c;o++)e[o-1]=arguments[o];l.push(r.apply(this,e))}else if(r&&r.length){if(r=r.slice(),c>3)for(e=new Array(c-1),o=1;o<c;o++)e[o-1]=arguments[o];for(s=0,n=r.length;s<n;s++)switch(this.event=t,c){case 1:l.push(r[s].call(this));break;case 2:l.push(r[s].call(this,arguments[1]));break;case 3:l.push(r[s].call(this,arguments[1],arguments[2]));break;default:l.push(r[s].apply(this,e))}}else if(!this._all&&"error"===t)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(l)},r.prototype.on=function(t,e){return this._on(t,e,!1)},r.prototype.prependListener=function(t,e){return this._on(t,e,!0)},r.prototype.onAny=function(t){return this._onAny(t,!1)},r.prototype.prependAny=function(t){return this._onAny(t,!0)},r.prototype.addListener=r.prototype.on,r.prototype._onAny=function(t,e){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),e?this._all.unshift(t):this._all.push(t),this},r.prototype._on=function(e,n,s){if("function"==typeof e)return this._onAny(e,n),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");return this._events||i.call(this),this.emit("newListener",e,n),this.wildcard?(function(e,n){for(var i=0,s=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;i+1<s;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var r=this.listenerTree,a=e.shift();a!==t;){if(r[a]||(r[a]={}),r=r[a],0===e.length)return r._listeners?("function"==typeof r._listeners&&(r._listeners=[r._listeners]),r._listeners.push(n),!r._listeners.warned&&this._maxListeners>0&&r._listeners.length>this._maxListeners&&(r._listeners.warned=!0,o.call(this,r._listeners.length,a))):r._listeners=n,!0;a=e.shift()}return!0}.call(this,e,n),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),s?this._events[e].unshift(n):this._events[e].push(n),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,o.call(this,this._events[e].length,e))):this._events[e]=n,this)},r.prototype.off=function(n,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");var s,o=[];if(this.wildcard){var r="string"==typeof n?n.split(this.delimiter):n.slice();o=a.call(this,null,r,this.listenerTree,0)}else{if(!this._events[n])return this;s=this._events[n],o.push({_listeners:s})}for(var l=0;l<o.length;l++){var c=o[l];if(s=c._listeners,e(s)){for(var u=-1,d=0,p=s.length;d<p;d++)if(s[d]===i||s[d].listener&&s[d].listener===i||s[d]._origin&&s[d]._origin===i){u=d;break}if(u<0)continue;return this.wildcard?c._listeners.splice(u,1):this._events[n].splice(u,1),0===s.length&&(this.wildcard?delete c._listeners:delete this._events[n]),this.emit("removeListener",n,i),this}(s===i||s.listener&&s.listener===i||s._origin&&s._origin===i)&&(this.wildcard?delete c._listeners:delete this._events[n],this.emit("removeListener",n,i))}return function e(n){if(n!==t){var i=Object.keys(n);for(var s in i){var o=i[s],r=n[o];r instanceof Function||"object"!=typeof r||null===r||(Object.keys(r).length>0&&e(n[o]),0===Object.keys(r).length&&delete n[o])}}}(this.listenerTree),this},r.prototype.offAny=function(t){var e,n=0,i=0;if(t&&this._all&&this._all.length>0){for(n=0,i=(e=this._all).length;n<i;n++)if(t===e[n])return e.splice(n,1),this.emit("removeListenerAny",t),this}else{for(n=0,i=(e=this._all).length;n<i;n++)this.emit("removeListenerAny",e[n]);this._all=[]}return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var e="string"==typeof t?t.split(this.delimiter):t.slice(),n=a.call(this,null,e,this.listenerTree,0),s=0;s<n.length;s++){n[s]._listeners=null}else this._events&&(this._events[t]=null);return this},r.prototype.listeners=function(t){if(this.wildcard){var n=[],s="string"==typeof t?t.split(this.delimiter):t.slice();return a.call(this,n,s,this.listenerTree,0),n}return this._events||i.call(this),this._events[t]||(this._events[t]=[]),e(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.eventNames=function(){return Object.keys(this._events)},r.prototype.listenerCount=function(t){return this.listeners(t).length},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return r}):"object"==typeof exports?module.exports=r:window.EventEmitter2=r}(),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(n),n}:t(jQuery)}(function(t){function e(e,n,i){"string"==typeof i&&(i={className:i}),this.options=y(w,t.isPlainObject(i)?i:{}),this.loadHTML(),this.wrapper=t(f.html),this.options.clickToHide&&this.wrapper.addClass(s+"-hidable"),this.wrapper.data(s,this),this.arrow=this.wrapper.find("."+s+"-arrow"),this.container=this.wrapper.find("."+s+"-container"),this.container.append(this.userContainer),e&&e.length&&(this.elementType=e.attr("type"),this.originalElement=e,this.elem=k(e),this.elem.data(s,this),this.elem.before(this.wrapper)),this.container.hide(),this.run(n)}var n=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},i="notify",s=i+"js",o=i+"!blank",r={t:"top",m:"middle",b:"bottom",l:"left",c:"center",r:"right"},a=["l","c","r"],l=["t","m","b"],c=["t","b","l","r"],u={t:"b",m:null,b:"t",l:"r",c:null,r:"l"},d=function(e){var n;return n=[],t.each(e.split(/\W+/),function(t,e){var i;if(i=e.toLowerCase().charAt(0),r[i])return n.push(i)}),n},p={},f={name:"core",html:'<div class="'+s+'-wrapper">\n\t<div class="'+s+'-arrow"></div>\n\t<div class="'+s+'-container"></div>\n</div>',css:"."+s+"-corner {\n\tposition: fixed;\n\tmargin: 5px;\n\tz-index: 1050;\n}\n\n."+s+"-corner ."+s+"-wrapper,\n."+s+"-corner ."+s+"-container {\n\tposition: relative;\n\tdisplay: block;\n\theight: inherit;\n\twidth: inherit;\n\tmargin: 3px;\n}\n\n."+s+"-wrapper {\n\tz-index: 1;\n\tposition: absolute;\n\tdisplay: inline-block;\n\theight: 0;\n\twidth: 0;\n}\n\n."+s+"-container {\n\tdisplay: none;\n\tz-index: 1;\n\tposition: absolute;\n}\n\n."+s+"-hidable {\n\tcursor: pointer;\n}\n\n[data-notify-text],[data-notify-html] {\n\tposition: relative;\n}\n\n."+s+"-arrow {\n\tposition: absolute;\n\tz-index: 2;\n\twidth: 0;\n\theight: 0;\n}"},h={"border-radius":["-webkit-","-moz-"]},b=function(e,n){if(!e)throw"Missing Style name";if(!n)throw"Missing Style definition";if(!n.html)throw"Missing Style HTML";var o=p[e];o&&o.cssElem&&(window.console&&console.warn(i+": overwriting style '"+e+"'"),p[e].cssElem.remove()),n.name=e,p[e]=n;var r="";n.classes&&t.each(n.classes,function(e,i){return r+="."+s+"-"+n.name+"-"+e+" {\n",t.each(i,function(e,n){return h[e]&&t.each(h[e],function(t,i){return r+="\t"+i+e+": "+n+";\n"}),r+="\t"+e+": "+n+";\n"}),r+="}\n"}),n.css&&(r+="/* styles for "+n.name+" */\n"+n.css),r&&(n.cssElem=m(r),n.cssElem.attr("id","notify-"+n.name));var a={},l=t(n.html);g("html",l,a),g("text",l,a),n.fields=a},m=function(e){var n;(n=A("style")).attr("type","text/css"),t("head").append(n);try{n.html(e)}catch(t){n[0].styleSheet.cssText=e}return n},g=function(e,n,i){var s;return"html"!==e&&(e="text"),v(n,"["+(s="data-notify-"+e)+"]").each(function(){var n;(n=t(this).attr(s))||(n=o),i[n]=e})},v=function(t,e){return t.is(e)?t:t.find(e)},w={clickToHide:!0,autoHide:!0,autoHideDelay:5e3,arrowShow:!0,arrowSize:5,breakNewLines:!0,elementPosition:"bottom",globalPosition:"top right",style:"bootstrap",className:"error",showAnimation:"slideDown",showDuration:400,hideAnimation:"slideUp",hideDuration:200,gap:5},y=function(e,n){var i;return(i=function(){}).prototype=e,t.extend(!0,new i,n)},A=function(e){return t("<"+e+"></"+e+">")},x={},k=function(e){var n;return e.is("[type=radio]")&&(n=e.parents("form:first").find("[type=radio]").filter(function(n,i){return t(i).attr("name")===e.attr("name")}),e=n.first()),e},C=function(t,e,n){var i;if("string"==typeof n)n=parseInt(n,10);else if("number"!=typeof n)return;if(!isNaN(n))return i=r[u[e.charAt(0)]],e,void 0!==t[i]&&(e=r[i.charAt(0)],n=-n),void 0===t[e]?t[e]=n:t[e]+=n,null},$=function(t,e,n){if("l"===t||"t"===t)return 0;if("c"===t||"m"===t)return n/2-e/2;if("r"===t||"b"===t)return n-e;throw"Invalid alignment"},P=function(t){return P.e=P.e||A("div"),P.e.text(t).html()};e.prototype.loadHTML=function(){var e;e=this.getStyle(),this.userContainer=t(e.html),this.userFields=e.fields},e.prototype.show=function(t,e){var n,i,s,o,r;if(i=function(n){return function(){if(!t&&!n.elem&&n.destroy(),e)return e()}}(this),r=this.container.parent().parents(":hidden").length>0,s=this.container.add(this.arrow),n=[],r&&t)o="show";else if(r&&!t)o="hide";else if(!r&&t)o=this.options.showAnimation,n.push(this.options.showDuration);else{if(r||t)return i();o=this.options.hideAnimation,n.push(this.options.hideDuration)}return n.push(i),s[o].apply(s,n)},e.prototype.setGlobalPosition=function(){var e=this.getPosition(),n=e[0],i=e[1],o=r[n],a=r[i],l=n+"|"+i,c=x[l];if(!c||!document.body.contains(c[0])){c=x[l]=A("div");var u={};u[o]=0,"middle"===a?u.top="45%":"center"===a?u.left="45%":u[a]=0,c.css(u).addClass(s+"-corner"),t("body").append(c)}return c.prepend(this.wrapper)},e.prototype.setElementPosition=function(){var e,i,s,o,d,p,f,h,b,m,g,v,w,y,A,x,k,P,D,I,S,F,N,E,z,T,L,U;for(N=(T=this.getPosition())[0],F=T[1],T[2],g=this.elem.position(),h=this.elem.outerHeight(),v=this.elem.outerWidth(),b=this.elem.innerHeight(),m=this.elem.innerWidth(),U=this.wrapper.position(),d=this.container.height(),p=this.container.width(),P=r[N],(f={})[S=r[I=u[N]]]="b"===N?h:"r"===N?v:0,C(f,"top",g.top-U.top),C(f,"left",g.left-U.left),y=0,x=(L=["top","left"]).length;y<x;y++)E=L[y],(D=parseInt(this.elem.css("margin-"+E),10))&&C(f,E,D);if(w=Math.max(0,this.options.gap-(this.options.arrowShow?s:0)),C(f,S,w),this.options.arrowShow){for(s=this.options.arrowSize,i=t.extend({},f),e=this.userContainer.css("border-color")||this.userContainer.css("border-top-color")||this.userContainer.css("background-color")||"white",A=0,k=c.length;A<k;A++)z=r[E=c[A]],E!==I&&(o=z===P?e:"transparent",i["border-"+z]=s+"px solid "+o);C(f,r[I],s),n.call(c,F)>=0&&C(i,r[F],2*s)}else this.arrow.hide();if(n.call(l,N)>=0?(C(f,"left",$(F,p,v)),i&&C(i,"left",$(F,s,m))):n.call(a,N)>=0&&(C(f,"top",$(F,d,h)),i&&C(i,"top",$(F,s,b))),this.container.is(":visible")&&(f.display="block"),this.container.removeAttr("style").css(f),i)return this.arrow.removeAttr("style").css(i)},e.prototype.getPosition=function(){var t,e,i,s,o,r,u,p;if(p=this.options.position||(this.elem?this.options.elementPosition:this.options.globalPosition),0===(t=d(p)).length&&(t[0]="b"),e=t[0],n.call(c,e)<0)throw"Must be one of ["+c+"]";return(1===t.length||(i=t[0],n.call(l,i)>=0&&(s=t[1],n.call(a,s)<0))||(o=t[0],n.call(a,o)>=0&&(r=t[1],n.call(l,r)<0)))&&(t[1]=(u=t[0],n.call(a,u)>=0?"m":"l")),2===t.length&&(t[2]=t[1]),t},e.prototype.getStyle=function(t){var e;if(t||(t=this.options.style),t||(t="default"),!(e=p[t]))throw"Missing style: "+t;return e},e.prototype.updateClasses=function(){var e,n;return e=["base"],t.isArray(this.options.className)?e=e.concat(this.options.className):this.options.className&&e.push(this.options.className),n=this.getStyle(),e=t.map(e,function(t){return s+"-"+n.name+"-"+t}).join(" "),this.userContainer.attr("class",e)},e.prototype.run=function(e,n){var i,s,r,a,l;if(t.isPlainObject(n)?t.extend(this.options,n):"string"===t.type(n)&&(this.options.className=n),!this.container||e){if(this.container||e){for(r in s={},t.isPlainObject(e)?s=e:s[o]=e,s)i=s[r],(a=this.userFields[r])&&("text"===a&&(i=P(i),this.options.breakNewLines&&(i=i.replace(/\n/g,"<br/>"))),l=r===o?"":"="+r,v(this.userContainer,"[data-notify-"+a+l+"]").html(i));this.updateClasses(),this.elem?this.setElementPosition():this.setGlobalPosition(),this.show(!0),this.options.autoHide&&(clearTimeout(this.autohideTimer),this.autohideTimer=setTimeout(this.show.bind(this,!1),this.options.autoHideDelay))}}else this.show(!1)},e.prototype.destroy=function(){this.wrapper.data(s,null),this.wrapper.remove()},t[i]=function(n,s,o){return n&&n.nodeName||n.jquery?t(n)[i](s,o):(o=s,new e(null,s=n,o)),n},t.fn[i]=function(n,i){return t(this).each(function(){var o=k(t(this)).data(s);o&&o.destroy();new e(t(this),n,i)}),this},t.extend(t[i],{defaults:function(e){return t.extend(w,e)},addStyle:b,removeStyle:function(t){if(!t)throw"Missing Style name";p[t]&&delete p[t]},pluginOptions:w,getStyle:function(t){return p[t]},insertCSS:m}),b("bootstrap",{html:"<div>\n<span data-notify-text></span>\n</div>",classes:{base:{"font-weight":"bold",padding:"8px 15px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)","background-color":"#fcf8e3",border:"1px solid #fbeed5","border-radius":"4px","white-space":"nowrap","padding-left":"25px","background-repeat":"no-repeat","background-position":"3px 7px"},error:{color:"#B94A48","background-color":"#F2DEDE","border-color":"#EED3D7","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtRJREFUeNqkVc1u00AQHq+dOD+0poIQfkIjalW0SEGqRMuRnHos3DjwAH0ArlyQeANOOSMeAA5VjyBxKBQhgSpVUKKQNGloFdw4cWw2jtfMOna6JOUArDTazXi/b3dm55socPqQhFka++aHBsI8GsopRJERNFlY88FCEk9Yiwf8RhgRyaHFQpPHCDmZG5oX2ui2yilkcTT1AcDsbYC1NMAyOi7zTX2Agx7A9luAl88BauiiQ/cJaZQfIpAlngDcvZZMrl8vFPK5+XktrWlx3/ehZ5r9+t6e+WVnp1pxnNIjgBe4/6dAysQc8dsmHwPcW9C0h3fW1hans1ltwJhy0GxK7XZbUlMp5Ww2eyan6+ft/f2FAqXGK4CvQk5HueFz7D6GOZtIrK+srupdx1GRBBqNBtzc2AiMr7nPplRdKhb1q6q6zjFhrklEFOUutoQ50xcX86ZlqaZpQrfbBdu2R6/G19zX6XSgh6RX5ubyHCM8nqSID6ICrGiZjGYYxojEsiw4PDwMSL5VKsC8Yf4VRYFzMzMaxwjlJSlCyAQ9l0CW44PBADzXhe7xMdi9HtTrdYjFYkDQL0cn4Xdq2/EAE+InCnvADTf2eah4Sx9vExQjkqXT6aAERICMewd/UAp/IeYANM2joxt+q5VI+ieq2i0Wg3l6DNzHwTERPgo1ko7XBXj3vdlsT2F+UuhIhYkp7u7CarkcrFOCtR3H5JiwbAIeImjT/YQKKBtGjRFCU5IUgFRe7fF4cCNVIPMYo3VKqxwjyNAXNepuopyqnld602qVsfRpEkkz+GFL1wPj6ySXBpJtWVa5xlhpcyhBNwpZHmtX8AGgfIExo0ZpzkWVTBGiXCSEaHh62/PoR0p/vHaczxXGnj4bSo+G78lELU80h1uogBwWLf5YlsPmgDEd4M236xjm+8nm4IuE/9u+/PH2JXZfbwz4zw1WbO+SQPpXfwG/BBgAhCNZiSb/pOQAAAAASUVORK5CYII=)"},success:{color:"#468847","background-color":"#DFF0D8","border-color":"#D6E9C6","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAutJREFUeNq0lctPE0Ecx38zu/RFS1EryqtgJFA08YCiMZIAQQ4eRG8eDGdPJiYeTIwHTfwPiAcvXIwXLwoXPaDxkWgQ6islKlJLSQWLUraPLTv7Gme32zoF9KSTfLO7v53vZ3d/M7/fIth+IO6INt2jjoA7bjHCJoAlzCRw59YwHYjBnfMPqAKWQYKjGkfCJqAF0xwZjipQtA3MxeSG87VhOOYegVrUCy7UZM9S6TLIdAamySTclZdYhFhRHloGYg7mgZv1Zzztvgud7V1tbQ2twYA34LJmF4p5dXF1KTufnE+SxeJtuCZNsLDCQU0+RyKTF27Unw101l8e6hns3u0PBalORVVVkcaEKBJDgV3+cGM4tKKmI+ohlIGnygKX00rSBfszz/n2uXv81wd6+rt1orsZCHRdr1Imk2F2Kob3hutSxW8thsd8AXNaln9D7CTfA6O+0UgkMuwVvEFFUbbAcrkcTA8+AtOk8E6KiQiDmMFSDqZItAzEVQviRkdDdaFgPp8HSZKAEAL5Qh7Sq2lIJBJwv2scUqkUnKoZgNhcDKhKg5aH+1IkcouCAdFGAQsuWZYhOjwFHQ96oagWgRoUov1T9kRBEODAwxM2QtEUl+Wp+Ln9VRo6BcMw4ErHRYjH4/B26AlQoQQTRdHWwcd9AH57+UAXddvDD37DmrBBV34WfqiXPl61g+vr6xA9zsGeM9gOdsNXkgpEtTwVvwOklXLKm6+/p5ezwk4B+j6droBs2CsGa/gNs6RIxazl4Tc25mpTgw/apPR1LYlNRFAzgsOxkyXYLIM1V8NMwyAkJSctD1eGVKiq5wWjSPdjmeTkiKvVW4f2YPHWl3GAVq6ymcyCTgovM3FzyRiDe2TaKcEKsLpJvNHjZgPNqEtyi6mZIm4SRFyLMUsONSSdkPeFtY1n0mczoY3BHTLhwPRy9/lzcziCw9ACI+yql0VLzcGAZbYSM5CCSZg1/9oc/nn7+i8N9p/8An4JMADxhH+xHfuiKwAAAABJRU5ErkJggg==)"},info:{color:"#3A87AD","background-color":"#D9EDF7","border-color":"#BCE8F1","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QYFAhkSsdes/QAAA8dJREFUOMvVlGtMW2UYx//POaWHXg6lLaW0ypAtw1UCgbniNOLcVOLmAjHZolOYlxmTGXVZdAnRfXQm+7SoU4mXaOaiZsEpC9FkiQs6Z6bdCnNYruM6KNBw6YWewzl9z+sHImEWv+vz7XmT95f/+3/+7wP814v+efDOV3/SoX3lHAA+6ODeUFfMfjOWMADgdk+eEKz0pF7aQdMAcOKLLjrcVMVX3xdWN29/GhYP7SvnP0cWfS8caSkfHZsPE9Fgnt02JNutQ0QYHB2dDz9/pKX8QjjuO9xUxd/66HdxTeCHZ3rojQObGQBcuNjfplkD3b19Y/6MrimSaKgSMmpGU5WevmE/swa6Oy73tQHA0Rdr2Mmv/6A1n9w9suQ7097Z9lM4FlTgTDrzZTu4StXVfpiI48rVcUDM5cmEksrFnHxfpTtU/3BFQzCQF/2bYVoNbH7zmItbSoMj40JSzmMyX5qDvriA7QdrIIpA+3cdsMpu0nXI8cV0MtKXCPZev+gCEM1S2NHPvWfP/hL+7FSr3+0p5RBEyhEN5JCKYr8XnASMT0xBNyzQGQeI8fjsGD39RMPk7se2bd5ZtTyoFYXftF6y37gx7NeUtJJOTFlAHDZLDuILU3j3+H5oOrD3yWbIztugaAzgnBKJuBLpGfQrS8wO4FZgV+c1IxaLgWVU0tMLEETCos4xMzEIv9cJXQcyagIwigDGwJgOAtHAwAhisQUjy0ORGERiELgG4iakkzo4MYAxcM5hAMi1WWG1yYCJIcMUaBkVRLdGeSU2995TLWzcUAzONJ7J6FBVBYIggMzmFbvdBV44Corg8vjhzC+EJEl8U1kJtgYrhCzgc/vvTwXKSib1paRFVRVORDAJAsw5FuTaJEhWM2SHB3mOAlhkNxwuLzeJsGwqWzf5TFNdKgtY5qHp6ZFf67Y/sAVadCaVY5YACDDb3Oi4NIjLnWMw2QthCBIsVhsUTU9tvXsjeq9+X1d75/KEs4LNOfcdf/+HthMnvwxOD0wmHaXr7ZItn2wuH2SnBzbZAbPJwpPx+VQuzcm7dgRCB57a1uBzUDRL4bfnI0RE0eaXd9W89mpjqHZnUI5Hh2l2dkZZUhOqpi2qSmpOmZ64Tuu9qlz/SEXo6MEHa3wOip46F1n7633eekV8ds8Wxjn37Wl63VVa+ej5oeEZ/82ZBETJjpJ1Rbij2D3Z/1trXUvLsblCK0XfOx0SX2kMsn9dX+d+7Kf6h8o4AIykuffjT8L20LU+w4AZd5VvEPY+XpWqLV327HR7DzXuDnD8r+ovkBehJ8i+y8YAAAAASUVORK5CYII=)"},warn:{color:"#C09853","background-color":"#FCF8E3","border-color":"#FBEED5","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABJlBMVEXr6eb/2oD/wi7/xjr/0mP/ykf/tQD/vBj/3o7/uQ//vyL/twebhgD/4pzX1K3z8e349vK6tHCilCWbiQymn0jGworr6dXQza3HxcKkn1vWvV/5uRfk4dXZ1bD18+/52YebiAmyr5S9mhCzrWq5t6ufjRH54aLs0oS+qD751XqPhAybhwXsujG3sm+Zk0PTwG6Shg+PhhObhwOPgQL4zV2nlyrf27uLfgCPhRHu7OmLgAafkyiWkD3l49ibiAfTs0C+lgCniwD4sgDJxqOilzDWowWFfAH08uebig6qpFHBvH/aw26FfQTQzsvy8OyEfz20r3jAvaKbhgG9q0nc2LbZxXanoUu/u5WSggCtp1anpJKdmFz/zlX/1nGJiYmuq5Dx7+sAAADoPUZSAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfdBgUBGhh4aah5AAAAlklEQVQY02NgoBIIE8EUcwn1FkIXM1Tj5dDUQhPU502Mi7XXQxGz5uVIjGOJUUUW81HnYEyMi2HVcUOICQZzMMYmxrEyMylJwgUt5BljWRLjmJm4pI1hYp5SQLGYxDgmLnZOVxuooClIDKgXKMbN5ggV1ACLJcaBxNgcoiGCBiZwdWxOETBDrTyEFey0jYJ4eHjMGWgEAIpRFRCUt08qAAAAAElFTkSuQmCC)"}}}),t(function(){m(f.css).attr("id","core-notify"),t(document).on("click","."+s+"-hidable",function(e){t(this).trigger("notify-hide")}),t(document).on("notify-hide","."+s+"-wrapper",function(e){var n=t(this).data(s);n&&n.show(!1)})})}),$$.control.registerControl("breizbot.alexa",{deps:["brainjs.http"],init(t,e){const n=window.location.hash.substr(1),i=$$.util.parseUrlParams(n);e.post("/api/alexa/auth",i).then(()=>{window.close()})}}),$$.control.registerControl("breizbot.appTab",{props:{appUrl:"about:blank"},template:'<iframe bn-attr="{src: appUrl}" bn-bind="iframe" bn-event="load: onFrameLoaded"></iframe>',init:function(t){const{appUrl:e}=this.props,n=$$.viewController(t,{data:{appUrl:e},events:{onFrameLoaded:function(){}}});this.onAppExit=function(){const t=$(n.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();return t&&"function"==typeof t.onAppExit?t.onAppExit():Promise.resolve()},this.onAppSuspend=function(){const t=$(n.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();t&&"function"==typeof t.onAppSuspend&&t.onAppSuspend()},this.onAppResume=function(){const t=$(n.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();t&&"function"==typeof t.onAppResume&&t.onAppResume()},this.setAppUrl=function(t){n.setData({appUrl:t+"&date="+Date.now()})}}}),$$.control.registerControl("breizbot.apps",{deps:["breizbot.scheduler"],props:{apps:[],showActivated:!1,items:null},$iface:"setData(data)",template:'<div class="scrollPanel">\n\t<div bn-each="apps" \n\t\tbn-iter="app" \n\t\tclass="main" \n\t\tbn-event="click.tile: onTileClick, contextmenuchange.tile: onTileContextMenu"\n\t\t>\t\t\t\n\t\t<div bn-attr="class1" bn-control="brainjs.contextmenu" bn-data="{items: getItems}">\n\t\t\t<div class="arrow-right" bn-show="show1"></div>\n\t\t\t<div bn-show="show2" style="margin-bottom: 5px;">\n\t\t\t\t<i bn-attr="{class: $scope.app.props.iconCls}"></i>\n\t\t\t</div>\n\n\t\t\t<span bn-text="$scope.app.props.title"></span>\n\t\t</div>\n\n\t</div>\n</div>',init:function(t,e){const{apps:n,showActivated:i,items:s}=this.props,o=$$.viewController(t,{data:{getItems:function(t){return"function"==typeof s?s(t.app):s},apps:n,showActivated:i,show1:function(t){return this.showActivated&&t.app.activated},class1:function(t){return{class:`tile w3-btn ${t.app.props.colorCls}`}},show2:function(t){return"string"==typeof t.app.props.iconCls}},events:{onTileClick:function(e){const n=$(this).index();t.trigger("appclick",o.model.apps[n])},onTileContextMenu:function(e,n){const i=$(this).index(),{cmd:s}=n,r=$.extend({cmd:s},o.model.apps[i]);t.trigger("appcontextmenu",r)}}});this.setData=function(t){o.setData({apps:t.apps.filter(t=>0!=t.props.visible&&"template"!=t.appName)})}},$iface:"setData(data)",$events:"appclick;appcontextmenu"}),$$.control.registerControl("breizbot.contacts",{deps:["breizbot.users"],props:{showSelection:!1,showDeleteButton:!1},template:'<p bn-show="show2">You have no contacts</p>\n<div class="scrollPanel">\n\t<ul class="w3-ul w3-border w3-white" \n\t\tbn-event="click.w3-bar: onItemClick, click.delete: onDeleteItem"\n\t\tbn-each="contacts"\n\t\tbn-show="show1"\n\t\t>\n\t\t<li class="w3-bar">\n\t\t\t<span class="w3-button w3-right delete" title="Delete" bn-show="showDeleteButton"><i class="fa fa-trash"></i></span>\n\n\t\t\t<div class="w3-bar-item">\n\t\t\t\t<i class="fa fa-user w3-text-blue"></i>\n\t\t\t\t<strong bn-text="$scope.$i.contactName"></strong><br>\n\t\t\t\t<i class="fa fa-envelope w3-text-blue"></i>\n\t\t\t\t<span bn-text="$scope.$i.contactEmail"></span>\n\t\t\t</div>\n\t\t</li>\n\t</ul>\t\t\n\n</div>\n',init:function(t,e){const{showSelection:n,showDeleteButton:i}=this.props,s=$$.viewController(t,{data:{contacts:[],showDeleteButton:i,show1:function(){return this.contacts.length>0},show2:function(){return 0==this.contacts.length}},events:{onItemClick:function(){const e=$(this).index(),i=s.model.contacts[e];console.log("onItemClick",i),n&&$(this).toggleClass("w3-blue"),t.trigger("contactclick",i)},onDeleteItem:async function(t){t.stopPropagation();const n=$(this).closest("li").index(),i=s.model.contacts[n];console.log("onDeleteItem",i),await e.removeContact(i._id),o()}}});async function o(){const t=await e.getContacts();console.log("contacts",t),s.setData({contacts:t})}o(),this.update=o,this.getSelection=function(){const e=[];return t.find("li.w3-blue").each(function(){const t=$(this).index();e.push(s.model.contacts[t])}),console.log("ret",e),e}},$iface:"getSelection(): [ContactInfo]",$events:"contactclick"}),$$.control.registerControl("breizbot.htmleditor",{template:'<div bn-event="click.cmd: onCommand" class="toolbar">\n\t<div class="group">\n\t\t<button class="cmd w3-button" data-cmd="bold" title="Bold"><i class="fa fa-bold"></i></button>\n\t\t<button class="cmd w3-button" data-cmd="italic" title="Italic"><i class="fa fa-italic"></i></button>\n\t\t<button class="cmd w3-button" data-cmd="underline" title="Underline"><i class="fa fa-underline"></i></button>\n\t\t<span class="separator"></span>\n\n\t</div>\n\n\t<div class="group">\n\n\t\t<button class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand"\n\t\t\ttitle="Title"\n\t\t\tdata-cmd="formatBlock" bn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: {\n\t\t\t\t\tp: {name: \'Normal\'},\n\t\t\t\t\th1: {name: \'Heading 1\'},\n\t\t\t\t\th2: {name: \'Heading 2\'},\n\t\t\t\t\th3: {name: \'Heading 3\'},\n\t\t\t\t\th4: {name: \'Heading 4\'}\n\t\t\t\t}\n\t\t\t}">\n\t\t\t§&nbsp;\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<button title="Alignment" class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand" bn-data="{\n\t\t\ttrigger: \'left\',\n\t\t\titems: {\n\t\t\t\tjustifyLeft: {name: \'Left\', icon: \'fas fa-align-left\'},\n\t\t\t\tjustifyCenter: {name: \'Center\', icon: \'fas fa-align-center\'},\n\t\t\t\tjustifyRight: {name: \'Right\', icon: \'fas fa-align-right\'}\n\t\t\t}\n\t\t}">\n\t\t\t<i class="fas fa-align-left"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<button class="w3-button" title="Text color" bn-control="brainjs.contextmenu"\n\t\t\tbn-data="{\n\t\t\t\titems: {\n\t\t\t\t\tblack: { name: \'Black\', icon: \'fas fa-square-full w3-text-black\' },\n\t\t\t\t\tred: { name: \'Red\', icon: \'fas fa-square-full w3-text-red\' },\n\t\t\t\t\tgreen: { name: \'Green\', icon: \'fas fa-square-full w3-text-green\' },\n\t\t\t\t\tblue: { name: \'Blue\', icon: \'fas fa-square-full w3-text-blue\' },\n\t\t\t\t\tyellow: { name: \'Yellow\', icon: \'fas fa-square-full w3-text-yellow\' },\n\t\t\t\t\tcyan: { name: \'Cyan\', icon: \'fas fa-square-full w3-text-cyan\' },\n\t\t\t\t\tpink: { name: \'Magenta\', icon: \'fas fa-square-full w3-text-pink\' }\n\t\t\t\t},\n\t\t\t\ttrigger: \'left\'\n\t\t\t}"\n\t\t\tbn-event="contextmenuchange: onColorMenuChange">\n\t\t\t<i class="fas fa-paint-brush"></i>\n\t\t</button>\n\n\t\t<span class="separator"></span>\n\t</div>\n\n\t<div class="group">\n\t\t<button title="Indent" class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand" bn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: {\n\t\t\t\t\tindent: {name: \'Indent\', icon: \'fas fa-indent\'},\n\t\t\t\t\toutdent: {name: \'Outdent\', icon: \'fas fa-outdent\'}\n\t\t\t\t}\n\t\t\t}">\n\t\t\t<i class="fas fa-indent"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\n\t\t<button title="List" class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand" bn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: {\n\t\t\t\t\tinsertUnorderedList: {name: \'Unordered\', icon: \'fas fa-list-ul\'},\n\t\t\t\t\tinsertOrderedList: {name: \'Ordered\', icon: \'fas fa-list-ol\'}\n\t\t\t\t}\n\t\t\t}">\n\t\t\t<i class="fas fa-list-ol"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<span class="separator"></span>\n\n\t</div>\n\n\t<div class="group">\n\t\t<button class="w3-button cmd" title="Horizontal Rule" data-cmd="insertHorizontalRule"><i class="fas fa-minus"></i></button>\n\t\t<button class="w3-button" title="Insert Link" bn-event="click: onCreateLink"><i class="fas fa-link"></i></button>\n\t\t<button title="Insert image" bn-event="click: onInsertImage" class="w3-button">\n\t\t\t<i class="fa fa-image"></i></button>\n\n\t</div>\n\n\n</div>\n\n\n</div>\n<div class="scrollPanel" bn-event="click: onScrollClick">\n\t<div contenteditable="true" bn-bind="editor" class="editor" bn-html="html"></div>\n</div>',deps:["breizbot.pager","breizbot.files"],init:function(t,e,n){const i={black:"#0",red:"#f44336",green:"#4CAF50",blue:"#2196F3",yellow:"#ffeb3b",cyan:"#00bcd4",pink:"#e91e63"},s=$$.viewController(t,{data:{html:t.val()},events:{onInsertImage:function(){const t=window.getSelection();if(!o(t.anchorNode))return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const i=t.getRangeAt(0);e.pushPage("breizbot.files",{title:"Insert Image",props:{filterExtension:"jpg,jpeg,png,gif"},events:{fileclick:function(t,n){e.popPage(n)}},onReturn:async function(t){const{fileName:e,rootDir:s}=t,o=n.fileUrl(s+e),r=await $$.util.imageUrlToDataUrl(o),a=document.createElement("img");a.src=r,i.insertNode(a)}})},onCreateLink:async function(){const t=window.getSelection();if(!o(t.anchorNode))return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const e=t.getRangeAt(0),n=await $$.ui.showPrompt({title:"Insert Link",label:"Link Target",attrs:{type:"url"}});console.log("href",n),null!=n&&(t.removeAllRanges(),t.addRange(e),document.execCommand("createLink",!1,n))},onScrollClick:function(){s.scope.editor.focus()},onCommand:function(t,e){let n,i;e?null!=(n=$(this).data("cmd"))?i=e.cmd:n=e.cmd:(n=$(this).data("cmd"),i=$(this).data("cmdArg")),document.execCommand(n,!1,i)},onColorMenuChange:function(t,e){document.execCommand("foreColor",!1,i[e.cmd])}}});function o(t){const e=s.scope.editor.get(0);for(;t&&t!=document.documentElement;){if(t==e)return!0;t=t.parentNode}return!1}this.html=function(t){if(null==t)return s.scope.editor.html();s.scope.editor.html(t)},this.load=function(t){return s.scope.editor.load(t)},this.insertImage=function(t){document.execCommand("insertImage",!1,t)},this.getValue=function(){return s.scope.editor.html()},this.setValue=function(t){s.scope.editor.html(t)},this.focus=function(){s.scope.editor.get(0).focus()}},$iface:"\n\t\thtml(htmlString): string;load(url);\n\t\tinsertImage(url)\n\t"}),function(){$$.control.registerControl("breizbot.files",{deps:["breizbot.files"],props:{selectionEnabled:!1,imageOnly:!1,filterExtension:void 0,getMP3Info:!1,friendUser:"",mp3Filters:null,menuItems:function(t){return{}}},template:'\n<div bn-text="info" bn-bind="info" class="info"></div>\n\n<div bn-show="loading" class="loading">\n\t<i class="fa fa-spinner fa-pulse"></i>\n\tloading ...\n</div>\n\n<div class="pathPanel" bn-event="click.pathItem: onPathItem" bn-show="!loading">\n\t<div bn-each="getPath" bn-index="idx">\n\t\t<i class="fa fa-chevron-right" bn-show="!isFirst"></i>\n\t\t<span>\n\t\t\t<a class="pathItem" bn-text="$scope.$i" href="#" bn-show="!isLast" bn-data="{info: getPathInfo}"></a>\n\t\t\t<span bn-text="$scope.$i" bn-show="isLast" class="lastItem"></span>\n\n\t\t</span>\n\t</div>\n\n\n</div>\n\n\n<div class="scrollPanel">\n\n\t<div \n\t\tbn-each="getFiles" \n\t\tbn-iter="f" \n\t\tbn-lazzy="10" \n\t\tbn-bind="files" \n\t\tbn-event="click.folder: onFolderClick, click.check: onCheckClick, click.file: onFileClick, contextmenuchange.thumbnail: onContextMenu"\n\t\tclass="container"\n\t>\n\n\t\t<div class="thumbnail w3-card-2" bn-control="brainjs.contextmenu" bn-data="{items: getItems}">\n\n\t\t\t<span bn-if="if1">\n\t\t\t\t<input type="checkbox" bn-show="selectionEnabled" class="check w3-check"\n\t\t\t\t\tbn-prop="{checked: $scope.f.checked}">\n\t\t\t</span>\n\t\t\t<div bn-if="$scope.f.folder" class="folder item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i class="fa fa-4x fa-folder-open w3-text-blue-grey"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate" bn-if="if1"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div bn-if="if2" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i bn-attr="{class: class1}"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bn-if="isMP3" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i bn-attr="{class: class1}"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<div>Title:&nbsp;<strong bn-text="$scope.f.mp3.title"></strong></div>\n\n\t\t\t\t\t<div>Artist:&nbsp;<strong bn-text="$scope.f.mp3.artist"></strong></div>\n\t\t\t\t\t<div bn-show="hasGenre">Genre:&nbsp;<strong bn-text="$scope.f.mp3.genre"></strong></div>\n\t\t\t\t\t<div bn-show="hasYear"> Year:&nbsp;<strong bn-text="getYear"></strong></div>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bn-if="if3" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<img bn-attr="{src: getThumbnailUrl}">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t\t<span bn-text="getDimension"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\n\n</div>',init:function(t,e){let n=!1,{selectionEnabled:i,filterExtension:s,friendUser:o,imageOnly:r,getMP3Info:a,mp3Filters:l,menuItems:c}=this.props;const u=$$.viewController(t,{data:{getItems:function(t){return c(t.f)},loading:!1,selectionEnabled:i,rootDir:"/",files:[],mp3Filters:l,info:function(){let t=0,e=0;this.getFiles().forEach(n=>{n.folder?".."!=n.name&&e++:t++});let n=[];return 1==e&&n.push(`${e} folder`),e>1&&n.push(`${e} folders`),1==t&&n.push(`${t} file`),t>1&&n.push(`${t} files`),n.join(" / ")},isInFilter:function(t){var e=!0;for(let n in this.mp3Filters){const i=t[n],s=this.mp3Filters[n];"All"!=s&&(e&=s===i)}return e},getFiles:function(){return null===this.mp3Filters?this.files:this.files.filter(t=>t.folder||t.mp3&&t.mp3&&this.isInFilter(t.mp3))},isMP3:function(t){return a&&null!=t.f.mp3&&null!=t.f.mp3.title&&""!=t.f.mp3.title},getPath:function(){const t=("/home"+this.rootDir).split("/");return t.shift(),t.pop(),t},isLast:function(t){return t.idx==this.getPath().length-1},isFirst:function(t){return 0==t.idx},getPathInfo:function(t){return this.getPath().slice(1,t.idx+1).join("/")},hasGenre:function(t){let{genre:e}=t.f.mp3;return null!=e&&""!=e&&!e.startsWith("(")},hasYear:function(t){let{year:e}=t.f.mp3;return null!=e&&""!=e},getYear:function(t){return parseInt(t.f.mp3.year)},getThumbnailUrl:function(t){return e.fileThumbnailUrl(this.rootDir+t.f.name,"100x?",o)},if1:function(t){return".."!=t.f.name},if2:function(t){return!t.f.folder&&!t.f.isImage&&!this.isMP3(t)},if3:function(t){return!t.f.folder&&t.f.isImage},class1:function(t){return`fa fa-4x w3-text-blue-grey ${e=t.f.name,(e=e.toLowerCase()).endsWith(".pdf")?"fa-file-pdf":e.endsWith(".hdoc")?"fa-file-word":e.endsWith(".ogg")||e.endsWith(".mp3")?"fa-file-audio":e.endsWith(".mp4")||e.endsWith(".webm")?"fa-file-video":e.endsWith(".zip")?"fa-file-archive":"fa-file"}`;var e},getSize:function(t){let e=t.f.size,n="octets";return e>1024&&(n="Ko",e/=1024),e>1024&&(n="Mo",e/=1024),"Size: "+(e=Math.floor(10*e)/10)+" "+n},getDimension:function(t){const e=t.f.dimension;return`Dimension: ${e.width}x${e.height}`},getDate:function(t){return"Last Modif: "+new Date(t.f.mtime).toLocaleDateString()}},events:{onPathItem:function(e){const n=$(this).data("info");e.preventDefault();const i=""==n?"/":"/"+n+"/";e.stopPropagation(),t.trigger("dirchange",{newDir:i}),d(i)},onContextMenu:async function(e,n){const{cmd:i}=n,s=$(this).closest(".thumbnail").index(),{name:o}=u.model.files[s],{rootDir:r}=u.model;e.stopPropagation(),t.trigger("contextmenuItem",{cmd:i,idx:s,name:o,rootDir:r})},onFileClick:function(e){const n=$(this).closest(".thumbnail").index(),i=u.model.getFiles()[n];e.stopPropagation();const s={fileName:i.name,rootDir:u.model.rootDir,isImage:i.isImage};t.trigger("fileclick",s)},onCheckClick:function(e){const n=$(this).closest(".thumbnail").index(),i=u.model.getFiles()[n];i.checked=$(this).getValue();let s=!1;"share"==i.name&&"/"==u.model.rootDir&&(s=$(this).getValue()),e.stopPropagation(),t.trigger("selchange",{isShareSelected:s})},onFolderClick:function(e){const n=$(this).closest(".thumbnail").index(),i=u.model.getFiles()[n].name;let s;if(".."==i){const t=u.model.rootDir.split("/");t.pop(),t.pop(),s=t.join("/")+"/"}else s=u.model.rootDir+i+"/";e.stopPropagation(),t.trigger("dirchange",{newDir:s}),d(s)}}});async function d(t,n){null==t&&(t=u.model.rootDir),u.setData({loading:!0});const i=await e.list(t,{filterExtension:s,imageOnly:r,getMP3Info:a},o);"/"!=t&&i.unshift({name:"..",folder:!0}),function(t){t.sort((t,e)=>t.folder&&!e.folder?-1:!t.folder&&e.folder?1:t.name.localeCompare(e.name))}(i),!1!==n&&(u.model.mp3Filters=null),u.setData({loading:!1,files:i,rootDir:t,nbSelection:0,isShareSelected:!1})}d(),this.getSelFiles=function(){const t=[];return u.model.files.forEach((e,n)=>{const{name:i,checked:s}=e;!0===s&&t.push({fileName:u.model.rootDir+i,idx:n})}),t},this.getSelFileNames=(()=>this.getSelFiles().map(t=>t.fileName)),this.getNbSelFiles=function(){return t.find(".check:checked").length},this.toggleSelection=function(){n=!n,t.find(".check").prop("checked",n),u.model.files.forEach(t=>{t.checked=n}),u.updateArrayValue("files","files"),n&&"/"==u.model.rootDir&&t.trigger("selchange",{isShareSelected:!0})},this.getRootDir=function(){return u.model.rootDir},this.insertFile=function(t,e){e?u.insertArrayItemAfter("files",e,t,"files"):(e=u.model.getFiles().filter(t=>t.folder).length,u.insertArrayItemAfter("files",e-1,t,"files")),u.updateNode("info")},this.removeFiles=function(t){t.reverse().forEach(t=>{u.removeArrayItem("files",t,"files")}),u.updateNode("info")},this.updateFile=function(t,e){u.updateArrayItem("files",t,e,"files")},this.updateFileInfo=async function(t,n){const{files:i,rootDir:s}=u.model;let r=u.model.getFiles().findIndex(e=>e.name==t);const a=await e.fileInfo(s+t,o,n);u.updateArrayItem("files",r,a),r=i.findIndex(e=>e.name==t),i[r]=a},this.getFiles=function(){return u.model.files.filter(t=>!t.folder)},this.getFilteredFiles=function(){return u.model.getFiles().filter(t=>!t.folder)},this.reload=function(){d(void 0,!1)},this.setMP3Filters=function(t){u.setData({mp3Filters:t})},this.getMP3Filters=function(){return u.model.mp3Filters}},$iface:"\n\t\t\treload();\n\t\t\tupdateFile(idx, fileInfo);\n\t\t\tinsertFile(fileInfo, idx);\n\t\t\tremoveFiles([number]);\n\t\t\tsetMP3Filters(mp3Filter);\n\t\t\tgetMP3Filters(): Mp3Filter;\n\t\t\tgetFiles(): [FileInfo];\n\t\t\tgetFilteredFiles(): [FileInfo];\n\t\t\tgetSelFiles(): [{fileName, idx}];\n\t\t\tgetSelFileNames() :[string];\n\t\t\tgetNbSelFiles(): number;\n\t\t\ttoggleSelection();\n\t\t\tgetRootDir(): string;\n\t\t",$events:"fileclick;contextmenuItem,selchnage,dirchange"})}(),$$.control.registerControl("breizbot.friends",{props:{showSelection:!1,showSendMessage:!1,showConnectionState:!0},deps:["breizbot.users","breizbot.broker"],template:'<ul class="w3-ul w3-border w3-white" bn-each="friends" bn-show="show1"\n\tbn-event="click.w3-bar: onItemClick, click.notif: onSendMessage">\n\t<li class="w3-bar" style="cursor: pointer;">\n\t\t\n\t\t<span class="w3-button w3-right notif w3-blue" title="Send Message" bn-show="showSendMessage">\n\t\t\t<i class="fa fa-envelope"></i>\n\t\t</span>\n\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-user" bn-class="class1"></i>\n\t\t\t<span bn-text="$scope.$i.friendUserName"></span>\n\t\t</div>\n\t</li>\n</ul>\n<p bn-show="show2">You have no friends</p>',init:function(t,e,n){const{showSelection:i,showSendMessage:s,showConnectionState:o}=this.props,r=$$.viewController(t,{data:{friends:[],showSendMessage:s,showConnectionState:o,show1:function(){return this.friends.length>0},show2:function(){return 0==this.friends.length},class1:function(t){const e=t.$i,n=this.showConnectionState;return{"w3-text-green":e.isConnected&&n,"w3-text-red":!e.isConnected&&n,"w3-text-blue":!n}}},events:{onItemClick:function(){const e=$(this).closest("li").index(),n=r.model.friends[e].friendUserName;i&&($(this).siblings(".w3-blue").removeClass("w3-blue"),$(this).addClass("w3-blue")),t.trigger("friendclick",{userName:n})},onSendMessage:async function(t){t.stopPropagation();const n=$(this).closest("li").index(),i=r.model.friends[n].friendUserName,s=await $$.ui.showPrompt({title:"Send Message",label:"Message:"});null!=s&&e.sendNotif(i,{text:s,reply:!0})}}});function a(t){if(!0===t.hist)return;const{isConnected:e,userName:n}=t.data;r.model.friends.find(t=>t.friendUserName==n).isConnected=e,r.update()}n.register("breizbot.friends",a),this.getSelection=function(){const e=t.find("li.w3-blue").index();return r.model.friends[e]},this.getFriends=function(){return r.model.friends.map(t=>t.friendUserName)},this.update=function(){e.getFriends().then(t=>{r.setData({friends:t})})},this.dispose=function(){console.log("[friends] dispose"),n.unregister("breizbot.friends",a)},this.update()},$iface:"\n\t\tgetSelection():string;\n\t\tgetFriends():[string]\n\t",$events:"friendclick"}),$$.control.registerControl("breizbot.home",{deps:["breizbot.broker","breizbot.users","breizbot.rtc","breizbot.apps","breizbot.scheduler"],props:{userName:"Unknown"},template:'<div class="header">\n\t<div>\n\t\t<button class="w3-button" title="FullScreen" bn-event="click: onFullScreen" bn-show="!fullScreen">\n\t\t\t<i class="fa fa-expand"></i></button>\n\t\t<button class="w3-button" title="Exit FullScreen" bn-event="click: onExitFullScreen" bn-show="fullScreen">\n\t\t\t<i class="fa fa-compress"></i></button>\n\t\t<button class="w3-button" title="Connection Status">\n\t\t\t<i bn-class="{w3-text-green: connected, w3-text-red: !connected}" class="fa fa-circle"></i>\n\n\t\t</button>\n\t\t<div bn-show="hasIncomingCall" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCallResponse"\n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\', \n\t\t\t\ttitle: callInfo.from,\n\t\t\t\titems: {\n\t\t\t\t\taccept: {name: \'Accept\'},\n\t\t\t\t\tdeny: {name: \'Decline\'},\n\t\t\t\t}\n\t\t\t}" class="w3-button">\n\t\t\t<i class="fa fa-spinner fa-pulse"></i>\n\t\t\t<i bn-attr="{class: callInfo.iconCls}"></i>\n\t\t</div>\n\t</div>\n\n\n\t\x3c!-- \t<strong bn-text="title"></strong>\n --\x3e\n\t<div>\n\t\t<button class="notification w3-button" title="Notification" bn-event="click: onNotification">\n\t\t\t<i class="fa fa-lg fa-bell"></i>\n\t\t\t<span class="w3-badge w3-red w3-tiny" bn-text="nbNotif" bn-show="hasNotif"></span>\n\t\t</button>\n\n\n\n\t\t<div bn-control="brainjs.contextmenu" bn-data="{\n\t\t\t\titems: {\n\t\t\t\t\tpwd: {name: \'Change password\', icon: \'fas fa-lock\'},\n\t\t\t\t\tapps: {name: \'Applications\', icon: \'fas fa-th\'},\n\t\t\t\t\tsep: \'------\',\n\t\t\t\t\tlogout: {name: \'Logout\', icon: \'fas fa-power-off\'}\n\t\t\t\t},\n\t\t\t\ttitle: userName,\n\t\t\t\ttrigger: \'left\'\n\t\t\t}" class="w3-button" bn-event="contextmenuchange: onContextMenu">\n\t\t\t<i class="fas fa-user-circle fa-lg"></i>\n\n\t\t</div>\n\n\t</div>\n\n\n</div>\n\n<div bn-control="brainjs.tabs" class="content" bn-iface="tabs"\n\tbn-event="tabsremove: onTabRemove, tabsactivate: onTabActivate">\n\t<div bn-control="breizbot.apps" bn-data="{\n\t\t\tapps: getMyApps,\n\t\t\titems\n\t\t}" bn-event="appclick: onAppClick, appcontextmenu: onTileContextMenu" title="Home">\n\t</div>\n\n</div>',init:function(t,e,n,i,s,o){i.processCall(),i.on("call",function(t){l.setData({hasIncomingCall:!0,callInfo:t}),a.play()}),i.on("cancel",function(){l.setData({hasIncomingCall:!1}),a.stop()});const{userName:r}=this.props,a=function(){let t=null;return{play:function(){(t=new Audio("/assets/skype.mp3")).loop=!0,setTimeout(()=>{t.play()},100)},stop:function(){null!=t&&t.pause(),t=null}}}(),l=$$.viewController(t,{data:{apps:[],userName:r,nbNotif:0,hasIncomingCall:!1,callInfo:null,fullScreen:!1,connected:!1,hasNotif:function(){return this.nbNotif>0},getMyApps:function(){return this.apps.filter(t=>t.activated)},items:function(){return{remove:{name:"Remove"}}}},events:{onTileContextMenu:async function(t,e){await n.activateApp(e.appName,!1),d()},onAppClick:function(t,e){u(e.appName)},onContextMenu:async function(t,e){if("logout"==e.cmd&&o.logout(),"apps"==e.cmd&&u("store"),"pwd"==e.cmd){const t=await $$.ui.showPrompt({title:"Change Password",label:"New Password:"});if(console.log("newPwd",t),null!=t)try{await n.changePwd(t),$$.ui.showAlert({title:"Change Password",content:"Password has been changed"})}catch(t){$$.ui.showAlert({title:"Error",content:t.responseText})}}},onNotification:function(t){0==l.model.nbNotif?$$.ui.showAlert({content:"no notifications",title:"Notifications"}):u("notif")},onCallResponse:function(t,e){const{cmd:n}=e;if(l.setData({hasIncomingCall:!1}),a.stop(),"accept"==n){const{from:t,appName:e}=l.model.callInfo;u(e,{caller:t,clientId:i.getRemoteClientId()})}"deny"==n&&i.deny()},onExitFullScreen:function(){document.exitFullscreen()},onFullScreen:function(t){const e=document.documentElement,n=e.requestFullscreen||e.webkitRequestFullscreen;n&&n.call(e)},onTabRemove:function(t,e){l.scope.tabs.getTabInfo(e).ctrlIface.onAppExit().then(()=>{l.scope.tabs.removeTab(e)})},onTabActivate:function(t,e){const{newTab:n,oldTab:i}=e,s=n.index(),o=i.index();if(o>0){l.scope.tabs.getTabInfo(o).ctrlIface.onAppSuspend()}if(s>0){l.scope.tabs.getTabInfo(s).ctrlIface.onAppResume()}0==s&&d()}}});function c(t){l.setData({nbNotif:t})}function u(t,e){const n=l.model.apps.find(e=>e.appName==t).props.title;let i=l.scope.tabs.getTabIndexFromTitle(n);const s=$$.util.getUrlParams(`/apps/${t}`,e);if(i<0)i=l.scope.tabs.addTab(n,{removable:!0,control:"breizbot.appTab",props:{appUrl:s}});else{const t=l.scope.tabs.getTabInfo(i);null!=e&&t.ctrlIface.setAppUrl(s)}l.scope.tabs.setSelectedTabIndex(i)}function d(){s.listAll().then(t=>{l.setData({apps:t})})}document.addEventListener("webkitfullscreenchange",function(t){console.log("fullscreenchange",t),l.setData({fullScreen:!l.model.fullScreen})}),document.addEventListener("fullscreenchange",function(t){console.log("fullscreenchange",t),l.setData({fullScreen:!l.model.fullScreen})}),e.on("connected",t=>{l.setData({connected:t})}),window.addEventListener("message",t=>{console.log("[home] message",t.data);const{type:e,data:n}=t.data;if("openApp"==e){const{appName:t,appParams:e}=n;u(t,e)}"reload"==e&&location.reload()},!1),e.register("breizbot.friends",t=>{if(!0===t.hist)return;const{isConnected:e,userName:n}=t.data;e?$.notify(`'${n}' is connected`,"success"):$.notify(`'${n}' is disconnected`,"error")}),e.register("breizbot.notifCount",function(t){c(t.data)}),e.onTopic("breizbot.logout",function(t){location.href="/logout"}),n.getNotifCount().then(c),d(),setInterval(function(){null!=p&&n.sendPosition({lat:p.latitude,lng:p.longitude})},3e4);let p=null;function f(t){p=t.coords}function h(){navigator.wakeLock&&navigator.wakeLock.request&&navigator.wakeLock.request("screen").then(t=>{console.log("take wakeLock"),t.addEventListener("release",()=>{console.log("Wake Lock was released")})}).catch(t=>{console.error("WakeLock",t)})}navigator.geolocation.getCurrentPosition(f),navigator.geolocation.watchPosition(f,function(t){console.log("geoloc error:",t)},{enableHighAccuracy:!0}),document.addEventListener("visibilitychange",function(){console.log("visibilitychange",document.visibilityState),"visible"===document.visibilityState&&h()}),h()}}),$$.control.registerControl("breizbot.pager",{props:{rootPage:""},template:'<div bn-show="showBack" class="toolbar">\n\t<div class="left">\n\t\t<button class="w3-button" title="Back" bn-event="click: onBack">\n\t\t\t<i class="fa fa-arrow-left"></i>\n\t\t</button>\n\t\t<span bn-text="title" class="title"></span>\n\t\n\t</div>\n\t<div bn-each="buttons" class="right" bn-event="click.action: onAction, contextmenuchange.menu: onContextMenu">\n\t\t<button bn-show="show1" class="w3-button action" bn-text="$scope.$i.label"\n\t\t\tbn-data="{cmd: $scope.$i.name}" bn-prop="{disabled: !isEnabled}"></button>\n\t\t<button bn-show="show2" class="w3-button action" bn-data="{cmd: $scope.$i.name}"\n\t\t\tbn-attr="{title: $scope.$i.title}" bn-prop="{disabled: !isEnabled}"><i bn-attr="{class: $scope.$i.icon}"></i></button>\n\n\t\t\t<button bn-show="show3" class="w3-button menu" \n\t\t\tbn-prop="{disabled: !isEnabled}"\n\t\t\tbn-control="brainjs.contextmenu" bn-data="{items: $scope.$i.items, trigger: \'left\', cmd: $scope.$i.name}"\n\t\t\tbn-attr="{title: $scope.$i.title}"><i bn-attr="{class: $scope.$i.icon}"></i></button>\n\t\t</div>\t\t\t\n\t</div>\n</div>\n<div bn-bind="content" class="content"></div>',$iface:"\n\t\tpopPage(data)\n\t\tpushPage(ctrlName, options)\n\t\tsetButtonVisible(buttonsVisible: {[buttonName]:boolean})\n\t\tsetButtonEnabled(buttonsEnabled: {[buttonName]:boolean})\n\t",init:function(t){const{rootPage:e}=this.props,n=$$.viewController(t,{data:{showBack:!1,title:"",buttons:[],show1:function(t){return null==t.$i.items&&null==t.$i.icon&&!(!1===t.$i.visible)},show2:function(t){return null==t.$i.items&&null!=t.$i.icon&&!(!1===t.$i.visible)},show3:function(t){return null!=t.$i.items&&!(!1===t.$i.visible)},isEnabled:t=>null==t.$i.enabled||!0===t.$i.enabled},events:{onBack:function(t){r(!0)},onAction:function(t){const e=$(this).data("cmd"),n=o.ctrl.iface(),i=o.buttons[e].onClick;"function"==typeof i&&i.call(n)},onContextMenu:function(t,e){console.log("onContextMenu",e);const n=$(this).data("cmd"),i=o.ctrl.iface();console.log("onAction",n);const s=o.buttons[n].onClick;"function"==typeof s&&s.call(i,e.cmd)}}}),i=n.scope.content,s=[];let o=null;function r(t,e){o.ctrl.iface();o.ctrl.safeEmpty().remove(),t?"function"==typeof o.onBack&&o.onBack():"function"==typeof o.onReturn&&o.onReturn(e),(o=s.pop()).ctrl.show();const{title:i,buttons:r}=o;n.setData({showBack:s.length>0,title:i,buttons:$$.util.objToArray(r,"name")})}this.popPage=function(t){return r(!1,t)},this.pushPage=function(t,e){null!=o&&(o.ctrl.hide(),s.push(o)),e=e||{};let{title:r,props:a,onReturn:l,onBack:c,events:u}=e;const d=i.addControl(t,$.extend({$pager:this},a),u);let p={};if(null!=e.buttons)p=e.buttons;else{const t=d.iface().getButtons;"function"==typeof t&&(p=t())}o={title:r,buttons:p,onReturn:l,onBack:c,ctrl:d},n.setData({showBack:s.length>0,title:r,buttons:$$.util.objToArray(p,"name")})},this.setButtonVisible=function(t){const{buttons:e}=o;for(let n in t)n in e&&(e[n].visible=t[n]);n.setData({buttons:$$.util.objToArray(e,"name")})},this.setButtonEnabled=function(t){const{buttons:e}=o;for(let n in t)n in e&&(e[n].enabled=t[n]);n.setData({buttons:$$.util.objToArray(e,"name")})},this.pushPage(e)}}),$$.control.registerControl("breizbot.pdf",{template:'<div class="toolbar">\n\t<div bn-show="wait" class="loading">\n\t\t<i class="fa fa-spinner fa-pulse"></i> Rendering...\n\t</div>\n\t<div bn-show="!wait">\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Fit" \n\t\t\tbn-event="click: onFit">\n\t\t\t\t<i class="fa fa-expand"></i>\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Print" \n\t\t\tbn-event="click: onPrint">\n\t\t\t\t<i class="fa fa-print"></i>\n\t\t</button>\t\t\n\t</div>\n\t<div>\n\t</div>\n\t<div class="pages" bn-show="show1">\n\t\t<div>\n\t\t\t<button class="w3-button" title="previous page" bn-event="click: onPrevPage">\n\t\t\t\t<i class="fa fa-angle-left"></i>\n\t\t\t</button>\t\n\n\t\t\t<button class="w3-button" title="next page" bn-event="click: onNextPage">\n\t\t\t\t<i class="fa fa-angle-right"></i>\n\t\t\t</button>\t\t\t\n\t\t</div>\n\t\t<div>\n\t\t\tPages: <span bn-text="currentPage"></span> / <span bn-text="numPages"></span>\t\t\n\t\t</div>\n\t</div>\n</div>\n\t\n<div bn-control="brainjs.pdf" \n\tbn-data="{worker: \'/brainjs/pdf/worker.js\'}"\n\tbn-iface="pdf"\n\t \n></div>\t\t\n',props:{url:""},deps:["breizbot.files"],init:function(t,e){const{url:n}=this.props,i=$$.viewController(t,{data:{numPages:0,title:"",currentPage:1,wait:!1,show1:function(){return this.numPages>1&&!this.wait}},events:{onPrint:function(){i.scope.pdf.print()},onNextPage:async function(t){i.setData({wait:!0});const e=await i.scope.pdf.nextPage();i.setData({currentPage:e,wait:!1})},onPrevPage:async function(t){i.setData({wait:!0});const e=await i.scope.pdf.prevPage();i.setData({currentPage:e,wait:!1})},onFit:function(t){i.scope.pdf.fit()}}});async function s(t,e){i.setData({wait:!0});const n=await i.scope.pdf.openFile(t);console.log("file loaded"),i.setData({title:e,numPages:n,wait:!1})}""!=n&&s(n),this.setData=function(t){console.log("setData",t),null!=t.url&&s(t.url)}},$iface:"\n\t\tsetData({url})\n\t"}),$$.control.registerControl("breizbot.rtc",{deps:["breizbot.rtc","breizbot.pager"],props:{appName:"",iconCls:"",title:"Select a friend"},init:function(t,e,n){const{appName:i,iconCls:s,title:o}=this.props,r=t.children().remove();t.append('<div class="toolbar">\n\n\t\t<div class="status">\n\t\t\t<p>Status: <span bn-text="status"></span></p>\n\t\t</div>\t\t\n\n\t\t<div>\n\t\t\t<button \n\t\t\t\ttitle="Call a friend" \n\t\t\t\tbn-event="click: onCall"\n\t\t\t\tbn-show="show1"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone"></i></button>\n\n\t\t\t<button \n\t\t\t\tbn-event="click: onCancel"\n\t\t\t\ttitle="Cancel"\n\t\t\t\tbn-show="show2"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone-slash"></i></button>\n\n\t\t\t<button \n\t\t\t\ttitle="Hangup" \n\t\t\t\tbn-event="click: onHangup"\n\t\t\t\tbn-show="show3"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone-slash"></i></button>\t\t\t\n\t\t</div>\n\n\n</div>\n<div bn-show="show4" bn-bind="panel" class="panel"></div>'),e.on("status",t=>{a.setData(t)});const a=$$.viewController(t,{data:{status:"ready",distant:"",hasChildren:r.length>0,show1:function(){return["ready","disconnected","refused","canceled"].includes(this.status)},show2:function(){return"calling"==this.status},show3:function(){return"connected"==this.status},show4:function(){return"connected"==this.status&&this.hasChildren}},events:{onCall:function(t){console.log("onCall"),n.pushPage("breizbot.friends",{title:o,props:{showSelection:!0},buttons:{call:{title:"Call",icon:"fa fa-check",onClick:function(){const t=this.getSelection();if(null==t)return void $$.ui.showAlert({title:"Error",content:"Please select a friend"});const{friendUserName:e,isConnected:i}=t;console.log("userName",e),i?n.popPage(e):$$.ui.showAlert({title:"Error",content:`User <strong>${e}</strong> is not connected`})}}},onReturn:function(t){e.call(t,i,s)}})},onCancel:function(t){e.cancel()},onHangup:function(n){e.bye(),t.trigger("rtchangup")}}});a.scope.panel.append(r)}}),$$.control.registerControl("breizbot.searchbar",{template:'<form bn-event="submit: onSearch" bn-bind="form">\n\t<input type="search" \n        name="value" \n        bn-attr="{placeholder}"\n\t\trequired="" \n\t\tbn-control="brainjs.input">\n\t<button class="w3-button w3-text-blue" type="submit" ><i class="fa fa-search"></i></button>\n</form>',props:{placeholder:""},init:function(t){const{placeholder:e}=this.props,n=$$.viewController(t,{data:{placeholder:e},events:{onSearch:async function(e){e.preventDefault();const{value:n}=$(this).getFormData();t.trigger("searchbarsubmit",{value:n})}}});this.setValue=function(t){n.scope.form.setFormData({value:t})}},$iface:"\n        setValue(value: string)\n    ",$events:"searchbarsubmit"}),$$.control.registerControl("breizbot.addUser",{template:'<form bn-event="submit: onSubmit">\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>UserName</label>\n\t\t<input type="text" placeholder="username" name="username" required="">\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Pseudo</label>\n\t\t<input type="text" placeholder="pseudo" name="pseudo" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Location</label>\n\t\t<input type="text" placeholder="location" name="location" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Email</label>\n\t\t<input type="email" placeholder="email" name="email" required>\t\n\t</div>\n\t\n\t<input type="submit" hidden="" bn-bind="submit">\n</form>\n',props:{$pager:null},init:function(t){const{$pager:e}=this.props,n=$$.viewController(t,{data:{},events:{onSubmit:function(t){t.preventDefault(),e.popPage($(this).getFormData())}}});this.getButtons=function(){return{create:{title:"Create",icon:"fa fa-check",onClick:function(){n.scope.submit.click()}}}}}}),$$.control.registerControl("breizbot.users",{deps:["breizbot.users"],template:'<div class="toolbar">\n\t<button bn-event="click: onUpdate" class="w3-btn w3-blue" title="Update">\n\t\t<i class="fa fa-redo"></i>\n\t</button>\t\n\t<button bn-event="click: onAddUser" class="w3-btn w3-blue btnAddUser" title="Add User">\n\t\t<i class="fa fa-user-plus"></i>\n\t</button>\t\n</div>\n\n<div class="scrollPanel">\n    <table class="w3-table-all w3-small">\n        <thead>\n            <tr class="w3-green">\n                <th>User Name</th>\n                <th>Pseudo</th>\n                <th>Location</th>\n                <th>Email</th>\n                <th>Create Date</th>\n                <th>Last Login Date</th>\n                <th>Actions</th>\n            </tr>\n        </thead>\n        <tbody bn-each="data" bn-event="click.delete: onDelete, click.notif: onNotif">\n  \t\t\t<tr>\n\t\t\t\t<td bn-text="$scope.$i.username"></td>\n\t\t\t\t<td bn-text="$scope.$i.pseudo"></td>\n\t\t\t\t<td bn-text="$scope.$i.location"></td>\n\t\t\t\t<td bn-text="$scope.$i.email"></td>\n\t\t\t\t<td >\n\t\t\t\t\t<span bn-text="text1" bn-show="show1"></span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<span bn-show="show2">\n\n\t\t\t\t\t\t<span bn-text="text2"></span><br>\n\t\t\t\t\t\tat \n\t\t\t\t\t\t<span bn-text="text3"></span>\n\t\t\t\t\t</span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button class="delete w3-btn w3-blue" title="Delete User">\n\t\t\t\t\t\t<i class="fa fa-trash"></i>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="notif w3-btn w3-blue" title="Send Notification">\n\t\t\t\t\t\t<i class="fa fa-bell"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>      \t\n\n        </tbody>\n    </table>\n</div>',props:{$pager:null},init:function(t,e){const{$pager:n}=this.props,i=$$.viewController(t,{data:{data:[],text1:function(t){return new Date(t.$i.createDate).toLocaleDateString("fr-FR")},text2:function(t){return new Date(t.$i.lastLoginDate).toLocaleDateString("fr-FR")},text3:function(t){return new Date(t.$i.lastLoginDate).toLocaleTimeString("fr-FR")},show1:function(t){return null!=t.$i.createDate},show2:function(t){return null!=t.$i.lastLoginDate&&0!=t.$i.lastLoginDate}},events:{onAddUser:function(t){n.pushPage("breizbot.addUser",{title:"Add User",onReturn:async function(t){await e.add(t),s()}})},onDelete:function(t){const n=$(this).closest("tr").index(),{username:o}=i.model.data[n];$$.ui.showConfirm({title:"Delete User",content:"Are you sure ?"},async function(){await e.remove(o),s()})},onNotif:async function(t){const n=$(this).closest("tr").index(),{username:s}=i.model.data[n],o=await $$.ui.showPrompt({title:"Send Notification",label:"Message"});null!=o&&e.sendNotif(s,{text:o})},onUpdate:function(){s()}}});async function s(){const t=await e.list();console.log("getUsers",t),i.setData({data:t})}s()}}),$$.control.registerControl("breizbot.viewer",{deps:["breizbot.files"],template:'<div bn-if="isImage">\n\t<div \n\t\tclass="image" \n\t\tbn-control="brainjs.image" \n\t\tbn-data="{src: url}" \n\t\t\n\t\tstyle="height: 100%">\n\t\t\t\n\t\t</div>\n\t\n</div>\n\n\n<div bn-if="isPdf">\n\t<div \n\t\tclass="pdf" \n\t\tbn-control="breizbot.pdf" \n\t\tbn-data="{url}" \n\t\t\n\t\tstyle="height: 100%">\n\t\t\t\n\t\t</div>\t\t\n</div>\n\n<div bn-if="isAudio" class="audio">\n\t<audio bn-attr="{src: url}" controls="" controlsList=nodownload></audio>\n</div>\n\n<div bn-if="isVideo" class="video">\n\t<video bn-attr="{src: url}" controls="" controlsList=nodownload></video>\n</div>\n\n<div bn-if="isDoc" class="doc">\n\t<div class="scrollPanel">\n\t\t<div bn-load="url" class="html"></div>\n\t</div>\n</div>',props:{type:"",url:"#"},init:function(t,e){let{type:n,url:i}=this.props;const s=$$.viewController(t,{data:{url:i,type:n,isImage:function(){return"image"==this.type},isPdf:function(){return"pdf"==this.type},isAudio:function(){return"audio"==this.type},isVideo:function(){return"video"==this.type},isDoc:function(){return"hdoc"==this.type}}});this.setData=function(t){t.url&&s.setData({url:t.url})}},$iface:"\n\t\tsetData({url: string})\n\t\t"}),$$.service.registerService("breizbot.appData",{deps:["brainjs.http"],init:function(t,e){let n=t;return{getData:function(){return n},saveData:function(t){return n=t,e.post("/api/appData",t)}}},$iface:"\n\t\tgetData():Data;\n\t\tsaveData(data):Promise \n\t\t"}),$$.service.registerService("breizbot.apps",{deps:["brainjs.http"],init:function(t,e){return{listAll:function(){return e.get("/api/apps/all")}}},$iface:"\n\t\tlistAll():Promise;\n\t\t"}),function(){class t extends EventEmitter2{constructor(){super(),this.sock=null,this.isConnected=!1,this.tryReconnect=!0,this.isPingOk=!0,this.topics=new EventEmitter2({wildcard:!0}),this.pingInterval=1e4,this.timeoutId=void 0,this.registeredTopics={};let{host:t,pathname:e,protocol:n}=location;n="http:"==n?"ws:":"wss:",this.url=`${n}//${t}/hmi${e}`}checkPing(){this.timeoutId=setTimeout(()=>{this.isPingOk?(this.isPingOk=!1,this.sendMsg({type:"ping"}),this.checkPing()):(console.log("timeout ping"),this.sock.onmessage=null,this.sock.onclose=null,this.sock.close(),this.onClose())},this.pingInterval)}onClose(){this.isConnected&&(console.log("[Broker] Disconnected !"),this.emit("connected",!1)),this.isConnected=!1,this.tryReconnect&&setTimeout(()=>{this.connect()},5e3)}connect(){console.log("try to connect..."),this.sock=new WebSocket(this.url),this.sock.onopen=(()=>{console.log("Connected to broker"),this.isConnected=!0,this.isPingOk=!0,this.emit("connected",!0),this.checkPing()}),this.sock.onmessage=(t=>{const e=JSON.parse(t.data);if(t.currentTarget!=this.sock)return console.log("[broker] message bad target",e.type),void t.currentTarget.close();"ready"==e.type&&(Object.keys(this.registeredTopics).forEach(t=>{this.sendMsg({type:"register",topic:t})}),this.emit("ready",{clientId:e.clientId})),"pong"==e.type&&(this.isPingOk=!0),"notif"==e.type&&this.topics.emit(e.topic,e),"error"==e.type&&(console.log("[Broker] log",e.text),this.tryReconnect=!1,this.sock.close())}),this.sock.onclose=(t=>{t.currentTarget==this.sock?(console.log("[broker] close"),null!=this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.onClose()):console.log("[broker] close bad target")})}sendMsg(t){t.time=Date.now();var e=JSON.stringify(t);this.isConnected&&this.sock.send(e)}emitTopic(t,e){var n={type:"notif",topic:t,data:e};this.sendMsg(n)}onTopic(t,e){this.topics.on(t,e)}register(t,e){null==this.registeredTopics[t]?this.registeredTopics[t]=1:this.registeredTopics[t]++,this.topics.on(t,e),this.sendMsg({type:"register",topic:t})}unregister(t,e){this.topics.off(t,e),0==--this.registeredTopics[t]&&(delete this.registeredTopics[t],this.sendMsg({type:"unregister",topic:t}))}}$$.service.registerService("breizbot.broker",{init:function(e){const n=new t;return n.connect(),n},$iface:"\n\t\t\temitTopic(topicName, data);\n\t\t\tregister(topicName, callback);\n\t\t\tunregister(topicName, callback);\n\t\t\tonTopic(topicName, callback)\n\n\t\t"})}(),$$.service.registerService("breizbot.cities",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/cities");return{getCountries:function(){return n.get("/countries")},getCities:function(t,e){return n.post("/cities",{country:t,search:e})}}},$iface:"\n\t\tgetCountries():Promise;\n\t\tgetCities(country, search):Promise;\n\t\t"}),$$.service.registerService("breizbot.files",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/files");return{fileInfo:function(t,e,i){return console.log("[FileService] fileInfo",t,e,i),n.post("/fileInfo",{filePath:t,friendUser:e,options:i})},list:function(t,e,i){return console.log("[FileService] list",t),n.post("/list",{destPath:t,options:e,friendUser:i})},fileUrl:function(t,e){return $$.util.getUrlParams("/api/files/load",{fileName:t,friendUser:e})},fileThumbnailUrl:function(t,e,n){return $$.util.getUrlParams("/api/files/loadThumbnail",{fileName:t,size:e,friendUser:n})},uploadFile:function(t,e,i,s){if(console.log("[FileService] uploadFile",e,i),!(t instanceof Blob))return console.warn("File format not supported"),Promise.reject("File format not supported");var o=new FormData;return o.append("file",t,e),o.append("destPath",i),n.postFormData("/save",o,s)}}},$iface:"\n\t\tlist(path, options, friendUser):Promise<[FileInfo]>;\n\t\tfileInfo(filePath, friendUser, options):Promise<FileInfo>\n\t\tfileUrl(fileName, friendUser):string;\n\t\tfileThumbnailUrl(fileName, size, friendUser):string;\n\t\tuploadFile(blob, saveAsfileName, destPath, onUploadProgress):Promise;\n\t"}),$$.service.registerService("breizbot.http",{deps:["brainjs.resource","breizbot.params"],init:function(t,e,n){return e(`/api/app/${n.$appName}`)}}),$$.service.registerService("breizbot.pager",{init:function(t){return $(".breizbotPager").iface()}}),$$.service.registerService("breizbot.params",{init:function(t){return"string"==typeof t?JSON.parse(t):{}}}),function(){class t extends EventEmitter2{constructor(t,e,n){super(),this.broker=t,this.http=e,this.srdId=void 0,this.destId=void 0,this.distant="",this.status="ready",this.isCallee=!1,null!=n.caller&&(this.status="connected",this.distant=n.caller,this.destId=n.clientId,this.isCallee=!0),t.on("ready",t=>{this.srcId=t.clientId,this.emit("ready")}),t.onTopic("breizbot.rtc.accept",t=>{!0!==t.hist&&(console.log("msg",t),this.cancel(!1),this.destId=t.srcId,this.status="connected",this.emitStatus(),this.emit("accept"))}),t.onTopic("breizbot.rtc.deny",t=>{!0!==t.hist&&(console.log("msg",t),this.status="refused",this.cancel(!1),this.emitStatus(),this.emit("deny"))}),t.onTopic("breizbot.rtc.bye",t=>{!0!==t.hist&&(console.log("msg",t),this.status="disconnected",this.emitStatus(),this.emit("bye"))})}getRemoteClientId(){return this.destId}processCall(){console.log("[RTC] processCall"),this.broker.register("breizbot.rtc.call",t=>{!0!==t.hist&&(console.log("msg",t),this.destId=t.srcId,this.emit("call",t.data))}),this.broker.register("breizbot.rtc.cancel",t=>{!0!==t.hist&&(console.log("msg",t),this.emit("cancel"))})}onData(t,e){this.broker.onTopic("breizbot.rtc."+t,t=>{!0!==t.hist&&e(t.data,t.time)})}emitStatus(){this.emit("status",{status:this.status,distant:this.distant})}call(t,e,n){return this.distant=t,this.status="calling",this.emitStatus(),this.http.post("/api/rtc/sendToUser",{to:t,srcId:this.srcId,type:"call",data:{appName:e,iconCls:n}})}cancel(t=!0){return console.log("[RTC] cancel",t),t&&(this.status="canceled",this.emitStatus()),this.http.post("/api/rtc/sendToUser",{to:this.distant,srcId:this.srcId,type:"cancel"})}accept(){return console.log("[RTC] accept"),this.emitStatus(),this.sendData("accept")}deny(){return console.log("[RTC] deny"),this.sendData("deny")}bye(){return console.log("[RTC] bye"),"connected"==this.status?(this.status="ready",this.distant="",this.emitStatus(),this.sendData("bye")):Promise.resolve()}exit(){return"calling"==this.status?this.cancel():"connected"==this.status?this.bye():Promise.resolve()}sendData(t,e){return this.http.post("/api/rtc/sendToClient",{destId:this.destId,srcId:this.srcId,type:t,data:e})}}$$.service.registerService("breizbot.rtc",{deps:["brainjs.http","breizbot.broker","breizbot.params"],init:function(e,n,i,s){return new t(i,n,s)},$iface:"\n\t\tcall(to):Promise;\n\t\tcancel(to):Promise;\n\t\tdeny():Promise;\n\t\tbye():Promise;\n\t\tsendData(type, data):Promise;\n\t\tonData(callback(data, time))\n\t"})}(),$$.service.registerService("breizbot.scheduler",{deps:["brainjs.http"],init:function(t,e){return{openApp:function(t,e){console.log("[scheduler] openApp",t,e),window.parent.postMessage({type:"openApp",data:{appName:t,appParams:e}},location.href)},logout:function(){return console.log("[scheduler] logout"),e.post("/api/logout")}}},$iface:"\n\t\topenApp(appName, appParams);\n\t\tlogout()\n\t\t"}),$$.service.registerService("breizbot.users",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/users");return{list:function(){return n.get("/")},match:function(t){return n.get("/",{match:t})},add:function(t){return n.post("/",t)},remove:function(t){return n.delete(`/${t}`)},update:function(t,e){return n.put(`/${t}`,e)},get:function(t){return n.get(`/${t}`)},activateApp:function(t,e){return n.post("/activateApp",{appName:t,activated:e})},sendNotif:function(t,e){return n.post("/sendNotif",{to:t,notif:e})},removeNotif:function(t){return n.delete(`/removeNotif/${t}`)},getNotifs:function(){return n.get("/getNotifs")},getNotifCount:function(){return n.get("/getNotifCount")},getSharingGroups:function(){return n.get("/getSharingGroups")},addSharingGroup:function(t){return n.post("/addSharingGroup",{sharingGroupName:t})},getFriends:function(){return n.get("/getFriends")},getFriendInfo:function(t){return n.post("/getFriendInfo",{friend:t})},setFriendInfo:function(t,e,i){return n.post("/setFriendInfo",{friend:t,groups:e,positionAuth:i})},addFriend:function(t){return n.post("/addFriend",{friendUserName:t})},changePwd:function(t){return n.post("/changePwd",{newPwd:t})},addContact:function(t,e){return n.post("/addContact",{name:t,email:e})},getContacts:function(){return n.get("/getContacts")},removeContact:function(t){return n.delete(`/removeContact/${t}`)},sendPosition:function(t){return n.post("/position",t)}}},$iface:"\n\t\tlist():Promise;\n\t\tadd(data):Promise;\n\t\tremove(user):Promise;\n\t\tupdate(user, data):Promise;\n\t\tget(user):Promise;\n\t\tactivateApp(appName, activated):Promise;\n\t\tsendNotif(to, notif):Promise;\n\t\tremoveNotif(notifId):Promise;\n\t\tgetNotifs():Promise;\n\t\tgetNotifCount():Promise;\n\t\tgetFriends():Promise;\n\t\taddFriend(friendUserName):Promise;\n\t\tchangePwd(newPwd):Promise;\n\t\taddContact(name, email):Promise;\n\t\tgetContacts():Promise(contacts);\n\t\tremoveContact(contactId):Promise;\n\t\tsendPosition(coords):Promise\n\t"});