!function(t){var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=10;function i(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==t?e.maxListeners:n,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=n}function o(t,e){var n="(node) warning: possible EventEmitter memory leak detected. "+t+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+e+"."),"undefined"!=typeof process&&process.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=t,process.emitWarning(i)}else console.error(n),console.trace&&console.trace()}function r(t){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,s.call(this,t)}function a(t,e,n,i){if(!n)return[];var s,o,r,l,c,p,f,u=[],d=e.length,h=e[i],m=e[i+1];if(i===d&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(s=0,o=n._listeners.length;s<o;s++)t&&t.push(n._listeners[s]);return[n]}if("*"===h||"**"===h||n[h]){if("*"===h){for(r in n)"_listeners"!==r&&n.hasOwnProperty(r)&&(u=u.concat(a(t,e,n[r],i+1)));return u}if("**"===h){for(r in(f=i+1===d||i+2===d&&"*"===m)&&n._listeners&&(u=u.concat(a(t,e,n,d))),n)"_listeners"!==r&&n.hasOwnProperty(r)&&("*"===r||"**"===r?(n[r]._listeners&&!f&&(u=u.concat(a(t,e,n[r],d))),u=u.concat(a(t,e,n[r],i))):u=r===m?u.concat(a(t,e,n[r],i+2)):u.concat(a(t,e,n[r],i)));return u}u=u.concat(a(t,e,n[h],i+1))}if((l=n["*"])&&a(t,e,l,i+1),c=n["**"])if(i<d)for(r in c._listeners&&a(t,e,c,d),c)"_listeners"!==r&&c.hasOwnProperty(r)&&(r===m?a(t,e,c[r],i+2):r===h?a(t,e,c[r],i+1):((p={})[r]=c[r],a(t,e,{"**":p},i+1)));else c._listeners?a(t,e,c,d):c["*"]&&c["*"]._listeners&&a(t,e,c["*"],d);return u}r.EventEmitter2=r,r.prototype.delimiter=".",r.prototype.setMaxListeners=function(e){e!==t&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},r.prototype.event="",r.prototype.once=function(t,e){return this._once(t,e,!1)},r.prototype.prependOnceListener=function(t,e){return this._once(t,e,!0)},r.prototype._once=function(t,e,n){return this._many(t,1,e,n),this},r.prototype.many=function(t,e,n){return this._many(t,e,n,!1)},r.prototype.prependMany=function(t,e,n){return this._many(t,e,n,!0)},r.prototype._many=function(t,e,n,i){var s=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function o(){return 0==--e&&s.off(t,o),n.apply(this,arguments)}return o._origin=n,this._on(t,o,i),s},r.prototype.emit=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;var e,n,s,o,r,l=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),l>3)for(e=new Array(l),o=0;o<l;o++)e[o]=arguments[o];for(s=0,n=r.length;s<n;s++)switch(this.event=t,l){case 1:r[s].call(this,t);break;case 2:r[s].call(this,t,arguments[1]);break;case 3:r[s].call(this,t,arguments[1],arguments[2]);break;default:r[s].apply(this,e)}}if(this.wildcard){r=[];var c="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,c,this.listenerTree,0)}else{if("function"==typeof(r=this._events[t])){switch(this.event=t,l){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(e=new Array(l-1),o=1;o<l;o++)e[o-1]=arguments[o];r.apply(this,e)}return!0}r&&(r=r.slice())}if(r&&r.length){if(l>3)for(e=new Array(l-1),o=1;o<l;o++)e[o-1]=arguments[o];for(s=0,n=r.length;s<n;s++)switch(this.event=t,l){case 1:r[s].call(this);break;case 2:r[s].call(this,arguments[1]);break;case 3:r[s].call(this,arguments[1],arguments[2]);break;default:r[s].apply(this,e)}return!0}if(!this._all&&"error"===t)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},r.prototype.emitAsync=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var e,n,s,o,r,l=[],c=arguments.length;if(this._all){if(c>3)for(e=new Array(c),o=1;o<c;o++)e[o]=arguments[o];for(s=0,n=this._all.length;s<n;s++)switch(this.event=t,c){case 1:l.push(this._all[s].call(this,t));break;case 2:l.push(this._all[s].call(this,t,arguments[1]));break;case 3:l.push(this._all[s].call(this,t,arguments[1],arguments[2]));break;default:l.push(this._all[s].apply(this,e))}}if(this.wildcard){r=[];var p="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,p,this.listenerTree,0)}else r=this._events[t];if("function"==typeof r)switch(this.event=t,c){case 1:l.push(r.call(this));break;case 2:l.push(r.call(this,arguments[1]));break;case 3:l.push(r.call(this,arguments[1],arguments[2]));break;default:for(e=new Array(c-1),o=1;o<c;o++)e[o-1]=arguments[o];l.push(r.apply(this,e))}else if(r&&r.length){if(r=r.slice(),c>3)for(e=new Array(c-1),o=1;o<c;o++)e[o-1]=arguments[o];for(s=0,n=r.length;s<n;s++)switch(this.event=t,c){case 1:l.push(r[s].call(this));break;case 2:l.push(r[s].call(this,arguments[1]));break;case 3:l.push(r[s].call(this,arguments[1],arguments[2]));break;default:l.push(r[s].apply(this,e))}}else if(!this._all&&"error"===t)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(l)},r.prototype.on=function(t,e){return this._on(t,e,!1)},r.prototype.prependListener=function(t,e){return this._on(t,e,!0)},r.prototype.onAny=function(t){return this._onAny(t,!1)},r.prototype.prependAny=function(t){return this._onAny(t,!0)},r.prototype.addListener=r.prototype.on,r.prototype._onAny=function(t,e){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),e?this._all.unshift(t):this._all.push(t),this},r.prototype._on=function(e,n,s){if("function"==typeof e)return this._onAny(e,n),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");return this._events||i.call(this),this.emit("newListener",e,n),this.wildcard?(function(e,n){for(var i=0,s=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;i+1<s;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var r=this.listenerTree,a=e.shift();a!==t;){if(r[a]||(r[a]={}),r=r[a],0===e.length)return r._listeners?("function"==typeof r._listeners&&(r._listeners=[r._listeners]),r._listeners.push(n),!r._listeners.warned&&this._maxListeners>0&&r._listeners.length>this._maxListeners&&(r._listeners.warned=!0,o.call(this,r._listeners.length,a))):r._listeners=n,!0;a=e.shift()}return!0}.call(this,e,n),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),s?this._events[e].unshift(n):this._events[e].push(n),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,o.call(this,this._events[e].length,e))):this._events[e]=n,this)},r.prototype.off=function(n,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");var s,o=[];if(this.wildcard){var r="string"==typeof n?n.split(this.delimiter):n.slice();o=a.call(this,null,r,this.listenerTree,0)}else{if(!this._events[n])return this;s=this._events[n],o.push({_listeners:s})}for(var l=0;l<o.length;l++){var c=o[l];if(s=c._listeners,e(s)){for(var p=-1,f=0,u=s.length;f<u;f++)if(s[f]===i||s[f].listener&&s[f].listener===i||s[f]._origin&&s[f]._origin===i){p=f;break}if(p<0)continue;return this.wildcard?c._listeners.splice(p,1):this._events[n].splice(p,1),0===s.length&&(this.wildcard?delete c._listeners:delete this._events[n]),this.emit("removeListener",n,i),this}(s===i||s.listener&&s.listener===i||s._origin&&s._origin===i)&&(this.wildcard?delete c._listeners:delete this._events[n],this.emit("removeListener",n,i))}return function e(n){if(n!==t){var i=Object.keys(n);for(var s in i){var o=i[s],r=n[o];r instanceof Function||"object"!=typeof r||null===r||(Object.keys(r).length>0&&e(n[o]),0===Object.keys(r).length&&delete n[o])}}}(this.listenerTree),this},r.prototype.offAny=function(t){var e,n=0,i=0;if(t&&this._all&&this._all.length>0){for(n=0,i=(e=this._all).length;n<i;n++)if(t===e[n])return e.splice(n,1),this.emit("removeListenerAny",t),this}else{for(n=0,i=(e=this._all).length;n<i;n++)this.emit("removeListenerAny",e[n]);this._all=[]}return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var e="string"==typeof t?t.split(this.delimiter):t.slice(),n=a.call(this,null,e,this.listenerTree,0),s=0;s<n.length;s++){n[s]._listeners=null}else this._events&&(this._events[t]=null);return this},r.prototype.listeners=function(t){if(this.wildcard){var n=[],s="string"==typeof t?t.split(this.delimiter):t.slice();return a.call(this,n,s,this.listenerTree,0),n}return this._events||i.call(this),this._events[t]||(this._events[t]=[]),e(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.eventNames=function(){return Object.keys(this._events)},r.prototype.listenerCount=function(t){return this.listeners(t).length},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return r}):"object"==typeof exports?module.exports=r:window.EventEmitter2=r}(),$$.control.registerControl("breizbot.apps",{props:{apps:[]},$iface:"setData(data)",template:'<div class="scrollPanel">\n\t<div bn-each="apps" bn-iter="app" class="main" bn-event="click.tile: onTileClick">\t\t\t\n\t\t<div class="tile w3-btn" bn-attr="{class: `tile w3-btn ${app.props.colorCls}`}" bn-data="{item: app}">\n\t\t\t<div bn-show="typeof app.props.iconCls == \'string\'" style="margin-bottom: 5px;">\n\t\t\t\t<i bn-attr="{class: app.props.iconCls}"></i>\n\t\t\t</div>\n\n\t\t\t<span bn-text="app.props.title"></span>\n\t\t</div>\n\n\t</div>\n</div>',init:function(t){const e=$$.viewController(t,{data:{apps:this.props.apps},events:{onTileClick:function(e){t.trigger("appclick",$(this).data("item"))}}});this.setData=function(t){e.setData(t)}},$iface:"setData(data)",$events:"appclick"}),$$.control.registerControl("breizbot.files",{deps:["breizbot.files"],props:{$pager:null,cmd:"",showToolbar:!1,imageOnly:!1,filterExtension:void 0,showThumbnail:!1,thumbnailSize:"?x100",maxUploadSize:4124672},template:'<div class="contentPanel">\n\n\t<div class="toolbar" bn-show="showToolbar">\n\t\t<div bn-control="brainjs.controlgroup">\n\t\t\t<button \n\t\t\t\ttitle="New folder"\n\t\t\t\tbn-event="click: onCreateFolder"\n\t\t\t><i class="fa fa-folder-open"></i></button>\t\t\n\n\t\t\t<button \n\t\t\t\ttitle="Import file"\n\t\t\t\tbn-event="click: onImportFile"\n\t\t\t><i class="fa fa-upload"></i></button>\t\t\n\n\t\t\t<button \n\t\t\t\ttitle="Toggle Select Mode"\n\t\t\t\tbn-event="click: onToggleSelMode"\n\t\t\t><i class="fa fa-check"></i></button>\t\n\t\t</div>\n\n\t\t<div bn-control="brainjs.controlgroup">\n\t\t\t<button title="Delete"\n\t\t\t\tbn-event="click: onDeleteFiles"\n\t\t\t\tbn-prop="{disabled: !hasSelection}"\n\t\t\t><i class="fa fa-trash"></i></button>\n\n\t\t\t<button title="Cut"\n\t\t\t\tbn-prop="{disabled: !hasSelection}"\n\t\t\t\tbn-event="click: onCutFiles"\n\t\t\t><i class="fa fa-cut"></i></button>\t\n\n\t\t\t<button title="Copy"\n\t\t\t\tbn-prop="{disabled: !hasSelection}"\n\t\t\t\tbn-event="click: onCopyFiles"\n\t\t\t\t><i class="fa fa-copy"></i></button>\n\n\t\t\t<button title="Paste"\n\t\t\t\tbn-prop="{disabled: !hasSelectedFiles()}"\n\t\t\t\tbn-event="click: onPasteFiles"\n\t\t\t><i class="fa fa-paste"></i></button>\t\t\n\t\t</div>\n\t</div>\n\n\t<div class="pathPanel">\n\t\tPath:&nbsp;<span bn-text="rootDir"></span>\n\t</div>\n\n\t<div class="scrollPanel">\n\n\t\t<div bn-each="files" \n\t\t\tbn-iter="f" \n\t\t\tclass="container"\n\t\t\tbn-bind="files" \n\t\t\tbn-event="click.folder: onFolderClick, click.check: onCheckClick, click.file: onFileClick">\n\t\t\t\n\t\t\t<div class="thumbnail w3-btn" bn-data="{info: f}">\t\n\t\t\t\t\t<input type="checkbox" bn-show="selectMode && f.name != \'..\'" class="check w3-check">\t\t\n\t\t\t\t\t<div bn-if="f.folder" class="folder">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<i class="fa fa-4x fa-folder-open w3-text-blue-grey"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<span bn-text="f.name"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bn-if="!f.folder && (!f.isImage || !showThumbnail)" bn-attr="{title: getSize(f.size)}" class="file">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<i bn-attr="{class: `fa fa-4x w3-text-blue-grey ${getIconClass(f.name)}`}"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<span bn-text="f.name"></span>\n\t\t\t\t\t</div>\t\t\t\n\n\t\t\t\t\t<div bn-if="!f.folder && f.isImage && showThumbnail" bn-attr="{title: getSize(f.size)}" class="file">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<img bn-attr="{src: f.url}">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<span bn-text="f.name"></span>\n\t\t\t\t\t</div>\t\t\t\n\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>',init:function(t,e){const{$pager:n,cmd:i,showToolbar:s,maxUploadSize:o,filterExtension:r,imageOnly:a,thumbnailSize:l,showThumbnail:c}=this.props,p=$$.viewController(t,{data:{showThumbnail:c,thumbnailSize:l,showToolbar:s,rootDir:"/",selectMode:!1,files:[],selectedFiles:[],operation:"none",hasSelection:!1,getSize:function(t){return"Size : "+Math.floor(t/1024)+" Ko"},hasSelectedFiles:function(){return selectedFiles.length>0},getIconClass:function(t){return t.endsWith(".pdf")?"fa-file-pdf":t.endsWith(".doc")?"fa-file-word":"fa-file"}},events:{onFileClick:function(e){const s=$(this).closest(".thumbnail").data("info"),o={fileName:s.name,rootDir:p.model.rootDir,isImage:s.isImage,cmd:i};null!=n?n.popPage(o):t.trigger("fileclick",o)},onCheckClick:function(e){console.log("onCheckClick"),p.setData({hasSelection:t.find(".check:checked").length>0})},onFolderClick:function(t){const e=$(this).closest(".thumbnail").data("info").name;if(".."==e){const t=p.model.rootDir.split("/");t.pop(),t.pop(),d(t.join("/")+"/")}else d(p.model.rootDir+e+"/")},onCreateFolder:function(){var t=p.model.rootDir;$$.ui.showPrompt({content:"Folder name:",title:"New Folder"},function(n){e.mkdir(t+n).then(function(t){console.log("resp",t),d()}).catch(function(t){console.log("resp",t),$$.ui.showAlert({content:t.responseText,title:"Error"})})})},onToggleSelMode:function(){console.log("onToggleSelMode"),f(!p.model.selectMode)},onDeleteFiles:function(t){const n=u();0!=n.length?$$.ui.showConfirm({content:"Are you sure ?",title:"Delete files"},function(){e.removeFiles(n).then(function(t){console.log("resp",t),d()}).catch(function(t){console.log("resp",t),$$.ui.showAlert({content:t.responseText,title:"Error"})})}):$$.ui.showAlert({title:"Delete files",content:"No files selected"})},onCutFiles:function(t){console.log("onCutFiles"),p.setData({selectedFiles:u(),operation:"cut"}),f(!1)},onCopyFiles:function(t){console.log("onCopyFiles"),p.setData({selectedFiles:u(),operation:"copy"}),f(!1)},onPasteFiles:function(t){console.log("onPasteFiles");const{rootDir:n,selectedFiles:i,operation:s}=p.model;("copy"==s?e.copyFiles(i,n):e.moveFiles(i,n)).then(function(t){console.log("resp",t),p.setData({selectedFiles:[],operation:"none"}),d()}).catch(function(t){console.log("resp",t),$$.ui.showAlert({content:t.responseText,title:"Error"})})},onImportFile:function(t){$$.util.openFileDialog(function(t){t.size>o?$$.ui.showAlert({content:"File too big",title:"Import file"}):$$.util.readFileAsDataURL(t,function(n){const i=$$.util.dataURLtoBlob(n);e.uploadFile(i,t.name,p.model.rootDir).then(function(){d()}).catch(function(t){console.log("resp",t),$$.ui.showAlert({content:t.responseText,title:"Error"})})})})}}});function f(t){0==t&&(p.model.hasSelection=!1),p.model.selectMode=t,p.forceUpdate("files")}function u(){const e=[];return t.find(".check:checked").each(function(){const t=$(this).closest(".thumbnail").data("info");e.push(p.model.rootDir+t.name)}),console.log("selFiles",e),e}function d(t){null==t&&(t=p.model.rootDir),e.list(t,{filterExtension:r,imageOnly:a}).then(function(n){console.log("files",n),n.forEach(n=>{n.isImage&&(n.url=e.fileThumbnailUrl(t+n.name,l))}),"/"!=t&&n.unshift({name:"..",folder:!0}),p.setData({files:n,rootDir:t,selectMode:!1,hasSelection:!1})})}d(),this.update=function(){console.log("[FileCtrl] update"),d()}},$iface:"update()",$events:"fileclick"}),$$.control.registerControl("breizbot.friends",{props:{showSelection:!1,showSendMessage:!1},deps:["breizbot.users","breizbot.broker"],template:'<ul class="w3-ul w3-border w3-white" \n\tbn-each="friends" bn-show="friends.length > 0" bn-event="click.w3-bar: onItemClick, click.notif: onSendMessage">\n\t<li class="w3-bar" bn-data="{item: $i}">\n\t\t<span class="w3-button w3-right notif w3-blue" title="Send Message" bn-show="showSendMessage"><i class="fa fa-envelope"></i></span>\n\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-user" bn-class="{\n\t\t\t\t\'w3-text-green\': $i.isConnected,\n\t\t\t\t\'w3-text-red\': !$i.isConnected\n\t\t\t}"></i>\n\t\t\t<span bn-text="$i.friendUserName"></span>\n\t\t</div>\n\t</li>\n</ul>\t\n<p bn-show="friends.length == 0">You have no friends</p>',init:function(t,e,n){const{showSelection:i,showSendMessage:s}=this.props,o=$$.viewController(t,{data:{friends:[],showSendMessage:s},events:{onItemClick:function(){const e=$(this).data("item").friendUserName;console.log("onItemClick",e),i&&($(this).siblings(".w3-blue").removeClass("w3-blue"),$(this).addClass("w3-blue")),t.trigger("friendclick",{userName:e})},onSendMessage:function(t){t.stopPropagation();const n=$(this).closest("li").data("item").friendUserName;console.log("onSendMessage",n),$$.ui.showPrompt({title:"Send Message",label:"Message:"},function(t){e.sendNotif(n,{text:t,reply:!0})})}}});function r(t){if(!0===t.hist)return;const{isConnected:e,userName:n}=t.data;o.model.friends.find(t=>t.friendUserName==n).isConnected=e,o.update()}n.register("breizbot.friends",r),this.getSelection=function(){return t.find("li.w3-blue").data("item")},this.getFriends=function(){return o.model.friends.map(t=>t.friendUserName)},this.update=function(){e.getFriends().then(t=>{console.log("friends",t),o.setData({friends:t})})},this.dispose=function(){console.log("[friends] dispose"),n.unregister("breizbot.friends",r)},this.update()},$iface:"\n\t\tgetSelection():string;\n\t\tgetFriends():[string]\n\t",$events:"friendclick"}),$$.control.registerControl("breizbot.header",{deps:["breizbot.broker","breizbot.users","breizbot.rtc","breizbot.scheduler"],props:{userName:"Unknown",showHome:!0,title:""},template:'<div class="header w3-teal">\n\t<div>\n\t\t<a bn-show="showHome" class="w3-button" href="/" title="Go Home">\n\t\t\t<i class="fa fa-home fa-lg"></i>\n\t\t</a>\t\t\n\t\t<div bn-show="hasIncomingCall" \n\t\t\tbn-control="brainjs.contextmenu"\n\t\t\tbn-event="contextmenuchange: onCallResponse"\n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\', \n\t\t\t\ttitle: caller,\n\t\t\t\titems: {\n\t\t\t\t\taccept: {name: \'Accept\'},\n\t\t\t\t\tdeny: {name: \'Decline\', icon: \'fas fa-phone-slash\'},\n\t\t\t\t}\n\t\t\t}"\n\t\t\tclass="w3-button">\n\t\t\t<i class="fa fa-phone fa-pulse"></i>\n\x3c!-- \t\t\t<span bn-text="caller"></span>\n --\x3e\t\t\t<i class="fa fa-angle-down fa-lg"></i>\n\t\t</div>\n\t</div>\n\n\n\t<strong bn-text="title"></strong>\n\n\t<div>\n\t\t<button class="notification w3-button" title="Notification" bn-event="click: onNotification">\n\t\t\t<i class="fa fa-lg fa-bell w3-text-white" ></i>\n\t\t\t<span class="w3-badge w3-red w3-tiny" bn-text="nbNotif" bn-show="nbNotif > 0"></span>\t\t\t\n\t\t</button>\n\n\n\n\t\t<div bn-control="brainjs.contextmenu" \n\t\t\tbn-data="{\n\t\t\t\titems: {\n\t\t\t\t\tpwd: {name: \'Change password\', icon: \'fas fa-lock\'},\n\t\t\t\t\tapps: {name: \'Applications\', icon: \'fas fa-th\'},\n\t\t\t\t\tsep: \'------\',\n\t\t\t\t\tlogout: {name: \'Logout\', icon: \'fas fa-power-off\'}\n\t\t\t\t},\n\t\t\t\ttitle: userName\n\t\t\t}" \n\t\t\tdata-trigger="left" \n\t\t\tclass="w3-button" \n\t\t\tbn-event="contextmenuchange: onContextMenu">\n\t\t\t\t<i class="fa fa-user fa-lg"></i>\n\x3c!-- \t\t\t\t<span bn-text="userName"></span>\t\n --\x3e\t\t\t\t<i class="fa fa-angle-down fa-lg"></i>\n    \t\n\t\t</div>\n\t\t\n\t</div>\n\n\t\n</div>\n',init:function(t,e,n,i,s){const o=new Audio("/assets/skype.mp3");o.loop=!0;const r=$$.viewController(t,{data:{items:{pwd:{name:"Change password",icon:"fas fa-lock"},apps:{name:"Applications",icon:"fas fa-th"},sep:"------",logout:{name:"Logout",icon:"fas fa-power-off"}},userName:this.props.userName,showHome:this.props.showHome,title:this.props.title,nbNotif:0,hasIncomingCall:!1,caller:""},events:{onContextMenu:function(t,e){console.log("onContextMenu",e),"logout"==e.cmd&&s.logout(),"apps"==e.cmd&&s.openApp("store"),"pwd"==e.cmd&&$$.ui.showPrompt({title:"Change Password",label:"New Password:"},function(t){n.changePwd(t).then(()=>{$$.ui.showAlert({title:"Change Password",content:"Password has been changed"})}).catch(t=>{$$.ui.showAlert({title:"Error",content:t.responseText})})})},onNotification:function(t){console.log("onNotification"),0==r.model.nbNotif?$$.ui.showAlert({content:"no notifications",title:"Notifications"}):s.openApp("notif")},onCallResponse:function(t,e){const{cmd:n}=e;console.log("onCallResponse",e),r.setData({hasIncomingCall:!1}),o.pause(),"accept"==n&&s.openApp("video",{caller:r.model.caller,clientId:i.getRemoteClientId()}),"deny"==n&&i.deny()},onDropDown:function(){console.log("onDropDown"),r.scope.userMenu.toggle("w3-show")}}});function a(t){r.setData({nbNotif:t})}e.register("breizbot.notifCount",function(t){a(t.data)}),e.register("breizbot.rtc.call",function(t){!0!==t.hist&&(console.log("msg",t),r.setData({hasIncomingCall:!0,caller:t.data.from}),i.setRemoteClientId(t.srcId),o.play())}),e.register("breizbot.rtc.cancel",function(t){!0!==t.hist&&(console.log("msg",t),r.setData({hasIncomingCall:!1}),o.pause())}),n.getNotifCount().then(a)}}),$$.control.registerControl("breizbot.home",{deps:["breizbot.apps","breizbot.scheduler"],template:'<div bn-control="breizbot.apps" \n\tbn-data="{apps}"\n\tbn-event="appclick: onAppClick" \n\tstyle="height: 100%">\n\t\t\n\t</div>\n',init:function(t,e,n){const i=$$.viewController(t,{data:{apps:[]},events:{onAppClick:function(t,e){n.openApp(e.appName)}}});e.listMyApp().then(t=>{console.log("apps",t),i.setData({apps:t})})}}),$$.control.registerControl("breizbot.pdf",{template:'<div class="toolbar">\n\t<div>\n\t\t<button \n\t\t\tclass="w3-button w3-blue" \n\t\t\tbn-show="showToolbar"\n\t\t\tbn-event="click: onOpenFile">\n\t\t\t\t<i class="fa fa-folder-open"></i>\n\t\t</button>\t\t\n\t</div>\n\t<div>\n\t\t<span bn-text="title" bn-show="showToolbar"></span>\n\t</div>\n\t<div class="pages">\n\t\t<div>\n\t\t\t<button class="w3-button" title="zoomOut" bn-event="click: onZoomOut">\n\t\t\t\t<i class="fa fa-search-minus"></i>\n\t\t\t</button>\t\n\n\t\t\t<button class="w3-button" title="zoomIn" bn-event="click: onZoomIn">\n\t\t\t\t<i class="fa fa-search-plus"></i>\n\t\t\t</button>\t\n\n\t\t\t<button class="w3-button" title="previous page" bn-event="click: onPrevPage">\n\t\t\t\t<i class="fa fa-angle-left"></i>\n\t\t\t</button>\t\n\n\t\t\t<button class="w3-button" title="next page" bn-event="click: onNextPage">\n\t\t\t\t<i class="fa fa-angle-right"></i>\n\t\t\t</button>\t\t\t\n\t\t</div>\n\t\t<div>\n\t\t\tPages: <span bn-text="currentPage"></span> / <span bn-text="numPages"></span>\t\t\n\t\t</div>\n\t</div>\n</div>\n\t\n<div class="content">\n\t<div bn-control="brainjs.pdf" \n\t\tbn-data="{worker: \'/brainjs/pdf/worker.js\'}"\n\t\tbn-iface="pdf"\n\t\t \n\t></div>\t\t\n</div>',props:{showToolbar:!1,url:""},deps:["breizbot.files"],init:function(t,e){const{showToolbar:n}=this.props;let i=1;const s=$$.viewController(t,{data:{numPages:0,title:"",currentPage:1,showToolbar:n},events:{onOpenFile:function(e){t.trigger("pdfopenfile")},onNextPage:function(t){s.scope.pdf.nextPage().then(t=>{s.setData({currentPage:t})})},onPrevPage:function(t){s.scope.pdf.prevPage().then(t=>{s.setData({currentPage:t})})},onZoomIn:function(t){i+=.5,s.scope.pdf.setZoomLevel(i)},onZoomOut:function(t){i>1&&(i-=.5,s.scope.pdf.setZoomLevel(i))}}});function o(t,e){s.scope.pdf.openFile(t).then(t=>{console.log("file loaded"),s.setData({title:e,numPages:t})})}this.openFile=o,this.setData=function(t){console.log("setData",t),null!=t.url&&o(t.url)}},$iface:"\n\t\topenFile(url, title)\n\t"}),$$.control.registerControl("breizbot.addUser",{template:'<form bn-event="submit: onSubmit">\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>UserName</label>\n\t\t<input type="text" placeholder="username" name="username" required="">\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Pseudo</label>\n\t\t<input type="text" placeholder="pseudo" name="pseudo" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Location</label>\n\t\t<input type="text" placeholder="location" name="location" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Email</label>\n\t\t<input type="email" placeholder="email" name="email" required>\t\n\t</div>\n\t\n\t<input type="submit" hidden="" bn-bind="submit">\n</form>\n',props:{$pager:null},init:function(t){const{$pager:e}=this.props,n=$$.viewController(t,{data:{},events:{onSubmit:function(t){t.preventDefault(),e.popPage($(this).getFormData())}}});this.onAction=function(t){n.scope.submit.click()}},$iface:"\n\t\tonAction(cmd)\n\t"}),$$.control.registerControl("breizbot.users",{deps:["breizbot.users"],template:'<div class="toolbar">\n\t<button bn-event="click: onUpdate" class="w3-btn w3-blue" title="Update">\n\t\t<i class="fa fa-redo"></i>\n\t</button>\t\n\t<button bn-event="click: onAddUser" class="w3-btn w3-blue btnAddUser" title="Add User">\n\t\t<i class="fa fa-user-plus"></i>\n\t</button>\t\n</div>\n\n<div class="scrollPanel">\n    <table class="w3-table-all w3-small">\n        <thead>\n            <tr class="w3-green">\n                <th>User Name</th>\n                <th>Pseudo</th>\n                <th>Location</th>\n                <th>Email</th>\n                <th>Create Date</th>\n                <th>Last Login Date</th>\n                <th>Actions</th>\n            </tr>\n        </thead>\n        <tbody bn-each="data" bn-event="click.delete: onDelete, click.notif: onNotif">\n  \t\t\t<tr bn-data="{item: $i}">\n\t\t\t\t<td bn-text="$i.username"></td>\n\t\t\t\t<td bn-text="$i.pseudo"></td>\n\t\t\t\t<td bn-text="$i.location"></td>\n\t\t\t\t<td bn-text="$i.email"></td>\n\t\t\t\t<td >\n\t\t\t\t\t<span bn-text="new Date($i.createDate).toLocaleDateString(\'fr-FR\')" bn-show="$i.createDate != undefined"></span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<span bn-show="$i.lastLoginDate != undefined && $i.lastLoginDate != 0">\n\n\t\t\t\t\t\t<span bn-text="new Date($i.lastLoginDate).toLocaleDateString(\'fr-FR\')"></span><br>\n\t\t\t\t\t\tat \n\t\t\t\t\t\t<span bn-text="new Date($i.lastLoginDate).toLocaleTimeString(\'fr-FR\')"></span>\n\t\t\t\t\t</span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button class="delete w3-btn w3-blue" title="Delete User">\n\t\t\t\t\t\t<i class="fa fa-trash"></i>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="notif w3-btn w3-blue" title="Send Notification">\n\t\t\t\t\t\t<i class="fa fa-bell"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>      \t\n\n        </tbody>\n    </table>\n</div>',props:{$pager:null},init:function(t,e){const{$pager:n}=this.props,i=$$.viewController(t,{data:{data:[]},events:{onAddUser:function(t){n.pushPage("breizbot.addUser",{title:"Add User",buttons:[{label:"Create",name:"create"}]})},onDelete:function(t){const n=$(this).closest("tr").data("item");$$.ui.showConfirm({title:"Delete User",content:"Are you sure ?"},function(){e.remove(n.username).then(s)})},onNotif:function(t){const n=$(this).closest("tr").data("item");console.log("onNotif",n),$$.ui.showPrompt({title:"Send Notification",label:"Message"},function(t){e.sendNotif(n.username,{text:t})})},onUpdate:function(){s()}}});function s(){e.list().then(t=>{console.log("data",t),i.setData({data:t})})}s(),this.onReturn=function(t){e.add(t).then(s)}},$iface:"\n\t\tonReturn(formData)\n\t"}),$$.service.registerService("breizbot.apps",{deps:["brainjs.http"],init:function(t,e){return{listAll:function(){return e.get("/api/apps/all")},listMyApp:function(){return e.get("/api/apps/myapp")}}},$iface:"\n\t\tlistAll():Promise;\n\t\tlistMyApp():Promise \n\t\t"}),function(){class t extends EventEmitter2{constructor(){super(),this.sock=null,this.isConnected=!1,this.tryReconnect=!0,this.topics=new EventEmitter2({wildcard:!0}),this.registeredTopics={};const{host:t,pathname:e}=location;this.url=`wss://${t}:8090/hmi${e}`}connect(){console.log("try to connect..."),this.sock=new WebSocket(this.url),this.sock.addEventListener("open",()=>{console.log("Connected to broker"),this.isConnected=!0}),this.sock.addEventListener("message",t=>{const e=JSON.parse(t.data);"ready"==e.type&&(Object.keys(this.registeredTopics).forEach(t=>{this.sendMsg({type:"register",topic:t})}),this.emit("ready",{clientId:e.clientId})),"ping"==e.type&&this.sendMsg({type:"pong"}),"notif"==e.type&&this.topics.emit(e.topic,e),"error"==e.type&&(console.log("[Broker] log",e.text),this.tryReconnect=!1,sock.close())}),this.sock.addEventListener("close",(t,e)=>{this.isConnected&&console.log("[Broker] Disconnected !"),this.isConnected=!1,this.tryReconnect&&setTimeout(()=>{this.connect()},5e3)})}sendMsg(t){t.time=Date.now();var e=JSON.stringify(t);this.isConnected&&this.sock.send(e)}emitTopic(t,e){var n={type:"notif",topic:t,data:e};this.sendMsg(n)}onTopic(t,e){this.topics.on(t,e)}register(t,e){null==this.registeredTopics[t]?this.registeredTopics[t]=1:this.registeredTopics[t]++,this.topics.on(t,e),this.sendMsg({type:"register",topic:t})}unregister(t,e){this.topics.off(t,e),0==--this.registeredTopics[t]&&(delete this.registeredTopics[t],this.sendMsg({type:"unregister",topic:t}))}}$$.service.registerService("breizbot.broker",{init:function(e){const n=new t;return n.connect(),n},$iface:"\n\t\t\temitTopic(topicName, data);\n\t\t\tregister(topicName, callback);\n\t\t\tunregister(topicName, callback);\n\t\t\tonTopic(topicName, callback)\n\n\t\t"})}(),$$.service.registerService("breizbot.files",{deps:["brainjs.http"],init:function(t,e){return{list:function(t,n){return console.log("[FileService] list",t),e.post("/api/files/list",{path:t,options:n})},fileUrl:function(t){return"/api/files/load?fileName="+t},fileThumbnailUrl:function(t,e){return`/api/files/loadThumbnail?fileName=${t}&size=${e}`},uploadFile:function(t,n,i){if(console.log("[FileService] uploadFile",n),!(t instanceof Blob))return Promise.reject("File format not supported");var s=new FormData;return s.append("file",t,n),s.append("destPath",i),e.postFormData("/api/files/save",s)},removeFiles:function(t){return console.log("[FileService] removeFiles",t),e.post("/api/files/delete",t)},mkdir:function(t){return console.log("[FileService] mkdir",t),e.post("/api/files/mkdir",{fileName:t})},moveFiles:function(t,n){return console.log("[FileService] moveFiles",t,n),e.post("/api/files/move",{fileNames:t,destPath:n})},copyFiles:function(t,n){return console.log("[FileService] copyFiles",t,n),e.post("/api/files/copy",{fileNames:t,destPath:n})}}},$iface:"\n\t\tlist(path, options):Promise;\n\t\tfileUrl(fileName):string;\n\t\tfileThumbnailUrl(fileName, size):string;\n\t\tuploadFile(blob, saveAsfileName, destPath):Promise;\n\t\tremoveFiles(fileNames):Promise;\n\t\tmkdir(fileName):Promise;\n\t\tmoveFiles(fileNames, destPath):Promise;\n\t\tcopyFiles(fileNames, destPath):Promise\t\t\t\n\t"}),$$.service.registerService("breizbot.mails",{deps:["brainjs.http"],init:function(t,e){return{getMailAccount:function(){return e.get("/api/mails/")},createMailAccount:function(t){return e.post("/api/mails",t)},getMailboxes:function(t){return e.post("/api/mails/getMailboxes",{name:t})},openMailbox:function(t,n,i){return e.post("/api/mails/openMailbox",{name:t,mailboxName:n,pageNo:i})},openMessage:function(t,n,i,s){return e.post("/api/mails/openMessage",{name:t,mailboxName:n,seqNo:i,partID:s})},openAttachment:function(t,n,i,s){return e.post("/api/mails/openAttachment",{name:t,mailboxName:n,seqNo:i,partID:s})},deleteMessage:function(t,n,i){return e.post("/api/mails/deleteMessage",{name:t,mailboxName:n,seqNos:i})},moveMessage:function(t,n,i,s){return e.post("/api/mails/moveMessage",{name:t,mailboxName:n,targetName:i,seqNos:s})},sendMail:function(t,n){return e.post("/api/mails/sendMail",{accountName:t,data:n})}}},$iface:"\n\t\tgetMailAccount():Promise;\n\t\tcreateMaiAccount(data):Promise;\n\t\tgetMailboxes(name):Promise;\n\t\topenMailbox(name, mailboxName, pageNo):Promise;\n\t\topenMessage(name, mailboxName, seqNo, partID):Promise;\n\t\topenAttachment(name, mailboxName, seqNo, partID):Promise;\n\t\tdeleteMessage(name, mailboxName, seqNos):Promise;\n\t\tmoveMessage(name, mailboxName, targetName, seqNos):Promise\n\t\t"}),$$.service.registerService("breizbot.params",{init:function(t){return JSON.parse(t)}}),$$.service.registerService("breizbot.rtc",{deps:["brainjs.http","breizbot.broker"],init:function(t,e,n){let i,s;return n.on("ready",t=>{i=t.clientId}),{getRemoteClientId:function(){return s},setRemoteClientId:function(t){s=t},call:function(t){return e.post(`/api/rtc/sendToUser/${i}`,{to:t,type:"call"})},cancel:function(t){return e.post(`/api/rtc/sendToUser/${i}`,{to:t,type:"cancel"})},accept:function(){return e.post(`/api/rtc/sendToClient/${i}`,{destId:s,type:"accept"})},deny:function(){return e.post(`/api/rtc/sendToClient/${i}`,{destId:s,type:"deny"})},bye:function(){return e.post(`/api/rtc/sendToClient/${i}`,{destId:s,type:"bye"})},candidate:function(t){return e.post(`/api/rtc/sendToClient/${i}`,{destId:s,type:"candidate",data:{label:t.sdpMLineIndex,id:t.sdpMid,candidate:t.candidate}})},offer:function(t){return e.post(`/api/rtc/sendToClient/${i}`,{destId:s,type:"offer",data:t})},answer:function(t){return e.post(`/api/rtc/sendToClient/${i}`,{destId:s,type:"answer",data:t})}}},$iface:"\n\t\tgetRemoteClientId():string;\n\t\tsetRemoteClientId(clientId);\n\t\tcall(to):Promise;\n\t\tcancel(to):Promise;\n\t\tdeny():Promise;\n\t\tbye():Promise;\n\t\tcandidate(info):Promise;\n\t\toffer(data):Promise;\n\t\tanswer(data):Promise\n\t"}),$$.service.registerService("breizbot.scheduler",{init:function(t){return{openApp:function(t,e){if("object"==typeof e){const n=[];for(let t in e)n.push(t+"="+e[t]);location.href=`/apps/${t}?`+n.join("&")}else location.href=`/apps/${t}`},logout:function(){location.href="/logout"}}},$iface:"\n\t\topenApp(appName, params);\n\t\tlogout()\n\t"}),$$.service.registerService("breizbot.users",{deps:["brainjs.http"],init:function(t,e){return{list:function(){return e.get("/api/users")},match:function(t){return e.get(`/api/users?match=${t}`)},add:function(t){return e.post("/api/users",t)},remove:function(t){return e.delete(`/api/users/${t}`)},update:function(t,n){return e.put(`/api/users/${t}`,n)},get:function(t){return e.get(`/api/users/${t}`)},activateApp:function(t,n){return e.post("/api/users/activateApp",{appName:t,activated:n})},sendNotif:function(t,n){return e.post("/api/users/sendNotif",{to:t,notif:n})},removeNotif:function(t){return e.delete(`/api/users/removeNotif/${t}`)},getNotifs:function(){return e.get("/api/users/getNotifs")},getNotifCount:function(){return e.get("/api/users/getNotifCount")},getFriends:function(){return e.get("/api/users/getFriends")},addFriend:function(t){return e.post("/api/users/addFriend",{friendUserName:t})},changePwd:function(t){return e.post("/api/users/changePwd",{newPwd:t})}}},$iface:"\n\t\tlist():Promise;\n\t\tadd(data):Promise;\n\t\tremove(user):Promise;\n\t\tupdate(user, data):Promise;\n\t\tget(user):Promise;\n\t\tactivateApp(appName, activated):Promise;\n\t\tsendNotif(to, notif):Promise;\n\t\tremoveNotif(notifId):Promise;\n\t\tgetNotifs():Promise;\n\t\tgetNotifCount():Promise;\n\t\tgetFriends():Promise\n\t"});