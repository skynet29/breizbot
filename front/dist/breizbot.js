!function(t){var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},e=10;function i(){this._events={},this._conf&&o.call(this,this._conf)}function o(n){n?(this._conf=n,n.delimiter&&(this.delimiter=n.delimiter),this._maxListeners=n.maxListeners!==t?n.maxListeners:e,n.wildcard&&(this.wildcard=n.wildcard),n.newListener&&(this.newListener=n.newListener),n.verboseMemoryLeak&&(this.verboseMemoryLeak=n.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=e}function s(t,n){var e="(node) warning: possible EventEmitter memory leak detected. "+t+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(e+=" Event name: "+n+"."),"undefined"!=typeof process&&process.emitWarning){var i=new Error(e);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=t,process.emitWarning(i)}else console.error(e),console.trace&&console.trace()}function r(t){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,o.call(this,t)}function a(t,n,e,i){if(!e)return[];var o,s,r,l,c,u,d,f=[],p=n.length,h=n[i],b=n[i+1];if(i===p&&e._listeners){if("function"==typeof e._listeners)return t&&t.push(e._listeners),[e];for(o=0,s=e._listeners.length;o<s;o++)t&&t.push(e._listeners[o]);return[e]}if("*"===h||"**"===h||e[h]){if("*"===h){for(r in e)"_listeners"!==r&&e.hasOwnProperty(r)&&(f=f.concat(a(t,n,e[r],i+1)));return f}if("**"===h){for(r in(d=i+1===p||i+2===p&&"*"===b)&&e._listeners&&(f=f.concat(a(t,n,e,p))),e)"_listeners"!==r&&e.hasOwnProperty(r)&&("*"===r||"**"===r?(e[r]._listeners&&!d&&(f=f.concat(a(t,n,e[r],p))),f=f.concat(a(t,n,e[r],i))):f=r===b?f.concat(a(t,n,e[r],i+2)):f.concat(a(t,n,e[r],i)));return f}f=f.concat(a(t,n,e[h],i+1))}if((l=e["*"])&&a(t,n,l,i+1),c=e["**"])if(i<p)for(r in c._listeners&&a(t,n,c,p),c)"_listeners"!==r&&c.hasOwnProperty(r)&&(r===b?a(t,n,c[r],i+2):r===h?a(t,n,c[r],i+1):((u={})[r]=c[r],a(t,n,{"**":u},i+1)));else c._listeners?a(t,n,c,p):c["*"]&&c["*"]._listeners&&a(t,n,c["*"],p);return f}r.EventEmitter2=r,r.prototype.delimiter=".",r.prototype.setMaxListeners=function(n){n!==t&&(this._maxListeners=n,this._conf||(this._conf={}),this._conf.maxListeners=n)},r.prototype.event="",r.prototype.once=function(t,n){return this._once(t,n,!1)},r.prototype.prependOnceListener=function(t,n){return this._once(t,n,!0)},r.prototype._once=function(t,n,e){return this._many(t,1,n,e),this},r.prototype.many=function(t,n,e){return this._many(t,n,e,!1)},r.prototype.prependMany=function(t,n,e){return this._many(t,n,e,!0)},r.prototype._many=function(t,n,e,i){var o=this;if("function"!=typeof e)throw new Error("many only accepts instances of Function");function s(){return 0==--n&&o.off(t,s),e.apply(this,arguments)}return s._origin=e,this._on(t,s,i),o},r.prototype.emit=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;var n,e,o,s,r,l=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),l>3)for(n=new Array(l),s=0;s<l;s++)n[s]=arguments[s];for(o=0,e=r.length;o<e;o++)switch(this.event=t,l){case 1:r[o].call(this,t);break;case 2:r[o].call(this,t,arguments[1]);break;case 3:r[o].call(this,t,arguments[1],arguments[2]);break;default:r[o].apply(this,n)}}if(this.wildcard){r=[];var c="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,c,this.listenerTree,0)}else{if("function"==typeof(r=this._events[t])){switch(this.event=t,l){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=new Array(l-1),s=1;s<l;s++)n[s-1]=arguments[s];r.apply(this,n)}return!0}r&&(r=r.slice())}if(r&&r.length){if(l>3)for(n=new Array(l-1),s=1;s<l;s++)n[s-1]=arguments[s];for(o=0,e=r.length;o<e;o++)switch(this.event=t,l){case 1:r[o].call(this);break;case 2:r[o].call(this,arguments[1]);break;case 3:r[o].call(this,arguments[1],arguments[2]);break;default:r[o].apply(this,n)}return!0}if(!this._all&&"error"===t)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},r.prototype.emitAsync=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var n,e,o,s,r,l=[],c=arguments.length;if(this._all){if(c>3)for(n=new Array(c),s=1;s<c;s++)n[s]=arguments[s];for(o=0,e=this._all.length;o<e;o++)switch(this.event=t,c){case 1:l.push(this._all[o].call(this,t));break;case 2:l.push(this._all[o].call(this,t,arguments[1]));break;case 3:l.push(this._all[o].call(this,t,arguments[1],arguments[2]));break;default:l.push(this._all[o].apply(this,n))}}if(this.wildcard){r=[];var u="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,u,this.listenerTree,0)}else r=this._events[t];if("function"==typeof r)switch(this.event=t,c){case 1:l.push(r.call(this));break;case 2:l.push(r.call(this,arguments[1]));break;case 3:l.push(r.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(c-1),s=1;s<c;s++)n[s-1]=arguments[s];l.push(r.apply(this,n))}else if(r&&r.length){if(r=r.slice(),c>3)for(n=new Array(c-1),s=1;s<c;s++)n[s-1]=arguments[s];for(o=0,e=r.length;o<e;o++)switch(this.event=t,c){case 1:l.push(r[o].call(this));break;case 2:l.push(r[o].call(this,arguments[1]));break;case 3:l.push(r[o].call(this,arguments[1],arguments[2]));break;default:l.push(r[o].apply(this,n))}}else if(!this._all&&"error"===t)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(l)},r.prototype.on=function(t,n){return this._on(t,n,!1)},r.prototype.prependListener=function(t,n){return this._on(t,n,!0)},r.prototype.onAny=function(t){return this._onAny(t,!1)},r.prototype.prependAny=function(t){return this._onAny(t,!0)},r.prototype.addListener=r.prototype.on,r.prototype._onAny=function(t,n){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),n?this._all.unshift(t):this._all.push(t),this},r.prototype._on=function(n,e,o){if("function"==typeof n)return this._onAny(n,e),this;if("function"!=typeof e)throw new Error("on only accepts instances of Function");return this._events||i.call(this),this.emit("newListener",n,e),this.wildcard?(function(n,e){for(var i=0,o=(n="string"==typeof n?n.split(this.delimiter):n.slice()).length;i+1<o;i++)if("**"===n[i]&&"**"===n[i+1])return;for(var r=this.listenerTree,a=n.shift();a!==t;){if(r[a]||(r[a]={}),r=r[a],0===n.length)return r._listeners?("function"==typeof r._listeners&&(r._listeners=[r._listeners]),r._listeners.push(e),!r._listeners.warned&&this._maxListeners>0&&r._listeners.length>this._maxListeners&&(r._listeners.warned=!0,s.call(this,r._listeners.length,a))):r._listeners=e,!0;a=n.shift()}return!0}.call(this,n,e),this):(this._events[n]?("function"==typeof this._events[n]&&(this._events[n]=[this._events[n]]),o?this._events[n].unshift(e):this._events[n].push(e),!this._events[n].warned&&this._maxListeners>0&&this._events[n].length>this._maxListeners&&(this._events[n].warned=!0,s.call(this,this._events[n].length,n))):this._events[n]=e,this)},r.prototype.off=function(e,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");var o,s=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();s=a.call(this,null,r,this.listenerTree,0)}else{if(!this._events[e])return this;o=this._events[e],s.push({_listeners:o})}for(var l=0;l<s.length;l++){var c=s[l];if(o=c._listeners,n(o)){for(var u=-1,d=0,f=o.length;d<f;d++)if(o[d]===i||o[d].listener&&o[d].listener===i||o[d]._origin&&o[d]._origin===i){u=d;break}if(u<0)continue;return this.wildcard?c._listeners.splice(u,1):this._events[e].splice(u,1),0===o.length&&(this.wildcard?delete c._listeners:delete this._events[e]),this.emit("removeListener",e,i),this}(o===i||o.listener&&o.listener===i||o._origin&&o._origin===i)&&(this.wildcard?delete c._listeners:delete this._events[e],this.emit("removeListener",e,i))}return function n(e){if(e!==t){var i=Object.keys(e);for(var o in i){var s=i[o],r=e[s];r instanceof Function||"object"!=typeof r||null===r||(Object.keys(r).length>0&&n(e[s]),0===Object.keys(r).length&&delete e[s])}}}(this.listenerTree),this},r.prototype.offAny=function(t){var n,e=0,i=0;if(t&&this._all&&this._all.length>0){for(e=0,i=(n=this._all).length;e<i;e++)if(t===n[e])return n.splice(e,1),this.emit("removeListenerAny",t),this}else{for(e=0,i=(n=this._all).length;e<i;e++)this.emit("removeListenerAny",n[e]);this._all=[]}return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var n="string"==typeof t?t.split(this.delimiter):t.slice(),e=a.call(this,null,n,this.listenerTree,0),o=0;o<e.length;o++){e[o]._listeners=null}else this._events&&(this._events[t]=null);return this},r.prototype.listeners=function(t){if(this.wildcard){var e=[],o="string"==typeof t?t.split(this.delimiter):t.slice();return a.call(this,e,o,this.listenerTree,0),e}return this._events||i.call(this),this._events[t]||(this._events[t]=[]),n(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.eventNames=function(){return Object.keys(this._events)},r.prototype.listenerCount=function(t){return this.listeners(t).length},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return r}):"object"==typeof exports?module.exports=r:window.EventEmitter2=r}(),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(n,e){return void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(n)),t(e),e}:t(jQuery)}(function(t){function n(n,e,i){"string"==typeof i&&(i={className:i}),this.options=y(w,t.isPlainObject(i)?i:{}),this.loadHTML(),this.wrapper=t(p.html),this.options.clickToHide&&this.wrapper.addClass(o+"-hidable"),this.wrapper.data(o,this),this.arrow=this.wrapper.find("."+o+"-arrow"),this.container=this.wrapper.find("."+o+"-container"),this.container.append(this.userContainer),n&&n.length&&(this.elementType=n.attr("type"),this.originalElement=n,this.elem=C(n),this.elem.data(o,this),this.elem.before(this.wrapper)),this.container.hide(),this.run(e)}var e=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1},i="notify",o=i+"js",s=i+"!blank",r={t:"top",m:"middle",b:"bottom",l:"left",c:"center",r:"right"},a=["l","c","r"],l=["t","m","b"],c=["t","b","l","r"],u={t:"b",m:null,b:"t",l:"r",c:null,r:"l"},d=function(n){var e;return e=[],t.each(n.split(/\W+/),function(t,n){var i;if(i=n.toLowerCase().charAt(0),r[i])return e.push(i)}),e},f={},p={name:"core",html:'<div class="'+o+'-wrapper">\n\t<div class="'+o+'-arrow"></div>\n\t<div class="'+o+'-container"></div>\n</div>',css:"."+o+"-corner {\n\tposition: fixed;\n\tmargin: 5px;\n\tz-index: 1050;\n}\n\n."+o+"-corner ."+o+"-wrapper,\n."+o+"-corner ."+o+"-container {\n\tposition: relative;\n\tdisplay: block;\n\theight: inherit;\n\twidth: inherit;\n\tmargin: 3px;\n}\n\n."+o+"-wrapper {\n\tz-index: 1;\n\tposition: absolute;\n\tdisplay: inline-block;\n\theight: 0;\n\twidth: 0;\n}\n\n."+o+"-container {\n\tdisplay: none;\n\tz-index: 1;\n\tposition: absolute;\n}\n\n."+o+"-hidable {\n\tcursor: pointer;\n}\n\n[data-notify-text],[data-notify-html] {\n\tposition: relative;\n}\n\n."+o+"-arrow {\n\tposition: absolute;\n\tz-index: 2;\n\twidth: 0;\n\theight: 0;\n}"},h={"border-radius":["-webkit-","-moz-"]},b=function(n,e){if(!n)throw"Missing Style name";if(!e)throw"Missing Style definition";if(!e.html)throw"Missing Style HTML";var s=f[n];s&&s.cssElem&&(window.console&&console.warn(i+": overwriting style '"+n+"'"),f[n].cssElem.remove()),e.name=n,f[n]=e;var r="";e.classes&&t.each(e.classes,function(n,i){return r+="."+o+"-"+e.name+"-"+n+" {\n",t.each(i,function(n,e){return h[n]&&t.each(h[n],function(t,i){return r+="\t"+i+n+": "+e+";\n"}),r+="\t"+n+": "+e+";\n"}),r+="}\n"}),e.css&&(r+="/* styles for "+e.name+" */\n"+e.css),r&&(e.cssElem=m(r),e.cssElem.attr("id","notify-"+e.name));var a={},l=t(e.html);g("html",l,a),g("text",l,a),e.fields=a},m=function(n){var e;(e=A("style")).attr("type","text/css"),t("head").append(e);try{e.html(n)}catch(t){e[0].styleSheet.cssText=n}return e},g=function(n,e,i){var o;return"html"!==n&&(n="text"),v(e,"["+(o="data-notify-"+n)+"]").each(function(){var e;(e=t(this).attr(o))||(e=s),i[e]=n})},v=function(t,n){return t.is(n)?t:t.find(n)},w={clickToHide:!0,autoHide:!0,autoHideDelay:5e3,arrowShow:!0,arrowSize:5,breakNewLines:!0,elementPosition:"bottom",globalPosition:"top right",style:"bootstrap",className:"error",showAnimation:"slideDown",showDuration:400,hideAnimation:"slideUp",hideDuration:200,gap:5},y=function(n,e){var i;return(i=function(){}).prototype=n,t.extend(!0,new i,e)},A=function(n){return t("<"+n+"></"+n+">")},$={},C=function(n){var e;return n.is("[type=radio]")&&(e=n.parents("form:first").find("[type=radio]").filter(function(e,i){return t(i).attr("name")===n.attr("name")}),n=e.first()),n},x=function(t,n,e){var i;if("string"==typeof e)e=parseInt(e,10);else if("number"!=typeof e)return;if(!isNaN(e))return i=r[u[n.charAt(0)]],n,void 0!==t[i]&&(n=r[i.charAt(0)],e=-e),void 0===t[n]?t[n]=e:t[n]+=e,null},k=function(t,n,e){if("l"===t||"t"===t)return 0;if("c"===t||"m"===t)return e/2-n/2;if("r"===t||"b"===t)return e-n;throw"Invalid alignment"},S=function(t){return S.e=S.e||A("div"),S.e.text(t).html()};n.prototype.loadHTML=function(){var n;n=this.getStyle(),this.userContainer=t(n.html),this.userFields=n.fields},n.prototype.show=function(t,n){var e,i,o,s,r;if(i=function(e){return function(){if(!t&&!e.elem&&e.destroy(),n)return n()}}(this),r=this.container.parent().parents(":hidden").length>0,o=this.container.add(this.arrow),e=[],r&&t)s="show";else if(r&&!t)s="hide";else if(!r&&t)s=this.options.showAnimation,e.push(this.options.showDuration);else{if(r||t)return i();s=this.options.hideAnimation,e.push(this.options.hideDuration)}return e.push(i),o[s].apply(o,e)},n.prototype.setGlobalPosition=function(){var n=this.getPosition(),e=n[0],i=n[1],s=r[e],a=r[i],l=e+"|"+i,c=$[l];if(!c||!document.body.contains(c[0])){c=$[l]=A("div");var u={};u[s]=0,"middle"===a?u.top="45%":"center"===a?u.left="45%":u[a]=0,c.css(u).addClass(o+"-corner"),t("body").append(c)}return c.prepend(this.wrapper)},n.prototype.setElementPosition=function(){var n,i,o,s,d,f,p,h,b,m,g,v,w,y,A,$,C,S,D,P,F,I,z,N,E,j,U,L;for(z=(j=this.getPosition())[0],I=j[1],j[2],g=this.elem.position(),h=this.elem.outerHeight(),v=this.elem.outerWidth(),b=this.elem.innerHeight(),m=this.elem.innerWidth(),L=this.wrapper.position(),d=this.container.height(),f=this.container.width(),S=r[z],(p={})[F=r[P=u[z]]]="b"===z?h:"r"===z?v:0,x(p,"top",g.top-L.top),x(p,"left",g.left-L.left),y=0,$=(U=["top","left"]).length;y<$;y++)N=U[y],(D=parseInt(this.elem.css("margin-"+N),10))&&x(p,N,D);if(w=Math.max(0,this.options.gap-(this.options.arrowShow?o:0)),x(p,F,w),this.options.arrowShow){for(o=this.options.arrowSize,i=t.extend({},p),n=this.userContainer.css("border-color")||this.userContainer.css("border-top-color")||this.userContainer.css("background-color")||"white",A=0,C=c.length;A<C;A++)E=r[N=c[A]],N!==P&&(s=E===S?n:"transparent",i["border-"+E]=o+"px solid "+s);x(p,r[P],o),e.call(c,I)>=0&&x(i,r[I],2*o)}else this.arrow.hide();if(e.call(l,z)>=0?(x(p,"left",k(I,f,v)),i&&x(i,"left",k(I,o,m))):e.call(a,z)>=0&&(x(p,"top",k(I,d,h)),i&&x(i,"top",k(I,o,b))),this.container.is(":visible")&&(p.display="block"),this.container.removeAttr("style").css(p),i)return this.arrow.removeAttr("style").css(i)},n.prototype.getPosition=function(){var t,n,i,o,s,r,u,f;if(f=this.options.position||(this.elem?this.options.elementPosition:this.options.globalPosition),0===(t=d(f)).length&&(t[0]="b"),n=t[0],e.call(c,n)<0)throw"Must be one of ["+c+"]";return(1===t.length||(i=t[0],e.call(l,i)>=0&&(o=t[1],e.call(a,o)<0))||(s=t[0],e.call(a,s)>=0&&(r=t[1],e.call(l,r)<0)))&&(t[1]=(u=t[0],e.call(a,u)>=0?"m":"l")),2===t.length&&(t[2]=t[1]),t},n.prototype.getStyle=function(t){var n;if(t||(t=this.options.style),t||(t="default"),!(n=f[t]))throw"Missing style: "+t;return n},n.prototype.updateClasses=function(){var n,e;return n=["base"],t.isArray(this.options.className)?n=n.concat(this.options.className):this.options.className&&n.push(this.options.className),e=this.getStyle(),n=t.map(n,function(t){return o+"-"+e.name+"-"+t}).join(" "),this.userContainer.attr("class",n)},n.prototype.run=function(n,e){var i,o,r,a,l;if(t.isPlainObject(e)?t.extend(this.options,e):"string"===t.type(e)&&(this.options.className=e),!this.container||n){if(this.container||n){for(r in o={},t.isPlainObject(n)?o=n:o[s]=n,o)i=o[r],(a=this.userFields[r])&&("text"===a&&(i=S(i),this.options.breakNewLines&&(i=i.replace(/\n/g,"<br/>"))),l=r===s?"":"="+r,v(this.userContainer,"[data-notify-"+a+l+"]").html(i));this.updateClasses(),this.elem?this.setElementPosition():this.setGlobalPosition(),this.show(!0),this.options.autoHide&&(clearTimeout(this.autohideTimer),this.autohideTimer=setTimeout(this.show.bind(this,!1),this.options.autoHideDelay))}}else this.show(!1)},n.prototype.destroy=function(){this.wrapper.data(o,null),this.wrapper.remove()},t[i]=function(e,o,s){return e&&e.nodeName||e.jquery?t(e)[i](o,s):(s=o,new n(null,o=e,s)),e},t.fn[i]=function(e,i){return t(this).each(function(){var s=C(t(this)).data(o);s&&s.destroy();new n(t(this),e,i)}),this},t.extend(t[i],{defaults:function(n){return t.extend(w,n)},addStyle:b,removeStyle:function(t){if(!t)throw"Missing Style name";f[t]&&delete f[t]},pluginOptions:w,getStyle:function(t){return f[t]},insertCSS:m}),b("bootstrap",{html:"<div>\n<span data-notify-text></span>\n</div>",classes:{base:{"font-weight":"bold",padding:"8px 15px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)","background-color":"#fcf8e3",border:"1px solid #fbeed5","border-radius":"4px","white-space":"nowrap","padding-left":"25px","background-repeat":"no-repeat","background-position":"3px 7px"},error:{color:"#B94A48","background-color":"#F2DEDE","border-color":"#EED3D7","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtRJREFUeNqkVc1u00AQHq+dOD+0poIQfkIjalW0SEGqRMuRnHos3DjwAH0ArlyQeANOOSMeAA5VjyBxKBQhgSpVUKKQNGloFdw4cWw2jtfMOna6JOUArDTazXi/b3dm55socPqQhFka++aHBsI8GsopRJERNFlY88FCEk9Yiwf8RhgRyaHFQpPHCDmZG5oX2ui2yilkcTT1AcDsbYC1NMAyOi7zTX2Agx7A9luAl88BauiiQ/cJaZQfIpAlngDcvZZMrl8vFPK5+XktrWlx3/ehZ5r9+t6e+WVnp1pxnNIjgBe4/6dAysQc8dsmHwPcW9C0h3fW1hans1ltwJhy0GxK7XZbUlMp5Ww2eyan6+ft/f2FAqXGK4CvQk5HueFz7D6GOZtIrK+srupdx1GRBBqNBtzc2AiMr7nPplRdKhb1q6q6zjFhrklEFOUutoQ50xcX86ZlqaZpQrfbBdu2R6/G19zX6XSgh6RX5ubyHCM8nqSID6ICrGiZjGYYxojEsiw4PDwMSL5VKsC8Yf4VRYFzMzMaxwjlJSlCyAQ9l0CW44PBADzXhe7xMdi9HtTrdYjFYkDQL0cn4Xdq2/EAE+InCnvADTf2eah4Sx9vExQjkqXT6aAERICMewd/UAp/IeYANM2joxt+q5VI+ieq2i0Wg3l6DNzHwTERPgo1ko7XBXj3vdlsT2F+UuhIhYkp7u7CarkcrFOCtR3H5JiwbAIeImjT/YQKKBtGjRFCU5IUgFRe7fF4cCNVIPMYo3VKqxwjyNAXNepuopyqnld602qVsfRpEkkz+GFL1wPj6ySXBpJtWVa5xlhpcyhBNwpZHmtX8AGgfIExo0ZpzkWVTBGiXCSEaHh62/PoR0p/vHaczxXGnj4bSo+G78lELU80h1uogBwWLf5YlsPmgDEd4M236xjm+8nm4IuE/9u+/PH2JXZfbwz4zw1WbO+SQPpXfwG/BBgAhCNZiSb/pOQAAAAASUVORK5CYII=)"},success:{color:"#468847","background-color":"#DFF0D8","border-color":"#D6E9C6","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAutJREFUeNq0lctPE0Ecx38zu/RFS1EryqtgJFA08YCiMZIAQQ4eRG8eDGdPJiYeTIwHTfwPiAcvXIwXLwoXPaDxkWgQ6islKlJLSQWLUraPLTv7Gme32zoF9KSTfLO7v53vZ3d/M7/fIth+IO6INt2jjoA7bjHCJoAlzCRw59YwHYjBnfMPqAKWQYKjGkfCJqAF0xwZjipQtA3MxeSG87VhOOYegVrUCy7UZM9S6TLIdAamySTclZdYhFhRHloGYg7mgZv1Zzztvgud7V1tbQ2twYA34LJmF4p5dXF1KTufnE+SxeJtuCZNsLDCQU0+RyKTF27Unw101l8e6hns3u0PBalORVVVkcaEKBJDgV3+cGM4tKKmI+ohlIGnygKX00rSBfszz/n2uXv81wd6+rt1orsZCHRdr1Imk2F2Kob3hutSxW8thsd8AXNaln9D7CTfA6O+0UgkMuwVvEFFUbbAcrkcTA8+AtOk8E6KiQiDmMFSDqZItAzEVQviRkdDdaFgPp8HSZKAEAL5Qh7Sq2lIJBJwv2scUqkUnKoZgNhcDKhKg5aH+1IkcouCAdFGAQsuWZYhOjwFHQ96oagWgRoUov1T9kRBEODAwxM2QtEUl+Wp+Ln9VRo6BcMw4ErHRYjH4/B26AlQoQQTRdHWwcd9AH57+UAXddvDD37DmrBBV34WfqiXPl61g+vr6xA9zsGeM9gOdsNXkgpEtTwVvwOklXLKm6+/p5ezwk4B+j6droBs2CsGa/gNs6RIxazl4Tc25mpTgw/apPR1LYlNRFAzgsOxkyXYLIM1V8NMwyAkJSctD1eGVKiq5wWjSPdjmeTkiKvVW4f2YPHWl3GAVq6ymcyCTgovM3FzyRiDe2TaKcEKsLpJvNHjZgPNqEtyi6mZIm4SRFyLMUsONSSdkPeFtY1n0mczoY3BHTLhwPRy9/lzcziCw9ACI+yql0VLzcGAZbYSM5CCSZg1/9oc/nn7+i8N9p/8An4JMADxhH+xHfuiKwAAAABJRU5ErkJggg==)"},info:{color:"#3A87AD","background-color":"#D9EDF7","border-color":"#BCE8F1","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QYFAhkSsdes/QAAA8dJREFUOMvVlGtMW2UYx//POaWHXg6lLaW0ypAtw1UCgbniNOLcVOLmAjHZolOYlxmTGXVZdAnRfXQm+7SoU4mXaOaiZsEpC9FkiQs6Z6bdCnNYruM6KNBw6YWewzl9z+sHImEWv+vz7XmT95f/+3/+7wP814v+efDOV3/SoX3lHAA+6ODeUFfMfjOWMADgdk+eEKz0pF7aQdMAcOKLLjrcVMVX3xdWN29/GhYP7SvnP0cWfS8caSkfHZsPE9Fgnt02JNutQ0QYHB2dDz9/pKX8QjjuO9xUxd/66HdxTeCHZ3rojQObGQBcuNjfplkD3b19Y/6MrimSaKgSMmpGU5WevmE/swa6Oy73tQHA0Rdr2Mmv/6A1n9w9suQ7097Z9lM4FlTgTDrzZTu4StXVfpiI48rVcUDM5cmEksrFnHxfpTtU/3BFQzCQF/2bYVoNbH7zmItbSoMj40JSzmMyX5qDvriA7QdrIIpA+3cdsMpu0nXI8cV0MtKXCPZev+gCEM1S2NHPvWfP/hL+7FSr3+0p5RBEyhEN5JCKYr8XnASMT0xBNyzQGQeI8fjsGD39RMPk7se2bd5ZtTyoFYXftF6y37gx7NeUtJJOTFlAHDZLDuILU3j3+H5oOrD3yWbIztugaAzgnBKJuBLpGfQrS8wO4FZgV+c1IxaLgWVU0tMLEETCos4xMzEIv9cJXQcyagIwigDGwJgOAtHAwAhisQUjy0ORGERiELgG4iakkzo4MYAxcM5hAMi1WWG1yYCJIcMUaBkVRLdGeSU2995TLWzcUAzONJ7J6FBVBYIggMzmFbvdBV44Corg8vjhzC+EJEl8U1kJtgYrhCzgc/vvTwXKSib1paRFVRVORDAJAsw5FuTaJEhWM2SHB3mOAlhkNxwuLzeJsGwqWzf5TFNdKgtY5qHp6ZFf67Y/sAVadCaVY5YACDDb3Oi4NIjLnWMw2QthCBIsVhsUTU9tvXsjeq9+X1d75/KEs4LNOfcdf/+HthMnvwxOD0wmHaXr7ZItn2wuH2SnBzbZAbPJwpPx+VQuzcm7dgRCB57a1uBzUDRL4bfnI0RE0eaXd9W89mpjqHZnUI5Hh2l2dkZZUhOqpi2qSmpOmZ64Tuu9qlz/SEXo6MEHa3wOip46F1n7633eekV8ds8Wxjn37Wl63VVa+ej5oeEZ/82ZBETJjpJ1Rbij2D3Z/1trXUvLsblCK0XfOx0SX2kMsn9dX+d+7Kf6h8o4AIykuffjT8L20LU+w4AZd5VvEPY+XpWqLV327HR7DzXuDnD8r+ovkBehJ8i+y8YAAAAASUVORK5CYII=)"},warn:{color:"#C09853","background-color":"#FCF8E3","border-color":"#FBEED5","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABJlBMVEXr6eb/2oD/wi7/xjr/0mP/ykf/tQD/vBj/3o7/uQ//vyL/twebhgD/4pzX1K3z8e349vK6tHCilCWbiQymn0jGworr6dXQza3HxcKkn1vWvV/5uRfk4dXZ1bD18+/52YebiAmyr5S9mhCzrWq5t6ufjRH54aLs0oS+qD751XqPhAybhwXsujG3sm+Zk0PTwG6Shg+PhhObhwOPgQL4zV2nlyrf27uLfgCPhRHu7OmLgAafkyiWkD3l49ibiAfTs0C+lgCniwD4sgDJxqOilzDWowWFfAH08uebig6qpFHBvH/aw26FfQTQzsvy8OyEfz20r3jAvaKbhgG9q0nc2LbZxXanoUu/u5WSggCtp1anpJKdmFz/zlX/1nGJiYmuq5Dx7+sAAADoPUZSAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfdBgUBGhh4aah5AAAAlklEQVQY02NgoBIIE8EUcwn1FkIXM1Tj5dDUQhPU502Mi7XXQxGz5uVIjGOJUUUW81HnYEyMi2HVcUOICQZzMMYmxrEyMylJwgUt5BljWRLjmJm4pI1hYp5SQLGYxDgmLnZOVxuooClIDKgXKMbN5ggV1ACLJcaBxNgcoiGCBiZwdWxOETBDrTyEFey0jYJ4eHjMGWgEAIpRFRCUt08qAAAAAElFTkSuQmCC)"}}}),t(function(){m(p.css).attr("id","core-notify"),t(document).on("click","."+o+"-hidable",function(n){t(this).trigger("notify-hide")}),t(document).on("notify-hide","."+o+"-wrapper",function(n){var e=t(this).data(o);e&&e.show(!1)})})}),$$.control.registerControl("breizbot.alexa",{deps:["brainjs.http"],init(t,n){const e=window.location.hash.substr(1),i=$$.util.parseUrlParams(e);n.post("/api/alexa/auth",i).then(()=>{window.close()})}}),$$.control.registerControl("breizbot.appTab",{props:{appUrl:"about:blank"},template:'<iframe bn-attr="{src: appUrl}" bn-bind="iframe" bn-event="load: onFrameLoaded"></iframe>',init:function(t){const{appUrl:n}=this.props,e=$$.viewController(t,{data:{appUrl:n},events:{onFrameLoaded:function(){}}});this.onAppExit=function(){const t=$(e.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();return t&&"function"==typeof t.onAppExit?t.onAppExit():Promise.resolve()},this.onAppSuspend=function(){const t=$(e.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();t&&"function"==typeof t.onAppSuspend&&t.onAppSuspend()},this.onAppResume=function(){const t=$(e.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();t&&"function"==typeof t.onAppResume&&t.onAppResume()},this.setAppUrl=function(t){e.setData({appUrl:t+"&date="+Date.now()})}}}),$$.control.registerControl("breizbot.apps",{props:{apps:[],showActivated:!1,items:null},$iface:"setData(data)",template:'<div class="scrollPanel">\n\t<div bn-each="apps" \n\t\tbn-iter="app" \n\t\tclass="main" \n\t\tbn-event="click.tile: onTileClick, contextmenuchange.tile: onTileContextMenu"\n\t\t>\t\t\t\n\t\t<div bn-attr="class1" bn-control="brainjs.contextmenu" bn-data="{items: getItems}">\n\t\t\t<div class="arrow-right" bn-show="show1"></div>\n\t\t\t<div bn-show="show2" style="margin-bottom: 5px;">\n\t\t\t\t<i bn-attr="{class: $scope.app.props.iconCls}"></i>\n\t\t\t</div>\n\n\t\t\t<span bn-text="$scope.app.props.title"></span>\n\t\t</div>\n\n\t</div>\n</div>',init:function(t){const{apps:n,showActivated:e,items:i}=this.props,o=$$.viewController(t,{data:{getItems:function(t){return"function"==typeof i?i(t.app):i},apps:n,showActivated:e,show1:function(t){return this.showActivated&&t.app.activated},class1:function(t){return{class:`tile w3-btn ${t.app.props.colorCls}`}},show2:function(t){return"string"==typeof t.app.props.iconCls}},events:{onTileClick:function(n){const e=$(this).index();t.trigger("appclick",o.model.apps[e])},onTileContextMenu:function(n,e){const i=$(this).index(),{cmd:s}=e,r=$.extend({cmd:s},o.model.apps[i]);t.trigger("appcontextmenu",r)}}});this.setData=function(t){o.setData({apps:t.apps.filter(t=>0!=t.props.visible&&"template"!=t.appName)})}},$iface:"setData(data)",$events:"appclick;appcontextmenu"}),$$.control.registerControl("breizbot.addContactPage",{template:'<form bn-event="submit: onSubmit" bn-form="info">\n\n\t<div bn-control="brainjs.accordion" data-height-style="fill">\n\n\n\t\t<div title="Name & Email">\n\t\t\t<div class="gender">\n\t\t\t\t<label>Gender:</label>\n\t\t\t\t<div bn-control="brainjs.radiogroup" name="gender">\n\t\t\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t\t\t<input type="radio" value="male">\n\t\t\t\t\t\t<label>Male</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t\t\t<input type="radio" value="female">\n\t\t\t\t\t\t<label>Female</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Name:</label><br>\n\t\t\t\t<input type="text" name="name" required="">\n\t\t\t</div>\n\t\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Email:</label><br>\n\t\t\t\t<input type="email" name="email">\n\t\t\t</div>\n\t\n\t\t</div>\n\n\t\t<div title="Birthday">\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Birthday</label><br>\n\t\t\t\t<input type="text" bn-control="brainjs.datepicker" \n\t\t\t\t\tbn-data="{\n\t\t\t\t\t\tchangeYear: true,\n\t\t\t\t\t\tyearRange: \'-100:+0\'\n\t\t\t\t\t}"\n\t\t\t\t\tname="birthday">\n\t\t\t</div>\n\t\n\t\t\t<div class="birthNotif">\n\t\t\t\t<label>Activate birthday Notification</label>\n\t\t\t\t<div bn-control="brainjs.flipswitch" name="birthdayNotif"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\t\t<div title="Phones">\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Home Phone:</label><br>\n\t\t\t\t<input name="phone" bn-control="brainjs.inputphone">\n\t\t\t</div>\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Cell Phone:</label><br>\n\t\t\t\t<input name="mobilePhone" bn-control="brainjs.inputphone">\n\t\t\t</div>\n\t\n\t\t</div>\n\n\t\t<div title="Address">\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Address:</label><br>\n\t\t\t\t<input type="text" name="address">\n\t\t\t</div>\n\t\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Postal Code:</label><br>\n\t\t\t\t<input type="number" name="postalCode" maxlength="5" bn-event="blur: onPostalCodeLostFocus">\n\t\t\t</div>\n\t\n\t\t\t<div>\n\t\t\t\t<label>City:</label>\n\t\t\t\t<div bn-control="brainjs.combobox" bn-data="{items: cities}" name="city" bn-val="city"></div>\n\t\t\t</div>\n\t\n\t\t</div>\n\n\t</div>\n\n\t<input type="submit" bn-bind="submit" hidden="">\n</form>',deps:["breizbot.pager","breizbot.contacts","breizbot.cities"],props:{data:{}},init:function(t,n,e,i){const o=this.props.info||{},s=o._id,{postalCode:r,city:a}=o,l=$$.viewController(t,{data:{info:o,cities:[]},events:{onSubmit:async function(t){t.preventDefault();const e=$(this).getFormData();n.popPage({id:s,data:e})},onPostalCodeLostFocus:async function(){const t=await i.getCitesFromPostalCode(this.value);l.setData({cities:t})}}});r&&""!=r&&async function(){const t=await i.getCitesFromPostalCode(r);l.setData({cities:t}),a&&""!=a&&l.setData({city:a})}(),this.addContact=async function(t){await e.addContact(t)},this.updateContactInfo=async function(t,n){await e.updateContactInfo(t,n)},this.getButtons=function(){return{add:{title:"Apply",icon:"fa fa-check",onClick:function(){l.scope.submit.click()}}}}}}),$$.control.registerControl("breizbot.contacts",{deps:["breizbot.contacts"],props:{showSelection:!1,hasSearchbar:!1,contextMenu:{}},template:'<div bn-control="breizbot.searchbar" \n\tbn-event="searchbarsubmit: onSearch" \n\tbn-show="hasSearchbar"\n\tbn-data="{required: false}"\n\t></div>\n<p bn-show="show2">You have no contacts</p>\n<div class="scrollPanel">\n\t<ul class="w3-ul w3-border w3-white" \n\t\tbn-event="contextmenuchange.w3-bar: onItemContextMenu, click.w3-bar: onItemClick, click.input: onInputClick"\n\t\tbn-each="getContacts"\n\t\tbn-show="show1"\n\t\t>\n\t\t<li class="w3-bar" bn-control="brainjs.contextmenu" bn-data="{items: contextMenu}">\n\n\t\t\t<div class="w3-bar-item" >\n\t\t\t\t<strong bn-text="$scope.$i.name"></strong><br>\n\t\t\t\t<div bn-text="getAddress"></div>\n\t\t\t\t<div bn-show="$scope.$i.email">\n\t\t\t\t\t<i class="fa fa-envelope w3-text-blue"></i>\n\t\t\t\t\t<span bn-text="$scope.$i.email"></span>\t\n\t\t\t\t</div>\n\t\t\t\t<div bn-show="$scope.$i.mobilePhone">\n\t\t\t\t\t<a bn-attr="{href : getCellPhone}"><i class="fa fa-mobile-alt w3-text-blue"></i></a>\n\t\t\t\t\t<input class="input" bn-control="brainjs.inputphone" bn-val="$scope.$i.mobilePhone" readonly>\t\n\t\t\t\t</div>\n\t\t\t\t<div bn-show="$scope.$i.phone">\n\t\t\t\t\t<a bn-attr="{href : getHomePhone}"><i class="fa fa-home w3-text-blue"></i></a>\n\t\t\t\t\t<input class="input" bn-control="brainjs.inputphone" bn-val="$scope.$i.phone" readonly>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</li>\n\t</ul>\t\t\n\n</div>\n',init:function(t,n){const{showSelection:e,contextMenu:i,hasSearchbar:o}=this.props,s=$$.viewController(t,{data:{contacts:[],showSelection:e,hasSearchbar:o,filter:"",contextMenu:i,getContacts:function(){if(""!=this.filter){const t=new RegExp(`w*${this.filter}w*`,"i");return this.contacts.filter(n=>t.test(n.name))}return this.showSelection?this.contacts.filter(t=>t.email&&""!=t.email):this.contacts},show1:function(){return this.contacts.length>0},show2:function(){return 0==this.contacts.length},getCellPhone:function(t){return"tel:"+t.$i.mobilePhone},getHomePhone:function(t){return"tel:"+t.$i.phone},getAddress:function(t){const{address:n,city:e,postalCode:i}=t.$i;return`${n||""} ${i||""} ${e||""}`}},events:{onSearch:function(t,n){s.setData({filter:n.value})},onInputClick:function(){$(this).closest("div").find("a").get(0).click()},onItemContextMenu:function(n,e){const{cmd:i}=e,o=$(this).index(),r=s.model.getContacts()[o];t.trigger("contactcontextmenu",{cmd:i,info:r})},onItemClick:function(){e&&$(this).toggleClass("w3-blue")}}});async function r(){const t=await n.getContacts();s.setData({contacts:t})}r(),this.update=r,this.removeContact=async function(t){await n.removeContact(t),await r()},this.getSelection=function(){const n=[];return t.find("li.w3-blue").each(function(){const t=$(this).index();n.push(s.model.getContacts()[t])}),console.log("ret",n),n}},$iface:"\n\t\tgetSelection(): [ContactInfo]\n\t\tremoveContact(id)\n\t",$events:"contactclick"}),$$.control.registerControl("breizbot.htmleditor",{template:'<div bn-event="click.cmd: onCommand" class="toolbar">\n\t<div class="group">\n\t\t<button class="cmd w3-button" data-cmd="bold" title="Bold"><i class="fa fa-bold"></i></button>\n\t\t<button class="cmd w3-button" data-cmd="italic" title="Italic"><i class="fa fa-italic"></i></button>\n\t\t<button class="cmd w3-button" data-cmd="underline" title="Underline"><i class="fa fa-underline"></i></button>\n\t\t<span class="separator"></span>\n\n\t</div>\n\n\t<div class="group">\n\t\t<button class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onFontNameChange"\n\t\t\ttitle="Font Name"\n\t\t\tbn-html="getFontName"\n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: fontNameItems\n\t\t\t}">\n\t\t\t<i class="fas fa-caret-down"></i>`\n\n\t\t</button>\n\n\t\t<button class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onFontSizeChange"\n\t\t\ttitle="Font Size"\n\t\t\tbn-html="getFontSize"\n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: fontSizeItems\n\t\t\t}">\n\t\t\t<i class="fas fa-caret-down"></i>`\n\n\t\t</button>\n\n\n\t\t<button class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand"\n\t\t\ttitle="Title"\n\t\t\tdata-cmd="formatBlock" bn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: headingItems\n\t\t\t}">\n\t\t\tÂ§&nbsp;\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<button title="Alignment" class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand" bn-data="{\n\t\t\ttrigger: \'left\',\n\t\t\titems: {\n\t\t\t\tjustifyLeft: {name: \'Left\', icon: \'fas fa-align-left\'},\n\t\t\t\tjustifyCenter: {name: \'Center\', icon: \'fas fa-align-center\'},\n\t\t\t\tjustifyRight: {name: \'Right\', icon: \'fas fa-align-right\'}\n\t\t\t}\n\t\t}">\n\t\t\t<i class="fas fa-align-left"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<button class="w3-button" title="Text color" bn-control="brainjs.contextmenu"\n\t\t\tbn-data="{\n\t\t\t\titems: colorItems,\n\t\t\t\ttrigger: \'left\'\n\t\t\t}"\n\t\t\tbn-event="contextmenuchange: onColorMenuChange">\n\t\t\t<i class="fas fa-paint-brush" bn-style="{color}"></i>\n\t\t</button>\n\n\t\t<span class="separator"></span>\n\t</div>\n\n\t<div class="group">\n\t\t<button title="Indent" class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand" bn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: {\n\t\t\t\t\tindent: {name: \'Indent\', icon: \'fas fa-indent\'},\n\t\t\t\t\toutdent: {name: \'Outdent\', icon: \'fas fa-outdent\'}\n\t\t\t\t}\n\t\t\t}">\n\t\t\t<i class="fas fa-indent"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\n\t\t<button title="List" class="w3-button" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCommand" bn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: {\n\t\t\t\t\tinsertUnorderedList: {name: \'Unordered\', icon: \'fas fa-list-ul\'},\n\t\t\t\t\tinsertOrderedList: {name: \'Ordered\', icon: \'fas fa-list-ol\'}\n\t\t\t\t}\n\t\t\t}">\n\t\t\t<i class="fas fa-list-ol"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<span class="separator"></span>\n\n\t</div>\n\n\t<div class="group">\n\t\t<button class="w3-button cmd" title="Horizontal Rule" data-cmd="insertHorizontalRule"><i class="fas fa-minus"></i></button>\n\t\t<button class="w3-button" title="Insert Link" bn-event="click: onCreateLink"><i class="fas fa-link"></i></button>\n\t\t<button title="Insert image" bn-event="click: onInsertImage" class="w3-button">\n\t\t\t<i class="fa fa-image"></i></button>\n\n\t</div>\n\n\n</div>\n\n\n</div>\n<div class="scrollPanel" bn-event="click: onScrollClick">\n\t<div contenteditable="true" bn-bind="editor" class="editor" bn-html="html"></div>\n</div>',deps:["breizbot.pager","breizbot.files"],props:{useDataUrlForImg:!1},init:function(t,n,e){const{useDataUrlForImg:i}=this.props;console.log("useDataUrlForImg",i);const o={black:"#000000",red:"#f44336",green:"#4CAF50",blue:"#2196F3",yellow:"#ffeb3b",cyan:"#00bcd4",pink:"#e91e63"},s="8,10,12,14,18,24,36".split(","),r=["Arial","Courier New","Times New Roman"];const a=function(){const t={};return s.forEach((n,e)=>{t[e+1]={name:`<font size="${e+1}">${n} pt</font>`,isHtmlName:!0}}),t}(),l=function(){const t={};return r.forEach(n=>{t[n]={name:`<font face="${n}">${n}</font>`,isHtmlName:!0}}),t}(),c=function(){const t={};return Object.keys(o).forEach(n=>{t[n]={name:n.charAt(0).toUpperCase()+n.slice(1),icon:`fas fa-square-full w3-text-${n}`}}),t}(),u=o.black,d=$$.viewController(t,{data:{html:t.val(),fontSize:"3",fontName:"Arial",getFontSize:function(){return`${s[this.fontSize-1]} pt&nbsp;<i class="fas fa-caret-down"></i>`},getFontName:function(){return`${this.fontName}&nbsp;<i class="fas fa-caret-down"></i>`},fontSizeItems:a,fontNameItems:l,colorItems:c,color:u,headingItems:function(){const t={p:{name:"Normal"}};for(let n=1;n<=6;n++)t["h"+n]={name:`<h${n}>Heading ${n}</h${n}>`,isHtmlName:!0};return t}()},events:{onInsertImage:function(t){!function(){const t=window.getSelection();if(!f(t.anchorNode))return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const o=t.getRangeAt(0);n.pushPage("breizbot.files",{title:"Insert Image",props:{filterExtension:"jpg,jpeg,png,gif"},events:{fileclick:function(t,e){n.popPage(e)}},onReturn:async function(t){console.log("onReturn",t);const{fileName:n,rootDir:s}=t;let r=e.fileUrl(s+n);i&&(r=await $$.util.imageUrlToDataUrl(r));const a=document.createElement("img");a.src=r,o.insertNode(a)}})}()},onFontNameChange:function(t,n){d.setData({fontName:n.cmd}),document.execCommand("fontName",!1,n.cmd)},onFontSizeChange:function(t,n){d.setData({fontSize:n.cmd}),document.execCommand("fontSize",!1,n.cmd)},onCreateLink:async function(){const t=window.getSelection();if(!f(t.anchorNode))return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const n=t.getRangeAt(0),e=await $$.ui.showPrompt({title:"Insert Link",label:"Link Target",attrs:{type:"url"}});null!=e&&(t.removeAllRanges(),t.addRange(n),document.execCommand("createLink",!1,e))},onScrollClick:function(){d.scope.editor.focus()},onCommand:function(t,n){let e,i;n?null!=(e=$(this).data("cmd"))?i=n.cmd:e=n.cmd:(e=$(this).data("cmd"),i=$(this).data("cmdArg")),document.execCommand(e,!1,i)},onColorMenuChange:function(t,n){console.log("onColorMenuChange",n);const e=o[n.cmd];d.setData({color:e}),document.execCommand("foreColor",!1,e)}}});function f(t){const n=d.scope.editor.get(0);for(;t&&t!=document.documentElement;){if(t==n)return!0;t=t.parentNode}return!1}t.find("button.w3-button").attr("type","button"),$(document).on("selectionchange",()=>{const t=window.getSelection();if(!f(t.anchorNode))return;const n=$(t.anchorNode).closest("font[size]");if(1==n.length){const t=n.attr("size")||"3",e=n.attr("face")||"Arial";d.setData({fontSize:t,fontName:e})}else d.setData({fontSize:"3",fontName:"Arial"});const e=$(t.anchorNode).closest("font[color]");if(1==e.length){const t=e.attr("color")||u;d.setData({color:t})}else d.setData({color:u})}),this.html=function(t){if(null==t)return d.scope.editor.html();d.scope.editor.html(t)},this.load=function(t){return d.scope.editor.load(t)},this.getValue=function(){return d.scope.editor.html()},this.setValue=function(t){d.scope.editor.html(t)},this.focus=function(){d.scope.editor.get(0).focus()}},$iface:"\n\t\thtml(htmlString): string;load(url)\n\t"}),function(){$$.control.registerControl("breizbot.files",{deps:["breizbot.files"],props:{selectionEnabled:!1,imageOnly:!1,filterExtension:void 0,getMP3Info:!1,friendUser:"",mp3Filters:null,menuItems:function(t){return{}}},template:'\n<div bn-text="info" bn-bind="info" class="info"></div>\n\n<div bn-show="loading" class="loading">\n\t<i class="fa fa-spinner fa-pulse"></i>\n\tloading ...\n</div>\n\n<div class="pathPanel" bn-event="click.pathItem: onPathItem" bn-show="!loading">\n\t<div bn-each="getPath" bn-index="idx">\n\t\t<i class="fa fa-chevron-right" bn-show="!isFirst"></i>\n\t\t<span>\n\t\t\t<a class="pathItem" bn-text="$scope.$i" href="#" bn-show="!isLast" bn-data="{info: getPathInfo}"></a>\n\t\t\t<span bn-text="$scope.$i" bn-show="isLast" class="lastItem"></span>\n\n\t\t</span>\n\t</div>\n\n\n</div>\n\n\n<div class="scrollPanel">\n\n\t<div \n\t\tbn-each="getFiles" \n\t\tbn-iter="f" \n\t\tbn-lazzy="10" \n\t\tbn-bind="files" \n\t\tbn-event="click.folder: onFolderClick, click.check: onCheckClick, click.file: onFileClick, contextmenuchange.thumbnail: onContextMenu"\n\t\tclass="container"\n\t>\n\n\t\t<div class="thumbnail w3-card-2" bn-control="brainjs.contextmenu" bn-data="{items: getItems}">\n\n\t\t\t<span bn-if="if1">\n\t\t\t\t<input type="checkbox" bn-show="selectionEnabled" class="check w3-check"\n\t\t\t\t\tbn-prop="{checked: $scope.f.checked}">\n\t\t\t</span>\n\t\t\t<div bn-if="$scope.f.folder" class="folder item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i class="fa fa-4x fa-folder-open w3-text-blue-grey"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate" bn-if="if1"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div bn-if="if2" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i bn-attr="{class: class1}"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bn-if="isMP3" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i bn-attr="{class: class1}"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<div>Title:&nbsp;<strong bn-text="$scope.f.mp3.title"></strong></div>\n\n\t\t\t\t\t<div>Artist:&nbsp;<strong bn-text="$scope.f.mp3.artist"></strong></div>\n\t\t\t\t\t<div bn-show="hasGenre">Genre:&nbsp;<strong bn-text="$scope.f.mp3.genre"></strong></div>\n\t\t\t\t\t<div bn-show="hasYear"> Year:&nbsp;<strong bn-text="getYear"></strong></div>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bn-if="if3" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<img bn-attr="{src: getThumbnailUrl}">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t\t<span bn-text="getDimension"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\n\n</div>',init:function(t,n){let e=!1,{selectionEnabled:i,filterExtension:o,friendUser:s,imageOnly:r,getMP3Info:a,mp3Filters:l,menuItems:c}=this.props;const u=$$.viewController(t,{data:{getItems:function(t){return c(t.f)},loading:!1,selectionEnabled:i,rootDir:"/",files:[],mp3Filters:l,info:function(){let t=0,n=0;this.getFiles().forEach(e=>{e.folder?".."!=e.name&&n++:t++});let e=[];return 1==n&&e.push(`${n} folder`),n>1&&e.push(`${n} folders`),1==t&&e.push(`${t} file`),t>1&&e.push(`${t} files`),e.join(" / ")},isInFilter:function(t){var n=!0;for(let e in this.mp3Filters){const i=t[e],o=this.mp3Filters[e];"All"!=o&&(n&=o===i)}return n},getFiles:function(){return null===this.mp3Filters?this.files:this.files.filter(t=>t.folder||t.mp3&&t.mp3&&this.isInFilter(t.mp3))},isMP3:function(t){return a&&null!=t.f.mp3&&null!=t.f.mp3.title&&""!=t.f.mp3.title},getPath:function(){const t=("/home"+this.rootDir).split("/");return t.shift(),t.pop(),t},isLast:function(t){return t.idx==this.getPath().length-1},isFirst:function(t){return 0==t.idx},getPathInfo:function(t){return this.getPath().slice(1,t.idx+1).join("/")},hasGenre:function(t){let{genre:n}=t.f.mp3;return null!=n&&""!=n&&!n.startsWith("(")},hasYear:function(t){let{year:n}=t.f.mp3;return null!=n&&""!=n},getYear:function(t){return parseInt(t.f.mp3.year)},getThumbnailUrl:function(t){return n.fileThumbnailUrl(this.rootDir+t.f.name,"100x?",s)},if1:function(t){return".."!=t.f.name},if2:function(t){return!t.f.folder&&!t.f.isImage&&!this.isMP3(t)},if3:function(t){return!t.f.folder&&t.f.isImage},class1:function(t){return`fa fa-4x w3-text-blue-grey ${n=t.f.name,(n=n.toLowerCase()).endsWith(".pdf")?"fa-file-pdf":n.endsWith(".hdoc")?"fa-file-word":n.endsWith(".ogg")||n.endsWith(".mp3")?"fa-file-audio":n.endsWith(".mp4")||n.endsWith(".webm")||n.endsWith(".3gp")?"fa-file-video":n.endsWith(".zip")?"fa-file-archive":"fa-file"}`;var n},getSize:function(t){let n=t.f.size,e="octets";return n>1024&&(e="Ko",n/=1024),n>1024&&(e="Mo",n/=1024),"Size: "+(n=Math.floor(10*n)/10)+" "+e},getDimension:function(t){const n=t.f.dimension;return`Dimension: ${n.width}x${n.height}`},getDate:function(t){return"Last Modif: "+new Date(t.f.mtime).toLocaleDateString()}},events:{onPathItem:function(n){const e=$(this).data("info");n.preventDefault();const i=""==e?"/":"/"+e+"/";n.stopPropagation(),t.trigger("dirchange",{newDir:i}),d(i)},onContextMenu:async function(n,e){const{cmd:i}=e,o=$(this).closest(".thumbnail").index(),{name:s}=u.model.files[o],{rootDir:r}=u.model;n.stopPropagation(),t.trigger("contextmenuItem",{cmd:i,idx:o,name:s,rootDir:r})},onFileClick:function(n){const e=$(this).closest(".thumbnail").index(),i=u.model.getFiles()[e];n.stopPropagation();const o={fileName:i.name,rootDir:u.model.rootDir,isImage:i.isImage};t.trigger("fileclick",o)},onCheckClick:function(n){const e=$(this).closest(".thumbnail").index();u.model.getFiles()[e].checked=$(this).getValue(),n.stopPropagation(),t.trigger("selchange",{isShareSelected:f()})},onFolderClick:function(n){const e=$(this).closest(".thumbnail").index(),i=u.model.getFiles()[e].name;let o;if(".."==i){const t=u.model.rootDir.split("/");t.pop(),t.pop(),o=t.join("/")+"/"}else o=u.model.rootDir+i+"/";n.stopPropagation(),t.trigger("dirchange",{newDir:o}),d(o)}}});async function d(t,e){null==t&&(t=u.model.rootDir),u.setData({loading:!0});const i=await n.list(t,{filterExtension:o,imageOnly:r,getMP3Info:a},s);"/"!=t&&i.unshift({name:"..",folder:!0}),function(t){t.sort((t,n)=>t.folder&&!n.folder?-1:!t.folder&&n.folder?1:t.name.localeCompare(n.name))}(i),!1!==e&&(u.model.mp3Filters=null),u.setData({loading:!1,files:i,rootDir:t,nbSelection:0})}function f(){return"/"==u.model.rootDir&&-1!=u.model.files.findIndex(t=>"share"==t.name&&t.folder&&t.checked)}d(),this.getSelFiles=function(){const t=[];return u.model.files.forEach((n,e)=>{const{name:i,checked:o}=n;!0===o&&".."!=i&&t.push({fileName:u.model.rootDir+i,idx:e})}),t},this.getSelFileNames=(()=>this.getSelFiles().map(t=>t.fileName)),this.getNbSelFiles=function(){return t.find(".check:checked").length},this.toggleSelection=function(){e=!e,t.find(".check").prop("checked",e),u.model.files.forEach(t=>{t.checked=e}),u.updateArrayValue("files","files"),t.trigger("selchange",{isShareSelected:f()})},this.getRootDir=function(){return u.model.rootDir},this.insertFile=function(t,n){n?u.insertArrayItemAfter("files",n,t,"files"):(n=u.model.getFiles().filter(t=>t.folder).length,u.insertArrayItemAfter("files",n-1,t,"files")),u.updateNode("info")},this.removeFiles=function(t){u.removeArrayItem("files",t,"files"),u.updateNode("info")},this.updateFile=function(t,n){u.updateArrayItem("files",t,n,"files")},this.updateFileInfo=async function(t,e){const{files:i,rootDir:o}=u.model;let r=u.model.getFiles().findIndex(n=>n.name==t);const a=await n.fileInfo(o+t,s,e);u.updateArrayItem("files",r,a),r=i.findIndex(n=>n.name==t),i[r]=a},this.getFiles=function(){return u.model.files.filter(t=>!t.folder)},this.getFilteredFiles=function(){return u.model.getFiles().filter(t=>!t.folder)},this.reload=function(){d(void 0,!1)},this.setMP3Filters=function(t){u.setData({mp3Filters:t})},this.getMP3Filters=function(){return u.model.mp3Filters}}})}(),$$.control.registerControl("breizbot.friends",{props:{showSelection:!1,showSendMessage:!1,showConnectionState:!0},deps:["breizbot.friends","breizbot.notifs","breizbot.broker"],template:'<ul class="w3-ul w3-border w3-white" bn-each="friends" bn-show="show1"\n\tbn-event="click.w3-bar: onItemClick, click.notif: onSendMessage">\n\t<li class="w3-bar" style="cursor: pointer;">\n\t\t\n\t\t<span class="w3-button w3-right notif w3-blue" title="Send Message" bn-show="showSendMessage">\n\t\t\t<i class="fa fa-envelope"></i>\n\t\t</span>\n\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-user" bn-class="class1"></i>\n\t\t\t<span bn-text="$scope.$i.friendUserName"></span>\n\t\t</div>\n\t</li>\n</ul>\n<p bn-show="show2">You have no friends</p>',init:function(t,n,e,i){const{showSelection:o,showSendMessage:s,showConnectionState:r}=this.props,a=$$.viewController(t,{data:{friends:[],showSendMessage:s,showConnectionState:r,show1:function(){return this.friends.length>0},show2:function(){return 0==this.friends.length},class1:function(t){const n=t.$i,e=this.showConnectionState;return{"w3-text-green":n.isConnected&&e,"w3-text-red":!n.isConnected&&e,"w3-text-blue":!e}}},events:{onItemClick:function(){const n=$(this).closest("li").index(),e=a.model.friends[n].friendUserName;o&&($(this).siblings(".w3-blue").removeClass("w3-blue"),$(this).addClass("w3-blue")),t.trigger("friendclick",{userName:e})},onSendMessage:async function(t){t.stopPropagation();const n=$(this).closest("li").index(),i=a.model.friends[n].friendUserName,o=await $$.ui.showPrompt({title:"Send Message",label:"Message:"});null!=o&&e.sendNotif(i,{text:o,reply:!0})}}});function l(t){if(!0===t.hist)return;const{isConnected:n,userName:e}=t.data;a.model.friends.find(t=>t.friendUserName==e).isConnected=n,a.update()}i.register("breizbot.friends",l),this.getSelection=function(){const n=t.find("li.w3-blue").index();return a.model.friends[n]},this.getFriends=function(){return a.model.friends.map(t=>t.friendUserName)},this.update=function(){n.getFriends().then(t=>{a.setData({friends:t})})},this.dispose=function(){console.log("[friends] dispose"),i.unregister("breizbot.friends",l)},this.update()},$iface:"\n\t\tgetSelection():string;\n\t\tgetFriends():[string]\n\t",$events:"friendclick"}),$$.control.registerControl("breizbot.home",{deps:["breizbot.broker","breizbot.users","breizbot.notifs","breizbot.geoloc","breizbot.rtc","breizbot.apps","breizbot.scheduler","breizbot.wakelock","breizbot.fullscreen"],props:{userName:"Unknown"},template:'<div class="header">\n\t<div>\n\t\t<button class="w3-button" title="FullScreen" bn-event="click: onFullScreen" bn-show="!fullScreen">\n\t\t\t<i class="fa fa-expand"></i></button>\n\t\t<button class="w3-button" title="Exit FullScreen" bn-event="click: onExitFullScreen" bn-show="fullScreen">\n\t\t\t<i class="fa fa-compress"></i></button>\n\t\t<button class="w3-button" title="Connection Status">\n\t\t\t<i bn-class="{w3-text-green: connected, w3-text-red: !connected}" class="fa fa-circle"></i>\n\n\t\t</button>\n\t\t<div bn-show="hasIncomingCall" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCallResponse"\n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\', \n\t\t\t\ttitle: callInfo.from,\n\t\t\t\titems: {\n\t\t\t\t\taccept: {name: \'Accept\'},\n\t\t\t\t\tdeny: {name: \'Decline\'},\n\t\t\t\t}\n\t\t\t}" class="w3-button">\n\t\t\t<i class="fa fa-spinner fa-pulse"></i>\n\t\t\t<i bn-attr="{class: callInfo.iconCls}"></i>\n\t\t</div>\n\t</div>\n\n\n\t\x3c!-- \t<strong bn-text="title"></strong>\n --\x3e\n\t<div>\n\t\t<button class="notification w3-button" title="Notification" bn-event="click: onNotification">\n\t\t\t<i class="fa fa-lg fa-bell"></i>\n\t\t\t<span class="w3-badge w3-red w3-tiny" bn-text="nbNotif" bn-show="hasNotif"></span>\n\t\t</button>\n\n\n\n\t\t<div bn-control="brainjs.contextmenu" bn-data="{\n\t\t\t\titems: {\n\t\t\t\t\tsettings: {name: \'Settings\', icon: \'fas fa-cog\'},\n\t\t\t\t\tapps: {name: \'Applications\', icon: \'fas fa-th\'},\n\t\t\t\t\tsep: \'------\',\n\t\t\t\t\tlogout: {name: \'Logout\', icon: \'fas fa-power-off\'}\n\t\t\t\t},\n\t\t\t\ttitle: userName,\n\t\t\t\ttrigger: \'left\'\n\t\t\t}" class="w3-button" bn-event="contextmenuchange: onContextMenu">\n\t\t\t<i class="fas fa-user-circle fa-lg"></i>\n\n\t\t</div>\n\n\t</div>\n\n\n</div>\n\n<div bn-control="brainjs.tabs" class="content" bn-iface="tabs"\n\tbn-event="tabsremove: onTabRemove, tabsactivate: onTabActivate">\n\t<div bn-control="breizbot.apps" bn-data="{\n\t\t\tapps: getMyApps,\n\t\t\titems\n\t\t}" bn-event="appclick: onAppClick, appcontextmenu: onTileContextMenu" title="Home">\n\t</div>\n\n</div>',init:function(t,n,e,i,o,s,r,a,l,c){s.processCall(),s.on("call",function(t){f.setData({hasIncomingCall:!0,callInfo:t}),d.play()}),s.on("cancel",function(){f.setData({hasIncomingCall:!1}),d.stop()});const{userName:u}=this.props,d=function(){let t=null;return{play:function(){(t=new Audio("/assets/skype.mp3")).loop=!0,setTimeout(()=>{t.play()},100)},stop:function(){null!=t&&t.pause(),t=null}}}(),f=$$.viewController(t,{data:{apps:[],userName:u,nbNotif:0,hasIncomingCall:!1,callInfo:null,fullScreen:!1,connected:!1,hasNotif:function(){return this.nbNotif>0},getMyApps:function(){return this.apps.filter(t=>t.activated)},items:function(){return{remove:{name:"Remove"}}}},events:{onTileContextMenu:async function(t,n){await e.activateApp(n.appName,!1),m()},onAppClick:function(t,n){b(n.appName)},onContextMenu:async function(t,n){if("logout"==n.cmd&&a.logout(),"apps"==n.cmd&&b("store"),"settings"==n.cmd){const t=await e.getUserSettings();console.log("setting",t),b("settings",t)}},onNotification:function(t){0==f.model.nbNotif?$$.ui.showAlert({content:"no notifications",title:"Notifications"}):b("notif")},onCallResponse:function(t,n){const{cmd:e}=n;if(f.setData({hasIncomingCall:!1}),d.stop(),"accept"==e){const{from:t,appName:n}=f.model.callInfo;b(n,{caller:t,clientId:s.getRemoteClientId()})}"deny"==e&&s.deny()},onExitFullScreen:function(){c.exit()},onFullScreen:function(t){c.enter()},onTabRemove:function(t,n){f.scope.tabs.getTabInfo(n).ctrlIface.onAppExit().then(()=>{f.scope.tabs.removeTab(n)})},onTabActivate:function(t,n){const{newTab:e,oldTab:i}=n,o=e.index(),s=i.index();if(s>0){f.scope.tabs.getTabInfo(s).ctrlIface.onAppSuspend()}if(o>0){f.scope.tabs.getTabInfo(o).ctrlIface.onAppResume()}0==o&&m()}}}),p=f.scope.tabs;function h(t){f.setData({nbNotif:t})}function b(t,n){const e=f.model.apps.find(n=>n.appName==t).props.title;let i=p.getTabIndexFromTitle(e);const o=$$.util.getUrlParams(`/apps/${t}`,n);if(i<0)i=p.addTab(e,{removable:!0,control:"breizbot.appTab",props:{appUrl:o}});else{const t=p.getTabInfo(i);null!=n&&t.ctrlIface.setAppUrl(o)}p.setSelectedTabIndex(i)}function m(){r.listAll().then(t=>{f.setData({apps:t})})}c.init(t=>{f.setData({fullScreen:t})}),n.on("connected",t=>{f.setData({connected:t})}),window.addEventListener("message",t=>{const{type:n,data:e}=t.data;if("openApp"==n){const{appName:t,appParams:n}=e;b(t,n)}"reload"==n&&location.reload()},!1),n.register("breizbot.friends",t=>{if(!0===t.hist)return;const{isConnected:n,userName:e}=t.data;n?$.notify(`'${e}' is connected`,"success"):$.notify(`'${e}' is disconnected`,"error")}),n.register("breizbot.notifCount",function(t){h(t.data)}),n.onTopic("breizbot.logout",function(t){location.href="/logout"}),i.getNotifCount().then(h),m(),o.startWatch(),l.requestWakeLock()}}),$$.control.registerControl("breizbot.pager",{props:{rootPage:""},template:'<div bn-show="showBack" class="toolbar">\n\t<div class="left">\n\t\t<button class="w3-button" title="Back" bn-event="click: onBack">\n\t\t\t<i class="fa fa-arrow-left"></i>\n\t\t</button>\n\t\t<span bn-text="title" class="title"></span>\n\t\n\t</div>\n\t<div bn-each="buttons" class="right" bn-event="click.action: onAction, contextmenuchange.menu: onContextMenu">\n\t\t<button bn-show="show1" class="w3-button action" bn-text="$scope.$i.label"\n\t\t\tbn-data="{cmd: $scope.$i.name}" bn-prop="{disabled: !isEnabled}"></button>\n\t\t<button bn-show="show2" class="w3-button action" bn-data="{cmd: $scope.$i.name}"\n\t\t\tbn-attr="{title: $scope.$i.title}" bn-prop="{disabled: !isEnabled}"><i bn-attr="{class: $scope.$i.icon}"></i></button>\n\n\t\t\t<button bn-show="show3" class="w3-button menu" \n\t\t\tbn-prop="{disabled: !isEnabled}"\n\t\t\tbn-control="brainjs.contextmenu" bn-data="{items: $scope.$i.items, trigger: \'left\', cmd: $scope.$i.name}"\n\t\t\tbn-attr="{title: $scope.$i.title}"><i bn-attr="{class: $scope.$i.icon}"></i></button>\n\t\t</div>\t\t\t\n\t</div>\n</div>\n<div bn-bind="content" class="content"></div>',$iface:"\n\t\tpopPage(data)\n\t\tpushPage(ctrlName, options)\n\t\tsetButtonVisible(buttonsVisible: {[buttonName]:boolean})\n\t\tsetButtonEnabled(buttonsEnabled: {[buttonName]:boolean})\n\t",init:function(t){const{rootPage:n}=this.props,e=$$.viewController(t,{data:{showBack:!1,title:"",buttons:[],show1:function(t){return null==t.$i.items&&null==t.$i.icon&&!(!1===t.$i.visible)},show2:function(t){return null==t.$i.items&&null!=t.$i.icon&&!(!1===t.$i.visible)},show3:function(t){return null!=t.$i.items&&!(!1===t.$i.visible)},isEnabled:t=>null==t.$i.enabled||!0===t.$i.enabled},events:{onBack:function(t){r(!0)},onAction:function(t){const n=$(this).data("cmd"),e=s.ctrl.iface(),i=s.buttons[n].onClick;"function"==typeof i&&i.call(e)},onContextMenu:function(t,n){console.log("onContextMenu",n);const e=$(this).data("cmd"),i=s.ctrl.iface();console.log("onAction",e);const o=s.buttons[e].onClick;"function"==typeof o&&o.call(i,n.cmd)}}}),i=e.scope.content,o=[];let s=null;function r(t,n){const i=s.ctrl.iface();s.ctrl.safeEmpty().remove(),t?"function"==typeof s.onBack&&s.onBack.call(i):"function"==typeof s.onReturn&&s.onReturn.call(i,n),(s=o.pop()).ctrl.show();const{title:r,buttons:a}=s;e.setData({showBack:o.length>0,title:r,buttons:$$.util.objToArray(a,"name")})}this.popPage=function(t){return r(!1,t)},this.pushPage=function(t,n){null!=s&&(s.ctrl.hide(),o.push(s)),n=n||{};let{title:r,props:a,onReturn:l,onBack:c,events:u}=n;const d=i.addControl(t,a,u);let f={};if(null!=n.buttons)f=n.buttons;else{const t=d.iface().getButtons;"function"==typeof t&&(f=t())}s={title:r,buttons:f,onReturn:l,onBack:c,ctrl:d},e.setData({showBack:o.length>0,title:r,buttons:$$.util.objToArray(f,"name")})},this.setButtonVisible=function(t){const{buttons:n}=s;for(let e in t)e in n&&(n[e].visible=t[e]);e.setData({buttons:$$.util.objToArray(n,"name")})},this.setButtonEnabled=function(t){const{buttons:n}=s;if("boolean"==typeof t)for(let e in n)n[e].enabled=t;else for(let e in t)e in n&&(n[e].enabled=t[e]);e.setData({buttons:$$.util.objToArray(n,"name")})},this.pushPage(n)}}),$$.control.registerControl("breizbot.pdf",{template:'<div class="toolbar">\n\t<div bn-show="wait" class="loading">\n\t\t<i class="fa fa-spinner fa-pulse"></i> Rendering...\n\t</div>\n\t<div bn-show="!wait">\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Fit" \n\t\t\tbn-icon="fa fa-expand"\n\t\t\tbn-event="click: onFit">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Print" \n\t\t\tbn-icon="fa fa-print"\n\t\t\tbn-event="click: onPrint">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Go to Page" \n\t\t\tbn-icon="fa fa-reply fa-flip-horizontal"\n\t\t\tbn-event="click: onGotoPage">\n\t\t</button>\t\t\n\t</div>\n\t<div>\n\t</div>\n\t<div class="pages" bn-show="show1">\n\t\t<div>\n\t\t\t<button class="w3-button" title="previous page" bn-event="click: onPrevPage" bn-icon="fa fa-angle-left">\n\t\t\t</button>\t\n\n\t\t\t<button class="w3-button" title="next page" bn-event="click: onNextPage" bn-icon="fa fa-angle-right">\n\t\t\t</button>\t\t\t\n\t\t</div>\n\t\t<div>\n\t\t\tPages: <span bn-text="currentPage"></span> / <span bn-text="numPages"></span>\t\t\n\t\t</div>\n\t</div>\n</div>\n\t\n<div bn-control="brainjs.pdf" \n\tbn-data="{worker: \'/brainjs/pdf/worker.js\'}"\n\tbn-iface="pdf"\n\t \n></div>\t\t\n',props:{url:""},init:function(t){const{url:n}=this.props,e=$$.viewController(t,{data:{numPages:0,title:"",currentPage:1,wait:!1,show1:function(){return this.numPages>1&&!this.wait}},events:{onGotoPage:async function(){const t=await $$.ui.showPrompt({title:"Go to Page",label:"Page Number",attrs:{type:"number",min:1,max:e.model.numPages,step:1}});e.setData({wait:!0});const n=await i.setPage(t);e.setData({currentPage:n,wait:!1})},onPrint:function(){i.print()},onNextPage:async function(t){e.setData({wait:!0});const n=await i.nextPage();e.setData({currentPage:n,wait:!1})},onPrevPage:async function(t){e.setData({wait:!0});const n=await i.prevPage();e.setData({currentPage:n,wait:!1})},onFit:function(t){i.fit()}}}),i=e.scope.pdf;async function o(t,n){e.setData({wait:!0});const o=await i.openFile(t);console.log("file loaded"),e.setData({title:n,numPages:o,wait:!1})}""!=n&&o(n),this.setData=function(t){console.log("setData",t),null!=t.url&&o(t.url)}},$iface:"\n\t\tsetData({url})\n\t"}),$$.control.registerControl("breizbot.rtc",{deps:["breizbot.rtc","breizbot.pager"],props:{appName:"",iconCls:"",title:"Select a friend"},init:function(t,n,e){const{appName:i,iconCls:o,title:s}=this.props,r=t.children().remove();t.append('<div class="toolbar">\n\n\t\t<div class="status">\n\t\t\t<p>Status: <span bn-text="status"></span></p>\n\t\t</div>\t\t\n\n\t\t<div>\n\t\t\t<button \n\t\t\t\ttitle="Call a friend" \n\t\t\t\tbn-event="click: onCall"\n\t\t\t\tbn-show="show1"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone"></i></button>\n\n\t\t\t<button \n\t\t\t\tbn-event="click: onCancel"\n\t\t\t\ttitle="Cancel"\n\t\t\t\tbn-show="show2"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone-slash"></i></button>\n\n\t\t\t<button \n\t\t\t\ttitle="Hangup" \n\t\t\t\tbn-event="click: onHangup"\n\t\t\t\tbn-show="show3"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone-slash"></i></button>\t\t\t\n\t\t</div>\n\n\n</div>\n<div bn-show="show4" bn-bind="panel" class="panel"></div>'),n.on("status",t=>{a.setData(t)});const a=$$.viewController(t,{data:{status:"ready",distant:"",hasChildren:r.length>0,show1:function(){return["ready","disconnected","refused","canceled"].includes(this.status)},show2:function(){return"calling"==this.status},show3:function(){return"connected"==this.status},show4:function(){return"connected"==this.status&&this.hasChildren}},events:{onCall:function(t){console.log("onCall"),e.pushPage("breizbot.friends",{title:s,props:{showSelection:!0},buttons:{call:{title:"Call",icon:"fa fa-check",onClick:function(){const t=this.getSelection();if(null==t)return void $$.ui.showAlert({title:"Error",content:"Please select a friend"});const{friendUserName:n,isConnected:i}=t;console.log("userName",n),i?e.popPage(n):$$.ui.showAlert({title:"Error",content:`User <strong>${n}</strong> is not connected`})}}},onReturn:function(t){n.call(t,i,o)}})},onCancel:function(t){n.cancel()},onHangup:function(e){n.bye(),t.trigger("rtchangup")}}});a.scope.panel.append(r)}}),$$.control.registerControl("breizbot.searchbar",{template:'<form bn-event="submit: onSearch" bn-bind="form">\n\t<input type="search" \n        name="value" \n        bn-attr="{placeholder, minlength, required}"\n\t\tautocomplete="off"\n\t\tbn-control="brainjs.input">\n\t<button class="w3-button w3-text-blue" type="submit" ><i class="fa fa-search"></i></button>\n</form>',props:{placeholder:"",minlength:0,required:!0},init:function(t){const{placeholder:n,minlength:e,required:i}=this.props,o=$$.viewController(t,{data:{placeholder:n,minlength:e,required:i},events:{onSearch:async function(n){n.preventDefault();const{value:e}=$(this).getFormData();t.trigger("searchbarsubmit",{value:e})}}});this.setValue=function(t){o.scope.form.setFormData({value:t})}},$iface:"\n        setValue(value: string)\n    ",$events:"searchbarsubmit"}),$$.control.registerControl("breizbot.addUser",{template:'<form bn-event="submit: onSubmit">\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>UserName</label>\n\t\t<input type="text" placeholder="username" name="username" required="">\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Pseudo</label>\n\t\t<input type="text" placeholder="pseudo" name="pseudo" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Location</label>\n\t\t<input type="text" placeholder="location" name="location" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Email</label>\n\t\t<input type="email" placeholder="email" name="email" required>\t\n\t</div>\n\t\n\t<input type="submit" hidden="" bn-bind="submit">\n</form>\n',deps:["breizbot.pager"],init:function(t,n){const e=$$.viewController(t,{data:{},events:{onSubmit:function(t){t.preventDefault(),n.popPage($(this).getFormData())}}});this.getButtons=function(){return{create:{title:"Create",icon:"fa fa-check",onClick:function(){e.scope.submit.click()}}}}}}),$$.control.registerControl("breizbot.users",{deps:["breizbot.users","breizbot.notifs","breizbot.pager"],template:'<div class="toolbar">\n\t<button bn-event="click: onUpdate" class="w3-btn w3-blue" title="Update">\n\t\t<i class="fa fa-redo"></i>\n\t</button>\t\n\t<button bn-event="click: onAddUser" class="w3-btn w3-blue btnAddUser" title="Add User">\n\t\t<i class="fa fa-user-plus"></i>\n\t</button>\t\n</div>\n\n<div class="scrollPanel">\n    <table class="w3-table-all w3-small">\n        <thead>\n            <tr class="w3-green">\n                <th>User Name</th>\n                <th>Pseudo</th>\n                <th>Location</th>\n                <th>Email</th>\n                <th>Create Date</th>\n                <th>Last Login Date</th>\n                <th>Actions</th>\n            </tr>\n        </thead>\n        <tbody bn-each="data" bn-event="click.delete: onDelete, click.notif: onNotif">\n  \t\t\t<tr>\n\t\t\t\t<td bn-text="$scope.$i.username"></td>\n\t\t\t\t<td bn-text="$scope.$i.pseudo"></td>\n\t\t\t\t<td bn-text="$scope.$i.location"></td>\n\t\t\t\t<td bn-text="$scope.$i.email"></td>\n\t\t\t\t<td >\n\t\t\t\t\t<span bn-text="text1" bn-show="show1"></span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<span bn-show="show2">\n\n\t\t\t\t\t\t<span bn-text="text2"></span><br>\n\t\t\t\t\t\tat \n\t\t\t\t\t\t<span bn-text="text3"></span>\n\t\t\t\t\t</span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button class="delete w3-btn w3-blue" title="Delete User">\n\t\t\t\t\t\t<i class="fa fa-trash"></i>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="notif w3-btn w3-blue" title="Send Notification">\n\t\t\t\t\t\t<i class="fa fa-bell"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>      \t\n\n        </tbody>\n    </table>\n</div>',init:function(t,n,e,i){const o=$$.viewController(t,{data:{data:[],text1:function(t){return new Date(t.$i.createDate).toLocaleDateString("fr-FR")},text2:function(t){return new Date(t.$i.lastLoginDate).toLocaleDateString("fr-FR")},text3:function(t){return new Date(t.$i.lastLoginDate).toLocaleTimeString("fr-FR")},show1:function(t){return null!=t.$i.createDate},show2:function(t){return null!=t.$i.lastLoginDate&&0!=t.$i.lastLoginDate}},events:{onAddUser:function(t){i.pushPage("breizbot.addUser",{title:"Add User",onReturn:async function(t){await n.add(t),s()}})},onDelete:function(t){const e=$(this).closest("tr").index(),{username:i}=o.model.data[e];$$.ui.showConfirm({title:"Delete User",content:"Are you sure ?"},async function(){await n.remove(i),s()})},onNotif:async function(t){const n=$(this).closest("tr").index(),{username:i}=o.model.data[n],s=await $$.ui.showPrompt({title:"Send Notification",label:"Message"});null!=s&&e.sendNotif(i,{text:s})},onUpdate:function(){s()}}});async function s(){const t=await n.list();console.log("getUsers",t),o.setData({data:t})}s()}}),$$.control.registerControl("breizbot.viewer",{template:'<div bn-if="isImage">\n\t<div \n\t\tclass="image" \n\t\tbn-control="brainjs.image" \n\t\tbn-data="{src: url}" \n\t\t\n\t\tstyle="height: 100%">\n\t\t\t\n\t\t</div>\n\t\n</div>\n\n\n<div bn-if="isPdf">\n\t<div \n\t\tclass="pdf" \n\t\tbn-control="breizbot.pdf" \n\t\tbn-data="{url}" \n\t\t\n\t\tstyle="height: 100%">\n\t\t\t\n\t\t</div>\t\t\n</div>\n\n<div bn-if="isAudio" class="audio">\n\t<audio bn-attr="{src: url}" controls="" controlsList=nodownload></audio>\n</div>\n\n<div bn-if="isVideo" class="video">\n\t<video bn-attr="{src: url}" controls="" controlsList=nodownload></video>\n</div>\n\n<div bn-if="isDoc" class="doc">\n\t<div class="scrollPanel">\n\t\t<div bn-load="url" class="html"></div>\n\t</div>\n</div>',props:{type:"",url:"#"},init:function(t){let{type:n,url:e}=this.props;const i=$$.viewController(t,{data:{url:e,type:n,isImage:function(){return"image"==this.type},isPdf:function(){return"pdf"==this.type},isAudio:function(){return"audio"==this.type},isVideo:function(){return"video"==this.type},isDoc:function(){return"hdoc"==this.type}}});this.setData=function(t){t.url&&i.setData({url:t.url})}},$iface:"\n\t\tsetData({url: string})\n\t\t"}),$$.service.registerService("breizbot.appData",{deps:["brainjs.http"],init:function(t,n){let e=t;return{getData:function(){return e},saveData:function(t){return e=t,n.post("/api/appData",t)}}}}),$$.service.registerService("breizbot.apps",{deps:["brainjs.http"],init:function(t,n){return{listAll:function(){return n.get("/api/apps/all")}}},$iface:"\n\t\tlistAll():Promise;\n\t\t"}),$$.service.registerService("breizbot.broker",{init:function(t){const n=new EventEmitter2;let e=null,i=!1,o=!0,s=!0;const r=new EventEmitter2({wildcard:!0}),a=1e4;let l=null;const c={};let{host:u,pathname:d,protocol:f}=location;const p=`${f="http:"==f?"ws:":"wss:"}//${u}/hmi${d}`;function h(){i&&(console.log("[Broker] Disconnected !"),n.emit("connected",!1)),i=!1,o&&setTimeout(()=>{b()},5e3)}function b(){console.log("try to connect..."),(e=new WebSocket(p)).onopen=(()=>{console.log("Connected to broker"),i=!0,s=!0,n.emit("connected",!0),function t(){l=setTimeout(()=>{s?(s=!1,m({type:"ping"}),t()):(console.log("timeout ping"),e.onmessage=null,e.onclose=null,e.close(),h())},a)}()}),e.onmessage=(t=>{const i=JSON.parse(t.data);if(t.currentTarget!=e)return console.log("[broker] message bad target",i.type),void t.currentTarget.close();"ready"==i.type&&(Object.keys(c).forEach(t=>{m({type:"register",topic:t})}),n.emit("ready",{clientId:i.clientId})),"pong"==i.type&&(s=!0),"notif"==i.type&&r.emit(i.topic,i),"error"==i.type&&(console.log("[Broker] log",i.text),o=!1,e.close())}),e.onclose=(t=>{t.currentTarget==e?(console.log("[broker] close"),null!=l&&(clearTimeout(l),l=null),h()):console.log("[broker] close bad target")})}function m(t){t.time=Date.now();const n=JSON.stringify(t);i&&e.send(n)}return b(),{emitTopic:function(t,n){m({type:"notif",topic:t,data:n})},onTopic:function(t,n){r.on(t,n)},offTopic:function(t,n){r.off(t,n)},register:function(t,n){null==c[t]?c[t]=1:c[t]++,r.on(t,n),m({type:"register",topic:t})},unregister:function(t,n){r.off(t,n),0==--c[t]&&(delete c[t],m({type:"unregister",topic:t}))},on:n.on.bind(n)}}}),$$.service.registerService("breizbot.cities",{deps:["brainjs.resource","brainjs.http"],init:function(t,n,e){const i=n("/api/cities");return{getCountries:function(){return i.get("/countries")},getCities:function(t,n){return i.post("/cities",{country:t,search:n})},getCitesFromPostalCode:async function(t){const n="https://apicarto.ign.fr/api/codes-postaux/communes/"+t;try{return(await e.get(n)).map(t=>t.libelleAcheminement)}catch(t){return[]}}}},$iface:"\n\t\tgetCountries():Promise;\n\t\tgetCities(country, search):Promise;\n\t\t"}),$$.service.registerService("breizbot.contacts",{deps:["brainjs.resource"],init:function(t,n){const e=n("/api/contacts");return{addContact:function(t){return e.post("/addContact",t)},getContacts:function(){return e.get("/getContacts")},removeContact:function(t){return e.delete(`/removeContact/${t}`)},updateContactInfo:function(t,n){return e.post(`/updateContactInfo/${t}`,n)}}}}),$$.service.registerService("breizbot.files",{deps:["brainjs.resource","breizbot.params"],init:function(t,n,e){const i=n("/api/files"),o=$$.ui.progressDialog();return{fileInfo:function(t,n,e){return console.log("[FileService] fileInfo",t,n,e),i.post("/fileInfo",{filePath:t,friendUser:n,options:e})},list:function(t,n,e){return console.log("[FileService] list",t),i.post("/list",{destPath:t,options:n,friendUser:e})},fileUrl:function(t,n){return $$.util.getUrlParams("/api/files/load",{fileName:t,friendUser:n})},fileAppUrl:function(t){return t=`/apps/${e.$appName}/${t}`,$$.util.getUrlParams("/api/files/load",{fileName:t})},fileThumbnailUrl:function(t,n,e){return $$.util.getUrlParams("/api/files/loadThumbnail",{fileName:t,size:n,friendUser:e})},fileAppThumbnailUrl:function(t,n){return t=`/apps/${e.$appName}/${t}`,$$.util.getUrlParams("/api/files/loadThumbnail",{fileName:t,size:n})},uploadFile:function(t,n,e,o){if(console.log("[FileService] uploadFile",n,e),!(t instanceof Blob))return console.warn("File format not supported"),Promise.reject("File format not supported");var s=new FormData;return s.append("file",t,n),s.append("destPath",e),i.postFormData("/save",s,o)},saveFile:async function(t,n,i){i=i||`/apps/${e.$appName}`;try{o.setPercentage(0),o.show();await this.uploadFile(t,n,i,t=>{o.setPercentage(t)});await $$.util.wait(1e3),o.hide()}catch(t){o.hide(),$$.ui.showAlert({title:"Error",content:t.responseText})}}}}}),$$.service.registerService("breizbot.friends",{deps:["brainjs.resource"],init:function(t,n){const e=n("/api/friends");return{getFriends:function(){return e.get("/getFriends")},getFriendInfo:function(t){return e.post("/getFriendInfo",{friend:t})},setFriendInfo:function(t,n,i){return e.post("/setFriendInfo",{friend:t,groups:n,positionAuth:i})},addFriend:function(t){return e.post("/addFriend",{friendUserName:t})}}}}),$$.service.registerService("breizbot.fullscreen",{init:function(t){return{init:function(t){document.addEventListener("webkitfullscreenchange",n=>{t(null!=document.fullscreenElement)}),document.addEventListener("fullscreenchange",n=>{t(null!=document.fullscreenElement)}),document.addEventListener("keydown",t=>{"F11"==t.key&&t.preventDefault()})},enter:function(){const t=document.documentElement,n=t.requestFullscreen||t.webkitRequestFullscreen;n&&n.call(t)},exit:function(){document.exitFullscreen()}}}}),$$.service.registerService("breizbot.geoloc",{deps:["brainjs.resource"],init:function(t,n){const e=n("/api/position");let i=null;function o(t){console.log("geoloc error:",t)}function s(t){i=t.coords}function r(){null!=i&&e.post("/position",{lat:i.latitude,lng:i.longitude})}return{startWatch:function(){navigator.geolocation.getCurrentPosition(s),navigator.geolocation.watchPosition(s,o,{enableHighAccuracy:!0}),setInterval(r,3e4)}}}}),$$.service.registerService("breizbot.http",{deps:["brainjs.resource","breizbot.params"],init:function(t,n,e){return n(`/api/app/${e.$appName}`)}}),$$.service.registerService("breizbot.notifs",{deps:["brainjs.resource"],init:function(t,n){const e=n("/api/notifs");return{sendNotif:function(t,n){return e.post("/sendNotif",{to:t,notif:n})},removeNotif:function(t){return e.delete(`/removeNotif/${t}`)},getNotifs:function(){return e.get("/getNotifs")},getNotifCount:function(){return e.get("/getNotifCount")}}}}),$$.service.registerService("breizbot.pager",{init:function(t){return $(".breizbotPager").iface()}}),$$.service.registerService("breizbot.params",{init:function(t){return"string"==typeof t?JSON.parse(t):{}}}),$$.service.registerService("breizbot.rtc",{deps:["brainjs.http","breizbot.broker","breizbot.params"],init:function(t,n,e,i){const o=new EventEmitter2,s={srcId:null,destId:null,distant:"",status:"ready",isCallee:!1};function r(){o.emit("status",{status:s.status,distant:s.distant})}function a(t=!0){return console.log("[RTC] cancel",t),t&&(s.status="canceled",r()),n.post("/api/rtc/sendToUser",{to:s.distant,srcId:s.srcId,type:"cancel"})}function l(){return console.log("[RTC] bye"),"connected"==s.status?(s.status="ready",s.distant="",r(),c("bye")):Promise.resolve()}function c(t,e){return n.post("/api/rtc/sendToClient",{destId:s.destId,srcId:s.srcId,type:t,data:e})}return null!=i.caller&&(s.status="connected",s.distant=i.caller,s.destId=i.clientId,s.isCallee=!0),e.on("ready",t=>{s.srcId=t.clientId,o.emit("ready")}),e.onTopic("breizbot.rtc.accept",t=>{!0!==t.hist&&(console.log("msg",t),a(!1),s.destId=t.srcId,s.status="connected",r(),o.emit("accept"))}),e.onTopic("breizbot.rtc.deny",t=>{!0!==t.hist&&(console.log("msg",t),s.status="refused",a(!1),r(),o.emit("deny"))}),e.onTopic("breizbot.rtc.bye",t=>{!0!==t.hist&&(console.log("msg",t),s.status="disconnected",r(),o.emit("bye"))}),{call:function(t,e,i){return s.distant=t,s.status="calling",r(),n.post("/api/rtc/sendToUser",{to:t,srcId:s.srcId,type:"call",data:{appName:e,iconCls:i}})},cancel:a,deny:function(){return console.log("[RTC] deny"),c("deny")},bye:l,sendData:c,onData:function(t,n){e.onTopic("breizbot.rtc."+t,t=>{!0!==t.hist&&n(t.data,t.time)})},on:o.on.bind(o),processCall:function(){console.log("[RTC] processCall"),e.register("breizbot.rtc.call",t=>{!0!==t.hist&&(console.log("msg",t),s.destId=t.srcId,o.emit("call",t.data))}),e.register("breizbot.rtc.cancel",t=>{!0!==t.hist&&(console.log("msg",t),o.emit("cancel"))})},getRemoteClientId:function(){return s.destId},exit:function(){return"calling"==s.status?a():"connected"==s.status?l():Promise.resolve()},accept:function(){return console.log("[RTC] accept"),r(),c("accept")},isCallee:function(){return s.isCallee}}}}),$$.service.registerService("breizbot.scheduler",{deps:["brainjs.http"],init:function(t,n){return{openApp:function(t,n){window.parent.postMessage({type:"openApp",data:{appName:t,appParams:n}},location.href)},logout:function(){return console.log("[scheduler] logout"),n.post("/api/logout")}}}}),$$.service.registerService("breizbot.songs",{deps:["brainjs.resource"],init:function(t,n){const e=n("/api/songs");return{generateDb:function(){return e.post("/generateDb")}}}}),$$.service.registerService("breizbot.users",{deps:["brainjs.resource"],init:function(t,n){const e=n("/api/users");return{list:function(){return e.get("/")},match:function(t){return e.get("/",{match:t})},add:function(t){return e.post("/",t)},remove:function(t){return e.delete(`/${t}`)},update:function(t,n){return e.put(`/${t}`,n)},get:function(t){return e.get(`/${t}`)},activateApp:function(t,n){return e.post("/activateApp",{appName:t,activated:n})},changePwd:function(t){return e.post("/changePwd",{newPwd:t})},getUserSettings:function(){return e.post("/getUserSettings")},setUserSettings:function(t){return e.post("/setUserSettings",t)}}}}),$$.service.registerService("breizbot.wakelock",{init:function(t){async function n(){if(navigator.wakeLock)try{(await navigator.wakeLock.request("screen")).addEventListener("release",()=>{})}catch(t){console.error("WakeLock",t)}}return document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&n()}),{requestWakeLock:n}}});