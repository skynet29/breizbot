!function(t){var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=10;function i(){this._events={},this._conf&&o.call(this,this._conf)}function o(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==t?e.maxListeners:n,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=n}function s(t,e){var n="(node) warning: possible EventEmitter memory leak detected. "+t+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+e+"."),"undefined"!=typeof process&&process.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=t,process.emitWarning(i)}else console.error(n),console.trace&&console.trace()}function r(t){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,o.call(this,t)}function a(t,e,n,i){if(!n)return[];var o,s,r,l,c,u,d,f=[],p=e.length,h=e[i],b=e[i+1];if(i===p&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(o=0,s=n._listeners.length;o<s;o++)t&&t.push(n._listeners[o]);return[n]}if("*"===h||"**"===h||n[h]){if("*"===h){for(r in n)"_listeners"!==r&&n.hasOwnProperty(r)&&(f=f.concat(a(t,e,n[r],i+1)));return f}if("**"===h){for(r in(d=i+1===p||i+2===p&&"*"===b)&&n._listeners&&(f=f.concat(a(t,e,n,p))),n)"_listeners"!==r&&n.hasOwnProperty(r)&&("*"===r||"**"===r?(n[r]._listeners&&!d&&(f=f.concat(a(t,e,n[r],p))),f=f.concat(a(t,e,n[r],i))):f=r===b?f.concat(a(t,e,n[r],i+2)):f.concat(a(t,e,n[r],i)));return f}f=f.concat(a(t,e,n[h],i+1))}if((l=n["*"])&&a(t,e,l,i+1),c=n["**"])if(i<p)for(r in c._listeners&&a(t,e,c,p),c)"_listeners"!==r&&c.hasOwnProperty(r)&&(r===b?a(t,e,c[r],i+2):r===h?a(t,e,c[r],i+1):((u={})[r]=c[r],a(t,e,{"**":u},i+1)));else c._listeners?a(t,e,c,p):c["*"]&&c["*"]._listeners&&a(t,e,c["*"],p);return f}r.EventEmitter2=r,r.prototype.delimiter=".",r.prototype.setMaxListeners=function(e){e!==t&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},r.prototype.event="",r.prototype.once=function(t,e){return this._once(t,e,!1)},r.prototype.prependOnceListener=function(t,e){return this._once(t,e,!0)},r.prototype._once=function(t,e,n){return this._many(t,1,e,n),this},r.prototype.many=function(t,e,n){return this._many(t,e,n,!1)},r.prototype.prependMany=function(t,e,n){return this._many(t,e,n,!0)},r.prototype._many=function(t,e,n,i){var o=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function s(){return 0==--e&&o.off(t,s),n.apply(this,arguments)}return s._origin=n,this._on(t,s,i),o},r.prototype.emit=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;var e,n,o,s,r,l=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),l>3)for(e=new Array(l),s=0;s<l;s++)e[s]=arguments[s];for(o=0,n=r.length;o<n;o++)switch(this.event=t,l){case 1:r[o].call(this,t);break;case 2:r[o].call(this,t,arguments[1]);break;case 3:r[o].call(this,t,arguments[1],arguments[2]);break;default:r[o].apply(this,e)}}if(this.wildcard){r=[];var c="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,c,this.listenerTree,0)}else{if("function"==typeof(r=this._events[t])){switch(this.event=t,l){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(e=new Array(l-1),s=1;s<l;s++)e[s-1]=arguments[s];r.apply(this,e)}return!0}r&&(r=r.slice())}if(r&&r.length){if(l>3)for(e=new Array(l-1),s=1;s<l;s++)e[s-1]=arguments[s];for(o=0,n=r.length;o<n;o++)switch(this.event=t,l){case 1:r[o].call(this);break;case 2:r[o].call(this,arguments[1]);break;case 3:r[o].call(this,arguments[1],arguments[2]);break;default:r[o].apply(this,e)}return!0}if(!this._all&&"error"===t)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},r.prototype.emitAsync=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var e,n,o,s,r,l=[],c=arguments.length;if(this._all){if(c>3)for(e=new Array(c),s=1;s<c;s++)e[s]=arguments[s];for(o=0,n=this._all.length;o<n;o++)switch(this.event=t,c){case 1:l.push(this._all[o].call(this,t));break;case 2:l.push(this._all[o].call(this,t,arguments[1]));break;case 3:l.push(this._all[o].call(this,t,arguments[1],arguments[2]));break;default:l.push(this._all[o].apply(this,e))}}if(this.wildcard){r=[];var u="string"==typeof t?t.split(this.delimiter):t.slice();a.call(this,r,u,this.listenerTree,0)}else r=this._events[t];if("function"==typeof r)switch(this.event=t,c){case 1:l.push(r.call(this));break;case 2:l.push(r.call(this,arguments[1]));break;case 3:l.push(r.call(this,arguments[1],arguments[2]));break;default:for(e=new Array(c-1),s=1;s<c;s++)e[s-1]=arguments[s];l.push(r.apply(this,e))}else if(r&&r.length){if(r=r.slice(),c>3)for(e=new Array(c-1),s=1;s<c;s++)e[s-1]=arguments[s];for(o=0,n=r.length;o<n;o++)switch(this.event=t,c){case 1:l.push(r[o].call(this));break;case 2:l.push(r[o].call(this,arguments[1]));break;case 3:l.push(r[o].call(this,arguments[1],arguments[2]));break;default:l.push(r[o].apply(this,e))}}else if(!this._all&&"error"===t)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(l)},r.prototype.on=function(t,e){return this._on(t,e,!1)},r.prototype.prependListener=function(t,e){return this._on(t,e,!0)},r.prototype.onAny=function(t){return this._onAny(t,!1)},r.prototype.prependAny=function(t){return this._onAny(t,!0)},r.prototype.addListener=r.prototype.on,r.prototype._onAny=function(t,e){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),e?this._all.unshift(t):this._all.push(t),this},r.prototype._on=function(e,n,o){if("function"==typeof e)return this._onAny(e,n),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");return this._events||i.call(this),this.emit("newListener",e,n),this.wildcard?(function(e,n){for(var i=0,o=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;i+1<o;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var r=this.listenerTree,a=e.shift();a!==t;){if(r[a]||(r[a]={}),r=r[a],0===e.length)return r._listeners?("function"==typeof r._listeners&&(r._listeners=[r._listeners]),r._listeners.push(n),!r._listeners.warned&&this._maxListeners>0&&r._listeners.length>this._maxListeners&&(r._listeners.warned=!0,s.call(this,r._listeners.length,a))):r._listeners=n,!0;a=e.shift()}return!0}.call(this,e,n),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),o?this._events[e].unshift(n):this._events[e].push(n),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,s.call(this,this._events[e].length,e))):this._events[e]=n,this)},r.prototype.off=function(n,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");var o,s=[];if(this.wildcard){var r="string"==typeof n?n.split(this.delimiter):n.slice();s=a.call(this,null,r,this.listenerTree,0)}else{if(!this._events[n])return this;o=this._events[n],s.push({_listeners:o})}for(var l=0;l<s.length;l++){var c=s[l];if(o=c._listeners,e(o)){for(var u=-1,d=0,f=o.length;d<f;d++)if(o[d]===i||o[d].listener&&o[d].listener===i||o[d]._origin&&o[d]._origin===i){u=d;break}if(u<0)continue;return this.wildcard?c._listeners.splice(u,1):this._events[n].splice(u,1),0===o.length&&(this.wildcard?delete c._listeners:delete this._events[n]),this.emit("removeListener",n,i),this}(o===i||o.listener&&o.listener===i||o._origin&&o._origin===i)&&(this.wildcard?delete c._listeners:delete this._events[n],this.emit("removeListener",n,i))}return function e(n){if(n!==t){var i=Object.keys(n);for(var o in i){var s=i[o],r=n[s];r instanceof Function||"object"!=typeof r||null===r||(Object.keys(r).length>0&&e(n[s]),0===Object.keys(r).length&&delete n[s])}}}(this.listenerTree),this},r.prototype.offAny=function(t){var e,n=0,i=0;if(t&&this._all&&this._all.length>0){for(n=0,i=(e=this._all).length;n<i;n++)if(t===e[n])return e.splice(n,1),this.emit("removeListenerAny",t),this}else{for(n=0,i=(e=this._all).length;n<i;n++)this.emit("removeListenerAny",e[n]);this._all=[]}return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var e="string"==typeof t?t.split(this.delimiter):t.slice(),n=a.call(this,null,e,this.listenerTree,0),o=0;o<n.length;o++){n[o]._listeners=null}else this._events&&(this._events[t]=null);return this},r.prototype.listeners=function(t){if(this.wildcard){var n=[],o="string"==typeof t?t.split(this.delimiter):t.slice();return a.call(this,n,o,this.listenerTree,0),n}return this._events||i.call(this),this._events[t]||(this._events[t]=[]),e(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.eventNames=function(){return Object.keys(this._events)},r.prototype.listenerCount=function(t){return this.listeners(t).length},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return r}):"object"==typeof exports?module.exports=r:window.EventEmitter2=r}(),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(n),n}:t(jQuery)}(function(t){function e(e,n,i){"string"==typeof i&&(i={className:i}),this.options=y(w,t.isPlainObject(i)?i:{}),this.loadHTML(),this.wrapper=t(p.html),this.options.clickToHide&&this.wrapper.addClass(o+"-hidable"),this.wrapper.data(o,this),this.arrow=this.wrapper.find("."+o+"-arrow"),this.container=this.wrapper.find("."+o+"-container"),this.container.append(this.userContainer),e&&e.length&&(this.elementType=e.attr("type"),this.originalElement=e,this.elem=x(e),this.elem.data(o,this),this.elem.before(this.wrapper)),this.container.hide(),this.run(n)}var n=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},i="notify",o=i+"js",s=i+"!blank",r={t:"top",m:"middle",b:"bottom",l:"left",c:"center",r:"right"},a=["l","c","r"],l=["t","m","b"],c=["t","b","l","r"],u={t:"b",m:null,b:"t",l:"r",c:null,r:"l"},d=function(e){var n;return n=[],t.each(e.split(/\W+/),function(t,e){var i;if(i=e.toLowerCase().charAt(0),r[i])return n.push(i)}),n},f={},p={name:"core",html:'<div class="'+o+'-wrapper">\n\t<div class="'+o+'-arrow"></div>\n\t<div class="'+o+'-container"></div>\n</div>',css:"."+o+"-corner {\n\tposition: fixed;\n\tmargin: 5px;\n\tz-index: 1050;\n}\n\n."+o+"-corner ."+o+"-wrapper,\n."+o+"-corner ."+o+"-container {\n\tposition: relative;\n\tdisplay: block;\n\theight: inherit;\n\twidth: inherit;\n\tmargin: 3px;\n}\n\n."+o+"-wrapper {\n\tz-index: 1;\n\tposition: absolute;\n\tdisplay: inline-block;\n\theight: 0;\n\twidth: 0;\n}\n\n."+o+"-container {\n\tdisplay: none;\n\tz-index: 1;\n\tposition: absolute;\n}\n\n."+o+"-hidable {\n\tcursor: pointer;\n}\n\n[data-notify-text],[data-notify-html] {\n\tposition: relative;\n}\n\n."+o+"-arrow {\n\tposition: absolute;\n\tz-index: 2;\n\twidth: 0;\n\theight: 0;\n}"},h={"border-radius":["-webkit-","-moz-"]},b=function(e,n){if(!e)throw"Missing Style name";if(!n)throw"Missing Style definition";if(!n.html)throw"Missing Style HTML";var s=f[e];s&&s.cssElem&&(window.console&&console.warn(i+": overwriting style '"+e+"'"),f[e].cssElem.remove()),n.name=e,f[e]=n;var r="";n.classes&&t.each(n.classes,function(e,i){return r+="."+o+"-"+n.name+"-"+e+" {\n",t.each(i,function(e,n){return h[e]&&t.each(h[e],function(t,i){return r+="\t"+i+e+": "+n+";\n"}),r+="\t"+e+": "+n+";\n"}),r+="}\n"}),n.css&&(r+="/* styles for "+n.name+" */\n"+n.css),r&&(n.cssElem=m(r),n.cssElem.attr("id","notify-"+n.name));var a={},l=t(n.html);g("html",l,a),g("text",l,a),n.fields=a},m=function(e){var n;(n=A("style")).attr("type","text/css"),t("head").append(n);try{n.html(e)}catch(t){n[0].styleSheet.cssText=e}return n},g=function(e,n,i){var o;return"html"!==e&&(e="text"),v(n,"["+(o="data-notify-"+e)+"]").each(function(){var n;(n=t(this).attr(o))||(n=s),i[n]=e})},v=function(t,e){return t.is(e)?t:t.find(e)},w={clickToHide:!0,autoHide:!0,autoHideDelay:5e3,arrowShow:!0,arrowSize:5,breakNewLines:!0,elementPosition:"bottom",globalPosition:"top right",style:"bootstrap",className:"error",showAnimation:"slideDown",showDuration:400,hideAnimation:"slideUp",hideDuration:200,gap:5},y=function(e,n){var i;return(i=function(){}).prototype=e,t.extend(!0,new i,n)},A=function(e){return t("<"+e+"></"+e+">")},$={},x=function(e){var n;return e.is("[type=radio]")&&(n=e.parents("form:first").find("[type=radio]").filter(function(n,i){return t(i).attr("name")===e.attr("name")}),e=n.first()),e},C=function(t,e,n){var i;if("string"==typeof n)n=parseInt(n,10);else if("number"!=typeof n)return;if(!isNaN(n))return i=r[u[e.charAt(0)]],e,void 0!==t[i]&&(e=r[i.charAt(0)],n=-n),void 0===t[e]?t[e]=n:t[e]+=n,null},k=function(t,e,n){if("l"===t||"t"===t)return 0;if("c"===t||"m"===t)return n/2-e/2;if("r"===t||"b"===t)return n-e;throw"Invalid alignment"},D=function(t){return D.e=D.e||A("div"),D.e.text(t).html()};e.prototype.loadHTML=function(){var e;e=this.getStyle(),this.userContainer=t(e.html),this.userFields=e.fields},e.prototype.show=function(t,e){var n,i,o,s,r;if(i=function(n){return function(){if(!t&&!n.elem&&n.destroy(),e)return e()}}(this),r=this.container.parent().parents(":hidden").length>0,o=this.container.add(this.arrow),n=[],r&&t)s="show";else if(r&&!t)s="hide";else if(!r&&t)s=this.options.showAnimation,n.push(this.options.showDuration);else{if(r||t)return i();s=this.options.hideAnimation,n.push(this.options.hideDuration)}return n.push(i),o[s].apply(o,n)},e.prototype.setGlobalPosition=function(){var e=this.getPosition(),n=e[0],i=e[1],s=r[n],a=r[i],l=n+"|"+i,c=$[l];if(!c||!document.body.contains(c[0])){c=$[l]=A("div");var u={};u[s]=0,"middle"===a?u.top="45%":"center"===a?u.left="45%":u[a]=0,c.css(u).addClass(o+"-corner"),t("body").append(c)}return c.prepend(this.wrapper)},e.prototype.setElementPosition=function(){var e,i,o,s,d,f,p,h,b,m,g,v,w,y,A,$,x,D,S,P,F,I,E,z,N,T,M,U;for(E=(T=this.getPosition())[0],I=T[1],T[2],g=this.elem.position(),h=this.elem.outerHeight(),v=this.elem.outerWidth(),b=this.elem.innerHeight(),m=this.elem.innerWidth(),U=this.wrapper.position(),d=this.container.height(),f=this.container.width(),D=r[E],(p={})[F=r[P=u[E]]]="b"===E?h:"r"===E?v:0,C(p,"top",g.top-U.top),C(p,"left",g.left-U.left),y=0,$=(M=["top","left"]).length;y<$;y++)z=M[y],(S=parseInt(this.elem.css("margin-"+z),10))&&C(p,z,S);if(w=Math.max(0,this.options.gap-(this.options.arrowShow?o:0)),C(p,F,w),this.options.arrowShow){for(o=this.options.arrowSize,i=t.extend({},p),e=this.userContainer.css("border-color")||this.userContainer.css("border-top-color")||this.userContainer.css("background-color")||"white",A=0,x=c.length;A<x;A++)N=r[z=c[A]],z!==P&&(s=N===D?e:"transparent",i["border-"+N]=o+"px solid "+s);C(p,r[P],o),n.call(c,I)>=0&&C(i,r[I],2*o)}else this.arrow.hide();if(n.call(l,E)>=0?(C(p,"left",k(I,f,v)),i&&C(i,"left",k(I,o,m))):n.call(a,E)>=0&&(C(p,"top",k(I,d,h)),i&&C(i,"top",k(I,o,b))),this.container.is(":visible")&&(p.display="block"),this.container.removeAttr("style").css(p),i)return this.arrow.removeAttr("style").css(i)},e.prototype.getPosition=function(){var t,e,i,o,s,r,u,f;if(f=this.options.position||(this.elem?this.options.elementPosition:this.options.globalPosition),0===(t=d(f)).length&&(t[0]="b"),e=t[0],n.call(c,e)<0)throw"Must be one of ["+c+"]";return(1===t.length||(i=t[0],n.call(l,i)>=0&&(o=t[1],n.call(a,o)<0))||(s=t[0],n.call(a,s)>=0&&(r=t[1],n.call(l,r)<0)))&&(t[1]=(u=t[0],n.call(a,u)>=0?"m":"l")),2===t.length&&(t[2]=t[1]),t},e.prototype.getStyle=function(t){var e;if(t||(t=this.options.style),t||(t="default"),!(e=f[t]))throw"Missing style: "+t;return e},e.prototype.updateClasses=function(){var e,n;return e=["base"],t.isArray(this.options.className)?e=e.concat(this.options.className):this.options.className&&e.push(this.options.className),n=this.getStyle(),e=t.map(e,function(t){return o+"-"+n.name+"-"+t}).join(" "),this.userContainer.attr("class",e)},e.prototype.run=function(e,n){var i,o,r,a,l;if(t.isPlainObject(n)?t.extend(this.options,n):"string"===t.type(n)&&(this.options.className=n),!this.container||e){if(this.container||e){for(r in o={},t.isPlainObject(e)?o=e:o[s]=e,o)i=o[r],(a=this.userFields[r])&&("text"===a&&(i=D(i),this.options.breakNewLines&&(i=i.replace(/\n/g,"<br/>"))),l=r===s?"":"="+r,v(this.userContainer,"[data-notify-"+a+l+"]").html(i));this.updateClasses(),this.elem?this.setElementPosition():this.setGlobalPosition(),this.show(!0),this.options.autoHide&&(clearTimeout(this.autohideTimer),this.autohideTimer=setTimeout(this.show.bind(this,!1),this.options.autoHideDelay))}}else this.show(!1)},e.prototype.destroy=function(){this.wrapper.data(o,null),this.wrapper.remove()},t[i]=function(n,o,s){return n&&n.nodeName||n.jquery?t(n)[i](o,s):(s=o,new e(null,o=n,s)),n},t.fn[i]=function(n,i){return t(this).each(function(){var s=x(t(this)).data(o);s&&s.destroy();new e(t(this),n,i)}),this},t.extend(t[i],{defaults:function(e){return t.extend(w,e)},addStyle:b,removeStyle:function(t){if(!t)throw"Missing Style name";f[t]&&delete f[t]},pluginOptions:w,getStyle:function(t){return f[t]},insertCSS:m}),b("bootstrap",{html:"<div>\n<span data-notify-text></span>\n</div>",classes:{base:{"font-weight":"bold",padding:"8px 15px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)","background-color":"#fcf8e3",border:"1px solid #fbeed5","border-radius":"4px","white-space":"nowrap","padding-left":"25px","background-repeat":"no-repeat","background-position":"3px 7px"},error:{color:"#B94A48","background-color":"#F2DEDE","border-color":"#EED3D7","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtRJREFUeNqkVc1u00AQHq+dOD+0poIQfkIjalW0SEGqRMuRnHos3DjwAH0ArlyQeANOOSMeAA5VjyBxKBQhgSpVUKKQNGloFdw4cWw2jtfMOna6JOUArDTazXi/b3dm55socPqQhFka++aHBsI8GsopRJERNFlY88FCEk9Yiwf8RhgRyaHFQpPHCDmZG5oX2ui2yilkcTT1AcDsbYC1NMAyOi7zTX2Agx7A9luAl88BauiiQ/cJaZQfIpAlngDcvZZMrl8vFPK5+XktrWlx3/ehZ5r9+t6e+WVnp1pxnNIjgBe4/6dAysQc8dsmHwPcW9C0h3fW1hans1ltwJhy0GxK7XZbUlMp5Ww2eyan6+ft/f2FAqXGK4CvQk5HueFz7D6GOZtIrK+srupdx1GRBBqNBtzc2AiMr7nPplRdKhb1q6q6zjFhrklEFOUutoQ50xcX86ZlqaZpQrfbBdu2R6/G19zX6XSgh6RX5ubyHCM8nqSID6ICrGiZjGYYxojEsiw4PDwMSL5VKsC8Yf4VRYFzMzMaxwjlJSlCyAQ9l0CW44PBADzXhe7xMdi9HtTrdYjFYkDQL0cn4Xdq2/EAE+InCnvADTf2eah4Sx9vExQjkqXT6aAERICMewd/UAp/IeYANM2joxt+q5VI+ieq2i0Wg3l6DNzHwTERPgo1ko7XBXj3vdlsT2F+UuhIhYkp7u7CarkcrFOCtR3H5JiwbAIeImjT/YQKKBtGjRFCU5IUgFRe7fF4cCNVIPMYo3VKqxwjyNAXNepuopyqnld602qVsfRpEkkz+GFL1wPj6ySXBpJtWVa5xlhpcyhBNwpZHmtX8AGgfIExo0ZpzkWVTBGiXCSEaHh62/PoR0p/vHaczxXGnj4bSo+G78lELU80h1uogBwWLf5YlsPmgDEd4M236xjm+8nm4IuE/9u+/PH2JXZfbwz4zw1WbO+SQPpXfwG/BBgAhCNZiSb/pOQAAAAASUVORK5CYII=)"},success:{color:"#468847","background-color":"#DFF0D8","border-color":"#D6E9C6","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAutJREFUeNq0lctPE0Ecx38zu/RFS1EryqtgJFA08YCiMZIAQQ4eRG8eDGdPJiYeTIwHTfwPiAcvXIwXLwoXPaDxkWgQ6islKlJLSQWLUraPLTv7Gme32zoF9KSTfLO7v53vZ3d/M7/fIth+IO6INt2jjoA7bjHCJoAlzCRw59YwHYjBnfMPqAKWQYKjGkfCJqAF0xwZjipQtA3MxeSG87VhOOYegVrUCy7UZM9S6TLIdAamySTclZdYhFhRHloGYg7mgZv1Zzztvgud7V1tbQ2twYA34LJmF4p5dXF1KTufnE+SxeJtuCZNsLDCQU0+RyKTF27Unw101l8e6hns3u0PBalORVVVkcaEKBJDgV3+cGM4tKKmI+ohlIGnygKX00rSBfszz/n2uXv81wd6+rt1orsZCHRdr1Imk2F2Kob3hutSxW8thsd8AXNaln9D7CTfA6O+0UgkMuwVvEFFUbbAcrkcTA8+AtOk8E6KiQiDmMFSDqZItAzEVQviRkdDdaFgPp8HSZKAEAL5Qh7Sq2lIJBJwv2scUqkUnKoZgNhcDKhKg5aH+1IkcouCAdFGAQsuWZYhOjwFHQ96oagWgRoUov1T9kRBEODAwxM2QtEUl+Wp+Ln9VRo6BcMw4ErHRYjH4/B26AlQoQQTRdHWwcd9AH57+UAXddvDD37DmrBBV34WfqiXPl61g+vr6xA9zsGeM9gOdsNXkgpEtTwVvwOklXLKm6+/p5ezwk4B+j6droBs2CsGa/gNs6RIxazl4Tc25mpTgw/apPR1LYlNRFAzgsOxkyXYLIM1V8NMwyAkJSctD1eGVKiq5wWjSPdjmeTkiKvVW4f2YPHWl3GAVq6ymcyCTgovM3FzyRiDe2TaKcEKsLpJvNHjZgPNqEtyi6mZIm4SRFyLMUsONSSdkPeFtY1n0mczoY3BHTLhwPRy9/lzcziCw9ACI+yql0VLzcGAZbYSM5CCSZg1/9oc/nn7+i8N9p/8An4JMADxhH+xHfuiKwAAAABJRU5ErkJggg==)"},info:{color:"#3A87AD","background-color":"#D9EDF7","border-color":"#BCE8F1","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QYFAhkSsdes/QAAA8dJREFUOMvVlGtMW2UYx//POaWHXg6lLaW0ypAtw1UCgbniNOLcVOLmAjHZolOYlxmTGXVZdAnRfXQm+7SoU4mXaOaiZsEpC9FkiQs6Z6bdCnNYruM6KNBw6YWewzl9z+sHImEWv+vz7XmT95f/+3/+7wP814v+efDOV3/SoX3lHAA+6ODeUFfMfjOWMADgdk+eEKz0pF7aQdMAcOKLLjrcVMVX3xdWN29/GhYP7SvnP0cWfS8caSkfHZsPE9Fgnt02JNutQ0QYHB2dDz9/pKX8QjjuO9xUxd/66HdxTeCHZ3rojQObGQBcuNjfplkD3b19Y/6MrimSaKgSMmpGU5WevmE/swa6Oy73tQHA0Rdr2Mmv/6A1n9w9suQ7097Z9lM4FlTgTDrzZTu4StXVfpiI48rVcUDM5cmEksrFnHxfpTtU/3BFQzCQF/2bYVoNbH7zmItbSoMj40JSzmMyX5qDvriA7QdrIIpA+3cdsMpu0nXI8cV0MtKXCPZev+gCEM1S2NHPvWfP/hL+7FSr3+0p5RBEyhEN5JCKYr8XnASMT0xBNyzQGQeI8fjsGD39RMPk7se2bd5ZtTyoFYXftF6y37gx7NeUtJJOTFlAHDZLDuILU3j3+H5oOrD3yWbIztugaAzgnBKJuBLpGfQrS8wO4FZgV+c1IxaLgWVU0tMLEETCos4xMzEIv9cJXQcyagIwigDGwJgOAtHAwAhisQUjy0ORGERiELgG4iakkzo4MYAxcM5hAMi1WWG1yYCJIcMUaBkVRLdGeSU2995TLWzcUAzONJ7J6FBVBYIggMzmFbvdBV44Corg8vjhzC+EJEl8U1kJtgYrhCzgc/vvTwXKSib1paRFVRVORDAJAsw5FuTaJEhWM2SHB3mOAlhkNxwuLzeJsGwqWzf5TFNdKgtY5qHp6ZFf67Y/sAVadCaVY5YACDDb3Oi4NIjLnWMw2QthCBIsVhsUTU9tvXsjeq9+X1d75/KEs4LNOfcdf/+HthMnvwxOD0wmHaXr7ZItn2wuH2SnBzbZAbPJwpPx+VQuzcm7dgRCB57a1uBzUDRL4bfnI0RE0eaXd9W89mpjqHZnUI5Hh2l2dkZZUhOqpi2qSmpOmZ64Tuu9qlz/SEXo6MEHa3wOip46F1n7633eekV8ds8Wxjn37Wl63VVa+ej5oeEZ/82ZBETJjpJ1Rbij2D3Z/1trXUvLsblCK0XfOx0SX2kMsn9dX+d+7Kf6h8o4AIykuffjT8L20LU+w4AZd5VvEPY+XpWqLV327HR7DzXuDnD8r+ovkBehJ8i+y8YAAAAASUVORK5CYII=)"},warn:{color:"#C09853","background-color":"#FCF8E3","border-color":"#FBEED5","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABJlBMVEXr6eb/2oD/wi7/xjr/0mP/ykf/tQD/vBj/3o7/uQ//vyL/twebhgD/4pzX1K3z8e349vK6tHCilCWbiQymn0jGworr6dXQza3HxcKkn1vWvV/5uRfk4dXZ1bD18+/52YebiAmyr5S9mhCzrWq5t6ufjRH54aLs0oS+qD751XqPhAybhwXsujG3sm+Zk0PTwG6Shg+PhhObhwOPgQL4zV2nlyrf27uLfgCPhRHu7OmLgAafkyiWkD3l49ibiAfTs0C+lgCniwD4sgDJxqOilzDWowWFfAH08uebig6qpFHBvH/aw26FfQTQzsvy8OyEfz20r3jAvaKbhgG9q0nc2LbZxXanoUu/u5WSggCtp1anpJKdmFz/zlX/1nGJiYmuq5Dx7+sAAADoPUZSAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfdBgUBGhh4aah5AAAAlklEQVQY02NgoBIIE8EUcwn1FkIXM1Tj5dDUQhPU502Mi7XXQxGz5uVIjGOJUUUW81HnYEyMi2HVcUOICQZzMMYmxrEyMylJwgUt5BljWRLjmJm4pI1hYp5SQLGYxDgmLnZOVxuooClIDKgXKMbN5ggV1ACLJcaBxNgcoiGCBiZwdWxOETBDrTyEFey0jYJ4eHjMGWgEAIpRFRCUt08qAAAAAElFTkSuQmCC)"}}}),t(function(){m(p.css).attr("id","core-notify"),t(document).on("click","."+o+"-hidable",function(e){t(this).trigger("notify-hide")}),t(document).on("notify-hide","."+o+"-wrapper",function(e){var n=t(this).data(o);n&&n.show(!1)})})}),$$.control.registerControl("breizbot.alexa",{deps:["brainjs.http"],init(t,e){const n=window.location.hash.substr(1),i=$$.url.parseUrlParams(n);e.post("/api/alexa/auth",i).then(()=>{window.close()})}}),$$.control.registerControl("breizbot.appTab",{props:{appUrl:"about:blank"},template:'<iframe bn-attr="{src: appUrl}" bn-bind="iframe" bn-event="load: onFrameLoaded"></iframe>',init:function(t){const{appUrl:e}=this.props,n=$$.viewController(t,{data:{appUrl:e},events:{onFrameLoaded:function(){}}});this.onAppExit=function(){const t=$(n.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();return t&&"function"==typeof t.onAppExit?t.onAppExit():Promise.resolve()},this.onAppSuspend=function(){const t=$(n.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();t&&"function"==typeof t.onAppSuspend&&t.onAppSuspend()},this.onAppResume=function(){const t=$(n.scope.iframe.get(0).contentWindow.document).find(".rootPage").iface();t&&"function"==typeof t.onAppResume&&t.onAppResume()},this.setAppUrl=function(t){n.setData({appUrl:t+"&date="+Date.now()})}}}),$$.control.registerControl("breizbot.apps",{props:{apps:[],showActivated:!1,items:null},$iface:"setData(data)",template:'<div class="scrollPanel">\n\t<div bn-each="apps" \n\t\tbn-iter="app" \n\t\tclass="main" \n\t\tbn-event="click.tile: onTileClick, contextmenuchange.tile: onTileContextMenu"\n\t\t>\t\t\t\n\t\t<div bn-attr="class1" bn-control="brainjs.contextmenu" bn-data="{items: getItems}">\n\t\t\t<div class="arrow-right" bn-show="show1"></div>\n\t\t\t<div bn-show="show2" style="margin-bottom: 5px;">\n\t\t\t\t<i bn-attr="{class: $scope.app.props.iconCls}"></i>\n\t\t\t</div>\n\t\t\t<div bn-if="show3">\n\t\t\t\t<img bn-attr="{src: getIconUrl}">\n\t\t\t</div>\n\t\t\t<span bn-text="$scope.app.props.title" bn-show="!show3"></span>\n\t\t</div>\n\n\t</div>\n</div>',init:function(t){const{apps:e,showActivated:n,items:i}=this.props;console.log("apps",e);const o=$$.viewController(t,{data:{getItems:function(t){return"function"==typeof i?i(t.app):i},apps:e,showActivated:n,show1:function(t){return this.showActivated&&t.app.activated},class1:function(t){const{title:e,colorCls:n}=t.app.props,i={title:e,class:"tile w3-btn"};return n.startsWith("#")?i.style=`background-color: ${n}`:i.class+=" "+n,i},show2:function(t){return"string"==typeof t.app.props.iconCls},show3:function(t){return"string"==typeof t.app.props.iconUrl},getIconUrl(t){const{appName:e,props:n}=t.app;return`/webapps/${e}/assets/${n.iconUrl}`}},events:{onTileClick:function(e){const n=$(this).index();t.trigger("appclick",o.model.apps[n])},onTileContextMenu:function(e,n){const i=$(this).index(),{cmd:s}=n,r=$.extend({cmd:s},o.model.apps[i]);t.trigger("appcontextmenu",r)}}});this.setData=function(t){console.log("data",t),o.setData({apps:t.apps.filter(t=>0!=t.props.visible&&"template"!=t.appName)})}},$iface:"setData(data)",$events:"appclick;appcontextmenu"}),$$.control.registerControl("breizbot.addContactPage",{template:'<form bn-event="submit: onSubmit" bn-form="info">\n\n\t<div bn-control="brainjs.accordion" data-height-style="fill">\n\n\n\t\t<div title="Name & Email">\n\t\t\t<div class="gender">\n\t\t\t\t<label>Gender:</label>\n\t\t\t\t<div bn-control="brainjs.radiogroup" name="gender">\n\t\t\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t\t\t<input type="radio" value="male">\n\t\t\t\t\t\t<label>Male</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t\t\t<input type="radio" value="female">\n\t\t\t\t\t\t<label>Female</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Name:</label><br>\n\t\t\t\t<input type="text" name="name" required="">\n\t\t\t</div>\n\t\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Email:</label><br>\n\t\t\t\t<input type="email" name="email">\n\t\t\t</div>\n\t\n\t\t</div>\n\n\t\t<div title="Birthday">\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Birthday</label><br>\n\t\t\t\t<input type="text" bn-control="brainjs.datepicker" \n\t\t\t\t\tbn-data="{\n\t\t\t\t\t\tchangeYear: true,\n\t\t\t\t\t\tyearRange: \'-100:+0\'\n\t\t\t\t\t}"\n\t\t\t\t\tname="birthday">\n\t\t\t</div>\n\t\n\t\t\t<div class="birthNotif">\n\t\t\t\t<label>Activate birthday Notification</label>\n\t\t\t\t<div bn-control="brainjs.flipswitch" name="birthdayNotif"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\t\t<div title="Phones">\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Home Phone:</label><br>\n\t\t\t\t<input name="phone" bn-control="brainjs.inputphone">\n\t\t\t</div>\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Cell Phone:</label><br>\n\t\t\t\t<input name="mobilePhone" bn-control="brainjs.inputphone">\n\t\t\t</div>\n\t\n\t\t</div>\n\n\t\t<div title="Address">\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Address:</label><br>\n\t\t\t\t<input type="text" name="address">\n\t\t\t</div>\n\t\n\t\t\t<div bn-control="brainjs.inputgroup">\n\t\t\t\t<label>Postal Code:</label><br>\n\t\t\t\t<input type="number" name="postalCode" maxlength="5" bn-event="blur: onPostalCodeLostFocus">\n\t\t\t</div>\n\t\n\t\t\t<div>\n\t\t\t\t<label>City:</label>\n\t\t\t\t<div bn-control="brainjs.combobox" bn-data="{items: cities}" name="city" bn-val="city"></div>\n\t\t\t</div>\n\t\n\t\t</div>\n\n\t</div>\n\n\t<input type="submit" bn-bind="submit" hidden="">\n</form>',deps:["breizbot.pager","breizbot.contacts","breizbot.cities"],props:{data:{}},init:function(t,e,n,i){const o=this.props.info||{},s=o._id,{postalCode:r,city:a}=o,l=$$.viewController(t,{data:{info:o,cities:[]},events:{onSubmit:async function(t){t.preventDefault();const n=$(this).getFormData();e.popPage({id:s,data:n})},onPostalCodeLostFocus:async function(){const t=await i.getCitesFromPostalCode(this.value);l.setData({cities:t})}}});r&&""!=r&&async function(){const t=await i.getCitesFromPostalCode(r);l.setData({cities:t}),a&&""!=a&&l.setData({city:a})}(),this.addContact=async function(t){await n.addContact(t)},this.updateContactInfo=async function(t,e){await n.updateContactInfo(t,e)},this.getButtons=function(){return{add:{title:"Apply",icon:"fa fa-check",onClick:function(){l.scope.submit.click()}}}}}}),$$.control.registerControl("breizbot.contacts",{deps:["breizbot.contacts"],props:{showSelection:!1,hasSearchbar:!1,contextMenu:{}},template:'<div bn-control="breizbot.searchbar" \n\tbn-event="searchbarsubmit: onSearch" \n\tbn-show="hasSearchbar"\n\tbn-data="{required: false}"\n\t></div>\n<p bn-show="show2">You have no contacts</p>\n<div class="scrollPanel">\n\t<ul class="w3-ul w3-border w3-white" \n\t\tbn-event="contextmenuchange.w3-bar: onItemContextMenu, click.w3-bar: onItemClick, click.input: onInputClick"\n\t\tbn-each="getContacts"\n\t\tbn-show="show1"\n\t\t>\n\t\t<li class="w3-bar" bn-control="brainjs.contextmenu" bn-data="{items: contextMenu}">\n\n\t\t\t<div class="w3-bar-item" >\n\t\t\t\t<strong bn-text="$scope.$i.name"></strong><br>\n\t\t\t\t<div bn-text="getAddress"></div>\n\t\t\t\t<div bn-show="$scope.$i.email">\n\t\t\t\t\t<i class="fa fa-envelope w3-text-blue"></i>\n\t\t\t\t\t<span bn-text="$scope.$i.email"></span>\t\n\t\t\t\t</div>\n\t\t\t\t<div bn-show="$scope.$i.mobilePhone">\n\t\t\t\t\t<a bn-attr="{href : getCellPhone}"><i class="fa fa-mobile-alt w3-text-blue"></i></a>\n\t\t\t\t\t<input class="input" bn-control="brainjs.inputphone" bn-val="$scope.$i.mobilePhone" readonly>\t\n\t\t\t\t</div>\n\t\t\t\t<div bn-show="$scope.$i.phone">\n\t\t\t\t\t<a bn-attr="{href : getHomePhone}"><i class="fa fa-home w3-text-blue"></i></a>\n\t\t\t\t\t<input class="input" bn-control="brainjs.inputphone" bn-val="$scope.$i.phone" readonly>\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</li>\n\t</ul>\t\t\n\n</div>\n',init:function(t,e){const{showSelection:n,contextMenu:i,hasSearchbar:o}=this.props,s=$$.viewController(t,{data:{contacts:[],showSelection:n,hasSearchbar:o,filter:"",contextMenu:i,getContacts:function(){if(""!=this.filter){const t=new RegExp(`w*${this.filter}w*`,"i");return this.contacts.filter(e=>t.test(e.name))}return this.showSelection?this.contacts.filter(t=>t.email&&""!=t.email):this.contacts},show1:function(){return this.contacts.length>0},show2:function(){return 0==this.contacts.length},getCellPhone:function(t){return"tel:"+t.$i.mobilePhone},getHomePhone:function(t){return"tel:"+t.$i.phone},getAddress:function(t){const{address:e,city:n,postalCode:i}=t.$i;return`${e||""} ${i||""} ${n||""}`}},events:{onSearch:function(t,e){s.setData({filter:e.value})},onInputClick:function(){$(this).closest("div").find("a").get(0).click()},onItemContextMenu:function(e,n){const{cmd:i}=n,o=$(this).index(),r=s.model.getContacts()[o];t.trigger("contactcontextmenu",{cmd:i,info:r})},onItemClick:function(){n&&$(this).toggleClass("w3-blue")}}});async function r(){const t=await e.getContacts();s.setData({contacts:t})}r(),this.update=r,this.removeContact=async function(t){await e.removeContact(t),await r()},this.getSelection=function(){const e=[];return t.find("li.w3-blue").each(function(){const t=$(this).index();e.push(s.model.getContacts()[t])}),console.log("ret",e),e}},$iface:"\n\t\tgetSelection(): [ContactInfo]\n\t\tremoveContact(id)\n\t",$events:"contactclick"}),$$.control.registerControl("breizbot.htmleditor",{template:'<div bn-event="click.cmd: onCommand" class="toolbar">\n\n\t<div class="group">\n\t\t<button class="cmd w3-button"  \n\t\t\tbn-icon="fas fa-microphone" \n\t\t\ttitle="Toogle Micro" \n\t\t\tbn-event="click: onToogleMicro" \n\t\t\tbn-show="speechRecoAvailable"></button>\n\t\t<button class="cmd w3-button"  bn-icon="fas fa-remove-format" title="Remove Format" bn-event="click: onRemoveFormat"></button>\n\t\t<span class="separator"></span>\n\n\t</div>\n\n\t<div class="group">\n\t\t<button class="cmd w3-button" data-cmd="bold" title="Bold" bn-icon="fa fa-bold"></button>\n\t\t<button class="cmd w3-button" data-cmd="italic" title="Italic" bn-icon="fa fa-italic"></button>\n\t\t<button class="cmd w3-button" data-cmd="underline" title="Underline" bn-icon="fa fa-underline"></button>\n\t\t<span class="separator"></span>\n\n\t</div>\n\n\t<div class="group">\n\t\t<button class="w3-button" \n\t\t\tbn-control="brainjs.contextmenu" \n\t\t\tbn-event="contextmenuchange: onFontNameChange"\n\t\t\tbn-icon="fas fa-caret-down"\n\t\t\ttitle="Font Name" \n\t\t\tbn-html="getFontName" \n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: fontNameItems\n\t\t\t}">\n\n\t\t</button>\n\n\t\t<button class="w3-button" \n\t\t\tbn-control="brainjs.contextmenu" \n\t\t\tbn-event="contextmenuchange: onFontSizeChange"\n\t\t\tbn-icon="fas fa-caret-down"\n\t\t\ttitle="Font Size" bn-html="getFontSize" \n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: fontSizeItems\n\t\t\t}">\n\n\t\t</button>\n\n\n\t\t<button class="w3-button" \n\t\t\tbn-control="brainjs.contextmenu" \n\t\t\tbn-event="contextmenuchange: onCommand" \n\t\t\ttitle="Title"\n\t\t\tbn-icon="fas fa-caret-down"\n\t\t\tdata-cmd="formatBlock" \n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: headingItems\n\t\t\t}">\n\t\t\tÂ§&nbsp;\n\t\t</button>\n\n\t\t<button title="Alignment" class="w3-button" \n\t\t\tbn-control="brainjs.contextmenu"\n\t\t\tbn-event="contextmenuchange: onCommand" \n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: {\n\t\t\t\t\tjustifyLeft: {name: \'Left\', icon: \'fas fa-align-left\'},\n\t\t\t\t\tjustifyCenter: {name: \'Center\', icon: \'fas fa-align-center\'},\n\t\t\t\t\tjustifyRight: {name: \'Right\', icon: \'fas fa-align-right\'}\n\t\t\t\t}\n\t\t\t}">\n\t\t\t<i class="fas fa-align-left"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<button class="w3-button" title="Text color" \n\t\t\tbn-control="brainjs.contextmenu" \n\t\t\tbn-data="{\n\t\t\t\titems: colorItems,\n\t\t\t\ttrigger: \'left\'\n\t\t\t}" \n\t\t\tbn-event="contextmenuchange: onColorMenuChange">\n\t\t\t<i class="fas fa-paint-brush" bn-style="{color}"></i>\n\t\t</button>\n\n\t\t<span class="separator"></span>\n\t</div>\n\n\t<div class="group">\n\t\t<button title="Indent" class="w3-button"\n\t\t\tbn-control="brainjs.contextmenu"\n\t\t\tbn-event="contextmenuchange: onCommand" \n\t\t\tbn-data="{\n\t\t\t\t\ttrigger: \'left\',\n\t\t\t\t\titems: {\n\t\t\t\t\t\tindent: {name: \'Indent\', icon: \'fas fa-indent\'},\n\t\t\t\t\t\toutdent: {name: \'Outdent\', icon: \'fas fa-outdent\'}\n\t\t\t\t\t}\n\t\t\t\t}">\n\t\t\t<i class="fas fa-indent"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\n\t\t<button title="List" class="w3-button" \n\t\t\tbn-control="brainjs.contextmenu" \n\t\t\tbn-event="contextmenuchange: onCommand"\n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\',\n\t\t\t\titems: {\n\t\t\t\t\tinsertUnorderedList: {name: \'Unordered\', icon: \'fas fa-list-ul\'},\n\t\t\t\t\tinsertOrderedList: {name: \'Ordered\', icon: \'fas fa-list-ol\'}\n\t\t\t\t}\n\t\t\t}">\n\t\t\t<i class="fas fa-list-ol"></i>\n\t\t\t<i class="fas fa-caret-down"></i>\n\t\t</button>\n\n\t\t<span class="separator"></span>\n\n\t</div>\n\n\t<div class="group">\n\t\t<button class="w3-button cmd" title="Horizontal Rule" data-cmd="insertHorizontalRule"bn-icon="fas fa-minus"></button>\n\t\t<button class="w3-button" title="Insert Link" bn-event="click: onCreateLink" bn-icon="fas fa-link"></button>\t\t\n\t\t<button title="Insert image" bn-event="click: onInsertImage" class="w3-button" bn-icon="fa fa-image"></button>\n\t\t<button title="Insert Table from selection" bn-event="click: onInsertTable" class="w3-button" bn-icon="fa fa-th"></button>\n\n\t</div>\n\n\n</div>\n\n\n<div class="bottom">\n\t<img bn-attr="{src: getMicUrl}" class="micro" bn-event="click: onMicro" bn-show="isMicroVisible" title="Speech Recognition">\n\t<div class="scrollPanel" bn-event="click: onScrollClick">\n\t\t<div contenteditable="true" bn-bind="editor" class="editor" bn-html="html"></div>\n\t</div>\n</div>\n',deps:["breizbot.pager","breizbot.files"],props:{useDataUrlForImg:!1},init:function(t,e,n){const{useDataUrlForImg:i}=this.props;console.log("useDataUrlForImg",i);const o={black:"#000000",red:"#f44336",green:"#4CAF50",blue:"#2196F3",yellow:"#ffeb3b",cyan:"#00bcd4",pink:"#e91e63"},s="8,10,12,14,18,24,36".split(","),r=["Arial","Courier New","Times New Roman"];const a=function(){const t={};return s.forEach((e,n)=>{t[n+1]={name:`<font size="${n+1}">${e} pt</font>`,isHtmlName:!0}}),t}(),l=function(){const t={};return r.forEach(e=>{t[e]={name:`<font face="${e}">${e}</font>`,isHtmlName:!0}}),t}(),c=function(){const t={};return Object.keys(o).forEach(e=>{t[e]={name:e.charAt(0).toUpperCase()+e.slice(1),icon:`fas fa-square-full w3-text-${e}`}}),t}(),u=o.black,d="webkitSpeechRecognition"in window,f=/Android/i.test(navigator.userAgent);console.log("isMobilDevice",f);let p=!1,h=null,b=null,m=null,g="",v=null;const w=/\n\n/g,y=/\n/g;function A(t){return t.replace(w,"<p></p>").replace(y,"<br>")}const x=/\S/;function C(){I()?(v=F(),b=document.createElement("span"),(m=document.createElement("span")).className="interim",v.insertNode(m),v.insertNode(b),g="",h.start(),p=!1):$$.ui.showAlert({title:"Error",content:"Please select a text before"})}function k(t,e){const n=["I","B","U","FONT"].includes(e)?"span":"div";return $(`<${n}>`).text(t)}d&&((h=new webkitSpeechRecognition).continuous=!0,h.interimResults=!0,h.lang="fr-FR",h.onstart=function(){console.log("onStart"),D.setData({recognizing:!0})},h.onerror=function(t){console.log("onError",t.error)},h.onend=function(){console.log("onEnd"),f&&D.model.recognizing?(v.collapse(),C()):(D.setData({recognizing:!1}),v.collapse())},h.onresult=function(t){let e="";for(let n=t.resultIndex;n<t.results.length;++n)t.results[n].isFinal&&0!=t.results[n][0].confidence?g+=t.results[n][0].transcript:e+=t.results[n][0].transcript;g=g.replace(x,t=>t.toUpperCase()),b.innerHTML=A(g),m.innerHTML=A(e)});const D=$$.viewController(t,{data:{html:t.val(),fontSize:"3",fontName:"Arial",getFontSize:function(){return`${s[this.fontSize-1]} pt&nbsp;<i class="fas fa-caret-down"></i>`},getFontName:function(){return`${this.fontName}&nbsp;<i class="fas fa-caret-down"></i>`},fontSizeItems:a,fontNameItems:l,colorItems:c,color:u,headingItems:function(){const t={p:{name:"Normal"}};for(let e=1;e<=6;e++)t["h"+e]={name:`<h${e}>Heading ${e}</h${e}>`,isHtmlName:!0};return t}(),showMicro:!1,isMicroVisible:function(){return this.showMicro&&this.speechRecoAvailable},speechRecoAvailable:d,recognizing:!1,getMicUrl:function(){return this.recognizing?"/assets/mic-animate.gif":"/assets/mic.gif"}},events:{onToogleMicro:function(){D.setData({showMicro:!D.model.showMicro})},onInsertTable:function(){if(!I())return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const t=window.getSelection(),e=t.getRangeAt(0);if(["TD","TH"].includes(e.startContainer.parentElement.tagName)){const n=$(e.startContainer.parentElement).closest("table"),i=n.find("tr"),o=[];i.each(function(){const t=$(this).find("td,th"),e=[];t.each(function(){e.push($(this).text())}),o.push(e.join(";"))}),n.remove(),e.deleteContents();for(const t of o.reverse()){const n=document.createElement("div");n.textContent=t,e.insertNode(n)}return void t.removeAllRanges()}const n=S(e.commonAncestorContainer,e.startContainer,e.endContainer);if(0==n.length)return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});e.deleteContents(),console.log(n);const i=document.createElement("table");for(const t of n){const e=document.createElement("tr");i.appendChild(e);for(const n of t.split(";")){const t=document.createElement("td");e.appendChild(t),t.textContent=n}}e.insertNode(i),t.removeAllRanges()},onRemoveFormat:function(t){t.stopPropagation();const e=window.getSelection();if(!I())return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const n=e.anchorNode;if(n.nodeType!=n.TEXT_NODE)return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const i=n.textContent,o=n.parentElement,s=o.tagName;$(o).hasClass("editor")?null!=n.previousSibling&&(k(i,s).insertAfter(n.previousSibling),o.removeChild(n)):1==o.parentElement.childElementCount?(o.removeChild(n),o.parentElement.textContent=o.parentElement.textContent+i):$(o).replaceWith(k(i,s))},onMicro:function(){D.model.recognizing?(D.setData({recognizing:!1}),h.stop()):C()},onInsertImage:function(t){!function(){const t=window.getSelection();if(!I())return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const o=t.getRangeAt(0);e.pushPage("breizbot.files",{title:"Insert Image",props:{filterExtension:"jpg,jpeg,png,gif"},events:{fileclick:function(t,n){e.popPage(n)}},onReturn:async function(t){console.log("onReturn",t);const{fileName:e,rootDir:s}=t;let r=n.fileUrl(s+e);i&&(r=await $$.url.imageUrlToDataUrl(r));const a=document.createElement("img");a.src=r,o.insertNode(a)}})}()},onFontNameChange:function(t,e){D.setData({fontName:e.cmd}),document.execCommand("fontName",!1,e.cmd)},onFontSizeChange:function(t,e){D.setData({fontSize:e.cmd}),document.execCommand("fontSize",!1,e.cmd)},onCreateLink:async function(){P(async()=>await $$.ui.showPrompt({title:"Insert Link",label:"Link Target",attrs:{type:"url"}}))},onScrollClick:function(){D.scope.editor.focus()},onCommand:function(t,e){let n,i;e?null!=(n=$(this).data("cmd"))?i=e.cmd:n=e.cmd:(n=$(this).data("cmd"),i=$(this).data("cmdArg")),document.execCommand(n,!1,i)},onColorMenuChange:function(t,e){console.log("onColorMenuChange",e);const n=o[e.cmd];D.setData({color:n}),document.execCommand("foreColor",!1,n)}}});function S(t,e,n){let i=!1,o=!1;const s=[];return function t(r){if(r==e&&(i=!0),r.nodeType==Node.TEXT_NODE){if(i&&!o)if("SPAN"==r.parentElement.tagName&&"DIV"==r.parentElement.parentElement.tagName&&function(t){return 0!=Array.from(t.childNodes).filter(t=>t.nodeType==Node.TEXT_NODE).length}(r.parentElement.parentElement)){const t=s.length;t>0&&(s[t-1]+=r.textContent)}else s.push(r.textContent)}else for(let e=0,n=r.childNodes.length;!o&&e<n;++e)t(r.childNodes[e]);r==n&&(o=!0)}(t),s}async function P(t){const e=window.getSelection();if(!I())return void $$.ui.showAlert({title:"Error",content:"Please select a text before"});const n=F();if("function"==typeof t&&"AsyncFunction"===t.constructor.name){const i=await t();console.log("href",i),null!=i&&(e.removeAllRanges(),e.addRange(n),document.execCommand("createLink",!1,i))}}function F(){return window.getSelection().getRangeAt(0)}function I(){let t=window.getSelection().anchorNode;const e=D.scope.editor.get(0);for(;t&&t!=document.documentElement;){if(t==e)return!0;t=t.parentNode}return!1}t.find("button.w3-button").attr("type","button"),$(document).on("selectionchange",()=>{const t=window.getSelection();if(!I())return;const e=$(t.anchorNode).closest("font[size]");if(1==e.length){const t=e.attr("size")||"3",n=e.attr("face")||"Arial";D.setData({fontSize:t,fontName:n})}else D.setData({fontSize:"3",fontName:"Arial"});const n=$(t.anchorNode).closest("font[color]");if(1==n.length){const t=n.attr("color")||u;D.setData({color:t})}else D.setData({color:u})}),this.addLink=P,this.isEditable=I,this.html=function(t){if(null==t)return D.scope.editor.find("span").remove(".interim"),D.scope.editor.find("span").removeAttr("style"),D.scope.editor.html();D.scope.editor.html(t)},this.load=function(t,e){return D.scope.editor.load(t,e)},this.getValue=function(){return D.scope.editor.html()},this.setValue=function(t){D.scope.editor.html(t)},this.focus=function(){D.scope.editor.get(0).focus()}}}),$$.control.registerControl("breizbot.filterDlg",{template:'<form bn-event="submit: onSubmit">\n\n    <label>Genre</label>\n    <div bn-control="brainjs.combobox" bn-data="{items: genres}" bn-val="selectedGenre" bn-event="comboboxchange: onGenreChange" name="genre"></div>    \n\n    <label>Artist</label>\n    <div bn-control="brainjs.combobox" bn-data="{items: artists}" bn-val="selectedArtist" bn-update="comboboxchange" name="artist"></div>    \n\n\n    <input type="submit" hidden bn-bind="submit">\n</form>\n',deps:["breizbot.pager"],props:{files:[],mp3Filters:null},init:function(t,e){let{files:n,mp3Filters:i}=this.props;const o=(i=i||{}).genre||"All",s=i.artist||"All";function r(t){let e={};return n.forEach(n=>{if(n.mp3&&("All"==t||n.mp3.genre==t)){const{artist:t}=n.mp3;t&&(e[t]?e[t]++:e[t]=1)}}),(e=Object.keys(e).sort().map(t=>{const n=e[t];return 1==n?{value:t,label:t}:{value:t,label:`${t} (${n})`}})).unshift({value:"All",label:"All",style:"font-weight: bold;"}),e}console.log("selectedArtist",s),console.log("selectedGenre",o);const a=$$.viewController(t,{data:{artists:r(o),genres:function(){let t={};return n.forEach(e=>{if(e.mp3){const{genre:n}=e.mp3;n&&!n.startsWith("(")&&(t[n]?t[n]++:t[n]=1)}}),(t=Object.keys(t).sort().map(e=>{const n=t[e];return 1==n?{value:e,label:e}:{value:e,label:`${e} (${n})`}})).unshift({value:"All",label:"All",style:"font-weight: bold;"}),t}(),selectedArtist:s,selectedGenre:o},events:{onGenreChange:function(t){const e=$(this).getValue();a.setData({artists:r(e)})},onSubmit:function(t){t.preventDefault(),e.popPage($(this).getFormData())}}});this.getButtons=function(){return{apply:{title:"Apply",icon:"fa fa-check",onClick:function(){a.scope.submit.click()}}}}}}),$$.control.registerControl("breizbot.filechooser",{template:'<p>Select a file system</p>\n<ul class="w3-ul w3-border w3-white">\n\t<li class="w3-bar" bn-event="click: onHome">\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-home fa-2x fa-fw w3-text-blue"></i>\n\t\t\t<span>Your home files</span>\n\t\t</div>\n\t</li>\n\n\t<li class="w3-bar" bn-event="click: onShare">\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-share-alt fa-2x fa-fw w3-text-blue"></i>\n\t\t\t<span>Files shared by your friends</span>\n\t\t</div>\n\t</li>\n</ul>\t',deps:["breizbot.pager","breizbot.files"],props:{filterExtension:"",getMP3Info:!1,showMp3Filter:!1},init:function(t,e,n){const{filterExtension:i,getMP3Info:o,showMp3Filter:s}=this.props;function r(t,r){const a={title:t,props:{filterExtension:i,friendUser:r,getMP3Info:o},events:{fileclick:function(t,i){const{rootDir:o,fileName:s,mp3:a}=i,l=n.fileUrl(o+s,r);e.popPage({url:l,mp3:a,fileName:s})}},onReturn:function(t){e.popPage(t)}};s&&(a.buttons={search:{title:"Filter",icon:"fas fa-filter",onClick:function(){!function(t){const n=t.getMP3Filters(),i=t.getFiles();e.pushPage("breizbot.filterDlg",{title:"Filter",props:{files:i,mp3Filters:n},onReturn:function(e){t.setMP3Filters(e)}})}(l)}}});const l=e.pushPage("breizbot.files",a)}$$.viewController(t,{data:{},events:{onHome:function(){r("Home files","")},onShare:function(){e.pushPage("breizbot.friends",{title:"Shared files",props:{showConnectionState:!1},events:{friendclick:function(t,e){const{userName:n}=e;r(n,n)}},onReturn:function(t){e.popPage(t)}})}}})}}),function(){function t(t){let{name:e,folder:n}=t;return e=e.toLowerCase(),n?"fa-folder-open w3-text-deep-orange":e.endsWith(".pdf")?"fa-file-pdf w3-text-red":e.endsWith(".hdoc")?"fa-file-word w3-text-blue":e.endsWith(".ogg")||e.endsWith(".mp3")?"fa-file-audio w3-text-purple":e.endsWith(".mp4")||e.endsWith(".webm")||e.endsWith(".3gp")?"fa-file-video w3-text-orange":e.endsWith(".zip")?"fa-file-archive w3-text-amber":"fa-file w3-text-blue-grey"}$$.control.registerControl("breizbot.filelist",{deps:["breizbot.files"],props:{selectionEnabled:!1,filterExtension:void 0,getMP3Info:!1,friendUser:"",mp3Filters:null},template:'<div bn-show="loading" class="loading">\n\t<i class="fa fa-spinner fa-pulse"></i>\n\tloading ...\n</div>\n\n<div class="pathPanel" bn-event="click.pathItem: onPathItem" bn-show="!loading">\n\t<div bn-each="getPath" bn-index="idx">\n\t\t<i class="fa fa-chevron-right" bn-show="!isFirst"></i>\n\t\t<span>\n\t\t\t<a class="pathItem" bn-text="$scope.$i" href="#" bn-show="!isLast" bn-data="{info: getPathInfo}"></a>\n\t\t\t<span bn-text="$scope.$i" bn-show="isLast" class="lastItem"></span>\n\n\t\t</span>\n\t</div>\n</div>\n\n<div class="scrollPanel">\n\t<table class="w3-table-all w3-hoverable w3-small">\n\t\t<thead>\n\t\t\t<tr bn-html="getHeader"></tr>\n\t\t</thead>\n\t\t<tbody bn-each="getFiles" bn-iter="f" bn-lazzy="10" bn-bind="files" bn-event="click.item: onItemClick">\n\t\t\t<tr class="item" bn-html="getItem"></tr>\n\t\t</tbody>\n\t</table>\n\n</div>\n\n',init:function(e,n){let{selectionEnabled:i,filterExtension:o,friendUser:s,getMP3Info:r,mp3Filters:a}=this.props;const l=$$.viewController(e,{data:{loading:!1,selectionEnabled:i,rootDir:"/",files:[],mp3Filters:a,getHeader:function(){const t=[];return t.push(""),r?(t.push("Title"),t.push("Artist"),t.push("Duration"),t.push("BPM")):(t.push("Name"),t.push("Size"),t.push("Last Modif")),t.map(t=>`<th>${t}</th>`).join("")},getItem:function(e){const n=[];return n.push(`<i class="fa fa-2x ${t(e.f)}"></i>`),r?(n.push(this.getTitle(e)),n.push(this.getArtist(e)),n.push(this.getDuration(e)),n.push(this.getBPM(e))):(n.push(e.f.name),n.push(this.getSize(e)),n.push(this.getDate(e))),n.map(t=>`<td>${t}</td>`).join("")},getIconClass:function(e){return{class:"fa fa-lg "+t(e.f)}},getDuration:function(t){const{mp3:e}=t.f;return null!=e&&e.length?$$.media.getFormatedTime(e.length):""},getBPM:function(t){const{mp3:e}=t.f;return null!=e&&e.bpm?e.bpm:""},getArtist:function(t){const{mp3:e}=t.f;return null!=e&&e.artist?e.artist:""},getTitle:function(t){const{mp3:e,folder:n,name:i}=t.f;return n?i:null!=e&&e.title?e.title:""},isInFilter:function(t){var e=!0;for(let n in this.mp3Filters){const i=t[n],o=this.mp3Filters[n];"All"!=o&&(e&=o===i)}return e},getFiles:function(){return null===this.mp3Filters?this.files:this.files.filter(t=>t.folder||t.mp3&&t.mp3&&this.isInFilter(t.mp3))},getPath:function(){const t=("/home"+this.rootDir).split("/");return t.shift(),t.pop(),t},isLast:function(t){return t.idx==this.getPath().length-1},isFirst:function(t){return 0==t.idx},getPathInfo:function(t){return this.getPath().slice(1,t.idx+1).join("/")},getSize:function(t){if(t.f.folder)return"";let e=t.f.size,n="octets";return e>1024&&(n="Ko",e/=1024),e>1024&&(n="Mo",e/=1024),(e=Math.floor(10*e)/10)+" "+n},getDate:function(t){return new Date(t.f.mtime).toLocaleDateString()}},events:{onPathItem:function(t){const n=$(this).data("info");t.preventDefault();const i=""==n?"/":"/"+n+"/";t.stopPropagation(),e.trigger("dirchange",{newDir:i}),u(i)},onItemClick:function(t){t.stopPropagation();const n=$(this).index(),o=l.model.getFiles()[n];if(o.folder){const t=o.name,n=l.model.rootDir+t+"/";e.trigger("dirchange",{newDir:n}),u(n)}else{i&&($(this).closest("tbody").find(".active").removeClass("active"),$(this).addClass("active"));const t={fileName:o.name,rootDir:l.model.rootDir,isImage:o.isImage,mp3:o.mp3};e.trigger("fileclick",t)}}}}),c=l.scope.files;async function u(t,e){null==t&&(t=l.model.rootDir),l.setData({loading:!0});let a=await n.list(t,{filterExtension:o,getMP3Info:r},s);r&&(a=a.filter(t=>t.folder||null!=t.mp3&&t.mp3.title)),function(t){t.sort((t,e)=>t.folder&&!e.folder?-1:!t.folder&&e.folder?1:t.name.localeCompare(e.name))}(a),!1!==e&&(l.model.mp3Filters=null),l.setData({loading:!1,files:a,rootDir:t}),i&&l.scope.files.find(".item").eq(0).addClass("active")}u(),this.getRootDir=function(){return l.model.rootDir},this.enterSelFolder=function(){const t=c.find(".active").index();console.log("enterSelFolder",t);const n=l.model.getFiles()[t];if(console.log("info",n),n.folder){const t=n.name,i=l.model.rootDir+t+"/";e.trigger("dirchange",{newDir:i}),u(i)}},this.selUp=function(){const t=c.find(".active"),e=t.index();if(e>0){t.removeClass("active");const n=c.find(".item");n.eq(e-1).addClass("active"),e-1>0?n.eq(e-2).get(0).scrollIntoViewIfNeeded():n.eq(e-1).get(0).scrollIntoViewIfNeeded()}},this.selDown=function(){const t=c.find(".active"),e=t.index();e<l.model.files.length-1&&(t.removeClass("active"),c.find(".item").eq(e+1).addClass("active").get(0).scrollIntoView(!1))},this.getSelFile=function(){const t=l.scope.files.find(".active").index();if(t<0)return null;const{mp3:e,name:i}=l.model.getFiles()[t];return{name:i,mp3:e,url:n.fileUrl(l.model.rootDir+i,s)}},this.setMP3Filters=function(t){l.setData({mp3Filters:t})},this.getMP3Filters=function(){return l.model.mp3Filters}}})}(),function(){$$.control.registerControl("breizbot.files",{deps:["breizbot.files"],props:{selectionEnabled:!1,folderSelectionEnabled:!0,imageOnly:!1,filterExtension:void 0,getMP3Info:!1,friendUser:"",mp3Filters:null,menuItems:function(t){return{}}},template:'\n<div bn-text="info" bn-bind="info" class="info"></div>\n\n<div bn-show="loading" class="loading">\n\t<i class="fa fa-spinner fa-pulse"></i>\n\tloading ...\n</div>\n\n<div class="pathPanel" bn-event="click.pathItem: onPathItem" bn-show="!loading">\n\t<div bn-each="getPath" bn-index="idx">\n\t\t<i class="fa fa-chevron-right" bn-show="!isFirst"></i>\n\t\t<span>\n\t\t\t<a class="pathItem" bn-text="$scope.$i" href="#" bn-show="!isLast" bn-data="{info: getPathInfo}"></a>\n\t\t\t<span bn-text="$scope.$i" bn-show="isLast" class="lastItem"></span>\n\n\t\t</span>\n\t</div>\n\n\n</div>\n\n\n<div class="scrollPanel">\n\n\t<div \n\t\tbn-each="getFiles" \n\t\tbn-iter="f" \n\t\tbn-lazzy="10" \n\t\tbn-bind="files" \n\t\tbn-event="click.folder: onFolderClick, click.check: onCheckClick, click.file: onFileClick, contextmenuchange.thumbnail: onContextMenu"\n\t\tclass="container"\n\t>\n\n\t\t<div class="thumbnail w3-card-2" bn-control="brainjs.contextmenu" bn-data="{items: getItems}">\n\n\t\t\t<span bn-if="if1">\n\t\t\t\t<input type="checkbox" bn-show="showCheckSelection" class="check w3-check"\n\t\t\t\t\tbn-prop="{checked: $scope.f.checked}">\n\t\t\t</span>\n\t\t\t<div bn-if="$scope.f.folder" class="folder item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i class="fa fa-4x fa-folder-open w3-text-deep-orange"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate" bn-if="if1"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div bn-if="if2" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i bn-attr="{class: class1}"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bn-if="isMP3" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<i bn-attr="{class: class1}"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<div>Title:&nbsp;<strong bn-text="$scope.f.mp3.title"></strong></div>\n\n\t\t\t\t\t<div>Artist:&nbsp;<strong bn-text="$scope.f.mp3.artist"></strong></div>\n\t\t\t\t\t<div bn-show="hasGenre">Genre:&nbsp;<strong bn-text="$scope.f.mp3.genre"></strong></div>\n\t\t\t\t\t<div bn-show="getDuration">Duration:&nbsp;<strong bn-text="getDuration"></strong></div>\n\t\t\t\t\t<div bn-show="hasYear"> Year:&nbsp;<strong bn-text="getYear"></strong></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bn-if="if3" class="file item">\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<img bn-attr="{src: getThumbnailUrl}">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="info">\n\t\t\t\t\t<strong bn-text="$scope.f.name"></strong>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t\t<span bn-text="getSize"></span>\n\t\t\t\t\t<span bn-text="getDimension"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\n\n</div>',init:function(t,e){let n=!1,{selectionEnabled:i,folderSelectionEnabled:o,filterExtension:s,friendUser:r,imageOnly:a,getMP3Info:l,mp3Filters:c,menuItems:u}=this.props;const d=$$.viewController(t,{data:{getItems:function(t){return u(t.f)},loading:!1,selectionEnabled:i,folderSelectionEnabled:o,rootDir:"/",files:[],mp3Filters:c,info:function(){let t=0,e=0;this.getFiles().forEach(n=>{n.folder?".."!=n.name&&e++:t++});let n=[];return 1==e&&n.push(`${e} folder`),e>1&&n.push(`${e} folders`),1==t&&n.push(`${t} file`),t>1&&n.push(`${t} files`),n.join(" / ")},isInFilter:function(t){var e=!0;for(let n in this.mp3Filters){const i=t[n],o=this.mp3Filters[n];"All"!=o&&(e&=o===i)}return e},getFiles:function(){return null===this.mp3Filters?this.files:this.files.filter(t=>t.folder||t.mp3&&t.mp3&&this.isInFilter(t.mp3))},isMP3:function(t){return l&&null!=t.f.mp3&&null!=t.f.mp3.title&&""!=t.f.mp3.title},getPath:function(){const t=("/home"+this.rootDir).split("/");return t.shift(),t.pop(),t},isLast:function(t){return t.idx==this.getPath().length-1},isFirst:function(t){return 0==t.idx},getPathInfo:function(t){return this.getPath().slice(1,t.idx+1).join("/")},hasGenre:function(t){let{genre:e}=t.f.mp3;return null!=e&&""!=e&&!e.startsWith("(")},hasYear:function(t){let{year:e}=t.f.mp3;return null!=e&&""!=e},getYear:function(t){return parseInt(t.f.mp3.year)},getThumbnailUrl:function(t){return e.fileThumbnailUrl(this.rootDir+t.f.name,"100x?",r)},if1:function(t){return".."!=t.f.name},showCheckSelection:function(t){let e=this.selectionEnabled;return t.f.folder&&(e&=this.folderSelectionEnabled),e},if2:function(t){return!t.f.folder&&!t.f.isImage&&!this.isMP3(t)},if3:function(t){return!t.f.folder&&t.f.isImage},class1:function(t){return`fa fa-4x ${e=t.f.name,(e=e.toLowerCase()).endsWith(".pdf")?"fa-file-pdf w3-text-red":e.endsWith(".hdoc")?"fa-file-word w3-text-blue":e.endsWith(".ogg")||e.endsWith(".mp3")?"fa-file-audio w3-text-purple":e.endsWith(".mp4")||e.endsWith(".webm")||e.endsWith(".3gp")?"fa-file-video w3-text-orange":e.endsWith(".zip")?"fa-file-archive w3-text-amber":"fa-file w3-text-blue-grey"}`;var e},getSize:function(t){let e=t.f.size,n="octets";return e>1024&&(n="Ko",e/=1024),e>1024&&(n="Mo",e/=1024),"Size: "+(e=Math.floor(10*e)/10)+" "+n},getDimension:function(t){const e=t.f.dimension;return`Dimension: ${e.width}x${e.height}`},getDate:function(t){return"Last Modif: "+new Date(t.f.mtime).toLocaleDateString()},getDuration:function(t){return t.f.mp3.length?$$.media.getFormatedTime(t.f.mp3.length):""}},events:{onPathItem:function(e){const n=$(this).data("info");e.preventDefault();const i=""==n?"/":"/"+n+"/";e.stopPropagation(),t.trigger("dirchange",{newDir:i}),f(i)},onContextMenu:async function(e,n){const{cmd:i}=n,o=$(this).closest(".thumbnail").index(),{name:s}=d.model.files[o],{rootDir:r}=d.model;e.stopPropagation(),t.trigger("contextmenuItem",{cmd:i,idx:o,name:s,rootDir:r})},onFileClick:function(e){const n=$(this).closest(".thumbnail").index(),i=d.model.getFiles()[n];e.stopPropagation();const o={fileName:i.name,rootDir:d.model.rootDir,isImage:i.isImage,mp3:i.mp3};t.trigger("fileclick",o)},onCheckClick:function(e){const n=$(this).closest(".thumbnail").index();d.model.getFiles()[n].checked=$(this).getValue(),e.stopPropagation(),t.trigger("selchange",{isShareSelected:p()})},onFolderClick:function(e){const n=$(this).closest(".thumbnail").index(),i=d.model.getFiles()[n].name,o=d.model.rootDir+i+"/";e.stopPropagation(),t.trigger("dirchange",{newDir:o}),f(o)}}});async function f(t,n){null==t&&(t=d.model.rootDir),d.setData({loading:!0});const i=await e.list(t,{filterExtension:s,imageOnly:a,getMP3Info:l},r);!function(t){t.sort((t,e)=>t.folder&&!e.folder?-1:!t.folder&&e.folder?1:t.name.localeCompare(e.name))}(i),!1!==n&&(d.model.mp3Filters=null),d.setData({loading:!1,files:i,rootDir:t,nbSelection:0})}function p(){return"/"==d.model.rootDir&&-1!=d.model.files.findIndex(t=>"share"==t.name&&t.folder&&t.checked)}f(),this.getSelFiles=function(){const t=[];return d.model.files.forEach((e,n)=>{const{name:i,checked:o}=e;!0===o&&".."!=i&&t.push({fileName:d.model.rootDir+i,idx:n})}),t},this.getSelFileNames=(()=>this.getSelFiles().map(t=>t.fileName)),this.getNbSelFiles=function(){return t.find(".check:checked").length},this.toggleSelection=function(){n=!n,t.find(".check").prop("checked",n),d.model.files.forEach(t=>{t.checked=n}),d.updateArrayValue("files","files"),t.trigger("selchange",{isShareSelected:p()})},this.getRootDir=function(){return d.model.rootDir},this.insertFile=function(t,e){e?d.insertArrayItemAfter("files",e,t,"files"):0==(e=d.model.getFiles().filter(t=>t.folder).length)?d.insertArrayItemBefore("files",0,t,"files"):d.insertArrayItemAfter("files",e-1,t,"files"),d.updateNode("info")},this.removeFiles=function(t){d.removeArrayItem("files",t,"files"),d.updateNode("info")},this.updateFile=function(t,e){d.updateArrayItem("files",t,e,"files")},this.updateFileInfo=async function(t,n){const{files:i,rootDir:o}=d.model;let s=d.model.getFiles().findIndex(e=>e.name==t);const a=await e.fileInfo(o+t,r,n);d.updateArrayItem("files",s,a),s=i.findIndex(e=>e.name==t),i[s]=a},this.getFiles=function(){return d.model.files.filter(t=>!t.folder)},this.getFilteredFiles=function(){return d.model.getFiles().filter(t=>!t.folder)},this.reload=function(){f(void 0,!1)},this.setMP3Filters=function(t){d.setData({mp3Filters:t})},this.getMP3Filters=function(){return d.model.mp3Filters}}})}(),$$.control.registerControl("breizbot.friends",{props:{showSelection:!1,showSendMessage:!1,showConnectionState:!0},deps:["breizbot.friends","breizbot.notifs","breizbot.broker"],template:'<ul class="w3-ul w3-border w3-white" bn-each="friends" bn-show="show1"\n\tbn-event="click.w3-bar: onItemClick, click.notif: onSendMessage">\n\t<li class="w3-bar" style="cursor: pointer;">\n\t\t\n\t\t<span class="w3-button w3-right notif w3-blue" title="Send Message" bn-show="showSendMessage">\n\t\t\t<i class="fa fa-envelope"></i>\n\t\t</span>\n\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-user" bn-class="class1"></i>\n\t\t\t<span bn-text="$scope.$i.friendUserName"></span>\n\t\t</div>\n\t</li>\n</ul>\n<p bn-show="show2">You have no friends</p>',init:function(t,e,n,i){const{showSelection:o,showSendMessage:s,showConnectionState:r}=this.props,a=$$.viewController(t,{data:{friends:[],showSendMessage:s,showConnectionState:r,show1:function(){return this.friends.length>0},show2:function(){return 0==this.friends.length},class1:function(t){const e=t.$i,n=this.showConnectionState;return{"w3-text-green":e.isConnected&&n,"w3-text-red":!e.isConnected&&n,"w3-text-blue":!n}}},events:{onItemClick:function(){const e=$(this).closest("li").index(),n=a.model.friends[e].friendUserName;o&&($(this).siblings(".w3-blue").removeClass("w3-blue"),$(this).addClass("w3-blue")),t.trigger("friendclick",{userName:n})},onSendMessage:async function(t){t.stopPropagation();const e=$(this).closest("li").index(),i=a.model.friends[e].friendUserName,o=await $$.ui.showPrompt({title:"Send Message",label:"Message:"});null!=o&&n.sendNotif(i,{text:o,reply:!0})}}});function l(t){if(!0===t.hist)return;const{isConnected:e,userName:n}=t.data;a.model.friends.find(t=>t.friendUserName==n).isConnected=e,a.update()}i.register("breizbot.friends",l),this.getSelection=function(){const e=t.find("li.w3-blue").index();return a.model.friends[e]},this.getFriends=function(){return a.model.friends.map(t=>t.friendUserName)},this.update=function(){e.getFriends().then(t=>{a.setData({friends:t})})},this.dispose=function(){console.log("[friends] dispose"),i.unregister("breizbot.friends",l)},this.update()},$iface:"\n\t\tgetSelection():string;\n\t\tgetFriends():[string]\n\t",$events:"friendclick"}),$$.control.registerControl("breizbot.home",{deps:["breizbot.broker","breizbot.users","breizbot.notifs","breizbot.geoloc","breizbot.rtc","breizbot.apps","breizbot.scheduler","breizbot.wakelock","breizbot.fullscreen"],props:{userName:"Unknown"},template:'<div class="header">\n\t<div>\n\t\t<button class="w3-button" title="FullScreen" bn-event="click: onFullScreen" bn-show="!fullScreen">\n\t\t\t<i class="fa fa-expand"></i></button>\n\t\t<button class="w3-button" title="Exit FullScreen" bn-event="click: onExitFullScreen" bn-show="fullScreen">\n\t\t\t<i class="fa fa-compress"></i></button>\n\t\t<button class="w3-button" title="Connection Status">\n\t\t\t<i bn-class="{w3-text-green: connected, w3-text-red: !connected}" class="fa fa-circle"></i>\n\n\t\t</button>\n\t\t<div bn-show="hasIncomingCall" bn-control="brainjs.contextmenu" bn-event="contextmenuchange: onCallResponse"\n\t\t\tbn-data="{\n\t\t\t\ttrigger: \'left\', \n\t\t\t\ttitle: callInfo.from,\n\t\t\t\titems: {\n\t\t\t\t\taccept: {name: \'Accept\'},\n\t\t\t\t\tdeny: {name: \'Decline\'},\n\t\t\t\t}\n\t\t\t}" class="w3-button">\n\t\t\t<i class="fa fa-spinner fa-pulse"></i>\n\t\t\t<i bn-attr="{class: callInfo.iconCls}"></i>\n\t\t</div>\n\t</div>\n\n\n\t\x3c!-- \t<strong bn-text="title"></strong>\n --\x3e\n\t<div>\n\t\t<button class="notification w3-button" title="Notification" bn-event="click: onNotification">\n\t\t\t<i class="fa fa-lg fa-bell"></i>\n\t\t\t<span class="w3-badge w3-red w3-tiny" bn-text="nbNotif" bn-show="hasNotif"></span>\n\t\t</button>\n\n\n\n\t\t<div bn-control="brainjs.contextmenu" bn-data="{\n\t\t\t\titems: {\n\t\t\t\t\tsettings: {name: \'Settings\', icon: \'fas fa-cog\'},\n\t\t\t\t\tapps: {name: \'Applications\', icon: \'fas fa-th\'},\n\t\t\t\t\tsep: \'------\',\n\t\t\t\t\tlogout: {name: \'Logout\', icon: \'fas fa-power-off\'}\n\t\t\t\t},\n\t\t\t\ttitle: userName,\n\t\t\t\ttrigger: \'left\'\n\t\t\t}" class="w3-button" bn-event="contextmenuchange: onContextMenu">\n\t\t\t<i class="fas fa-user-circle fa-lg"></i>\n\n\t\t</div>\n\n\t</div>\n\n\n</div>\n\n<div bn-control="brainjs.tabs" class="content" bn-iface="tabs"\n\tbn-event="tabsremove: onTabRemove, tabsactivate: onTabActivate">\n\t<div bn-control="breizbot.apps" bn-data="{\n\t\t\tapps: getMyApps,\n\t\t\titems\n\t\t}" bn-event="appclick: onAppClick, appcontextmenu: onTileContextMenu" title="Home">\n\t</div>\n\n</div>',init:function(t,e,n,i,o,s,r,a,l,c){s.processCall(),s.on("call",function(t){f.setData({hasIncomingCall:!0,callInfo:t}),d.play()}),s.on("cancel",function(){f.setData({hasIncomingCall:!1}),d.stop()});const{userName:u}=this.props,d=function(){let t=null;return{play:function(){(t=new Audio("/assets/skype.mp3")).loop=!0,setTimeout(()=>{t.play()},100)},stop:function(){null!=t&&t.pause(),t=null}}}(),f=$$.viewController(t,{data:{apps:[],userName:u,nbNotif:0,hasIncomingCall:!1,callInfo:null,fullScreen:!1,connected:!1,hasNotif:function(){return this.nbNotif>0},getMyApps:function(){return this.apps.filter(t=>t.activated)},items:function(){return{remove:{name:"Remove"}}}},events:{onTileContextMenu:async function(t,e){await n.activateApp(e.appName,!1),m()},onAppClick:function(t,e){b(e.appName)},onContextMenu:async function(t,e){if("logout"==e.cmd&&a.logout(),"apps"==e.cmd&&b("store"),"settings"==e.cmd){const t=await n.getUserSettings();console.log("setting",t),b("settings",t)}},onNotification:function(t){0==f.model.nbNotif?$$.ui.showAlert({content:"no notifications",title:"Notifications"}):b("notif")},onCallResponse:function(t,e){const{cmd:n}=e;if(f.setData({hasIncomingCall:!1}),d.stop(),"accept"==n){const{from:t,appName:e}=f.model.callInfo;b(e,{caller:t,clientId:s.getRemoteClientId()})}"deny"==n&&s.deny()},onExitFullScreen:function(){c.exit()},onFullScreen:function(t){c.enter()},onTabRemove:function(t,e){p.getTabInfo(e).ctrlIface.onAppExit().then(()=>{p.removeTab(e)})},onTabActivate:function(t,e){const{newTab:n,oldTab:i}=e,o=n.index(),s=i.index();if(s>0){p.getTabInfo(s).ctrlIface.onAppSuspend()}if(o>0){p.getTabInfo(o).ctrlIface.onAppResume()}0==o&&m()}}}),p=f.scope.tabs;function h(t){f.setData({nbNotif:t})}function b(t,e,n){let i=f.model.apps.find(e=>e.appName==t).props.title,o=p.getTabIndexFromTitle(i);const s=$$.url.getUrlParams(`/apps/${t}`,e),r="string"==typeof n;if(r||o<0)o=p.addTab(r?`${i}[${n}]`:i,{removable:!0,control:"breizbot.appTab",props:{appUrl:s}});else{const t=p.getTabInfo(o);null!=e&&t.ctrlIface.setAppUrl(s)}p.setSelectedTabIndex(o)}function m(){r.listAll().then(t=>{f.setData({apps:t})})}c.init(t=>{f.setData({fullScreen:t})}),e.on("connected",t=>{f.setData({connected:t})}),window.addEventListener("message",t=>{const{type:e,data:n}=t.data;if("openApp"==e){const{appName:t,appParams:e,newTabTitle:i}=n;b(t,e,i)}"reload"==e&&location.reload()},!1),e.register("breizbot.friends",t=>{if(!0===t.hist)return;const{isConnected:e,userName:n}=t.data;e?$.notify(`'${n}' is connected`,"success"):$.notify(`'${n}' is disconnected`,"error")}),e.register("breizbot.notifCount",function(t){h(t.data)}),e.onTopic("breizbot.logout",function(t){location.href="/logout"}),i.getNotifCount().then(h),m(),o.startWatch(),l.requestWakeLock()}}),$$.control.registerControl("breizbot.pager",{props:{rootPage:""},template:'<div bn-show="showBack" class="toolbar">\n\t<div class="left">\n\t\t<button class="w3-button" title="Back" bn-event="click: onBack">\n\t\t\t<i class="fa fa-arrow-left"></i>\n\t\t</button>\n\t\t<span bn-text="title" class="title"></span>\n\t\n\t</div>\n\t<div bn-each="buttons" class="right" bn-event="click.action: onAction, contextmenuchange.menu: onContextMenu">\n\t\t<button bn-show="show1" class="w3-button action" bn-text="$scope.$i.label"\n\t\t\tbn-data="{cmd: $scope.$i.name}" bn-prop="{disabled: !isEnabled}"></button>\n\t\t<button bn-show="show2" class="w3-button action" bn-data="{cmd: $scope.$i.name}"\n\t\t\tbn-attr="{title: $scope.$i.title}" bn-prop="{disabled: !isEnabled}"><i bn-attr="{class: $scope.$i.icon}"></i></button>\n\n\t\t\t<button bn-show="show3" class="w3-button menu" \n\t\t\tbn-prop="{disabled: !isEnabled}"\n\t\t\tbn-control="brainjs.contextmenu" bn-data="{items: $scope.$i.items, trigger: \'left\', cmd: $scope.$i.name}"\n\t\t\tbn-attr="{title: $scope.$i.title}"><i bn-attr="{class: $scope.$i.icon}"></i></button>\n\t\t</div>\t\t\t\n\t</div>\n</div>\n<div bn-bind="content" class="content"></div>',$iface:"\n\t\tpopPage(data)\n\t\tpushPage(ctrlName, options)\n\t\tsetButtonVisible(buttonsVisible: {[buttonName]:boolean})\n\t\tsetButtonEnabled(buttonsEnabled: {[buttonName]:boolean})\n\t",init:function(t){const{rootPage:e}=this.props,n=$$.viewController(t,{data:{showBack:!1,title:"",buttons:[],show1:function(t){return null==t.$i.items&&null==t.$i.icon&&!(!1===t.$i.visible)},show2:function(t){return null==t.$i.items&&null!=t.$i.icon&&!(!1===t.$i.visible)},show3:function(t){return null!=t.$i.items&&!(!1===t.$i.visible)},isEnabled:t=>null==t.$i.enabled||!0===t.$i.enabled},events:{onBack:function(t){r(!0)},onAction:function(t){const e=$(this).data("cmd"),n=s.ctrl.iface(),i=s.buttons[e].onClick;"function"==typeof i&&i.call(n)},onContextMenu:function(t,e){console.log("onContextMenu",e);const n=$(this).data("cmd"),i=s.ctrl.iface();console.log("onAction",n);const o=s.buttons[n].onClick;"function"==typeof o&&o.call(i,e.cmd)}}}),i=n.scope.content,o=[];let s=null;function r(t,e){const i=s.ctrl.iface();s.ctrl.safeEmpty().remove();const{onBack:r,onReturn:a}=s;(s=o.pop()).ctrl.show();const{title:l,buttons:c}=s;n.setData({showBack:o.length>0,title:l,buttons:$$.util.objToArray(c,"name")}),t?"function"==typeof r&&(console.log("[pager] onBack",i.name),r.call(i)):"function"==typeof a&&a.call(i,e)}this.popPage=function(t){return r(!1,t)},this.pushPage=function(t,e){null!=s&&(s.ctrl.hide(),o.push(s)),e=e||{};let{title:r,props:a,onReturn:l,onBack:c,events:u}=e;const d=i.addControl(t,a,u);let f={};if(null!=e.buttons)f=e.buttons;else{const t=d.iface().getButtons;"function"==typeof t&&(f=t())}return s={title:r,buttons:f,onReturn:l,onBack:c,ctrl:d},n.setData({showBack:o.length>0,title:r,buttons:$$.util.objToArray(f,"name")}),d.iface()},this.setButtonVisible=function(t){const{buttons:e}=s;for(let n in t)n in e&&(e[n].visible=t[n]);n.setData({buttons:$$.util.objToArray(e,"name")})},this.setButtonEnabled=function(t){const{buttons:e}=s;if("boolean"==typeof t)for(let n in e)e[n].enabled=t;else for(let n in t)n in e&&(e[n].enabled=t[n]);n.setData({buttons:$$.util.objToArray(e,"name")})},this.pushPage(e)}}),$$.control.registerControl("breizbot.pdf",{template:'<div class="toolbar">\n\t<div bn-show="wait" class="loading">\n\t\t<i class="fa fa-spinner fa-pulse"></i> Rendering...\n\t</div>\n\t<div bn-show="!wait">\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Refresh" \n\t\t\tbn-icon="fa fa-sync-alt"\n\t\t\tbn-event="click: onRefresh">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Fit" \n\t\t\tbn-icon="fa fa-expand"\n\t\t\tbn-event="click: onFit">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Zoom In" \n\t\t\tbn-icon="fa fa-search-plus"\n\t\t\tbn-event="click: onZoomIn">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Zoom Out" \n\t\t\tbn-icon="fa fa-search-minus "\n\t\t\tbn-event="click: onZoomOut">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Rotate Left" \n\t\t\tbn-icon="fas fa-undo-alt"\n\t\t\tbn-event="click: onRotateLeft">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Rotate Right" \n\t\t\tbn-icon="fas fa-redo-alt"\n\t\t\tbn-event="click: onRotateRight">\n\t\t</button>\t\t\n\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Print" \n\t\t\tbn-icon="fa fa-print"\n\t\t\tbn-event="click: onPrint">\n\t\t</button>\t\t\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\ttitle="Go to Page" \n\t\t\tbn-icon="fa fa-reply fa-flip-horizontal"\n\t\t\tbn-event="click: onGotoPage">\n\t\t</button>\t\t\n\t</div>\n\t<div>\n\t</div>\n\t<div class="pages" bn-show="show1">\n\t\t<div>\n\t\t\t<button class="w3-button" title="previous page" bn-event="click: onPrevPage" bn-icon="fa fa-angle-left">\n\t\t\t</button>\t\n\n\t\t\t<button class="w3-button" title="next page" bn-event="click: onNextPage" bn-icon="fa fa-angle-right">\n\t\t\t</button>\t\t\t\n\t\t</div>\n\t\t<div>\n\t\t\tPages: <span bn-text="currentPage"></span> / <span bn-text="numPages"></span>\t\t\n\t\t</div>\n\t</div>\n</div>\n\t\n<div bn-control="brainjs.pdf" \n\tbn-data="{worker: \'/brainjs/pdf/worker.js\'}"\n\tbn-iface="pdf"\n\t \n></div>\t\t\n',props:{url:""},init:function(t){const{url:e}=this.props,n=$$.ui.progressDialog("Processing..."),i=$$.viewController(t,{data:{numPages:0,title:"",currentPage:1,wait:!1,show1:function(){return this.numPages>1&&!this.wait}},events:{onRefresh:async function(){await o.refresh()},onRotateRight:async function(){await o.rotateRight()},onRotateLeft:async function(){await o.rotateLeft()},onZoomIn:async function(){await o.zoomIn()},onZoomOut:async function(){await o.zoomOut()},onGotoPage:async function(){const t=await $$.ui.showPrompt({title:"Go to Page",label:"Page Number",attrs:{type:"number",min:1,max:i.model.numPages,step:1}});i.setData({wait:!0});const e=await o.setPage(t);i.setData({currentPage:e,wait:!1})},onPrint:async function(){n.setPercentage(0),n.show(),await o.print({onProgress:function(t){n.setPercentage(t.page/i.model.numPages)}}),n.hide()},onNextPage:async function(t){i.setData({wait:!0});const e=await o.nextPage();i.setData({currentPage:e,wait:!1})},onPrevPage:async function(t){i.setData({wait:!0});const e=await o.prevPage();i.setData({currentPage:e,wait:!1})},onFit:function(t){o.fit()}}}),o=i.scope.pdf;async function s(t,e){i.setData({wait:!0});const n=await o.openFile(t);console.log("file loaded"),i.setData({title:e,numPages:n,wait:!1})}""!=e&&s(e),this.setData=function(t){console.log("setData",t),null!=t.url&&s(t.url)}},$iface:"\n\t\tsetData({url})\n\t"}),$$.control.registerControl("breizbot.rtc",{deps:["breizbot.rtc","breizbot.pager"],props:{appName:"",iconCls:"",title:"Select a friend"},init:function(t,e,n){const{appName:i,iconCls:o,title:s}=this.props,r=t.children().remove();t.append('<div class="toolbar">\n\n\t\t<div class="status">\n\t\t\t<p>Status: <span bn-text="status"></span></p>\n\t\t</div>\t\t\n\n\t\t<div>\n\t\t\t<button \n\t\t\t\ttitle="Call a friend" \n\t\t\t\tbn-event="click: onCall"\n\t\t\t\tbn-show="show1"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone"></i></button>\n\n\t\t\t<button \n\t\t\t\tbn-event="click: onCancel"\n\t\t\t\ttitle="Cancel"\n\t\t\t\tbn-show="show2"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone-slash"></i></button>\n\n\t\t\t<button \n\t\t\t\ttitle="Hangup" \n\t\t\t\tbn-event="click: onHangup"\n\t\t\t\tbn-show="show3"\n\t\t\t\tclass="w3-button"><i class="fa fa-phone-slash"></i></button>\t\t\t\n\t\t</div>\n\n\n</div>\n<div bn-show="show4" bn-bind="panel" class="panel"></div>'),e.on("status",t=>{a.setData(t)});const a=$$.viewController(t,{data:{status:"ready",distant:"",hasChildren:r.length>0,show1:function(){return["ready","disconnected","refused","canceled"].includes(this.status)},show2:function(){return"calling"==this.status},show3:function(){return"connected"==this.status},show4:function(){return"connected"==this.status&&this.hasChildren}},events:{onCall:function(t){console.log("onCall"),n.pushPage("breizbot.friends",{title:s,props:{showSelection:!0},buttons:{call:{title:"Call",icon:"fa fa-check",onClick:function(){const t=this.getSelection();if(null==t)return void $$.ui.showAlert({title:"Error",content:"Please select a friend"});const{friendUserName:e,isConnected:i}=t;console.log("userName",e),i?n.popPage(e):$$.ui.showAlert({title:"Error",content:`User <strong>${e}</strong> is not connected`})}}},onReturn:function(t){e.call(t,i,o)}})},onCancel:function(t){e.cancel()},onHangup:function(n){e.bye(),t.trigger("rtchangup")}}});a.scope.panel.append(r)}}),$$.control.registerControl("breizbot.searchbar",{template:'<form bn-event="submit: onSearch" bn-bind="form">\n\t<input type="search" \n        name="value" \n        bn-attr="{placeholder, minlength, required}"\n\t\tautocomplete="off"\n\t\tbn-control="brainjs.input">\n\t<button class="w3-button w3-text-blue" type="submit" ><i class="fa fa-search"></i></button>\n</form>',props:{placeholder:"",minlength:0,required:!0},init:function(t){const{placeholder:e,minlength:n,required:i}=this.props,o=$$.viewController(t,{data:{placeholder:e,minlength:n,required:i},events:{onSearch:async function(e){e.preventDefault();const{value:n}=$(this).getFormData();t.trigger("searchbarsubmit",{value:n})}}});this.setValue=function(t){o.scope.form.setFormData({value:t})}},$iface:"\n        setValue(value: string)\n    ",$events:"searchbarsubmit"}),$$.control.registerControl("breizbot.addUser",{template:'<form bn-event="submit: onSubmit">\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>UserName</label>\n\t\t<input type="text" placeholder="username" name="username" required="">\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Pseudo</label>\n\t\t<input type="text" placeholder="pseudo" name="pseudo" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Location</label>\n\t\t<input type="text" placeholder="location" name="location" required>\n\t</div>\n\t<div bn-control="brainjs.inputgroup">\n\t\t<label>Email</label>\n\t\t<input type="email" placeholder="email" name="email" required>\t\n\t</div>\n\t\n\t<input type="submit" hidden="" bn-bind="submit">\n</form>\n',deps:["breizbot.pager"],init:function(t,e){const n=$$.viewController(t,{data:{},events:{onSubmit:function(t){t.preventDefault(),e.popPage($(this).getFormData())}}});this.getButtons=function(){return{create:{title:"Create",icon:"fa fa-check",onClick:function(){n.scope.submit.click()}}}}}}),$$.control.registerControl("breizbot.users",{deps:["breizbot.users","breizbot.notifs","breizbot.pager"],template:'<div class="toolbar">\n\t<button bn-event="click: onUpdate" class="w3-btn w3-blue" title="Update">\n\t\t<i class="fa fa-redo"></i>\n\t</button>\t\n\t<button bn-event="click: onAddUser" class="w3-btn w3-blue btnAddUser" title="Add User">\n\t\t<i class="fa fa-user-plus"></i>\n\t</button>\t\n</div>\n\n<div class="scrollPanel">\n    <table class="w3-table-all w3-small">\n        <thead>\n            <tr class="w3-green">\n                <th>User Name</th>\n                <th>Pseudo</th>\n                <th>Location</th>\n                <th>Email</th>\n                <th>Create Date</th>\n                <th>Last Login Date</th>\n                <th>Actions</th>\n            </tr>\n        </thead>\n        <tbody bn-each="data" bn-event="click.delete: onDelete, click.notif: onNotif">\n  \t\t\t<tr>\n\t\t\t\t<td bn-text="$scope.$i.username"></td>\n\t\t\t\t<td bn-text="$scope.$i.pseudo"></td>\n\t\t\t\t<td bn-text="$scope.$i.location"></td>\n\t\t\t\t<td bn-text="$scope.$i.email"></td>\n\t\t\t\t<td >\n\t\t\t\t\t<span bn-text="text1" bn-show="show1"></span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<span bn-show="show2">\n\n\t\t\t\t\t\t<span bn-text="text2"></span><br>\n\t\t\t\t\t\tat \n\t\t\t\t\t\t<span bn-text="text3"></span>\n\t\t\t\t\t</span>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button class="delete w3-btn w3-blue" title="Delete User">\n\t\t\t\t\t\t<i class="fa fa-trash"></i>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="notif w3-btn w3-blue" title="Send Notification">\n\t\t\t\t\t\t<i class="fa fa-bell"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>      \t\n\n        </tbody>\n    </table>\n</div>',init:function(t,e,n,i){const o=$$.viewController(t,{data:{data:[],text1:function(t){return new Date(t.$i.createDate).toLocaleDateString("fr-FR")},text2:function(t){return new Date(t.$i.lastLoginDate).toLocaleDateString("fr-FR")},text3:function(t){return new Date(t.$i.lastLoginDate).toLocaleTimeString("fr-FR")},show1:function(t){return null!=t.$i.createDate},show2:function(t){return null!=t.$i.lastLoginDate&&0!=t.$i.lastLoginDate}},events:{onAddUser:function(t){i.pushPage("breizbot.addUser",{title:"Add User",onReturn:async function(t){await e.add(t),s()}})},onDelete:function(t){const n=$(this).closest("tr").index(),{username:i}=o.model.data[n];$$.ui.showConfirm({title:"Delete User",content:"Are you sure ?"},async function(){await e.remove(i),s()})},onNotif:async function(t){const e=$(this).closest("tr").index(),{username:i}=o.model.data[e],s=await $$.ui.showPrompt({title:"Send Notification",label:"Message"});null!=s&&n.sendNotif(i,{text:s})},onUpdate:function(){s()}}});async function s(){const t=await e.list();console.log("getUsers",t),o.setData({data:t})}s()}}),$$.control.registerControl("breizbot.viewer",{template:'<div bn-if="isImage">\n\t<div \n\t\tclass="image" \n\t\tbn-control="brainjs.image" \n\t\tbn-data="{src: url}" \n\t\t\n\t\tstyle="height: 100%">\n\t\t\t\n\t\t</div>\n\t\n</div>\n\n\n<div bn-if="isPdf">\n\t<div \n\t\tclass="pdf" \n\t\tbn-control="breizbot.pdf" \n\t\tbn-data="{url}" \n\t\t\n\t\tstyle="height: 100%">\n\t\t\t\n\t\t</div>\t\t\n</div>\n\n<div bn-if="isAudio" class="audio">\n\t<audio bn-attr="{src: url}" controls="" controlsList=nodownload></audio>\n</div>\n\n<div bn-if="isVideo" class="video">\n\t<video bn-attr="{src: url}" controls="" controlsList=nodownload></video>\n</div>\n\n<div bn-if="isDoc" class="doc" bn-bind="doc" bn-event="click.top: onTop">\n\t<button bn-icon="fas fa-angle-up" class="top" title="Top" ></button>\n\t<div class="scrollPanel">\n\t\t<div class="html"></div>\n\t</div>\n</div>',props:{type:"",url:"#"},init:function(t){let{type:e,url:n}=this.props;const i=$$.viewController(t,{data:{url:n,type:e,isImage:function(){return"image"==this.type},isPdf:function(){return"pdf"==this.type},isAudio:function(){return"audio"==this.type},isVideo:function(){return"video"==this.type},isDoc:function(){return"hdoc"==this.type}},events:{onTop:function(){console.log("onTop"),i.scope.doc.find(".scrollPanel").get(0).scroll(0,0)}}});"hdoc"==e&&async function(){const t=await fetch(n),e=await t.text(),o=i.scope.doc.find(".html");o.html(e),o.find("a[href^=http]").attr("target","_blank")}(),this.setData=function(t){console.log("[Viewer] setData",t),t.url&&i.setData({url:t.url})}}}),$$.service.registerService("breizbot.appData",{deps:["brainjs.http"],init:function(t,e){let n=t;return{getData:function(){return n},saveData:function(t){return n=t,e.post("/api/appData",t)}}}}),$$.service.registerService("breizbot.apps",{deps:["brainjs.http"],init:function(t,e){return{listAll:function(){return e.get("/api/apps/all")}}}}),$$.service.registerService("breizbot.beatdetector",{init:function(t){if("string"!=typeof t.workerPath)throw"beatdetector worker path is not defined";const e=new Worker(t.workerPath);return{computeBeatDetection:function(t){return new Promise(async n=>{const i=t.sampleRate,o=new OfflineAudioContext(1,t.length,i),s=o.createBufferSource();s.buffer=t;const r=o.createBiquadFilter();r.type="lowpass",r.frequency.value=240,s.connect(r),r.connect(o.destination),s.start(0),o.startRendering(),o.oncomplete=function(t){const o=t.renderedBuffer.getChannelData(0);e.postMessage({channelData:o,sampleRate:i}),e.onmessage=function(t){n(t.data)}}})}}},$iface:"function(prefix):HttpInterface"}),$$.service.registerService("breizbot.broker",{init:function(t){const e=new EventEmitter2;let n=null,i=!1,o=!0,s=!0;const r=new EventEmitter2({wildcard:!0}),a=1e4;let l=null;const c={};let{host:u,pathname:d,protocol:f}=location;const p=`${f="http:"==f?"ws:":"wss:"}//${u}/hmi${d}`;function h(){i&&(console.log("[Broker] Disconnected !"),e.emit("connected",!1)),i=!1,o&&setTimeout(()=>{b()},5e3)}function b(){console.log("try to connect..."),(n=new WebSocket(p)).onopen=(()=>{console.log("Connected to broker"),i=!0,s=!0,e.emit("connected",!0),function t(){l=setTimeout(()=>{s?(s=!1,m({type:"ping"}),t()):(console.log("timeout ping"),n.onmessage=null,n.onclose=null,n.close(),h())},a)}()}),n.onmessage=(t=>{const i=JSON.parse(t.data);if(t.currentTarget!=n)return console.log("[broker] message bad target",i.type),void t.currentTarget.close();"ready"==i.type&&(Object.keys(c).forEach(t=>{m({type:"register",topic:t})}),e.emit("ready",{clientId:i.clientId})),"pong"==i.type&&(s=!0),"notif"==i.type&&r.emit(i.topic,i),"error"==i.type&&(console.log("[Broker] log",i.text),o=!1,n.close())}),n.onclose=(t=>{t.currentTarget==n?(console.log("[broker] close"),null!=l&&(clearTimeout(l),l=null),h()):console.log("[broker] close bad target")})}function m(t){t.time=Date.now();const e=JSON.stringify(t);i&&n.send(e)}return b(),{emitTopic:function(t,e){m({type:"notif",topic:t,data:e})},onTopic:function(t,e){r.on(t,e)},offTopic:function(t,e){r.off(t,e)},register:function(t,e){null==c[t]?c[t]=1:c[t]++,r.on(t,e),m({type:"register",topic:t})},unregister:function(t,e){r.off(t,e),0==--c[t]&&(delete c[t],m({type:"unregister",topic:t}))},on:e.on.bind(e)}}}),$$.service.registerService("breizbot.cities",{deps:["brainjs.resource","brainjs.http"],init:function(t,e,n){const i=e("/api/cities");return{getCountries:function(){return i.get("/countries")},getCities:function(t,e){return i.post("/cities",{country:t,search:e})},getCitesFromPostalCode:async function(t){const e="https://apicarto.ign.fr/api/codes-postaux/communes/"+t;try{return(await n.get(e)).map(t=>t.libelleAcheminement)}catch(t){return[]}}}}}),$$.service.registerService("breizbot.contacts",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/contacts");return{addContact:function(t){return n.post("/addContact",t)},getContacts:function(){return n.get("/getContacts")},removeContact:function(t){return n.delete(`/removeContact/${t}`)},updateContactInfo:function(t,e){return n.post(`/updateContactInfo/${t}`,e)}}}}),$$.service.registerService("breizbot.display",{deps:["breizbot.params"],init:function(t,e){console.log("params",e);const n=new EventEmitter2,i=new PresentationRequest($$.url.getUrlParams("/apps/cast",{id:e.$id}));let o=null;function s(t){o.send(JSON.stringify(t))}return i.addEventListener("connectionavailable",function(t){console.log("connectionavailable",t),(o=t.connection).addEventListener("message",function(t){const e=JSON.parse(t.data);switch(e.type){case"ready":n.emit("ready");break;case"event":n.emit(e.name,e.value)}}),o.addEventListener("terminate",function(){n.emit("close")}),n.emit("connectionavailable")}),async function(){const t=await i.getAvailability();console.log("Available presentation displays: "+t.value),t.addEventListener("change",function(){console.log("> Available presentation displays: "+t.value),n.emit("availability",t.value)})}(),{on:n.on.bind(n),start:async function(){await i.start()},close:function(){o.terminate(),o=null},isStarted:function(){return null!=o},setUrl:function(t){s({type:"url",url:t})},setVolume:function(t){s({type:"volume",volume:t})},setCurrentTime:function(t){s({type:"currentTime",currentTime:t})},play:function(){s({type:"play"})},pause:function(){s({type:"pause"})},enableKaraoke:function(t){s({type:"enableKaraoke",enabled:t})}}}}),$$.service.registerService("breizbot.files",{deps:["brainjs.resource","breizbot.params"],init:function(t,e,n){const i=e("/api/files"),o=$$.ui.progressDialog();return{fileInfo:function(t,e,n){return console.log("[FileService] fileInfo",t,e,n),i.post("/fileInfo",{filePath:t,friendUser:e,options:n})},list:function(t,e,n){return console.log("[FileService] list",t),i.post("/list",{destPath:t,options:e,friendUser:n})},fileUrl:function(t,e){return $$.url.getUrlParams("/api/files/load",{fileName:t,friendUser:e})},fileAppUrl:function(t){return t=`/apps/${n.$appName}/${t}`,$$.url.getUrlParams("/api/files/load",{fileName:t})},fileThumbnailUrl:function(t,e,n){return $$.url.getUrlParams("/api/files/loadThumbnail",{fileName:t,size:e,friendUser:n})},fileAppThumbnailUrl:function(t,e){return t=`/apps/${n.$appName}/${t}`,$$.url.getUrlParams("/api/files/loadThumbnail",{fileName:t,size:e})},assetsUrl:function(t){return`/webapps/${n.$appName}/assets/${t}`},uploadFile:async function(t,e,n,o,s){if(console.log("[FileService] uploadFile",o,e,n),!(t instanceof Blob))return console.warn("File format not supported"),Promise.reject("File format not supported");if(o)try{return await this.fileInfo(n+"/"+e),Promise.reject("File already exists")}catch(t){}const r=new FormData;return r.append("file",t,e),r.append("destPath",n),i.postFormData("/save",r,s)},saveFile:async function(t,e,i){const s=(i=i||{}).destPath||`/apps/${n.$appName}`;try{o.setPercentage(0),o.show();await this.uploadFile(t,e,s,i.checkExists,t=>{o.setPercentage(t)});return await $$.util.wait(1e3),o.hide(),!0}catch(t){return console.log("error",t),o.hide(),$$.ui.showAlert({title:"Error",content:t.responseText||t}),!1}}}}}),$$.service.registerService("breizbot.friends",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/friends");return{getFriends:function(){return n.get("/getFriends")},getFriendInfo:function(t){return n.post("/getFriendInfo",{friend:t})},setFriendInfo:function(t,e,i){return n.post("/setFriendInfo",{friend:t,groups:e,positionAuth:i})},addFriend:function(t){return n.post("/addFriend",{friendUserName:t})}}}}),$$.service.registerService("breizbot.fullscreen",{init:function(t){return{init:function(t){document.addEventListener("webkitfullscreenchange",e=>{t(null!=document.fullscreenElement)}),document.addEventListener("fullscreenchange",e=>{t(null!=document.fullscreenElement)}),document.addEventListener("keydown",t=>{"F11"==t.key&&t.preventDefault()})},enter:function(){const t=document.documentElement,e=t.requestFullscreen||t.webkitRequestFullscreen;e&&e.call(t)},exit:function(){document.exitFullscreen()}}}}),$$.service.registerService("breizbot.gamepad",{init:function(t){const e=new EventEmitter2;let n=[],i=[];return window.addEventListener("gamepadconnected",t=>{for(const{pressed:e}of t.gamepad.buttons)n.push(e);for(const e of t.gamepad.axes)i.push(e);e.emit("connected",t.gamepad)}),window.addEventListener("gamepaddisconnected",t=>{n=[],i=[],e.emit("disconnected",t.gamepad)}),{on:e.on.bind(e),getGamepads:function(){return navigator.getGamepads()},checkGamePadStatus:function t(){const o=navigator.getGamepads()[0];if(o){for(let t=0;t<n.length;t++){const{pressed:i}=o.buttons[t];i!=n[t]&&(e.emit(i?"buttonDown":"buttonUp",{id:t}),n[t]=i)}for(let t=0;t<i.length;t++){const n=o.axes[t];n!=i[t]&&(e.emit("axe",{id:t,value:n}),i[t]=n)}setTimeout(t,50)}},getButtonState:function(t){return navigator.getGamepads()[0].buttons[t].pressed},getAxeValue:function(t){return navigator.getGamepads()[0].axes[t]}}}}),$$.service.registerService("breizbot.geoloc",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/position");let i=null;function o(t){console.log("geoloc error:",t)}function s(t){i=t.coords}function r(){null!=i&&n.post("/position",{lat:i.latitude,lng:i.longitude})}return{startWatch:function(){navigator.geolocation.getCurrentPosition(s),navigator.geolocation.watchPosition(s,o,{enableHighAccuracy:!0}),setInterval(r,3e4)}}}}),$$.service.registerService("breizbot.http",{deps:["brainjs.resource","breizbot.params"],init:function(t,e,n){return e(`/api/app/${n.$appName}`)}}),$$.service.registerService("breizbot.notifs",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/notifs");return{sendNotif:function(t,e){return n.post("/sendNotif",{to:t,notif:e})},removeNotif:function(t){return n.delete(`/removeNotif/${t}`)},getNotifs:function(){return n.get("/getNotifs")},getNotifCount:function(){return n.get("/getNotifCount")}}}}),$$.service.registerService("breizbot.pager",{init:function(t){return $(".breizbotPager").iface()}}),$$.service.registerService("breizbot.params",{init:function(t){return"string"==typeof t?JSON.parse(t):{}}}),$$.service.registerService("breizbot.rtc",{deps:["brainjs.http","breizbot.broker","breizbot.params"],init:function(t,e,n,i){const o=new EventEmitter2,s={srcId:null,destId:null,distant:"",status:"ready",isCallee:!1};function r(){o.emit("status",{status:s.status,distant:s.distant})}function a(t=!0){return console.log("[RTC] cancel",t),t&&(s.status="canceled",r()),e.post("/api/rtc/sendToUser",{to:s.distant,srcId:s.srcId,type:"cancel"})}function l(){return console.log("[RTC] bye"),"connected"==s.status?(s.status="ready",s.distant="",r(),c("bye")):Promise.resolve()}function c(t,n){return e.post("/api/rtc/sendToClient",{destId:s.destId,srcId:s.srcId,type:t,data:n})}return null!=i.caller&&(s.status="connected",s.distant=i.caller,s.destId=i.clientId,s.isCallee=!0),n.on("ready",t=>{s.srcId=t.clientId,o.emit("ready")}),n.onTopic("breizbot.rtc.accept",t=>{!0!==t.hist&&(console.log("msg",t),a(!1),s.destId=t.srcId,s.status="connected",r(),o.emit("accept"))}),n.onTopic("breizbot.rtc.deny",t=>{!0!==t.hist&&(console.log("msg",t),s.status="refused",a(!1),r(),o.emit("deny"))}),n.onTopic("breizbot.rtc.bye",t=>{!0!==t.hist&&(console.log("msg",t),s.status="disconnected",r(),o.emit("bye"))}),{call:function(t,n,i){return s.distant=t,s.status="calling",r(),e.post("/api/rtc/sendToUser",{to:t,srcId:s.srcId,type:"call",data:{appName:n,iconCls:i}})},cancel:a,deny:function(){return console.log("[RTC] deny"),c("deny")},bye:l,sendData:c,onData:function(t,e){n.onTopic("breizbot.rtc."+t,t=>{!0!==t.hist&&e(t.data,t.time)})},on:o.on.bind(o),processCall:function(){console.log("[RTC] processCall"),n.register("breizbot.rtc.call",t=>{!0!==t.hist&&(console.log("msg",t),s.destId=t.srcId,o.emit("call",t.data))}),n.register("breizbot.rtc.cancel",t=>{!0!==t.hist&&(console.log("msg",t),o.emit("cancel"))})},getRemoteClientId:function(){return s.destId},exit:function(){return"calling"==s.status?a():"connected"==s.status?l():Promise.resolve()},accept:function(){return console.log("[RTC] accept"),r(),c("accept")},isCallee:function(){return s.isCallee}}}}),$$.service.registerService("breizbot.scheduler",{deps:["brainjs.http"],init:function(t,e){return{openApp:function(t,e,n){window.parent.postMessage({type:"openApp",data:{appName:t,appParams:e,newTabTitle:n}},location.href)},logout:function(){return console.log("[scheduler] logout"),e.post("/api/logout")}}}}),$$.service.registerService("breizbot.songs",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/songs");return{generateDb:function(){return n.post("/generateDb")}}}}),$$.service.registerService("breizbot.spotify",{init:function(t){const e="https://api.spotify.com/v1",n="https://spotify-web-api-token.herokuapp.com";let i=null;async function o(t,e){let o=null;const s={method:"GET"};if(null==i){const t=await fetch(n+"/token");if(!t.ok)throw"spotify fetch token error";const e=await t.json();i=e.token,console.log("token",i)}const r=new Headers;r.append("Authorization","Bearer "+i),s.headers=r;const a=await fetch($$.url.getUrlParams(t,e),s);return a.ok&&(o=await a.json()),o}return{searchTracks:async function(t){console.log("searchTracks",t);const n={q:t,type:"track",limit:1},i=await o(e+"/search/",n);return console.log("results",i),i.tracks.items[0]},getAudioFeaturesForTrack:function(t){return o(e+"/audio-features/"+t)}}}}),$$.service.registerService("breizbot.users",{deps:["brainjs.resource"],init:function(t,e){const n=e("/api/users");return{list:function(){return n.get("/")},match:function(t){return n.get("/",{match:t})},add:function(t){return n.post("/",t)},remove:function(t){return n.delete(`/${t}`)},update:function(t,e){return n.put(`/${t}`,e)},get:function(t){return n.get(`/${t}`)},activateApp:function(t,e){return n.post("/activateApp",{appName:t,activated:e})},changePwd:function(t){return n.post("/changePwd",{newPwd:t})},getUserSettings:function(){return n.post("/getUserSettings")},setUserSettings:function(t){return n.post("/setUserSettings",t)}}}}),$$.service.registerService("breizbot.wakelock",{init:function(t){async function e(){if(navigator.wakeLock)try{(await navigator.wakeLock.request("screen")).addEventListener("release",()=>{})}catch(t){console.error("WakeLock",t)}}return document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&e()}),{requestWakeLock:e}}});