$$.control.registerControl("rootPage",{template:'<div>\n    <div bn-control="DSKY" bn-event="key: onKey" bn-iface="dsky"></div>\n</div>\n\n<div>\n    <div bn-control="IMU" bn-iface="imu" bn-event="launch: onLaunch"></div>\n\n</div>\n',deps:["breizbot.files","app.emuAgc","brainjs.http"],props:{},init:function(t,n,e,s){const i=$$.viewController(t,{data:{},events:{onKey:function(t,n){const{val:s}=n;isNaN(s)||e.writeIo(13,s)},onLaunch:function(){console.log("onLaunch"),d||b||(e.writeIo(24,0,16),u=r,l.setReactor(0),b=!0)}}}),a=i.scope.dsky,l=i.scope.imu,o=Math.PI/180;let c=null,r=0,u=-1,d=!1,b=!1;l.update(),async function(){c=await s.get(n.assetsUrl("profile.json")),await e.loadRom(n.assetsUrl("agc.data")),e.reset(),e.on("channelUpdate",t=>{const{channel:n,value:e}=t;switch(n){case 8:case 9:case 11:a.process(n,e);break;case 10:16&e&&l.zero();break;case 124:case 125:case 126:l.gyro_coarse_align(n,e);break;case 127:l.gyro_fine_align(n,e)}}),e.on("lightsUpdate",t=>{a.processLights(t)}),e.start();let t=performance.now();setInterval(function(){if(e.loop(),performance.now()-t>=100){let n;if(t=performance.now(),r%10==0&&(l.setSt(Math.round(r/10)),u>=0&&(n=Math.round((r-u)/10),l.setMet(n))),r++,b){if(d||n>=c.length)return d=!0,void(b=!1);if(l.accelerate([1.08*c[n][2],0,0]),l.rotate([-c[n][3]/10*o,-c[n][1]/10*o,0]),r%10||l.update(),c[n][4]){const t=Math.round(c[n][4]);l.setReactor(t)}}}},1e3/60)}()}}),$$.service.registerService("app.emuAgc",{deps:["breizbot.files"],init:function(t){const n=Module.cwrap("set_fixed",null,["number"]),e=Module.cwrap("cpu_reset"),s=Module.cwrap("cpu_step",null,["number"]),i=Module.cwrap("packet_read","number"),a=Module.cwrap("packet_write",null,["number","number"]),l=Module.cwrap("get_erasable_ptr","number"),o=new EventEmitter2,c=.01172,r={channels:{},lamps:0};let u=0,d=0,b=null;function v(t){return 1<<t-1}const p={COMP_ACTY:v(2),UPLINK_ACTY:v(3),TEMP:v(4),KEY_REL:v(5),VERB_NOUN:v(6),OPER_ERR:v(7),RESTART:v(8),STBY:v(9)},h={PRIO_DISP:v(1),NO_DAP:v(2),VEL:v(3),NO_ATT:v(4),ALT:v(5),GIMBAL_LOCK:v(6),TRACKER:v(8),PROG:v(9)};return{writeIo:function(t,n,e){null!=e&&a(t+256,e),a(t,n)},loadRom:async function(t){const e=await fetch(t),s=await e.arrayBuffer(),i=new Uint8Array(s);console.log("romArray",i.length);const a=Module._malloc(i.length*i.BYTES_PER_ELEMENT);console.log("romPtr",a),Module.HEAP8.set(i,a),n(a),Module._free(a),b=l(),console.log("erasablePtr",b)},reset:e,stepCpu:s,on:o.on.bind(o),start:function(){u=performance.now(),d=0},loop:function(){const t=Math.floor((performance.now()-u)/c)-d;if(t<0||t>1e5)return u=performance.now(),void(d=0);s(t),d+=t,function(){let t;do{const n=(t=i())>>16,e=65535&t;if(r.channels[n],o.emit("channelUpdate",{channel:n,value:e}),9===n){const t=6;r.lamps=r.lamps&~t>>>0|e&t,o.emit("lightsUpdate",r.lamps)}else if(115===n){const t=504;r.lamps=r.lamps&~t>>>0|e&t,o.emit("lightsUpdate",r.lamps)}}while(t)}()},peek:function(t){return 32767&Module.getValue(b+2*t,"i16")},poke:function(t,n){Module.setValue(b+2*t,n,"i16")},lampMask:p,statusMask:h}}}),$$.control.registerControl("DSKY",{template:'\n<div class="top">\n    <div class="left">\n        <div class="col">\n            <div bn-style="uplink_acty"><span>UPLINK ACTY</span></div>\n            <div bn-style="no_att">NO ATT</div>\n            <div bn-style="stby">STBY</div>\n            <div bn-style="key_rel">KEY REL</div>\n            <div bn-style="opr_err">OPR ERR</div>\n            <div></div>\n            <div></div>\n        </div>\n\n        <div class="col">\n            <div bn-style="temp">TEMP</div>\n            <div bn-style="gimball_lock"><span>GIMBALL LOCK</span></div>\n            <div bn-style="prog">PROG</div>\n            <div>RESTART</div>\n            <div bn-style="tracker">TRACKER</div>\n            <div bn-style="alt">ALT</div>\n            <div bn-style="vel">VEL</div>\n        </div>\n\n    \n    </div>\n    \n    \n    <div class="right">\n        <div class="line">\n            <div class="compActy" bn-style="comp_acty"><span>COMP ACTY</span></div>\n            <div>\n                <div class="label">PROG</div>\n                <div class="digit" bn-html="prog00"></div>\n            </div>\n    \n        </div>\n        <div class="line">\n            <div>\n                <div class="label">VERB</div>\n                <div class="digit" bn-html="verb00"></div>\n            </div>\n            <div>\n                <div class="label">NOUN</div>\n                <div class="digit" bn-html="noun00"></div>\n            </div>\n        </div>\n        <div class="digit big" bn-html="r1"></div>\n        <div class="digit big" bn-html="r2"></div>\n        <div class="digit big" bn-html="r3"></div>\n    \n    </div>\n</div>\n\n<div class="bottom">\n    <div class="keyboard" bn-event="click.key: onKey">\n        <div>\n            <button class="label key">VERB</button>\n            <button class="label key">NOUN</button>\n        </div>\n        <div>\n            <button class="key">+</button>\n            <button class="key">-</button>\n            <button class="key">0</button>\n        </div>\n        <div>\n            <button class="key">1</button>\n            <button class="key">4</button>\n            <button class="key">7</button>\n        </div>\n        <div>\n            <button class="key">8</button>\n            <button class="key">5</button>\n            <button class="key">2</button>\n        </div>\n        <div>\n            <button class="key">9</button>\n            <button class="key">6</button>\n            <button class="key">3</button>\n        </div>\n        <div>\n            <button class="label key">CLR</button>\n            <button class="label key">PRO</button>\n            <button class="label key">KEY REL</button>\n        </div>\n        <div>\n            <button class="label key">ENTR</button>\n            <button class="label key">RSET</button>\n        </div>\n    \n    </div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(t,n,e){var s=Math.floor,i=Math.round;const a={VERB:17,NOUN:31,"+":26,"-":27,0:16,CLR:30,"KEY REL":25,ENTR:28,RSET:18};function l(t){var n="E";switch(t){case 0:n="H";break;case 21:n="0";break;case 3:n="1";break;case 25:n="2";break;case 27:n="3";break;case 15:n="4";break;case 30:n="5";break;case 28:n="6";break;case 19:n="7";break;case 29:n="8";break;case 31:n="9"}return n}let o=0,c=0,r=0,u=0,d=0,b=0;const v="&nbsp;";function p(t){return{"background-color":t?"#ffc200":"#888888"}}function h(t){return{"background-color":t?"#ffffff":"#888888"}}const f=$$.viewController(t,{data:{lamps:0,status8:0,digits:"000000+00000+00000+00000",on:0,comp_acty:function(){return p(this.lamps&e.lampMask.COMP_ACTY)},uplink_acty:function(){return h(this.lamps&e.lampMask.UPLINK_ACTY)},temp:function(){return p(this.lamps&e.lampMask.TEMP)},key_rel:function(){return h(this.lamps&e.lampMask.KEY_REL)},opr_err:function(){return h(this.lamps&e.lampMask.OPER_ERR)},stby:function(){return h(this.lamps&e.lampMask.STBY)},vel:function(){return p(this.status8&e.statusMask.VEL)},no_att:function(){return h(this.status8&e.statusMask.NO_ATT)},alt:function(){return p(this.status8&e.statusMask.ALT)},gimball_lock:function(){return p(this.status8&e.statusMask.GIMBAL_LOCK)},tracker:function(){return p(this.status8&e.statusMask.TRACKER)},prog:function(){return p(this.status8&e.statusMask.PROG)},r1:function(){return this.digits.slice(6,12).replace(/H/g,v)},r2:function(){return this.digits.slice(12,18).replace(/H/g,v)},prog00:function(){return this.digits.slice(0,2).replace(/H/g,v)},r3:function(){return this.digits.slice(18,24).replace(/H/g,v)},verb00:function(){return this.lamps&e.lampMask.VERB_NOUN?v+v:this.digits.slice(2,4).replace(/H/g,v)},noun00:function(){return this.lamps&e.lampMask.VERB_NOUN?v+v:this.digits.slice(4,6).replace(/H/g,v)}},events:{onKey:function(n){const e=$(this).text();let s=a[e];null==s&&(s=parseInt(e)),n.stopPropagation(),t.trigger("key",{val:s})}}});this.tick=function(t){var n,e,a,l,o;return phase%10==0&&(e=i(phase/10),n=((a=s(e/3600))<10?"0"+a:a)+":"+((l=s(e/60)%60)<10?"0"+l:l)+":"+((o=e%60)<10?"0"+o:o),$("#st").html(n),phase0>=0&&(e=i((phase-phase0)/10),n=((a=s(e/3600))<10?"0"+a:a)+":"+((l=s(e/60)%60)<10?"0"+l:l)+":"+((o=e%60)<10?"0"+o:o),$("#met").html(n))),phase++},this.processLights=function(t){f.setData({lamps:t})},this.process=function(t,n){if(0!=n&&8==t){const t=n>>11,e=n>>10&1,s=l(n>>5&31),i=l(31&n),a=f.model.digits.split("");switch(t){case 12:f.setData({status8:n});break;case 11:a[0]=s,a[1]=i;break;case 10:a[2]=s,a[3]=i;break;case 9:a[4]=s,a[5]=i;break;case 8:a[7]=i;break;case 7:a[8]=s,a[9]=i,o=e;break;case 6:a[10]=s,a[11]=i,c=e;break;case 5:a[13]=s,a[14]=i,r=e;break;case 4:a[15]=s,a[16]=i,u=e;break;case 3:a[17]=s,a[19]=i;break;case 2:a[20]=s,a[21]=i,d=e;break;case 1:a[22]=s,a[23]=i,b=e}if(12!=t){a[6]=o&&!c?"+":o||c?"-":"H",a[12]=r&&!u?"+":r||u?"-":"H",a[18]=d&&!b?"+":d||b?"-":"H";const t=a.join("");f.setData({digits:t})}}}}}),$$.control.registerControl("IMU",{template:'<div class="top">\n    <div class="left">\n        <div class="imuGroup">\n            <label class="imuLabel">ST</label>\n            <div class="clock" bn-html="getSt"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MET</label>\n            <div class="clock" bn-html="getMet"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">OGA</label>\n            <div class="imu" bn-html="imux"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">IGA</label>\n            <div class="imu" bn-html="imuy"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MGA</label>\n            <div class="imu" bn-html="imuz"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">ROLL</label>\n            <div class="imu" bn-html="roll"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">PITCH</label>\n            <div class="imu" bn-html="pitch"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">YAW</label>\n            <div class="imu" bn-html="yaw"></div>\n        </div>\n    </div>\n\n    <div class="right">\n        <button bn-event="click: enableIMU">Enable IMU</button>\n        <button bn-event="click: launch">Launch</button>\n        <div class="light" bn-style="sic">S-IC</div>\n        <div class="light" bn-style="sii">S-II</div>\n        <div class="light" bn-style="sivb">S-IVB</div>\n    </div>\n</div>\n<div class="bottom">\n    <canvas width="200" height="200" bn-bind="fdai"></canvas>\n</div>',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(t,n,e){const s=Math.abs,i=Math.floor,a=(Math.round,Math.sqrt,Math.sin),l=Math.cos,o=Math.atan2,c=Math.asin,r=Math.PI,u=r/180,d=180/r,b=75,v=.043948*u,p=.617981/3600*u,h=360/32768*u,f=.0585;let m,g,k,y,M,_,R,E,T=0;function L(){console.log("zero"),m=[0,0,0],g=[0,0,0],k=[0,0,0],y=[0,0,0],M=[0,0,0],R=[0,0,0],_=[0,0,0],E=!1,T=1,U()}function w(t,n,e){return t-(e-n)*i((t-n)/(e-n))}function P(t){let n=(t*d).toFixed(2);return n="000".substr(0,6-n.length)+n}function A(t){return(t*d).toFixed(1)}function I(t){const n=i(t/3600),e=i(t/60)%60,s=t%60;return(n<10?"0"+n:n)+":"+(e<10?"0"+e:e)+":"+(s<10?"0"+s:s)}function C(t){return{"background-color":t?"#ffc200":"#888888"}}const O=$$.viewController(t,{data:{st:0,met:0,c:-1,sic:function(){return C(0==this.c)},sii:function(){return C(1==this.c)},sivb:function(){return C(2==this.c)},getSt:function(){return I(this.st)},getMet:function(){return I(this.met)},imu_angle:[0,0,0],euler:[0,0,0],imux:function(){return P(this.imu_angle[0])},imuy:function(){return P(this.imu_angle[1])},imuz:function(){return P(this.imu_angle[2])},roll:function(){return A(this.euler[0])},pitch:function(){return A(this.euler[1])},yaw:function(){return A(this.euler[2])}},events:{enableIMU:function(t){console.log("enableIMU"),e.writeIo(24,0,8192)},launch:function(n){n.stopPropagation(),t.trigger("launch")}}}),S=O.scope.fdai.get(0),N=S.getContext("2d");function U(){O.setData({imu_angle:g,euler:k}),s(T)>.01&&(!function(){const t=a(g[0]),n=a(g[1]),e=a(g[2]),s=l(g[0]),i=l(g[1]),u=l(g[2]),d=e,b=u*s,v=i*e*t+n*s,p=-u*t,h=-n*e*t+i*s;k[0]=c(p),k[1]=o(v,h),k[2]=o(d,b);for(let t=0;t<3;t++)k[t]<-2*r?k[t]+=2*r:k[t]>=2*r&&(k[t]-=2*r)}(),function(){let t=k[0],n=k[1],e=k[2];N.fillStyle="#888888",N.fillRect(0,0,S.width,S.height),N.setTransform(1,0,0,1,S.width/2,S.height/2),N.strokeStyle="#FFFFFF",N.lineWidth=2;for(let t=0;t<36;t++){const n=10*t*u,e=t%3?10:15;N.beginPath(),N.moveTo((b+2)*l(n),(b+2)*a(n)),N.lineTo((b+e)*l(n),(b+e)*a(n)),N.stroke()}let i=1;N.rotate(-t),N.strokeStyle="#000",N.lineWidth=4,N.beginPath(),N.fillStyle="#FFFFFF",N.lineWidth=1,N.arc(0,0,b,0,2*r,!0),N.fill(),N.stroke(),N.save(),N.beginPath(),N.lineWidth=4,N.fillStyle="#000000",l(n)<0?(n+=r,N.arc(0,0,b,0,r,!0)):N.arc(0,0,b,0,r,!1),i=a(n),s(i)<.001?(N.moveTo(-b,0),N.lineTo(b,0)):(N.scale(1,i),N.arc(0,0,b,r,0,!0)),N.fill(),N.restore(),N.save(),N.beginPath(),N.strokeStyle="#aaa",l(e)<0&&(e+=r),e=w(e,-r,r),i=-a(e),s(i)<.01?(N.lineWidth=1,N.moveTo(0,-b),N.lineTo(0,b)):(N.lineWidth=4,N.scale(i,1),N.arc(0,0,b,-r/2,r/2,!0)),N.stroke(),N.restore(),N.beginPath(),N.strokeStyle="#F00",N.lineWidth=2,N.arc(0,0,10,0,2*r,!1),N.stroke()}(),T=0)}function K(t){if(E)return;for(let n=0;n<3;n++)if(t[n]){g[n]=w(g[n]+t[n],0,2*r);const a=w(g[n]-y[n],-r,r);T+=s(a);const l=a>0?1:-1;let o=i(s(a)/h);y[n]=w(y[n]+l*h*o,0,2*r);let c=e.peek(26+n);c=16384&c?-(32767^c):c,c+=l*o,e.poke(26+n,c<0?32767^-c:c)}}L(),this.rotate=function(t){const n=a(g[2]),e=l(g[2])*l(g[0]),s=a(g[0]),i=-l(g[2])*a(g[0]),o=l(g[0]),c=o*e-i*s;K([w(t[0]-(t[1]*o*n-t[2]*s*n)/c,-r,r),w((t[1]*o-t[2]*s)/c,-r,r),w((t[2]*e-t[1]*i)/c,-r,r)])},this.accelerate=function(t){const n=a(g[0]),s=a(g[1]),o=a(g[2]),c=l(g[0]),r=l(g[1]),u=l(g[2]),d=[u*r*t[0]+(-c*o*r+n*s)*t[1]+(n*o*r+c*s)*t[2],o*t[0]+c*u*t[1]-n*u*t[2],-u*s*t[0]+(c*o*s+n*r)*t[1]+(-n*o*s+c*r)*t[2]];for(let t=0;t<3;t++){R[t]+=d[t];const n=i((R[t]-_[t]*f)/f);_[t]+=n;let s=e.peek(31+t);s=16384&s?-(32767^s):s,s+=n,e.poke(31+t,s<0?32767^-s:s)}},this.update=U,this.gyro_coarse_align=function(t,n){const e=(16384&n?-1:1)*(16383&n);124===t?K([e*v,0,0]):125===t?K([0,e*v,0]):126===t&&K([0,0,e*v]),U()},this.zero=L,this.gyro_fine_align=function(t,n){const e=8192&n,s=4096&n,i=(16384&n?-1:1)*(2047&n);!e&&s&&K([i*p,0,0]),e&&!s&&K([0,i*p,0]),e&&s&&K([0,0,i*p]),U()},this.setSt=function(t){O.setData({st:t})},this.setMet=function(t){O.setData({met:t})},this.setReactor=function(t){O.setData({c:t})}}});