$$.control.registerControl("rootPage",{template:'<div>\n    <div bn-control="DSKY" bn-event="key: onKey" bn-iface="dsky"></div>\n</div>\n\n<div>\n    <div bn-control="IMU" bn-iface="imu" bn-event="launch: onLaunch"></div>\n\n</div>\n\n<div>\n    <div bn-control="SIMU" bn-iface="simu" bn-event="rotate: onSimuRotate, accelerate: onSimuAccelerate"></div>\n\n</div>\n',deps:["breizbot.files","app.emuAgc","brainjs.http"],props:{},init:function(n,t,e,s){window.agc=e;const i=$$.viewController(n,{data:{},events:{onKey:function(n,t){const{val:s}=t;isNaN(s)?(e.writeIo(26,0,e.inputsMask.PROCEED),setTimeout(()=>{e.writeIo(26,e.inputsMask.PROCEED,e.inputsMask.PROCEED)},200)):e.writeIo(13,s)},onLaunch:function(){console.log("onLaunch"),b||p||(e.writeIo(24,0,e.inputsMask.LIFTOFF),d=u,l.setReactor(0),p=!0)},onSimuRotate:function(n,t){console.log("onSimuRotate",t),l.rotate(t)},onSimuAccelerate:function(n,t){console.log("onSimuAccelerate",t),l.accelerate(t)}}}),a=i.scope.dsky,l=i.scope.imu,o=i.scope.simu,r=Math.PI/180;let c=null,u=0,d=-1,b=!1,p=!1;!async function(){c=await s.get(t.assetsUrl("profile.json")),await e.loadRom(t.assetsUrl("Comanche055.bin")),e.reset(),e.on("channelUpdate",n=>{const{channel:t,value:s}=n;switch(t){case 8:a.process(t,s);break;case 10:console.log("channelUpdate",t.toString(8),s.toString(2).padStart(15,0)),s&e.outputsMask.ZERO_IMU&&l.zero();break;case 124:case 125:case 126:l.gyro_coarse_align(t,s);break;case 127:l.gyro_fine_align(t,s)}}),e.on("lightsUpdate",n=>{a.processLights(n)}),e.start(),setInterval(()=>{if(l.setSt(Math.round(u/10)),e.loop(),p){const n=Math.round((u-d)/10);if(l.setMet(n),b||n>=c.length)return b=!0,void(p=!1);if(l.accelerate([1.08*c[n][2],0,0]),l.rotate([-c[n][3]/10*r,-c[n][1]/10*r,0]),u%10==0&&l.update(),c[n][4]){const t=Math.round(c[n][4]);l.setReactor(t)}}u++,e.readAllIo()},100)}(),o.dynamic_simulation()}}),$$.service.registerService("app.emuAgc",{deps:["breizbot.files"],init:function(n){const t=Module.cwrap("set_fixed",null,["number"]),e=Module.cwrap("cpu_reset"),s=Module.cwrap("cpu_step",null,["number"]),i=Module.cwrap("packet_read","number"),a=Module.cwrap("packet_write",null,["number","number"]),l=Module.cwrap("get_erasable_ptr","number"),o=new EventEmitter2,r=.01172,c={channels:{},lamps:0};let u=0,d=0,b=null;function p(n){return 1<<n-1}const v={COMP_ACTY:p(2),UPLINK_ACTY:p(3),TEMP:p(4),KEY_REL:p(5),VERB_NOUN:p(6),OPER_ERR:p(7),RESTART:p(8),STBY:p(9)},_={PRIO_DISP:p(1),NO_DAP:p(2),VEL:p(3),NO_ATT:p(4),ALT:p(5),GIMBAL_LOCK:p(6),TRACKER:p(8),PROG:p(9)},h={LIFTOFF:p(5),ISS_TURN_ON:p(14),PROCEED:p(14)},f={ZERO_IMU:p(5)};return{writeIo:function(n,t,e){null!=e&&a(n+256,e),a(n,t)},loadRom:async function(n){const e=await fetch(n),s=await e.arrayBuffer(),i=new Uint8Array(s);console.log("romArray",i.length);const a=Module._malloc(i.length*i.BYTES_PER_ELEMENT);console.log("romPtr",a),Module.HEAP8.set(i,a),t(a),Module._free(a),b=l(),console.log("erasablePtr",b)},reset:e,stepCpu:s,on:o.on.bind(o),start:function(){u=performance.now(),d=0},loop:function(){const n=Math.floor((performance.now()-u)/r)-d;if(n<0||n>1e5)return u=performance.now(),void(d=0);s(n),d+=n},readAllIo:function(){let n;do{const t=(n=i())>>16,e=65535&n;if(c.channels[t]=e,o.emit("channelUpdate",{channel:t,value:e}),9===t){const n=6;c.lamps=c.lamps&~n>>>0|e&n,o.emit("lightsUpdate",c.lamps)}else if(115===t){const n=504;c.lamps=c.lamps&~n>>>0|e&n,o.emit("lightsUpdate",c.lamps)}}while(n)},peek:function(n){return 32767&Module.getValue(b+2*n,"i16")},poke:function(n,t){Module.setValue(b+2*n,t,"i16")},getChannelState:function(n){return c.channels[n]},getChannelBitState:function(n,t){return e=c.channels[n],s=t,e>>--s&1;var e,s},lampMask:v,statusMask:_,inputsMask:h,outputsMask:f}}}),$$.control.registerControl("DSKY",{template:'\n<div class="top">\n    <div class="left">\n        <div class="col">\n            <div bn-style="uplink_acty"><span>UPLINK ACTY</span></div>\n            <div bn-style="no_att">NO ATT</div>\n            <div bn-style="stby">STBY</div>\n            <div bn-style="key_rel">KEY REL</div>\n            <div bn-style="opr_err">OPR ERR</div>\n            <div></div>\n            <div></div>\n        </div>\n\n        <div class="col">\n            <div bn-style="temp">TEMP</div>\n            <div bn-style="gimball_lock"><span>GIMBALL LOCK</span></div>\n            <div bn-style="prog">PROG</div>\n            <div>RESTART</div>\n            <div bn-style="tracker">TRACKER</div>\n            <div bn-style="alt">ALT</div>\n            <div bn-style="vel">VEL</div>\n        </div>\n\n    \n    </div>\n    \n    \n    <div class="right">\n        <div class="line">\n            <div class="compActy" bn-style="comp_acty"><span>COMP ACTY</span></div>\n            <div>\n                <div class="label">PROG</div>\n                <div class="digit" bn-html="prog00"></div>\n            </div>\n    \n        </div>\n        <div class="line">\n            <div>\n                <div class="label">VERB</div>\n                <div class="digit" bn-html="verb00"></div>\n            </div>\n            <div>\n                <div class="label">NOUN</div>\n                <div class="digit" bn-html="noun00"></div>\n            </div>\n        </div>\n        <div class="digit big" bn-html="r1"></div>\n        <div class="digit big" bn-html="r2"></div>\n        <div class="digit big" bn-html="r3"></div>\n    \n    </div>\n</div>\n\n<div class="bottom">\n    <div class="keyboard" bn-event="click.key: onKey">\n        <div>\n            <button class="label key">VERB</button>\n            <button class="label key">NOUN</button>\n        </div>\n        <div>\n            <button class="key">+</button>\n            <button class="key">-</button>\n            <button class="key">0</button>\n        </div>\n        <div>\n            <button class="key">1</button>\n            <button class="key">4</button>\n            <button class="key">7</button>\n        </div>\n        <div>\n            <button class="key">8</button>\n            <button class="key">5</button>\n            <button class="key">2</button>\n        </div>\n        <div>\n            <button class="key">9</button>\n            <button class="key">6</button>\n            <button class="key">3</button>\n        </div>\n        <div>\n            <button class="label key">CLR</button>\n            <button class="label key">PRO</button>\n            <button class="label key">KEY REL</button>\n        </div>\n        <div>\n            <button class="label key">ENTR</button>\n            <button class="label key">RSET</button>\n        </div>\n    \n    </div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(n,t,e){Math.floor,Math.round;const s={VERB:17,NOUN:31,"+":26,"-":27,0:16,CLR:30,"KEY REL":25,ENTR:28,RSET:18};function i(n){var t="E";switch(n){case 0:t="H";break;case 21:t="0";break;case 3:t="1";break;case 25:t="2";break;case 27:t="3";break;case 15:t="4";break;case 30:t="5";break;case 28:t="6";break;case 19:t="7";break;case 29:t="8";break;case 31:t="9"}return t}let a=0,l=0,o=0,r=0,c=0,u=0;const d="&nbsp;";function b(n){return{"background-color":n?"#ffc200":"#888888"}}function p(n){return{"background-color":n?"#ffffff":"#888888"}}const v=$$.viewController(n,{data:{lamps:0,status8:0,digits:"000000+00000+00000+00000",on:0,comp_acty:function(){return b(this.lamps&e.lampMask.COMP_ACTY)},uplink_acty:function(){return p(this.lamps&e.lampMask.UPLINK_ACTY)},temp:function(){return b(this.lamps&e.lampMask.TEMP)},key_rel:function(){return p(this.lamps&e.lampMask.KEY_REL)},opr_err:function(){return p(this.lamps&e.lampMask.OPER_ERR)},stby:function(){return p(this.lamps&e.lampMask.STBY)},vel:function(){return b(this.status8&e.statusMask.VEL)},no_att:function(){return p(this.status8&e.statusMask.NO_ATT)},alt:function(){return b(this.status8&e.statusMask.ALT)},gimball_lock:function(){return b(this.status8&e.statusMask.GIMBAL_LOCK)},tracker:function(){return b(this.status8&e.statusMask.TRACKER)},prog:function(){return b(this.status8&e.statusMask.PROG)},r1:function(){return this.digits.slice(6,12).replace(/H/g,d)},r2:function(){return this.digits.slice(12,18).replace(/H/g,d)},prog00:function(){return this.digits.slice(0,2).replace(/H/g,d)},r3:function(){return this.digits.slice(18,24).replace(/H/g,d)},verb00:function(){return this.lamps&e.lampMask.VERB_NOUN?d+d:this.digits.slice(2,4).replace(/H/g,d)},noun00:function(){return this.lamps&e.lampMask.VERB_NOUN?d+d:this.digits.slice(4,6).replace(/H/g,d)}},events:{onKey:function(t){const e=$(this).text();let i=s[e];null==i&&(i=parseInt(e)),t.stopPropagation(),n.trigger("key",{val:i})}}});this.processLights=function(n){v.setData({lamps:n})},this.process=function(n,t){if(0==t)return;const e=t>>11,s=t>>10&1,d=i(t>>5&31),b=i(31&t),p=v.model.digits.split("");switch(e){case 12:v.setData({status8:t});break;case 11:p[0]=d,p[1]=b;break;case 10:p[2]=d,p[3]=b;break;case 9:p[4]=d,p[5]=b;break;case 8:p[7]=b;break;case 7:p[8]=d,p[9]=b,a=s;break;case 6:p[10]=d,p[11]=b,l=s;break;case 5:p[13]=d,p[14]=b,o=s;break;case 4:p[15]=d,p[16]=b,r=s;break;case 3:p[17]=d,p[19]=b;break;case 2:p[20]=d,p[21]=b,c=s;break;case 1:p[22]=d,p[23]=b,u=s}if(12!=e){p[6]=a&&!l?"+":a||l?"-":"H",p[12]=o&&!r?"+":o||r?"-":"H",p[18]=c&&!u?"+":c||u?"-":"H";const n=p.join("");v.setData({digits:n})}}}}),$$.control.registerControl("FDAI",{template:'<svg width="350" height="360" bn-bind="svg">\n    <defs>\n      <marker id="triangle" viewBox="0 0 10 10"\n            refX="1" refY="5"\n            markerUnits="strokeWidth"\n            markerWidth="10" markerHeight="10"\n            orient="auto">\n        <path d="M 0 0 L 10 5 L 0 10 z" fill="black"/>\n      </marker>\n      <marker id="triangle2" viewBox="0 0 16 16"\n            refX="1" refY="8"\n            markerUnits="strokeWidth"\n            markerWidth="16" markerHeight="16"\n            orient="auto">\n        <path d="M 0 0 L 16 8 L 0 16 z" fill="black"/>\n      </marker>\n  \n  </defs>\n    \n  </svg>',deps:["breizbot.pager"],props:{},init:function(n,t){const e=$$.viewController(n,{data:{},events:{}}).scope.svg.get(0),s=150,i=180,a=180/Math.PI,l=42.1875/384;let o=0,r=0,c=0;function u(n,t){Object.keys(t).forEach(e=>{n.setAttribute(e,t[e])})}function d(n,t){const s=document.createElementNS("http://www.w3.org/2000/svg",n);return"object"==typeof t&&u(s,t),e.appendChild(s),s}function b(n,t,e,s,i,a){return d("line",Object.assign({x1:n,y1:t,x2:e,y2:s,stroke:i},a))}function p(n,t,e,s,i){const a=d("text",Object.assign({x:n,y:t,fill:s},i));return a.textContent=e,a}function v(n,t,e,s,i){return d("circle",Object.assign({r:e,cx:n,cy:t,fill:s},i))}const _={};function h(n,t){u(_[n],{x1:t,x2:t})}function f(n,t){u(_[n],{y1:t,y2:t})}function m(n,t,e,s,i){u(_[n],{x1:t,y1:e,x2:s,y2:i})}function M(n,t,e){u(_[n],{x:t,y:e})}function g(n,t,e,s,i,a){const l=s*Math.PI/180;return b(n+e*Math.sin(l),t+e*Math.cos(l),n+(e+=i)*Math.sin(l),t+e*Math.cos(l),a)}for(let n=-270;n<=270;n+=30){const t=n>=-180&&n<=0||n>=180&&n<=360?"black":"white";_[`PITCH_${n}`]=b(0,0,0,0,t);const e=n<0?n+360:n;_[`PITCH_TXT_${n}`]=p(0,0,e,t)}_.zAxisLM=b(0,0,0,0,"blue");for(let n=-270;n<=270;n+=30){_[`zAxis_${n}`]=b(0,0,0,0,"blue");const t=n<0?n+360:n;_[`zAxis_TXT_${n}`]=p(0,0,t,"blue")}_.RollMarker=b(0,0,0,0,"black",{"marker-end":"url(#triangle2)"}),_.YawErrorNeedle=b(0,i+10,0,i+100,"orange"),_.PitchErrorNeedle=b(s+10,0,s+100,0,"orange"),_.RollErrorNeedle=b(0,i-10,0,i-100,"orange"),v(s,i,190,"none",{stroke:"darkgrey","stroke-width":180});for(let n=70;n<110;n+=.5)g(s,i,100,n,10,"red");for(let n=250;n<290;n+=.5)g(s,i,100,n,10,"red");for(let n=0;n<360;n+=10){g(s,i,100,n,n%30==0?10:15,"white")}v(s,i,100,"none",{stroke:"black","stroke-width":4}),b(s-10,i,s+10,i,"white"),b(s,i-10,s,i+10,"white");for(let n=-5;n<=5;n++)b(s+10*n,310,s+10*n,315,"white");_.YawRateMarker=b(0,325,0,324,"black",{"marker-end":"url(#triangle)"}),p(s,310,"0","white"),p(s,340,"YAW RATE","white"),_.RollRateMarker=b(0,36,0,37,"black",{"marker-end":"url(#triangle)"}),p(s,62,"0","white"),p(s,30,"ROLL RATE","white");for(let n=-5;n<=5;n++)b(s+10*n,45,s+10*n,50,"white");for(let n=-5;n<=5;n++)b(280,i+10*n,285,i+10*n,"white");function k(n){const t=2*Math.PI;return n<-t?n+t:n>=t?n-t:n}function E(n,t,e){return Math.max(Math.min(e,n),t)}function A(t,e){const[u,d,b]=t,[p,v,_]=e,g=Math.sin(u),A=Math.sin(d),y=Math.sin(b),R=Math.cos(u),S=Math.cos(d),T=Math.cos(b),P=y,w=T*R,x=S*y*g+A*R,L=-T*g,N=-A*y*g+S*R,C=k(Math.atan2(P,w)),I=k(Math.atan2(x,N)),G=k(Math.asin(L)),D=C,F=Math.sin(-1*D),O=Math.cos(-1*D),K=-1*G*a,U=I*a,$=C*a,Y=K>0?360-K:Math.abs(K),H=U<0?U+360:U,z=$<0?$+360:$;n.trigger("data",{fdai:[Y,H,z]}),h("YawRateMarker",s-10*E(c,-5,5)),f("PitchRateMarker",i-10*E(r,-5,5)),h("RollRateMarker",s+10*E(o,-5,5)),h("YawErrorNeedle",s+p*l),f("PitchErrorNeedle",i+v*l),h("RollErrorNeedle",s-_*l);const B=s+85*Math.sin(D+Math.PI),W=s+86*Math.sin(D+Math.PI);function V(n,t){return{x:n*O-t*F+s,y:n*F+t*O+i}}m("RollMarker",B,i+85*Math.cos(D+Math.PI),W,i+86*Math.cos(D+Math.PI));const j=U>180?U-180:U;for(let n=-270;n<=270;n+=30){const t=-50,e=50,s=-n+j,i=0,a=s,{x:l,y:o}=V(i,a),{x:r,y:c}=V(t,s),{x:u,y:d}=V(e,s);M(`PITCH_TXT_${n}`,l,o),m(`PITCH_${n}`,r,c,u,d)}const X=K>180?K-360:K,Z=-280+X,q=280+X,{x:J,y:Q}=V(Z,0),{x:nn,y:tn}=V(q,0);m("zAxisLM",J,Q,nn,tn);for(let n=-270;n<=270;n+=30){const t=n+X,e=-2,s=n+X,i=3,a=n+X,l=10,{x:o,y:r}=V(a,l),{x:c,y:u}=V(t,e),{x:d,y:b}=V(s,i);M(`zAxis_TXT_${n}`,o,r),m(`zAxis_${n}`,c,u,d,b)}}_.PitchRateMarker=b(296,0,295,0,"black",{"marker-end":"url(#triangle)"}),p(s+128-5,i,"0","white",{"alignment-baseline":"middle"}),p(s+155,i-30,"P","white"),p(s+155,i-22,"I","white"),p(s+155,i-14,"T","white"),p(s+155,i-6,"C","white"),p(s+155,i+2,"H","white"),p(s+155,i+18,"R","white"),p(s+155,i+26,"A","white"),p(s+155,i+34,"T","white"),p(s+155,i+42,"E","white"),A([0,0,0],[0,0,0]),this.update=A}}),$$.control.registerControl("IMU",{template:'<div class="top">\n    <div class="left">\n        <div class="imuGroup">\n            <label class="imuLabel">ST</label>\n            <div class="clock" bn-html="getSt"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MET</label>\n            <div class="clock" bn-html="getMet"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">OGA</label>\n            <div class="imu" bn-html="imux"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">IGA</label>\n            <div class="imu" bn-html="imuy"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MGA</label>\n            <div class="imu" bn-html="imuz"></div>\n        </div>\n    </div>\n\n    <div class="middle">\n        <div class="imuGroup">\n            <label class="imuLabel">YAW</label>\n            <div class="imu" bn-html="yaw"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">PITCH</label>\n            <div class="imu" bn-html="pitch"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">ROLL</label>\n            <div class="imu" bn-html="roll"></div>\n        </div>\n\n    </div>\n\n    <div class="right">\n        <button bn-event="click: enableIMU">Enable IMU</button>\n        <button bn-event="click: launch">Launch</button>\n        <div class="light" bn-style="sic">S-IC</div>\n        <div class="light" bn-style="sii">S-II</div>\n        <div class="light" bn-style="sivb">S-IVB</div>\n    </div>\n</div>\n<div class="bottom">\n    <div bn-control="FDAI" bn-iface="fdai" bn-event="data: onData"></div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(n,t,e){const s=Math.abs,i=Math.floor,a=(Math.round,Math.sqrt,Math.sin),l=Math.cos,o=(Math.atan2,Math.asin,Math.PI),r=o/180,c=180/o,u=.043948*r,d=.617981/3600*r,b=360/32768*r,p=.0585;let v,_,h,f,m,M,g,k,E=0;function A(){x.update(_,v),w.setData({imu_angle:_})}function y(n,t,e){return n-(e-t)*i((n-t)/(e-t))}function R(n){let t=(n*c).toFixed(2);return t="000".substr(0,6-t.length)+t}function S(n){return n.toFixed(1)}function T(n){const t=i(n/3600),e=i(n/60)%60,s=n%60;return(t<10?"0"+t:t)+":"+(e<10?"0"+e:e)+":"+(s<10?"0"+s:s)}function P(n){return{"background-color":n?"#ffc200":"#888888"}}const w=$$.viewController(n,{data:{st:0,met:0,c:-1,sic:function(){return P(0==this.c)},sii:function(){return P(1==this.c)},sivb:function(){return P(2==this.c)},getSt:function(){return T(this.st)},getMet:function(){return T(this.met)},imu_angle:[0,0,0],euler:[0,0,0],imux:function(){return R(this.imu_angle[0])},imuy:function(){return R(this.imu_angle[1])},imuz:function(){return R(this.imu_angle[2])},yaw:function(){return S(this.euler[0])},pitch:function(){return S(this.euler[1])},roll:function(){return S(this.euler[2])}},events:{onData:function(n,t){w.setData({euler:t.fdai})},enableIMU:function(n){console.log("enableIMU"),e.writeIo(24,0,e.inputsMask.ISS_TURN_ON)},launch:function(t){t.stopPropagation(),n.trigger("launch")}}}),x=w.scope.fdai;function L(n){if(k)return;for(let t=0;t<3;t++)if(n[t]){_[t]=y(_[t]+n[t],0,2*o);const a=y(_[t]-f[t],-o,o);E+=s(a);const l=a>0?1:-1;let r=i(s(a)/b);f[t]=y(f[t]+l*b*r,0,2*o);let c=e.peek(26+t);c=16384&c?-(32767^c):c,c+=l*r,e.poke(26+t,c<0?32767^-c:c)}}this.rotate=function(n){const t=a(_[2]),e=l(_[2])*l(_[0]),s=a(_[0]),i=-l(_[2])*a(_[0]),r=l(_[0]),c=r*e-i*s;L([y(n[0]-(n[1]*r*t-n[2]*s*t)/c,-o,o),y((n[1]*r-n[2]*s)/c,-o,o),y((n[2]*e-n[1]*i)/c,-o,o)])},this.update=A,this.accelerate=function(n){const t=a(_[0]),s=a(_[1]),o=a(_[2]),r=l(_[0]),c=l(_[1]),u=l(_[2]),d=[u*c*n[0]+(-r*o*c+t*s)*n[1]+(t*o*c+r*s)*n[2],o*n[0]+r*u*n[1]-t*u*n[2],-u*s*n[0]+(r*o*s+t*c)*n[1]+(-t*o*s+r*c)*n[2]];for(let n=0;n<3;n++){g[n]+=d[n];const t=i((g[n]-M[n]*p)/p);M[n]+=t;let s=e.peek(31+n);s=16384&s?-(32767^s):s,s+=t,e.poke(31+n,s<0?32767^-s:s)}},this.gyro_coarse_align=function(n,t){const s=(16384&t?-1:1)*(16383&t);1==e.getChannelBitState(10,4)?(124===n?L([s*u,0,0]):125===n?L([0,s*u,0]):126===n&&L([0,0,s*u]),A()):v[n-124]+=s},this.zero=function(){console.log("zero"),v=[0,0,0],_=[0,0,0],h=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0],M=[0,0,0],k=!1,E=1,A()},this.gyro_fine_align=function(n,t){const e=8192&t,s=4096&t,i=(16384&t?-1:1)*(2047&t);!e&&s&&L([i*d,0,0]),e&&!s&&L([0,i*d,0]),e&&s&&L([0,0,i*d]),A()},this.setSt=function(n){w.setData({st:n})},this.setMet=function(n){w.setData({met:n})},this.setReactor=function(n){w.setData({c:n})}}}),$$.control.registerControl("SIMU",{template:'<div>\n    <fieldset>\n        <div class="data">\n            <label>SIMULATION TIME:</label>\n            <div>\n                <span bn-text="Simulation_Timer_text"></span>\n                <span class="unit">SEC</span>    \n            </div>\n        </div>\n        <div class="data">\n            <label>LM WEIGHT:</label>\n            <div>\n                <span bn-text="LM_Weight_KG_text"></span>\n                <span class="unit">KG</span>    \n            </div>\n        </div>\n\n    </fieldset>\n    <fieldset>\n        <legend>DESCENT</legend>\n        <div class="data">\n            <label>THRUST:</label>\n            <div>\n                <span bn-text="Descent_Thrust_Procent_text"></span>\n                <span class="unit"></span>\n            </div>\n        </div>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="Descent_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>FUEL FLOW:</label>\n            <div>\n                <span bn-text="Descent_Fuel_Flow_SEC_text"></span>\n                <span class="unit">KG/S</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>ACCELERATION:</label>\n            <div>\n                <span bn-text="Descent_Acceleration_text"></span>\n                <span class="unit">M/S²</span>\n            </div>\n        </div>\n        <div bn-show="!isSeparated">\n            <div>\n                <input type="checkbox" bn-val="DESCENT_ENGINE_FLAG" bn-update="click">\n                <label>ENGINE ON/OFF</label>\n            </div>\n            <div class="data">\n                <label>Thrust</label>\n                <div>\n                    <span bn-text="Descent_Propulsion_N"></span>\n                    <span class="unit">N</span>\n                </div>\n            </div>\n            <div bn-control="brainjs.slider" bn-data="{min: Descent_Propulsion_Min_N, max: Descent_Propulsion_Max_N }"\n                bn-update="input" bn-val="Descent_Propulsion_N"></div>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>Stage</legend>\n        <button bn-event="click: onSeperateStage" bn-prop="{disabled: isSeparated}">SEPARATE STAGE</button>\n    </fieldset>\n    <fieldset>\n        <legend>ASCENT</legend>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="Ascent_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>FUEL FLOW:</label>\n            <div>\n                <span bn-text="Ascent_Fuel_Flow_SEC_text"></span>\n                <span class="unit">KG/S</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>ACCELERATION:</label>\n            <div>\n                <span bn-text="Ascent_Acceleration_text"></span>\n                <span class="unit">M/S²</span>\n            </div>\n        </div>\n        <div bn-show="isSeparated">\n            <input type="checkbox" bn-val="ASCENT_ENGINE_FLAG" bn-update="click">\n            <label>ENGINE ON/OFF</label>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>RCS</legend>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="RCS_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n\n    </fieldset>\n\n</div>',deps:["breizbot.pager"],props:{},init:function(n,t){const e=Math.PI,s=180/e*(e/4),i=Math.abs;let a=0,l=4670,o=10694,r=287,c=445,u=2840,d=8355,b=45040,p=3050,v=4560,_=0,h=0,f=0,m=!1,M=2353,g=15600,k=3050,E=0,A=0,y=!1,R=0,S=0,T=0,P=0,w=0,x=0,L=0;const N=[],C=[],I=[];for(let n=0;n<2;n++)N[n]=[],C[n]=[],I[n]=[];N[0][0]=.0065443852,C[0][0]=32e-6,I[0][0]=-.006923,N[0][1]=.0035784354,C[0][1]=.162862,I[0][1]=.002588,N[0][2]=.0056946631,C[0][2]=.009312,I[0][2]=-.023608,N[1][0]=.0059347674,C[1][0]=.002989,I[1][0]=.008721,N[1][1]=.0014979264,C[1][1]=.018791,I[1][1]=-.068163,N[1][2]=.0010451889,C[1][2]=.021345,I[1][2]=-.066027;let G=0,D=0,F=0,O=0,K=0,U=0,$=0,Y=0,H=0,z=0,B=0,W=0,V=0,j=0,X=0,Z=0,q=(Date.now(),0),J=0,Q=0;const nn=$$.viewController(n,{data:{Simulation_Timer:q,Descent_Thrust_Procent:h,LM_Weight_KG:a,Descent_Propellant_Mass_KG:d,Descent_Fuel_Flow_SEC:_,Descent_Acceleration:f,RCS_Propellant_Mass_KG:r,Ascent_Propellant_Mass_KG:M,Ascent_Fuel_Flow_SEC:E,Ascent_Acceleration:A,Descent_Propulsion_Min_N:4560,Descent_Propulsion_Max_N:b,Descent_Propulsion_N:v,DESCENT_ENGINE_FLAG:m,ASCENT_ENGINE_FLAG:y,LM_CONFIG:R,Simulation_Timer_text:function(){return this.Simulation_Timer.toFixed(1)},Descent_Thrust_Procent_text:function(){return this.Descent_Thrust_Procent.toFixed(1)},LM_Weight_KG_text:function(){return this.LM_Weight_KG.toFixed(0)},Descent_Propellant_Mass_KG_text:function(){return this.Descent_Propellant_Mass_KG.toFixed(0)},Descent_Fuel_Flow_SEC_text:function(){return this.Descent_Fuel_Flow_SEC.toFixed(2)},Descent_Acceleration_text:function(){return this.Descent_Acceleration.toFixed(3)},RCS_Propellant_Mass_KG_text:function(){return this.RCS_Propellant_Mass_KG.toFixed(1)},Ascent_Propellant_Mass_KG_text:function(){return this.Ascent_Propellant_Mass_KG.toFixed(0)},Ascent_Fuel_Flow_SEC_text:function(){return this.Ascent_Fuel_Flow_SEC.toFixed(1)},Ascent_Acceleration_text:function(){return this.Ascent_Acceleration.toFixed(3)},isSeparated:function(){return 1==this.LM_CONFIG}},events:{onSeperateStage:function(){console.log("onSeperateStage"),R=1,d=0,o=0,nn.setData({LM_CONFIG:R,Descent_Propellant_Mass_KG:d,LM_Weight_Descent_KG:o})}}});function tn(t,e,s){n.trigger("accelerate",[t,e,s])}window.simu=nn,this.dynamic_simulation=function(){if(console.log("dynamic_simulation"),a=l+o,nn.setData({Simulation_Timer:q,Descent_Thrust_Procent:h,LM_Weight_KG:a,Descent_Propellant_Mass_KG:d,Descent_Fuel_Flow_SEC:_,Descent_Acceleration:f,RCS_Propellant_Mass_KG:r,Ascent_Propellant_Mass_KG:M,Ascent_Fuel_Flow_SEC:E,Ascent_Acceleration:A}),m=nn.model.DESCENT_ENGINE_FLAG,y=nn.model.ASCENT_ENGINE_FLAG,h=nn.model.Descent_Propulsion_N/b,m&&d>0){const n=(_=v/p)/Q;d-=n,o-=n,tn((f=v/a)*Q,0,0)}else m=!1,f=0,_=0;if(y&&M>0){const n=(E=g/k)*Q;M-=n,tn((A=g/(l-=n))*Q,0,0)}else y=!1,A=0,E=0;const t=a/65535,[e,i,c]=N[R],[u,G,D]=C[R],[F,O,K]=I[R];var U,$,Y;S=s*(u+e/(t+F)),T=s*(G+i/(t+O)),P=s*(D+c/(t+K)),U=L*Q,$=x*Q,Y=w*Q,n.trigger("rorate",[U,$,Y])},this.update_RCS=function(){const n=1==z||1==G?z+G:0,t=1==H||1==D?-(H+D):0,e=1==V||1==K?V+K:0,s=1==Z||1==U?-(Z+U):0,o=1==j||1==W||1==$||1==O?j+W+$+O:0,d=1==X||1==B||1==Y||1==F?-(X+B+Y+F):0,b=n+t,p=e+s,v=o+d;let _=0;0!=n&&n+t==0&&(_=1==z?z+D:-(H+G)),0!=e&&e+s==0&&(1==V?_+=V+U:_-=Z+K),0!=_&&tn(J*_*c/a,0,0);0!=o&&o+d==0&&(1==X&&tn(0,2*J*c/a,0),1==Y&&tn(0,2*-J*c/a,0),1==B&&tn(0,0,2*J*c/a),1==j&&tn(0,0,2*-J*c/a));if(r>0){L+=S*J*v,x+=T*J*(p-b),w+=P*J*(p+b);const a=(i(n)+i(t)+i(e)+i(s)+i(o)+i(d))*c/u*J;l-=a,r-=a}}}});