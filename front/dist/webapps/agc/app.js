$$.control.registerControl("rootPage",{template:'<div>\n    <div bn-control="DSKY" bn-event="key: onKey" bn-iface="dsky"></div>\n</div>\n\n\n<div>\n    <div bn-control="INPUT"></div>\n</div>\n\n<div>\n    <div bn-control="SIMU" bn-iface="simu" bn-event="data: onSimuData"></div>\n</div>\n\n<div>\n    <div bn-control="IMU" bn-iface="imu" bn-event="launch: onLaunch"></div>\n\n</div>\n\n',deps:["breizbot.files","app.emuAgc","brainjs.http"],props:{},init:function(n,t,e,a){window.agc=e;const i=$$.viewController(n,{data:{},events:{onKey:function(n,t){const{val:a}=t;isNaN(a)?(e.writeIoBit(26,14,0),setTimeout(()=>{e.writeIoBit(26,14,1)},200)):e.writeIo(13,a)},onLaunch:function(){console.log("onLaunch"),u||b||(e.writeIo(24,0,e.inputsMask.LIFTOFF),d=r,s.setReactor(0),b=!0)},onSimuData:function(n,t){const{rotate:e,accelerate:a,omega:i}=t;e&&s.rotate(e),a&&s.accelerate(a)},onSimuAccelerate:function(n,t){console.log("onSimuAccelerate",t),s.accelerate(t)}}}),l=i.scope.dsky,s=i.scope.imu,c=i.scope.simu;Math.PI;let o=null,r=0,d=-1,u=!1,b=!1;!async function(){o=await a.get(t.assetsUrl("profile.json")),await e.loadRom(t.assetsUrl("Comanche055.bin")),e.start();let n=0,i=0,r=0,d=Date.now(),u=0,b=0,v=0,p=!1;setInterval(()=>{e.run()},10),function t(){const a=e.readIo();if(null!=a){const{channel:n,value:i}=a;switch(n){case 8:case 9:case 19:l.process(n,i);break;case 10:console.log("channelUpdate",n.toString(8),i.toString(2).padStart(15,"0")),i&e.outputsMask.ZERO_IMU&&s.zero();break;case 124:case 125:case 126:s.gyro_coarse_align(n,i);break;case 127:s.gyro_fine_align(n,i)}t()}else{const e=Date.now(),a=e-d;n+=a,i+=a,r+=a,u+=a,d=e,b=10,1==v&&(c.update_RCS(a/1e3),b=5),n>25&&(c.setData({Simulation_Timer:u/1e3}),c.dynamic_simulation(n/1e3),n=0),i>100&&(s.update(),i=0),r>300&&(p=!p,l.setData({flash_flag:p}),r=0),setTimeout(t,b)}}()}()}}),$$.service.registerService("app.emuAgc",{deps:["breizbot.files"],init:function(n){const t=Module.cwrap("set_fixed",null,["number"]),e=Module.cwrap("cpu_reset"),a=Module.cwrap("cpu_step",null,["number"]),i=Module.cwrap("packet_read","number"),l=Module.cwrap("packet_write",null,["number","number"]),s=Module.cwrap("get_erasable_ptr","number"),c=.01172;let o=0,r=0,d=null;const u={24:15577,25:32767,26:9215,27:32766};function b(n,t,e){null!=e&&l(n+256,e),l(n,t)}function v(n,t){return n>>--t&1}function p(n){const t=parseInt(n).toString(8).padStart("3","0");console.log(`channel[${t}] = `+u[n].toString(2).padStart(15,"0"))}function h(n){return 1<<n-1}function v(n,t){return 1==(n>>--t&1)}const _={LIFTOFF:h(5),ISS_TURN_ON:h(14),PROCEED:h(14)},f={ZERO_IMU:h(5)};return{writeIo:b,writeIoBit:function(n,t,e){console.log("writeIoBit",n.toString(8),t,e);const a=h(t);0==e?u[n]&=~a:u[n]|=a,b(n,0==e?0:a,a)},loadRom:async function(n){const e=await fetch(n),a=await e.arrayBuffer(),i=new Uint8Array(a);console.log("romArray",i.length);const l=Module._malloc(i.length*i.BYTES_PER_ELEMENT);console.log("romPtr",l),Module.HEAP8.set(i,l),t(l),Module._free(l),d=s(),console.log("erasablePtr",d)},start:function(){e(),[5,6].forEach(n=>{u[n]=0}),o=performance.now(),r=0},run:function(){const n=Math.floor((performance.now()-o)/c)-r;if(n<0||n>1e5)return o=performance.now(),void(r=0);a(n),r+=n},readIo:function(){let n=null;const t=i();if(t){const e=t>>16,a=65535&t;u[e]=a,n={channel:e,value:a}}return n},peek:function(n){return 32767&Module.getValue(d+2*n,"i16")},poke:function(n,t){Module.setValue(d+2*n,t,"i16")},getChannelState:function(n){return u[n]},getChannelBitState:function(n,t){return v(u[n],t)},bitMask:h,bit:v,logChannelState:p,logAllChannelState:function(){Object.keys(u).forEach(n=>{p(n)})},inputsMask:_,outputsMask:f}}}),$$.control.registerControl("DSKY",{template:'\n<div class="top">\n    <div class="left">\n        <div class="col">\n            <div bn-style="uplink_acty"><span>UPLINK ACTY</span></div>\n            <div bn-style="no_att">NO ATT</div>\n            <div bn-style="stby">STBY</div>\n            <div bn-style="key_rel">KEY REL</div>\n            <div bn-style="opr_err">OPR ERR</div>\n            <div></div>\n            <div></div>\n        </div>\n\n        <div class="col">\n            <div bn-style="temp">TEMP</div>\n            <div bn-style="gimball_lock"><span>GIMBALL LOCK</span></div>\n            <div bn-style="prog">PROG</div>\n            <div>RESTART</div>\n            <div bn-style="tracker">TRACKER</div>\n            <div bn-style="alt">ALT</div>\n            <div bn-style="vel">VEL</div>\n        </div>\n\n    \n    </div>\n    \n    \n    <div class="right">\n        <div class="line">\n            <div class="compActy" bn-style="comp_acty"><span>COMP ACTY</span></div>\n            <div>\n                <div class="label">PROG</div>\n                <div class="digit" bn-html="prog00"></div>\n            </div>\n    \n        </div>\n        <div class="line">\n            <div>\n                <div class="label">VERB</div>\n                <div class="digit" bn-html="verb00"></div>\n            </div>\n            <div>\n                <div class="label">NOUN</div>\n                <div class="digit" bn-html="noun00"></div>\n            </div>\n        </div>\n        <div class="digit big" bn-html="r1"></div>\n        <div class="digit big" bn-html="r2"></div>\n        <div class="digit big" bn-html="r3"></div>\n    \n    </div>\n</div>\n\n<div class="bottom">\n    <div class="keyboard" bn-event="click.key: onKey">\n        <div>\n            <button class="label key">VERB</button>\n            <button class="label key">NOUN</button>\n        </div>\n        <div>\n            <button class="key">+</button>\n            <button class="key">-</button>\n            <button class="key">0</button>\n        </div>\n        <div>\n            <button class="key">1</button>\n            <button class="key">4</button>\n            <button class="key">7</button>\n        </div>\n        <div>\n            <button class="key">8</button>\n            <button class="key">5</button>\n            <button class="key">2</button>\n        </div>\n        <div>\n            <button class="key">9</button>\n            <button class="key">6</button>\n            <button class="key">3</button>\n        </div>\n        <div>\n            <button class="label key">CLR</button>\n            <button class="label key">PRO</button>\n            <button class="label key">KEY REL</button>\n        </div>\n        <div>\n            <button class="label key">ENTR</button>\n            <button class="label key">RSET</button>\n        </div>\n    \n    </div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(n,t,e){Math.floor,Math.round;const a={VERB:17,NOUN:31,"+":26,"-":27,0:16,CLR:30,"KEY REL":25,ENTR:28,RSET:18},i=e.bit;function l(n){var t="E";switch(n){case 0:t="H";break;case 21:t="0";break;case 3:t="1";break;case 25:t="2";break;case 27:t="3";break;case 15:t="4";break;case 30:t="5";break;case 28:t="6";break;case 19:t="7";break;case 29:t="8";break;case 31:t="9"}return t}let s=0,c=0,o=0,r=0,d=0,u=0;const b="&nbsp;";function v(n){return{"background-color":n?"#ffc200":"#888888"}}function p(n){return{"background-color":n?"#ffffff":"#888888"}}const h=$$.viewController(n,{data:{flash_flag:!1,status11:0,status13:0,status10:0,digits:"000000+00000+00000+00000",comp_acty:function(){return v(i(this.status11,2))},uplink_acty:function(){return p(i(this.status11,3))},temp:function(){return v(i(this.status11,4))},key_rel:function(){return p(i(this.status11,5)&&this.flash_flag)},opr_err:function(){return p(i(this.status11,7)&&this.flash_flag)},stby:function(){return p(i(this.status13,11))},vel:function(){return v(i(this.status10,3))},no_att:function(){return p(i(this.status10,4))},alt:function(){return v(i(this.status10,5))},gimball_lock:function(){return v(i(this.status10,6))},tracker:function(){return v(i(this.status10,8))},prog:function(){return v(i(this.status10,9))},r1:function(){return this.digits.slice(6,12).replace(/H/g,b)},r2:function(){return this.digits.slice(12,18).replace(/H/g,b)},prog00:function(){return this.digits.slice(0,2).replace(/H/g,b)},r3:function(){return this.digits.slice(18,24).replace(/H/g,b)},verb00:function(){return i(this.status11,6)&&!this.flash_flag?b+b:this.digits.slice(2,4).replace(/H/g,b)},noun00:function(){return i(this.status11,6)&&!this.flash_flag?b+b:this.digits.slice(4,6).replace(/H/g,b)}},events:{onKey:function(t){const e=$(this).text();let i=a[e];null==i&&(i=parseInt(e)),t.stopPropagation(),n.trigger("key",{val:i})}}});this.processLights=function(n){h.setData({lamps:n})},this.setData=function(n){h.setData(n)},this.process=function(n,t){if(8==n&&0==t)return;if(9==n)return void h.setData({status11:t});if(11==n)return void h.setData({status11:t});const e=t>>11,a=t>>10&1,i=l(t>>5&31),b=l(31&t),v=h.model.digits.split("");switch(e){case 12:h.setData({status10:t});break;case 11:v[0]=i,v[1]=b;break;case 10:v[2]=i,v[3]=b;break;case 9:v[4]=i,v[5]=b;break;case 8:v[7]=b;break;case 7:v[8]=i,v[9]=b,s=a;break;case 6:v[10]=i,v[11]=b,c=a;break;case 5:v[13]=i,v[14]=b,o=a;break;case 4:v[15]=i,v[16]=b,r=a;break;case 3:v[17]=i,v[19]=b;break;case 2:v[20]=i,v[21]=b,d=a;break;case 1:v[22]=i,v[23]=b,u=a}if(12!=e){v[6]=s&&!c?"+":s||c?"-":"H",v[12]=o&&!r?"+":o||r?"-":"H",v[18]=d&&!u?"+":d||u?"-":"H";const n=v.join("");h.setData({digits:n})}}}}),$$.control.registerControl("FDAI",{template:'<svg width="350" height="360" bn-bind="svg">\n    <defs>\n      <marker id="triangle" viewBox="0 0 10 10"\n            refX="1" refY="5"\n            markerUnits="strokeWidth"\n            markerWidth="10" markerHeight="10"\n            orient="auto">\n        <path d="M 0 0 L 10 5 L 0 10 z" fill="black"/>\n      </marker>\n      <marker id="triangle2" viewBox="0 0 16 16"\n            refX="1" refY="8"\n            markerUnits="strokeWidth"\n            markerWidth="16" markerHeight="16"\n            orient="auto">\n        <path d="M 0 0 L 16 8 L 0 16 z" fill="black"/>\n      </marker>\n  \n  </defs>\n    \n  </svg>',deps:["breizbot.pager"],props:{},init:function(n,t){const e=$$.viewController(n,{data:{},events:{}}).scope.svg.get(0),a=150,i=180,l=180/Math.PI,s=42.1875/384;let c=0,o=0,r=0;function d(n,t){Object.keys(t).forEach(e=>{n.setAttribute(e,t[e])})}function u(n,t){const a=document.createElementNS("http://www.w3.org/2000/svg",n);return"object"==typeof t&&d(a,t),e.appendChild(a),a}function b(n,t,e,a,i,l){return u("line",Object.assign({x1:n,y1:t,x2:e,y2:a,stroke:i},l))}function v(n,t,e,a,i){const l=u("text",Object.assign({x:n,y:t,fill:a},i));return l.textContent=e,l}function p(n,t,e,a,i){return u("circle",Object.assign({r:e,cx:n,cy:t,fill:a},i))}const h={};function _(n,t){d(h[n],{x1:t,x2:t})}function f(n,t){d(h[n],{y1:t,y2:t})}function g(n,t,e,a,i){d(h[n],{x1:t,y1:e,x2:a,y2:i})}function k(n,t,e){d(h[n],{x:t,y:e})}function E(n,t,e,a,i,l){const s=a*Math.PI/180;return b(n+e*Math.sin(s),t+e*Math.cos(s),n+(e+=i)*Math.sin(s),t+e*Math.cos(s),l)}for(let n=-270;n<=270;n+=30){const t=n>=-180&&n<=0||n>=180&&n<=360?"black":"white";h[`PITCH_${n}`]=b(0,0,0,0,t);const e=n<0?n+360:n;h[`PITCH_TXT_${n}`]=v(0,0,e,t)}h.zAxisLM=b(0,0,0,0,"blue");for(let n=-270;n<=270;n+=30){h[`zAxis_${n}`]=b(0,0,0,0,"blue");const t=n<0?n+360:n;h[`zAxis_TXT_${n}`]=v(0,0,t,"blue")}h.RollMarker=b(0,0,0,0,"black",{"marker-end":"url(#triangle2)"}),h.YawErrorNeedle=b(0,i+10,0,i+100,"orange"),h.PitchErrorNeedle=b(a+10,0,a+100,0,"orange"),h.RollErrorNeedle=b(0,i-10,0,i-100,"orange"),p(a,i,190,"none",{stroke:"darkgrey","stroke-width":180});for(let n=70;n<110;n+=.5)E(a,i,100,n,10,"red");for(let n=250;n<290;n+=.5)E(a,i,100,n,10,"red");for(let n=0;n<360;n+=10){E(a,i,100,n,n%30==0?10:15,"white")}p(a,i,100,"none",{stroke:"black","stroke-width":4}),b(a-10,i,a+10,i,"white"),b(a,i-10,a,i+10,"white");for(let n=-5;n<=5;n++)b(a+10*n,310,a+10*n,315,"white");h.YawRateMarker=b(0,325,0,324,"black",{"marker-end":"url(#triangle)"}),v(a,310,"0","white"),v(a,340,"YAW RATE","white"),h.RollRateMarker=b(0,36,0,37,"black",{"marker-end":"url(#triangle)"}),v(a,62,"0","white"),v(a,30,"ROLL RATE","white");for(let n=-5;n<=5;n++)b(a+10*n,45,a+10*n,50,"white");for(let n=-5;n<=5;n++)b(280,i+10*n,285,i+10*n,"white");function m(n){const t=2*Math.PI;return n<-t?n+t:n>=t?n-t:n}function M(n,t,e){return Math.max(Math.min(e,n),t)}function S(t,e){const[d,u,b]=t,[v,p,h]=e,E=Math.sin(d),S=Math.sin(u),T=Math.sin(b),A=Math.cos(d),y=Math.cos(u),R=Math.cos(b),x=T,D=R*A,I=y*T*E+S*A,N=-R*E,C=-S*T*E+y*A,w=m(Math.atan2(x,D)),L=m(Math.atan2(I,C)),P=m(Math.asin(N)),G=w,O=Math.sin(-1*G),F=Math.cos(-1*G),U=-1*P*l,K=L*l,$=w*l,H=U>0?360-U:Math.abs(U),B=K<0?K+360:K,Y=$<0?$+360:$;n.trigger("data",{fdai:[H,B,Y]}),_("YawRateMarker",a-10*M(r,-5,5)),f("PitchRateMarker",i-10*M(o,-5,5)),_("RollRateMarker",a+10*M(c,-5,5)),_("YawErrorNeedle",a+v*s),f("PitchErrorNeedle",i+p*s),_("RollErrorNeedle",a-h*s);const z=a+85*Math.sin(G+Math.PI),W=a+86*Math.sin(G+Math.PI);function j(n,t){return{x:n*F-t*O+a,y:n*O+t*F+i}}g("RollMarker",z,i+85*Math.cos(G+Math.PI),W,i+86*Math.cos(G+Math.PI));const V=K>180?K-180:K;for(let n=-270;n<=270;n+=30){const t=-50,e=50,a=-n+V,i=0,l=a,{x:s,y:c}=j(i,l),{x:o,y:r}=j(t,a),{x:d,y:u}=j(e,a);k(`PITCH_TXT_${n}`,s,c),g(`PITCH_${n}`,o,r,d,u)}const X=U>180?U-360:U,Z=-280+X,q=280+X,{x:J,y:Q}=j(Z,0),{x:nn,y:tn}=j(q,0);g("zAxisLM",J,Q,nn,tn);for(let n=-270;n<=270;n+=30){const t=n+X,e=-2,a=n+X,i=3,l=n+X,s=10,{x:c,y:o}=j(l,s),{x:r,y:d}=j(t,e),{x:u,y:b}=j(a,i);k(`zAxis_TXT_${n}`,c,o),g(`zAxis_${n}`,r,d,u,b)}}h.PitchRateMarker=b(296,0,295,0,"black",{"marker-end":"url(#triangle)"}),v(a+128-5,i,"0","white",{"alignment-baseline":"middle"}),v(a+155,i-30,"P","white"),v(a+155,i-22,"I","white"),v(a+155,i-14,"T","white"),v(a+155,i-6,"C","white"),v(a+155,i+2,"H","white"),v(a+155,i+18,"R","white"),v(a+155,i+26,"A","white"),v(a+155,i+34,"T","white"),v(a+155,i+42,"E","white"),S([0,0,0],[0,0,0]),this.update=S}}),$$.control.registerControl("IMU",{template:'<div class="top">\n    <div class="left">\n        <div class="imuGroup">\n            <label class="imuLabel">ST</label>\n            <div class="clock" bn-html="getSt"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MET</label>\n            <div class="clock" bn-html="getMet"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">OGA</label>\n            <div class="imu" bn-html="imux"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">IGA</label>\n            <div class="imu" bn-html="imuy"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MGA</label>\n            <div class="imu" bn-html="imuz"></div>\n        </div>\n    </div>\n\n    <div class="middle">\n        <div class="imuGroup">\n            <label class="imuLabel">YAW</label>\n            <div class="imu" bn-html="yaw"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">PITCH</label>\n            <div class="imu" bn-html="pitch"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">ROLL</label>\n            <div class="imu" bn-html="roll"></div>\n        </div>\n\n    </div>\n\n    <div class="right">\n        <button bn-event="click: enableIMU">Enable IMU</button>\n        <button bn-event="click: launch">Launch</button>\n        <div class="light" bn-style="sic">S-IC</div>\n        <div class="light" bn-style="sii">S-II</div>\n        <div class="light" bn-style="sivb">S-IVB</div>\n    </div>\n</div>\n<div class="bottom">\n    <div bn-control="FDAI" bn-iface="fdai" bn-event="data: onData"></div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(n,t,e){const a=Math.abs,i=Math.floor,l=(Math.round,Math.sqrt,Math.sin),s=Math.cos,c=(Math.atan2,Math.asin,Math.PI),o=c/180,r=180/c,d=.043948*o,u=.617981/3600*o,b=360/32768*o,v=.0585;let p,h,_,f,g,k,E,m,M=0;function S(){console.log("zero"),p=[0,0,0],h=[0,0,0],_=[0,0,0],f=[0,0,0],g=[0,0,0],E=[0,0,0],k=[0,0,0],m=!1,M=1,T()}function T(){N.update(h,p),I.setData({imu_angle:h})}function A(n,t,e){return n-(e-t)*i((n-t)/(e-t))}function y(n){let t=(n*r).toFixed(2);return t="000".substr(0,6-t.length)+t}function R(n){return n.toFixed(1)}function x(n){const t=i(n/3600),e=i(n/60)%60,a=n%60;return(t<10?"0"+t:t)+":"+(e<10?"0"+e:e)+":"+(a<10?"0"+a:a)}function D(n){return{"background-color":n?"#ffc200":"#888888"}}const I=$$.viewController(n,{data:{st:0,met:0,c:-1,sic:function(){return D(0==this.c)},sii:function(){return D(1==this.c)},sivb:function(){return D(2==this.c)},getSt:function(){return x(this.st)},getMet:function(){return x(this.met)},imu_angle:[0,0,0],euler:[0,0,0],imux:function(){return y(this.imu_angle[0])},imuy:function(){return y(this.imu_angle[1])},imuz:function(){return y(this.imu_angle[2])},yaw:function(){return R(this.euler[0])},pitch:function(){return R(this.euler[1])},roll:function(){return R(this.euler[2])}},events:{onData:function(n,t){I.setData({euler:t.fdai})},enableIMU:function(n){console.log("enableIMU"),e.writeIoBit(24,14,0)},launch:function(t){t.stopPropagation(),n.trigger("launch")}}}),N=I.scope.fdai;function C(n){if(m)return;for(let t=0;t<3;t++)if(n[t]){h[t]=A(h[t]+n[t],0,2*c);const l=A(h[t]-f[t],-c,c);M+=a(l);const s=l>0?1:-1;let o=i(a(l)/b);f[t]=A(f[t]+s*b*o,0,2*c);let r=e.peek(26+t);r=16384&r?-(32767^r):r,r+=s*o,e.poke(26+t,r<0?32767^-r:r)}}this.rotate=function(n){const t=l(h[2]),e=s(h[2])*s(h[0]),a=l(h[0]),i=-s(h[2])*l(h[0]),o=s(h[0]),r=o*e-i*a;C([A(n[0]-(n[1]*o*t-n[2]*a*t)/r,-c,c),A((n[1]*o-n[2]*a)/r,-c,c),A((n[2]*e-n[1]*i)/r,-c,c)])},this.update=T,this.accelerate=function(n){const t=l(h[0]),a=l(h[1]),c=l(h[2]),o=s(h[0]),r=s(h[1]),d=s(h[2]),u=[d*r*n[0]+(-o*c*r+t*a)*n[1]+(t*c*r+o*a)*n[2],c*n[0]+o*d*n[1]-t*d*n[2],-d*a*n[0]+(o*c*a+t*r)*n[1]+(-t*c*a+o*r)*n[2]];for(let n=0;n<3;n++){E[n]+=u[n];const t=i((E[n]-k[n]*v)/v);k[n]+=t;let a=e.peek(31+n);a=16384&a?-(32767^a):a,a+=t,e.poke(31+n,a<0?32767^-a:a)}},this.gyro_coarse_align=function(n,t){const a=(16384&t?-1:1)*(16383&t);1==e.getChannelBitState(10,4)?(124===n?C([a*d,0,0]):125===n?C([0,a*d,0]):126===n&&C([0,0,a*d]),T()):p[n-124]+=a},this.zero=S,this.gyro_fine_align=function(n,t){const e=8192&t,a=4096&t,i=(16384&t?-1:1)*(2047&t);!e&&a&&C([i*u,0,0]),e&&!a&&C([0,i*u,0]),e&&a&&C([0,0,i*u]),T()},this.setSt=function(n){I.setData({st:n})},this.setMet=function(n){I.setData({met:n})},this.setReactor=function(n){I.setData({c:n})},S()}}),$$.control.registerControl("INPUT",{template:'<div bn-event="click.check: onCheckbox">\n    <div>\n        <fieldset>\n            <legend>ENGINE</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 3}" class="check">\n                <label>ENGINE ARMES SIGNAL</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 5}" class="check">\n                <label>AUTO THROTTLE<br>COMPUTER CONTROL OF DESCENT</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 9}" class="check">\n                <label>DESCENT ENGINE<br>DISABLED BY CREW</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 10}" class="check">\n                <label>APPARENT DESCENT ENGINE<br>GIMBAL FAILURE</label>\n            </div>\n        </fieldset>\n        <fieldset>\n            <legend>THRUSTERS</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 1}" class="check">\n                <label>THRUSTERS 2&4 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 2}" class="check">\n                <label>THRUSTERS 5&8 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 3}" class="check">\n                <label>THRUSTERS 1&3 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 4}" class="check">\n                <label>THRUSTERS 6&7 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 5}" class="check">\n                <label>THRUSTERS 14&16 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 6}" class="check">\n                <label>THRUSTERS 13&15 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 7}" class="check">\n                <label>THRUSTERS 9&12 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 8}" class="check">\n                <label>THRUSTERS 10&11 DISABLED</label>\n            </div>\n        </fieldset>\n    </div>\n    <div>\n        <fieldset>\n            <legend>RADAR</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 33, bit: 2}" class="check">\n                <label>RR AUTO-POWER ON</label>\n            </div>\n        </fieldset>\n        <fieldset>\n            <legend>IMU</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 14}" class="check">\n                <label>ISS TURN ON REQUESTED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 11}" class="check">\n                <label>IMU CAGE COMMAND TO DRIVE<br>IMU GIMBAL ANGLES TO 0</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 6}" class="check">\n                <label>DISPLAY INERTIAL DATA</label>\n            </div>\n        </fieldset>\n        <fieldset>\n            <legend>DAP/ATTITUDE MODE</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 10}" class="check">\n                <label>AGC HAS CONTROL OF LM<br>(NOT AGS)</label>\n            </div>\n            <div bn-control="brainjs.radiogroup">\n                <div class="data">\n                    <input type="radio">\n                    <label>DAP OFF</label>\n                </div>\n                <div class="data">\n                    <input type="radio">\n                    <label>ATTITUDE HOLD MODE ON</label>\n                </div>\n                <div class="data">\n                    <input type="radio">\n                    <label>AUTO STABILIZATION<br>OF ATTITUDE ON</label>\n                </div>\n\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>AOT BUTTONS</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 3}" class="check">\n                <label>X-AXIS MARK</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 4}" class="check">\n                <label>Y-AXIS MARK</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 5}" class="check">\n                <label>MARK REJECT</label>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>DESCENT CONTROL</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 6}" class="check">\n                <label>DESCENT+</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 7}" class="check">\n                <label>DESCENT-</label>\n            </div>\n        </fieldset>\n    </div>\n\n    <div>\n        <fieldset>\n            <legend>RHC/ACA</legend>\n            <div class="slider">\n                <div class="sliderValue">\n                    <label>Roll</label>\n                    <span bn-text="roll"></span>\n                </div>\n                <div bn-control="brainjs.slider" bn-data="rhcRange" bn-update="input" bn-val="roll"></div>\n            </div>\n            <div class="slider">\n                <div class="sliderValue">\n                    <label>Pitch</label>\n                    <span bn-text="pitch"></span>\n                </div>\n                <div bn-control="brainjs.slider" bn-data="rhcRange" bn-update="input" bn-val="pitch"></div>\n            </div>\n            <div class="slider">\n                <div class="sliderValue">\n                    <label>Yaw</label>\n                    <span bn-text="yaw"></span>\n                </div>\n                <div bn-control="brainjs.slider" bn-data="rhcRange" bn-update="input" bn-val="yaw"></div>\n            </div>\n            <div>\n                <button bn-event="click: onDetent">DETENT</button>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>THC</legend>\n            <div bn-control="brainjs.radiogroup" class="THC">\n                <div class="data">\n                    <input type="radio">\n                    <label>NEUTRAL</label>\n                </div>\n                <div class="XYZ">\n                    <div>\n                        <div class="data">\n                            <input type="radio">\n                            <label>+X</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio">\n                            <label>+Y</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio">\n                            <label>+Z</label>\n                        </div>\n                    </div>\n                    <div>\n                        <div class="data">\n                            <input type="radio">\n                            <label>-X</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio">\n                            <label>-Y</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio">\n                            <label>-Z</label>\n                        </div>\n                    </div>\n\n                </div>\n\n            </div>\n        </fieldset>\n    </div>\n</div>',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(n,t,e){const a=$$.viewController(n,{data:{roll:0,pitch:0,yaw:0,rhcRange:{min:-57,max:57}},events:{onDetent:function(n){a.setData({roll:0,pitch:0,yaw:0})},onCheckbox:function(){const n=$(this),{channel:t,bit:a}=n.data(),i=parseInt(t,8);console.log("onCheckbox",n.data(),n.getValue()),e.writeIoBit(i,a,n.getValue()?0:1)}}})}}),$$.control.registerControl("SIMU",{template:'<div>\n    <fieldset>\n        <div class="data">\n            <label>SIMULATION TIME:</label>\n            <div>\n                <span bn-text="Simulation_Timer_text"></span>\n                <span class="unit">SEC</span>    \n            </div>\n        </div>\n        <div class="data">\n            <label>LM WEIGHT:</label>\n            <div>\n                <span bn-text="LM_Weight_KG_text"></span>\n                <span class="unit">KG</span>    \n            </div>\n        </div>\n\n    </fieldset>\n    <fieldset>\n        <legend>DESCENT</legend>\n        <div class="data">\n            <label>THRUST:</label>\n            <div>\n                <span bn-text="Descent_Thrust_Procent_text"></span>\n                <span class="unit"></span>\n            </div>\n        </div>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="Descent_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>FUEL FLOW:</label>\n            <div>\n                <span bn-text="Descent_Fuel_Flow_SEC_text"></span>\n                <span class="unit">KG/S</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>ACCELERATION:</label>\n            <div>\n                <span bn-text="Descent_Acceleration_text"></span>\n                <span class="unit">M/S²</span>\n            </div>\n        </div>\n        <div bn-show="!isSeparated">\n            <div>\n                <input type="checkbox" bn-val="DESCENT_ENGINE_FLAG" bn-update="click">\n                <label>ENGINE ON/OFF</label>\n            </div>\n            <div class="data">\n                <label>Thrust</label>\n                <div>\n                    <span bn-text="Descent_Propulsion_N"></span>\n                    <span class="unit">N</span>\n                </div>\n            </div>\n            <div bn-control="brainjs.slider" bn-data="{min: Descent_Propulsion_Min_N, max: Descent_Propulsion_Max_N }"\n                bn-update="input" bn-val="Descent_Propulsion_N"></div>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>Stage</legend>\n        <button bn-event="click: onSeperateStage" bn-prop="{disabled: isSeparated}">SEPARATE STAGE</button>\n    </fieldset>\n    <fieldset>\n        <legend>ASCENT</legend>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="Ascent_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>FUEL FLOW:</label>\n            <div>\n                <span bn-text="Ascent_Fuel_Flow_SEC_text"></span>\n                <span class="unit">KG/S</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>ACCELERATION:</label>\n            <div>\n                <span bn-text="Ascent_Acceleration_text"></span>\n                <span class="unit">M/S²</span>\n            </div>\n        </div>\n        <div bn-show="isSeparated">\n            <input type="checkbox" bn-val="ASCENT_ENGINE_FLAG" bn-update="click">\n            <label>ENGINE ON/OFF</label>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>RCS</legend>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="RCS_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n\n    </fieldset>\n\n</div>',deps:["breizbot.pager"],props:{},init:function(n,t){const e=Math.PI,a=180/e*(e/4),i=Math.abs;let l=0,s=4670,c=10694,o=287,r=445,d=2840,u=8355,b=45040,v=3050,p=4560,h=0,_=0,f=0,g=!1,k=2353,E=15600,m=3050,M=0,S=0,T=!1,A="DESCENT",y=0,R=0,x=0,D=0,I=0,N=0;const C={ASCENT:{a:[.0065443852,.0035784354,.0056946631],b:[32e-6,.162862,.009312],c:[-.006923,.002588,-.023608]},DESCENT:{a:[.0059347674,.0014979264,.0010451889],b:[.002989,.018791,-.068163],c:[.008721,-.068163,-.066027]}};let w=0,L=0,P=0,G=0,O=0,F=0,U=0,K=0,$=0,H=0,B=0,Y=0,z=0,W=0,j=0,V=0;const X=$$.viewController(n,{data:{Simulation_Timer:0,Descent_Thrust_Procent:_,LM_Weight_KG:l,Descent_Propellant_Mass_KG:u,Descent_Fuel_Flow_SEC:h,Descent_Acceleration:f,RCS_Propellant_Mass_KG:o,Ascent_Propellant_Mass_KG:k,Ascent_Fuel_Flow_SEC:M,Ascent_Acceleration:S,Descent_Propulsion_Min_N:4560,Descent_Propulsion_Max_N:b,Descent_Propulsion_N:p,DESCENT_ENGINE_FLAG:g,ASCENT_ENGINE_FLAG:T,LM_CONFIG:A,Simulation_Timer_text:function(){return this.Simulation_Timer.toFixed(1)},Descent_Thrust_Procent_text:function(){return this.Descent_Thrust_Procent.toFixed(1)},LM_Weight_KG_text:function(){return this.LM_Weight_KG.toFixed(0)},Descent_Propellant_Mass_KG_text:function(){return this.Descent_Propellant_Mass_KG.toFixed(0)},Descent_Fuel_Flow_SEC_text:function(){return this.Descent_Fuel_Flow_SEC.toFixed(2)},Descent_Acceleration_text:function(){return this.Descent_Acceleration.toFixed(3)},RCS_Propellant_Mass_KG_text:function(){return this.RCS_Propellant_Mass_KG.toFixed(1)},Ascent_Propellant_Mass_KG_text:function(){return this.Ascent_Propellant_Mass_KG.toFixed(0)},Ascent_Fuel_Flow_SEC_text:function(){return this.Ascent_Fuel_Flow_SEC.toFixed(1)},Ascent_Acceleration_text:function(){return this.Ascent_Acceleration.toFixed(3)},isSeparated:function(){return"ASCENT"==this.LM_CONFIG}},events:{onSeperateStage:function(){console.log("onSeperateStage"),A="ASCENT",u=0,c=0,X.setData({LM_CONFIG:A,Descent_Propellant_Mass_KG:u,LM_Weight_Descent_KG:c})}}});function Z(t,e,a){n.trigger("data",{accelerate:[t,e,a]})}window.simu=X,this.dynamic_simulation=function(t){if(l=s+c,X.setData({Descent_Thrust_Procent:_,LM_Weight_KG:l,Descent_Propellant_Mass_KG:u,Descent_Fuel_Flow_SEC:h,Descent_Acceleration:f,RCS_Propellant_Mass_KG:o,Ascent_Propellant_Mass_KG:k,Ascent_Fuel_Flow_SEC:M,Ascent_Acceleration:S}),g=X.model.DESCENT_ENGINE_FLAG,T=X.model.ASCENT_ENGINE_FLAG,_=X.model.Descent_Propulsion_N/b,g&&u>0){const n=(h=p/v)*t;u-=n,c-=n,Z((f=p/l)*t,0,0)}else g=!1,f=0,h=0;if(T&&k>0){const n=(M=E/m)*t;k-=n,Z((S=E/(s-=n))*t,0,0)}else T=!1,S=0,M=0;const e=l/65535,[i,r,d]=C[A].a,[w,L,P]=C[A].b,[G,O,F]=C[A].c;var U,K,$;y=a*(w+i/(e+G)),R=a*(L+r/(e+O)),x=a*(P+d/(e+F)),U=N*t,K=I*t,$=D*t,n.trigger("data",{rotate:[U,K,$]})},this.update_RCS=function(t){console.log("update_RCS",t);const e=1==H||1==w?H+w:0,a=1==$||1==L?-($+L):0,c=1==z||1==O?z+O:0,u=1==V||1==F?-(V+F):0,b=1==W||1==Y||1==U||1==G?W+Y+U+G:0,v=1==j||1==B||1==K||1==P?-(j+B+K+P):0,p=e+a,h=c+u,_=b+v;let f=0;0!=e&&e+a==0&&(f=1==H?H+L:-($+w)),0!=c&&c+u==0&&(1==z?f+=z+F:f-=V+O),0!=f&&Z(t*f*r/l,0,0);0!=b&&b+v==0&&(1==j&&Z(0,2*t*r/l,0),1==K&&Z(0,2*-t*r/l,0),1==B&&Z(0,0,2*t*r/l),1==W&&Z(0,0,2*-t*r/l));if(o>0){N+=y*t*_,I+=R*t*(h-p),D+=x*t*(h+p),n.trigger("data",{omega:[N,I,D]});const l=(i(e)+i(a)+i(c)+i(u)+i(b)+i(v))*r/d*t;s-=l,o-=l}},this.setData=function(n){X.setData(n)}}});