$$.control.registerControl("rootPage",{template:'<div>\n    <div bn-control="DSKY" bn-event="key: onKey" bn-iface="dsky"></div>\n\n    <div bn-control="FDAI" bn-iface="fdai" bn-event="data: onFdaiData"></div>\n\n</div>\n\n<div>\n    <div bn-control="INPUT"></div>\n    <div bn-control="OUTPUT" bn-iface="output"></div>\n</div>\n\n<div bn-control="SIMU" bn-iface="simu" bn-event="data: onSimuData"></div>\n\n',deps:["breizbot.files","app.emuAgc","app.imu","brainjs.http"],props:{},init:function(n,e,t,a,s){window.agc=t;const i=t.bit,l=$$.viewController(n,{data:{},events:{onKey:function(n,e){const{val:a}=e;isNaN(a)?(t.writeIoBit(26,14,0),setTimeout(()=>{t.writeIoBit(26,14,1)},200)):t.writeIo(13,a)},onSimuData:function(n,e){const{rotate:t,accelerate:s}=e;t&&a.rotate(t),s&&a.accelerate(s),e.omega&&(b=e.omega)},onFdaiData:function(n,e){o.setData(e)}}}),c=l.scope.dsky,o=l.scope.simu,r=l.scope.fdai,d=l.scope.output;let u=null,b=[0,0,0];a.on("data",n=>{u=n}),async function(){await t.loadRom(e.assetsUrl("LMY99R0.bin")),t.start();let n=0,s=0,l=0,p=Date.now(),h=0,v=0,f=!1,_=!1,g=!1,E=new Array(16).fill(0);setInterval(()=>{t.run()},10),function e(){const k=t.readIo();if(null!=k){const{channel:n,value:s}=k;switch([11,12].includes(n)&&d.update(),n){case 8:case 9:case 11:c.process(n,s);break;case 10:i(s,5)&&!g?(a.zero(),g=!0):!i(s,5)&&g&&(g=!1);break;case 124:case 125:case 126:a.gyroCoarseAlign(n,s);break;case 127:a.gyroFineAlign(n,s);break;case 5:case 6:d.update(),E=function(){const n=[];for(let e=1;e<=8;e++)n.push(t.getChannelBitState(5,e));for(let e=1;e<=8;e++)n.push(t.getChannelBitState(6,e));return n}(),f=E.includes(1)}e()}else{const t=Date.now(),a=t-p;if(n+=a,s+=a,l+=a,h+=a,p=t,v=10,f&&(o.update_RCS(E,a/1e3),v=5),n>25&&(o.setData({Simulation_Timer:h/1e3}),o.dynamic_simulation(n/1e3),n=0),s>100){if(null!=u){const{imu_angle:n,error:e}=u;r.update(n,e,b)}s=0}l>300&&(_=!_,c.setData({flash_flag:_}),l=0),setTimeout(e,v)}}()}()}}),$$.service.registerService("app.emuAgc",{deps:["breizbot.files"],init:function(n){const e=Module.cwrap("set_fixed",null,["number"]),t=Module.cwrap("cpu_reset"),a=Module.cwrap("cpu_step",null,["number"]),s=Module.cwrap("packet_read","number"),i=Module.cwrap("packet_write",null,["number","number"]),l=Module.cwrap("get_erasable_ptr","number"),c=.01172;let o=0,r=0,d=null;const u={24:32767,25:32767,26:9215,27:32766},b={24:15577,25:32767,26:9215,27:24574};function p(n,e,t){n=parseInt(n),null!=t&&i(n+256,t),i(n,e)}function h(n,e,t){const a=g(e);return 0==t?n&=~a:n|=a,n}function v(n,e){let t=0,a=0;0!=Object.keys(e).length&&(Object.entries(e).forEach(([e,s])=>{t=h(t,e,1),a=h(a,e,s),b[n]=h(b[n],e,s)}),console.log(`chan[${n.toString(8).padStart(3,"0")}]=`+b[n].toString(2).padStart(15,"0")),p(n,a,t))}function f(n,e){return n>>e-1&1}function _(n){const e=parseInt(n).toString(8).padStart("3","0");console.log(`channel[${e}] = `+b[n].toString(2).padStart(15,"0"))}function g(n){return 1<<n-1}return{writeIo:p,writeIoBit:function(n,e,t){const a={};a[e]=t,v(n,a)},writeIoBits:v,loadRom:async function(n){const t=await fetch(n),a=await t.arrayBuffer(),s=new Uint8Array(a);console.log("romArray",s.length);const i=Module._malloc(s.length*s.BYTES_PER_ELEMENT);console.log("romPtr",i),Module.HEAP8.set(s,i),e(i),Module._free(i),d=l(),console.log("erasablePtr",d)},start:function(){console.log("start"),t(),setTimeout(()=>{Object.entries(b).forEach(([n,e])=>{p(n,e,u[n])}),[5,6,12].forEach(n=>{b[n]=0})},100),o=performance.now(),r=0},run:function(){const n=Math.floor((performance.now()-o)/c)-r;if(n<0||n>1e5)return o=performance.now(),void(r=0);a(n),r+=n},readIo:function(){let n=null;const e=s();if(e){const t=e>>16,a=65535&e;b[t]=a,n={channel:t,value:a}}return n},peek:function(n){return 32767&Module.getValue(d+2*n,"i16")},poke:function(n,e){Module.setValue(d+2*n,e,"i16")},getChannelState:function(n){return b[n]},getChannelBitState:function(n,e){return f(b[n],e)},bitMask:g,bit:f,logChannelState:_,logAllChannelState:function(){Object.keys(b).forEach(n=>{_(n)})}}}}),$$.service.registerService("app.imu",{deps:["app.emuAgc"],init:function(n,e){const t=new EventEmitter2,a=Math.abs,s=Math.floor,i=Math.sin,l=Math.cos,c=Math.PI,o=2*c,r=c/180,d=180/c,u=.043948,b=.617981/3600,p=360/32768,h=.0585;let v,f,_,g,E,k;function T(){console.log("zero"),v=[0,0,0],f=[0,0,0],euler=[0,0,0],_=[0,0,0],omega=[0,0,0],E=[0,0,0],g=[0,0,0],k=!1,A()}function A(){t.emit("data",{imu_angle:f,error:v})}function y(n){return n<0&&(n+=360),n>=360&&(n-=360),n}function D(n){return n<-o&&(n+=o),n>=o&&(n-=o),n}function C(n){if(k)return;for(let i=0;i<3;i++)if(n[i]){f[i]=y(n[i]+f[i]);const l=((t=f[i]-_[i])<-180&&(t+=360),t>180&&(t-=360),t),c=l>0?1:-1;let o=s(a(l)/p);_[i]=y(_[i]+c*p*o);let r=e.peek(26+i);r=16384&r?-(32767^r):r,r+=c*o,e.poke(26+i,r<0?32767^-r:r)}var t}return T(),{rotate:function(n){const e=n[0]*r,t=n[1]*r,a=n[2]*r,s=f[0]*r,c=(f[1],f[2]*r),o=i(c),u=l(c)*l(s),b=i(s),p=-l(c)*i(s),h=l(s),v=h*u-p*b,_=D(e-(t*h*o-a*b*o)/v),g=D((t*h-a*b)/v),E=D((a*u-t*p)/v);C([_*d,g*d,E*d])},accelerate:function(n){const t=f[0]*r,a=f[1]*r,c=f[2]*r,o=i(t),d=i(a),u=i(c),b=l(t),p=l(a),v=l(c),_=[v*p*n[0]+(-b*u*p+o*d)*n[1]+(o*u*p+b*d)*n[2],u*n[0]+b*v*n[1]-o*v*n[2],-v*d*n[0]+(b*u*d+o*p)*n[1]+(-o*u*d+b*p)*n[2]];for(let n=0;n<3;n++){E[n]+=_[n];const t=s((E[n]-g[n]*h)/h);g[n]+=t;let a=e.peek(31+n);a=16384&a?-(32767^a):a,a+=t,e.poke(31+n,a<0?32767^-a:a)}},gyroCoarseAlign:function(n,t){const a=(16384&t?-1:1)*(16383&t);1==e.getChannelBitState(10,4)?(124===n?C([a*u,0,0]):125===n?C([0,a*u,0]):126===n&&C([0,0,a*u]),A()):v[n-124]+=a},zero:T,gyroFineAlign:function(n,e){const t=8192&e,a=4096&e,s=(16384&e?-1:1)*(2047&e);!t&&a&&C([s*b,0,0]),t&&!a&&C([0,s*b,0]),t&&a&&C([0,0,s*b]),A()},on:t.on.bind(t)}}}),$$.control.registerControl("DSKY",{template:'\n<div class="top">\n    <div class="left">\n        <div class="col">\n            <div bn-style="uplink_acty"><span>UPLINK ACTY</span></div>\n            <div bn-style="no_att">NO ATT</div>\n            <div bn-style="stby">STBY</div>\n            <div bn-style="key_rel">KEY REL</div>\n            <div bn-style="opr_err">OPR ERR</div>\n            <div></div>\n            <div></div>\n        </div>\n\n        <div class="col">\n            <div bn-style="temp">TEMP</div>\n            <div bn-style="gimball_lock"><span>GIMBALL LOCK</span></div>\n            <div bn-style="prog">PROG</div>\n            <div>RESTART</div>\n            <div bn-style="tracker">TRACKER</div>\n            <div bn-style="alt">ALT</div>\n            <div bn-style="vel">VEL</div>\n        </div>\n\n    \n    </div>\n    \n    \n    <div class="right">\n        <div class="line">\n            <div class="compActy" bn-style="comp_acty"><span>COMP ACTY</span></div>\n            <div>\n                <div class="label">PROG</div>\n                <div class="digit" bn-html="prog00"></div>\n            </div>\n    \n        </div>\n        <div class="line">\n            <div>\n                <div class="label">VERB</div>\n                <div class="digit" bn-html="verb00"></div>\n            </div>\n            <div>\n                <div class="label">NOUN</div>\n                <div class="digit" bn-html="noun00"></div>\n            </div>\n        </div>\n        <div class="digit big" bn-html="r1"></div>\n        <div class="digit big" bn-html="r2"></div>\n        <div class="digit big" bn-html="r3"></div>\n    \n    </div>\n</div>\n\n<div class="bottom">\n    <div class="keyboard" bn-event="click.key: onKey">\n        <div>\n            <button class="label key">VERB</button>\n            <button class="label key">NOUN</button>\n        </div>\n        <div>\n            <button class="key">+</button>\n            <button class="key">-</button>\n            <button class="key">0</button>\n        </div>\n        <div>\n            <button class="key">1</button>\n            <button class="key">4</button>\n            <button class="key">7</button>\n        </div>\n        <div>\n            <button class="key">8</button>\n            <button class="key">5</button>\n            <button class="key">2</button>\n        </div>\n        <div>\n            <button class="key">9</button>\n            <button class="key">6</button>\n            <button class="key">3</button>\n        </div>\n        <div>\n            <button class="label key">CLR</button>\n            <button class="label key">PRO</button>\n            <button class="label key">KEY REL</button>\n        </div>\n        <div>\n            <button class="label key">ENTR</button>\n            <button class="label key">RSET</button>\n        </div>\n    \n    </div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(n,e,t){const a={VERB:17,NOUN:31,"+":26,"-":27,0:16,CLR:30,"KEY REL":25,ENTR:28,RSET:18},s=t.bit;function i(n){var e="E";switch(n){case 0:e="H";break;case 21:e="0";break;case 3:e="1";break;case 25:e="2";break;case 27:e="3";break;case 15:e="4";break;case 30:e="5";break;case 28:e="6";break;case 19:e="7";break;case 29:e="8";break;case 31:e="9"}return e}let l=0,c=0,o=0,r=0,d=0,u=0;const b="&nbsp;";function p(n){return{"background-color":n?"#ffc200":"#888888"}}function h(n){return{"background-color":n?"#ffffff":"#888888"}}const v=$$.viewController(n,{data:{flash_flag:!1,status11:0,status13:0,status10:0,digits:"000000+00000+00000+00000",comp_acty:function(){return p(s(this.status11,2))},uplink_acty:function(){return h(s(this.status11,3))},temp:function(){return p(s(this.status11,4))},key_rel:function(){return h(s(this.status11,5)&&this.flash_flag)},opr_err:function(){return h(s(this.status11,7)&&this.flash_flag)},stby:function(){return h(s(this.status13,11))},vel:function(){return p(s(this.status10,3))},no_att:function(){return h(s(this.status10,4))},alt:function(){return p(s(this.status10,5))},gimball_lock:function(){return p(s(this.status10,6))},tracker:function(){return p(s(this.status10,8))},prog:function(){return p(s(this.status10,9))},r1:function(){return this.digits.slice(6,12).replace(/H/g,b)},r2:function(){return this.digits.slice(12,18).replace(/H/g,b)},prog00:function(){return this.digits.slice(0,2).replace(/H/g,b)},r3:function(){return this.digits.slice(18,24).replace(/H/g,b)},verb00:function(){return s(this.status11,6)&&!this.flash_flag?b+b:this.digits.slice(2,4).replace(/H/g,b)},noun00:function(){return s(this.status11,6)&&!this.flash_flag?b+b:this.digits.slice(4,6).replace(/H/g,b)}},events:{onKey:function(e){const t=$(this).text();let s=a[t];null==s&&(s=parseInt(t)),e.stopPropagation(),n.trigger("key",{val:s})}}});this.processLights=function(n){v.setData({lamps:n})},this.setData=function(n){v.setData(n)},this.process=function(n,e){if(8==n&&0==e)return;if(9==n)return void v.setData({status11:e});if(11==n)return void v.setData({status13:e});const t=e>>11,a=e>>10&1,s=i(e>>5&31),b=i(31&e),p=v.model.digits.split("");switch(t){case 12:v.setData({status10:e});break;case 11:p[0]=s,p[1]=b;break;case 10:p[2]=s,p[3]=b;break;case 9:p[4]=s,p[5]=b;break;case 8:p[7]=b;break;case 7:p[8]=s,p[9]=b,l=a;break;case 6:p[10]=s,p[11]=b,c=a;break;case 5:p[13]=s,p[14]=b,o=a;break;case 4:p[15]=s,p[16]=b,r=a;break;case 3:p[17]=s,p[19]=b;break;case 2:p[20]=s,p[21]=b,d=a;break;case 1:p[22]=s,p[23]=b,u=a}if(12!=t){p[6]=l&&!c?"+":l||c?"-":"H",p[12]=o&&!r?"+":o||r?"-":"H",p[18]=d&&!u?"+":d||u?"-":"H";const n=p.join("");v.setData({digits:n})}}}}),$$.control.registerControl("FDAI",{template:'<svg width="350" height="360" bn-bind="svg">\n    <defs>\n      <marker id="triangle" viewBox="0 0 10 10"\n            refX="1" refY="5"\n            markerUnits="strokeWidth"\n            markerWidth="10" markerHeight="10"\n            orient="auto">\n        <path d="M 0 0 L 10 5 L 0 10 z" fill="black"/>\n      </marker>\n      <marker id="triangle2" viewBox="0 0 16 16"\n            refX="1" refY="8"\n            markerUnits="strokeWidth"\n            markerWidth="16" markerHeight="16"\n            orient="auto">\n        <path d="M 0 0 L 16 8 L 0 16 z" fill="black"/>\n      </marker>\n  \n  </defs>\n    \n  </svg>',deps:["breizbot.pager"],props:{},init:function(n,e){const t=$$.viewController(n,{data:{},events:{}}).scope.svg.get(0),a=150,s=180,i=180/Math.PI,l=Math.PI/180,c=42.1875/384;function o(n,e){Object.keys(e).forEach(t=>{n.setAttribute(t,e[t])})}function r(n,e){const a=document.createElementNS("http://www.w3.org/2000/svg",n);return"object"==typeof e&&o(a,e),t.appendChild(a),a}function d(n,e,t,a,s,i){return r("line",Object.assign({x1:n,y1:e,x2:t,y2:a,stroke:s},i))}function u(n,e,t,a,s){const i=r("text",Object.assign({x:n,y:e,fill:a},s));return i.textContent=t,i}function b(n,e,t,a,s){return r("circle",Object.assign({r:t,cx:n,cy:e,fill:a},s))}const p={};function h(n,e){o(p[n],{x1:e,x2:e})}function v(n,e){o(p[n],{y1:e,y2:e})}function f(n,e,t,a,s){o(p[n],{x1:e,y1:t,x2:a,y2:s})}function _(n,e,t){o(p[n],{x:e,y:t})}function g(n,e,t,a,s,i){const l=a*Math.PI/180;return d(n+t*Math.sin(l),e+t*Math.cos(l),n+(t+=s)*Math.sin(l),e+t*Math.cos(l),i)}for(let n=-270;n<=270;n+=30){const e=n>=-180&&n<=0||n>=180&&n<=360?"black":"white";p[`PITCH_${n}`]=d(0,0,0,0,e);const t=n<0?n+360:n;p[`PITCH_TXT_${n}`]=u(0,0,t,e)}p.zAxisLM=d(0,0,0,0,"blue");for(let n=-270;n<=270;n+=30){p[`zAxis_${n}`]=d(0,0,0,0,"blue");const e=n<0?n+360:n;p[`zAxis_TXT_${n}`]=u(0,0,e,"blue")}p.RollMarker=d(0,0,0,0,"black",{"marker-end":"url(#triangle2)"}),p.YawErrorNeedle=d(0,s+10,0,s+100,"orange"),p.PitchErrorNeedle=d(a+10,0,a+100,0,"orange"),p.RollErrorNeedle=d(0,s-10,0,s-100,"orange"),b(a,s,190,"none",{stroke:"darkgrey","stroke-width":180});for(let n=70;n<110;n+=.5)g(a,s,100,n,10,"red");for(let n=250;n<290;n+=.5)g(a,s,100,n,10,"red");for(let n=0;n<360;n+=10){g(a,s,100,n,n%30==0?10:15,"white")}b(a,s,100,"none",{stroke:"black","stroke-width":4}),d(a-10,s,a+10,s,"white"),d(a,s-10,a,s+10,"white");for(let n=-5;n<=5;n++)d(a+10*n,310,a+10*n,315,"white");p.YawRateMarker=d(0,325,0,324,"black",{"marker-end":"url(#triangle)"}),u(a,310,"0","white"),u(a,340,"YAW RATE","white"),p.RollRateMarker=d(0,36,0,37,"black",{"marker-end":"url(#triangle)"}),u(a,62,"0","white"),u(a,30,"ROLL RATE","white");for(let n=-5;n<=5;n++)d(a+10*n,45,a+10*n,50,"white");for(let n=-5;n<=5;n++)d(280,s+10*n,285,s+10*n,"white");function E(n){const e=2*Math.PI;return n<-e?n+e:n>=e?n-e:n}function k(n,e,t){return Math.max(Math.min(t,n),e)}function T(e,t,o){const[r,d,u]=o,b=e[0]*l,p=e[1]*l,g=e[2]*l,[T,A,y]=t,D=Math.sin(b),C=Math.sin(p),R=Math.sin(g),S=Math.cos(b),M=Math.cos(p),w=Math.cos(g),N=R,m=w*S,x=M*R*D+C*S,I=-w*D,L=-C*R*D+M*S,P=E(Math.atan2(N,m)),O=E(Math.atan2(x,L)),U=E(Math.asin(I)),F=P,G=Math.sin(-1*F),B=Math.cos(-1*F),H=-1*U*i,K=O*i,$=P*i,Q=H>0?360-H:Math.abs(H),Y=K<0?K+360:K,X=$<0?$+360:$;n.trigger("data",{euler:[Q,Y,X]}),h("YawRateMarker",a-10*k(r,-5,5)),v("PitchRateMarker",s-10*k(d,-5,5)),h("RollRateMarker",a+10*k(u,-5,5)),h("YawErrorNeedle",a+T*c),v("PitchErrorNeedle",s+A*c),h("RollErrorNeedle",a-y*c);const j=a+85*Math.sin(F+Math.PI),W=a+86*Math.sin(F+Math.PI);function z(n,e){return{x:n*B-e*G+a,y:n*G+e*B+s}}f("RollMarker",j,s+85*Math.cos(F+Math.PI),W,s+86*Math.cos(F+Math.PI));const V=K>180?K-180:K;for(let n=-270;n<=270;n+=30){const e=-50,t=50,a=-n+V,s=0,i=a,{x:l,y:c}=z(s,i),{x:o,y:r}=z(e,a),{x:d,y:u}=z(t,a);_(`PITCH_TXT_${n}`,l,c),f(`PITCH_${n}`,o,r,d,u)}const Z=H>180?H-360:H,q=-280+Z,J=280+Z,{x:nn,y:en}=z(q,0),{x:tn,y:an}=z(J,0);f("zAxisLM",nn,en,tn,an);for(let n=-270;n<=270;n+=30){const e=n+Z,t=-2,a=n+Z,s=3,i=n+Z,l=10,{x:c,y:o}=z(i,l),{x:r,y:d}=z(e,t),{x:u,y:b}=z(a,s);_(`zAxis_TXT_${n}`,c,o),f(`zAxis_${n}`,r,d,u,b)}}p.PitchRateMarker=d(296,0,295,0,"black",{"marker-end":"url(#triangle)"}),u(a+128-5,s,"0","white",{"alignment-baseline":"middle"}),u(a+155,s-30,"P","white"),u(a+155,s-22,"I","white"),u(a+155,s-14,"T","white"),u(a+155,s-6,"C","white"),u(a+155,s+2,"H","white"),u(a+155,s+18,"R","white"),u(a+155,s+26,"A","white"),u(a+155,s+34,"T","white"),u(a+155,s+42,"E","white"),T([0,0,0],[0,0,0],[0,0,0]),this.update=T}}),$$.control.registerControl("INPUT",{template:'<div bn-event="click.check: onCheckbox">\n    <div>\n        <fieldset>\n            <legend>ENGINE</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 3}" class="check" checked>\n                <label>ENGINE ARMES SIGNAL</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 5}" class="check">\n                <label>AUTO THROTTLE<br>COMPUTER CONTROL OF DESCENT</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 9}" class="check">\n                <label>DESCENT ENGINE<br>DISABLED BY CREW</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 10}" class="check">\n                <label>APPARENT DESCENT ENGINE<br>GIMBAL FAILURE</label>\n            </div>\n        </fieldset>\n        <fieldset>\n            <legend>THRUSTERS</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 1}" class="check">\n                <label>THRUSTERS 2&4 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 2}" class="check">\n                <label>THRUSTERS 5&8 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 3}" class="check">\n                <label>THRUSTERS 1&3 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 4}" class="check">\n                <label>THRUSTERS 6&7 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 5}" class="check">\n                <label>THRUSTERS 14&16 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 6}" class="check">\n                <label>THRUSTERS 13&15 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 7}" class="check">\n                <label>THRUSTERS 9&12 DISABLED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 32, bit: 8}" class="check">\n                <label>THRUSTERS 10&11 DISABLED</label>\n            </div>\n        </fieldset>\n    </div>\n    <div>\n        <fieldset>\n            <legend>RADAR</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 33, bit: 2}" class="check">\n                <label>RR AUTO-POWER ON</label>\n            </div>\n        </fieldset>\n        <fieldset>\n            <legend>IMU</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 14}" class="check">\n                <label>ISS TURN ON REQUESTED</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 11}" class="check">\n                <label>IMU CAGE COMMAND TO DRIVE<br>IMU GIMBAL ANGLES TO 0</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 6}" class="check" checked>\n                <label>DISPLAY INERTIAL DATA</label>\n            </div>\n        </fieldset>\n        <fieldset>\n            <legend>DAP/ATTITUDE MODE</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 30, bit: 10}" class="check" checked>\n                <label>AGC HAS CONTROL OF LM<br>(NOT AGS)</label>\n            </div>\n            <div bn-control="brainjs.radiogroup" bn-event="change: onDapModeChange" bn-val="DAP_MODE">\n                <div class="data">\n                    <input type="radio" value="OFF">\n                    <label>DAP OFF</label>\n                </div>\n                <div class="data">\n                    <input type="radio" value="HOLD">\n                    <label>ATTITUDE HOLD MODE ON</label>\n                </div>\n                <div class="data">\n                    <input type="radio" value="AUTO">\n                    <label>AUTO STABILIZATION<br>OF ATTITUDE ON</label>\n                </div>\n\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>AOT BUTTONS</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 3}" class="check">\n                <label>X-AXIS MARK</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 4}" class="check">\n                <label>Y-AXIS MARK</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 5}" class="check">\n                <label>MARK REJECT</label>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>DESCENT CONTROL</legend>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 6}" class="check">\n                <label>DESCENT+</label>\n            </div>\n            <div class="data">\n                <input type="checkbox" bn-data="{channel: 16, bit: 7}" class="check">\n                <label>DESCENT-</label>\n            </div>\n        </fieldset>\n    </div>\n\n    <div>\n        <fieldset>\n            <legend>RHC/ACA</legend>\n            <div class="slider">\n                <div class="sliderValue">\n                    <label>Roll</label>\n                    <span bn-text="roll"></span>\n                </div>\n                <div bn-control="brainjs.slider" bn-data="rhcRange" bn-update="input" bn-val="roll" bn-event="input: onRollChange"></div>\n            </div>\n            <div class="slider">\n                <div class="sliderValue">\n                    <label>Pitch</label>\n                    <span bn-text="pitch"></span>\n                </div>\n                <div bn-control="brainjs.slider" bn-data="rhcRange" bn-update="input" bn-val="pitch" bn-event="input: onPitchChange"></div>\n            </div>\n            <div class="slider">\n                <div class="sliderValue">\n                    <label>Yaw</label>\n                    <span bn-text="yaw"></span>\n                </div>\n                <div bn-control="brainjs.slider" bn-data="rhcRange" bn-update="input" bn-val="yaw" bn-event="input: onYawChange"></div>\n            </div>\n            <div>\n                <button bn-event="click: onDetent">DETENT</button>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend>THC</legend>\n            <div bn-control="brainjs.radiogroup" class="THC" bn-event="change: onThcChange" bn-val="THC">\n                <div class="data">\n                    <input type="radio" value="NEUTRAL">\n                    <label>NEUTRAL</label>\n                </div>\n                <div class="XYZ">\n                    <div>\n                        <div class="data">\n                            <input type="radio" value="+X">\n                            <label>+X</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio" value="+Y">\n                            <label>+Y</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio" value="+Z">\n                            <label>+Z</label>\n                        </div>\n                    </div>\n                    <div>\n                        <div class="data">\n                            <input type="radio" value="-X">\n                            <label>-X</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio" value="-Y">\n                            <label>-Y</label>\n                        </div>\n                        <div class="data">\n                            <input type="radio" value="-Z">\n                            <label>-Z</label>\n                        </div>\n                    </div>\n\n                </div>\n\n            </div>\n        </fieldset>\n    </div>\n</div>',deps:["breizbot.gamepad","app.emuAgc"],props:{},init:function(n,e,t){function a(){const n=e.getGamepads()[0];if(n){const{axes:e}=n,t=Math.ceil(57*e[0]),i=Math.ceil(57*e[1]);s.setData({roll:t,pitch:i}),setTimeout(a,50)}}e.on("connected",n=>{console.log("connected",n),a()});const s=$$.viewController(n,{data:{roll:0,pitch:0,yaw:0,rhcRange:{min:-57,max:57},DAP_MODE:"OFF",THC:"NEUTRAL"},events:{onDetent:function(n){s.setData({roll:0,pitch:0,yaw:0}),t.writeIo(118,0),t.writeIo(119,0),t.writeIo(120,0),t.writeIoBit(25,15,1),l()},onCheckbox:function(){const n=$(this),{channel:e,bit:a}=n.data(),s=parseInt(e,8);t.writeIoBit(s,a,n.getValue()?0:1)},onDapModeChange:function(n){const e=$(this).getValue();switch(console.log("onDapModeChange",e),e){case"OFF":t.writeIoBits(25,{13:1,14:1});break;case"HOLD":t.writeIoBits(25,{13:0,14:1});break;case"AUTO":t.writeIoBits(25,{13:1,14:0})}},onThcChange:function(){const n=$(this).getValue();switch(console.log("onThcChange",n),n){case"NEUTRAL":t.writeIoBits(25,{7:1,8:1,9:1,10:1,11:1,12:1});break;case"+X":t.writeIoBits(25,{7:0,8:1,9:1,10:1,11:1,12:1});break;case"-X":t.writeIoBits(25,{7:1,8:0,9:1,10:1,11:1,12:1});break;case"+Y":t.writeIoBits(25,{7:1,8:1,9:0,10:1,11:1,12:1});break;case"-Y":t.writeIoBits(25,{7:1,8:1,9:1,10:0,11:1,12:1});break;case"+Z":t.writeIoBits(25,{7:1,8:1,9:1,10:1,11:0,12:1});break;case"-Z":t.writeIoBits(25,{7:1,8:1,9:1,10:1,11:1,12:0})}},onRollChange:function(){console.log("onRollChange",s.model.roll),i(s.model.roll,120,5,6)},onPitchChange:function(){console.log("onPitchChange",s.model.pitch),i(s.model.pitch,118,1,2)},onYawChange:function(){console.log("onYawChange",s.model.yaw),i(s.model.yaw,119,3,4)}}});function i(n,e,a,i){const c=t.getChannelBitState(25,15);let o={};n<0?(1==c&&(o[a]=1,o[i]=0,setTimeout(l,100)),o[15]=0,n=32767^-n):n>0&&(1==c&&(o[a]=0,o[i]=1,setTimeout(l,100)),o[15]=0),t.writeIoBits(25,o),t.writeIo(e,n);const{roll:r,pitch:d,yaw:u}=s.model;0==r&&0==d&&0==u&&0==c&&t.writeIoBit(25,15,1)}function l(){console.log("reset_rhc"),t.writeIoBits(25,{1:1,2:1,3:1,4:1,5:1,6:1})}}}),$$.control.registerControl("OUTPUT",{template:'<div>\n    <fieldset>\n        <legend>RCS JET CONTROL</legend>\n        <div>\n            <div class="quad">\n                <label>QUAD 1</label>\n                    <span bn-style="Q1D" class="one">D</span>\n                    <span bn-style="Q1F" class="two">F</span>\n                    <span bn-style="Q1L" class="three">L</span>\n                    <span bn-style="Q1U" class="four">U</span>\n            </div>\n            <div class="quad">\n                <label>QUAD 4</label>\n                    <span bn-style="Q4F" class="one">F</span>\n                    <span bn-style="Q4D" class="two">D</span>\n                    <span bn-style="Q4U" class="three">U</span>\n                    <span bn-style="Q4R" class="four">R</span>\n            </div>    \n        </div>\n        <div>\n            <div class="quad">\n                <label>QUAD 2</label>\n                    <span bn-style="Q2L" class="one">L</span>\n                    <span bn-style="Q2U" class="two">U</span>\n                    <span bn-style="Q2D" class="three">D</span>\n                    <span bn-style="Q2A" class="four">A</span>\n            </div>\n            <div class="quad">\n                <label>QUAD 3</label>\n                    <span bn-style="Q3U" class="one">U</span>\n                    <span bn-style="Q3R" class="two">R</span>\n                    <span bn-style="Q3A" class="three">A</span>\n                    <span bn-style="Q3D" class="four">D</span>\n            </div>    \n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend>CDU</legend>\n        <div class="field">\n            <span bn-style="CDUZ">DRIVE CDU Z</span>\n            <span bn-style="CDUY">DRIVE CDU Y</span>\n            <span bn-style="CDUX">DRIVE CDU X</span>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend>HAND CONTROLLER</legend>\n        <div class="field">\n            <span bn-style="RHC_COUNTER_EANBLE">RHC COUNTER ENABLE</span>\n            <span bn-style="START_RHC_READ">START RHC READ</span>\n        </div>\n    </fieldset>\n</div>',deps:["app.emuAgc"],props:{},init:function(n,e){const t=e.bit;function a(n){return{"background-color":n?"#ffffff":"transparent"}}const s=$$.viewController(n,{data:{channel5:0,channel6:0,channel14:0,channel13:0,CDUZ:function(){return a(t(this.channel14,13))},CDUY:function(){return a(t(this.channel14,14))},CDUX:function(){return a(t(this.channel14,15))},Q4U:function(){return a(t(this.channel5,1))},Q4D:function(){return a(t(this.channel5,2))},Q3U:function(){return a(t(this.channel5,3))},Q3D:function(){return a(t(this.channel5,4))},Q2U:function(){return a(t(this.channel5,5))},Q2D:function(){return a(t(this.channel5,6))},Q1U:function(){return a(t(this.channel5,7))},Q1D:function(){return a(t(this.channel5,8))},Q3A:function(){return a(t(this.channel6,1))},Q4F:function(){return a(t(this.channel6,2))},Q1F:function(){return a(t(this.channel6,3))},Q2A:function(){return a(t(this.channel6,4))},Q2L:function(){return a(t(this.channel6,5))},Q3R:function(){return a(t(this.channel6,6))},Q4R:function(){return a(t(this.channel6,7))},Q1L:function(){return a(t(this.channel6,8))},RHC_COUNTER_EANBLE:function(){return a(t(this.channel13,8))},START_RHC_READ:function(){return a(t(this.channel13,9))}},events:{}});this.update=function(){s.setData({channel5:e.getChannelState(5),channel6:e.getChannelState(6),channel13:e.getChannelState(11),channel14:e.getChannelState(12)})}}}),$$.control.registerControl("SIMU",{template:'<div>\n    <fieldset>\n        <div class="data">\n            <label>SIMULATION TIME:</label>\n            <div>\n                <span bn-text="Simulation_Timer_text"></span>\n                <span class="unit">SEC</span>    \n            </div>\n        </div>\n        <div class="data">\n            <label>LM WEIGHT:</label>\n            <div>\n                <span bn-text="LM_Weight_KG_text"></span>\n                <span class="unit">KG</span>    \n            </div>\n        </div>\n\n    </fieldset>\n    <fieldset>\n        <legend>DESCENT</legend>\n        <div class="data">\n            <label>THRUST:</label>\n            <div>\n                <span bn-text="Descent_Thrust_Procent_text"></span>\n                <span class="unit"></span>\n            </div>\n        </div>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="Descent_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>FUEL FLOW:</label>\n            <div>\n                <span bn-text="Descent_Fuel_Flow_SEC_text"></span>\n                <span class="unit">KG/S</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>ACCELERATION:</label>\n            <div>\n                <span bn-text="Descent_Acceleration_text"></span>\n                <span class="unit">M/S²</span>\n            </div>\n        </div>\n        <div bn-show="!isSeparated">\n            <div>\n                <input type="checkbox" bn-val="DESCENT_ENGINE_FLAG" bn-update="click">\n                <label>ENGINE ON/OFF</label>\n            </div>\n            <div class="data">\n                <label>Thrust</label>\n                <div>\n                    <span bn-text="Descent_Propulsion_N"></span>\n                    <span class="unit">N</span>\n                </div>\n            </div>\n            <div bn-control="brainjs.slider" bn-data="{min: Descent_Propulsion_Min_N, max: Descent_Propulsion_Max_N }"\n                bn-update="input" bn-val="Descent_Propulsion_N"></div>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>Stage</legend>\n        <button bn-event="click: onSeperateStage" bn-prop="{disabled: isSeparated}">SEPARATE STAGE</button>\n    </fieldset>\n    <fieldset>\n        <legend>ASCENT</legend>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="Ascent_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>FUEL FLOW:</label>\n            <div>\n                <span bn-text="Ascent_Fuel_Flow_SEC_text"></span>\n                <span class="unit">KG/S</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>ACCELERATION:</label>\n            <div>\n                <span bn-text="Ascent_Acceleration_text"></span>\n                <span class="unit">M/S²</span>\n            </div>\n        </div>\n        <div bn-show="isSeparated">\n            <input type="checkbox" bn-val="ASCENT_ENGINE_FLAG" bn-update="click">\n            <label>ENGINE ON/OFF</label>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>RCS</legend>\n        <div class="data">\n            <label>PROPELLANT:</label>\n            <div>\n                <span bn-text="RCS_Propellant_Mass_KG_text"></span>\n                <span class="unit">KG</span>\n            </div>\n        </div>\n\n    </fieldset>\n    <fieldset>\n        <legend>EULER ANGLE</legend>\n        <div class="data">\n            <label>YAW:</label>\n            <div>\n                <span bn-text="yaw"></span>\n                <span class="unit">°</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>PITCH:</label>\n            <div>\n                <span bn-text="pitch"></span>\n                <span class="unit">°</span>\n            </div>\n        </div>\n        <div class="data">\n            <label>ROLL:</label>\n            <div>\n                <span bn-text="roll"></span>\n                <span class="unit">°</span>\n            </div>\n        </div>\n    </fieldset>\n\n</div>',props:{},init:function(n){const e=Math.PI,t=180/e*(e/4),a=Math.abs;let s=0,i=4670,l=10694,c=287,o=445,r=2840,d=8355,u=45040,b=3050,p=4560,h=0,v=0,f=0,_=!1,g=2353,E=15600,k=3050,T=0,A=0,y=!1,D="DESCENT",C=0,R=0,S=0,M=0,w=0,N=0;const m={ASCENT:{a:[.0065443852,.0035784354,.0056946631],b:[32e-6,.162862,.009312],c:[-.006923,.002588,-.023608]},DESCENT:{a:[.0059347674,.0014979264,.0010451889],b:[.002989,.018791,.021345],c:[.008721,-.068163,-.066027]}},x=$$.viewController(n,{data:{Simulation_Timer:0,Descent_Thrust_Procent:v,LM_Weight_KG:s,Descent_Propellant_Mass_KG:d,Descent_Fuel_Flow_SEC:h,Descent_Acceleration:f,RCS_Propellant_Mass_KG:c,Ascent_Propellant_Mass_KG:g,Ascent_Fuel_Flow_SEC:T,Ascent_Acceleration:A,Descent_Propulsion_Min_N:4560,Descent_Propulsion_Max_N:u,Descent_Propulsion_N:p,DESCENT_ENGINE_FLAG:_,ASCENT_ENGINE_FLAG:y,LM_CONFIG:D,euler:[0,0,0],yaw:function(){return this.euler[0].toFixed(2)},pitch:function(){return this.euler[1].toFixed(2)},roll:function(){return this.euler[2].toFixed(2)},Simulation_Timer_text:function(){return this.Simulation_Timer.toFixed(1)},Descent_Thrust_Procent_text:function(){return this.Descent_Thrust_Procent.toFixed(1)},LM_Weight_KG_text:function(){return this.LM_Weight_KG.toFixed(0)},Descent_Propellant_Mass_KG_text:function(){return this.Descent_Propellant_Mass_KG.toFixed(0)},Descent_Fuel_Flow_SEC_text:function(){return this.Descent_Fuel_Flow_SEC.toFixed(2)},Descent_Acceleration_text:function(){return this.Descent_Acceleration.toFixed(3)},RCS_Propellant_Mass_KG_text:function(){return this.RCS_Propellant_Mass_KG.toFixed(1)},Ascent_Propellant_Mass_KG_text:function(){return this.Ascent_Propellant_Mass_KG.toFixed(0)},Ascent_Fuel_Flow_SEC_text:function(){return this.Ascent_Fuel_Flow_SEC.toFixed(1)},Ascent_Acceleration_text:function(){return this.Ascent_Acceleration.toFixed(3)},isSeparated:function(){return"ASCENT"==this.LM_CONFIG}},events:{onSeperateStage:function(){console.log("onSeperateStage"),D="ASCENT",d=0,l=0,x.setData({LM_CONFIG:D,Descent_Propellant_Mass_KG:d,LM_Weight_Descent_KG:l})}}});function I(e,t,a){n.trigger("data",{accelerate:[e,t,a]})}window.simu=x,this.dynamic_simulation=function(e){if(s=i+l,x.setData({Descent_Thrust_Procent:v,LM_Weight_KG:s,Descent_Propellant_Mass_KG:d,Descent_Fuel_Flow_SEC:h,Descent_Acceleration:f,RCS_Propellant_Mass_KG:c,Ascent_Propellant_Mass_KG:g,Ascent_Fuel_Flow_SEC:T,Ascent_Acceleration:A}),_=x.model.DESCENT_ENGINE_FLAG,y=x.model.ASCENT_ENGINE_FLAG,p=x.model.Descent_Propulsion_N,v=p/u,_&&d>0){const n=(h=p/b)*e;d-=n,l-=n,I((f=p/s)*e,0,0)}else _=!1,f=0,h=0;if(y&&g>0){const n=(T=E/k)*e;g-=n,I((A=E/(i-=n))*e,0,0)}else y=!1,A=0,T=0;const a=s/65535,[o,r,L]=m[D].a,[P,O,U]=m[D].b,[F,G,B]=m[D].c;var H,K,$;C=t*(P+o/(a+F)),R=t*(O+r/(a+G)),S=t*(U+L/(a+B)),H=N*e,K=w*e,$=M*e,n.trigger("data",{rotate:[H,K,$]})},this.update_RCS=function(e,t){const[l,d,u,b,p,h,v,f,_,g,E,k,T,A,y,D]=e,m=1==h||1==l?h+l:0,x=1==p||1==d?-(p+d):0,L=1==f||1==u?f+u:0,P=1==v||1==b?-(v+b):0,O=1==E||1==T||1==_||1==y?E+T+_+y:0,U=1==D||1==k||1==A||1==g?-(D+k+A+g):0,F=m+x,G=L+P,B=O+U;let H=0;0!=m&&m+x==0&&(H=1==h?h+d:-(p+l)),0!=L&&L+P==0&&(1==f?H+=f+b:H-=v+u),0!=H&&I(t*H*o/s,0,0);0!=O&&O+U==0&&(1==D&&I(0,2*t*o/s,0),1==A&&I(0,2*-t*o/s,0),1==k&&I(0,0,2*t*o/s),1==E&&I(0,0,2*-t*o/s));if(c>0){N+=C*t*B,w+=R*t*(G-F),M+=S*t*(G+F),n.trigger("data",{omega:[N,w,M]});const e=(a(m)+a(x)+a(L)+a(P)+a(O)+a(U))*o/r*t;i-=e,c-=e}},this.setData=function(n){x.setData(n)}}});