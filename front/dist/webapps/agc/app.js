$$.control.registerControl("rootPage",{template:'<div>\n    <div bn-control="DSKY" bn-event="key: onKey" bn-iface="dsky"></div>\n</div>',deps:["breizbot.files","app.emuAgc"],props:{},init:function(t,n,s){const e=$$.viewController(t,{data:{},events:{onKey:function(t,n){const{val:e}=n;isNaN(e)||s.writeIo(13,e)}}}).scope.dsky;let a=0;!async function(){await s.loadRom(n.assetsUrl("Comanche055.bin")),s.reset(),s.on("channelUpdate",t=>{const{channel:n,value:s}=t;switch(n){case 8:case 9:case 11:e.process(n,s)}}),s.on("lightsUpdate",t=>{e.processLights(t)}),s.start(),setInterval(function(){e.tick(),a+=.1,s.loop()},1e3/60)}()}}),$$.control.registerControl("DSKY",{template:'\n<div class="top">\n    <div class="left">\n        <div class="col">\n            <div bn-style="uplink_acty"><span>UPLINK ACTY</span></div>\n            <div bn-style="no_att">NO ATT</div>\n            <div bn-style="stby">STBY</div>\n            <div bn-style="key_rel">KEY REL</div>\n            <div bn-style="opr_err">OPR ERR</div>\n            <div></div>\n            <div></div>\n        </div>\n\n        <div class="col">\n            <div bn-style="temp">TEMP</div>\n            <div bn-style="gimball_lock"><span>GIMBALL LOCK</span></div>\n            <div bn-style="prog">PROG</div>\n            <div>RESTART</div>\n            <div bn-style="tracker">TRACKER</div>\n            <div bn-style="alt">ALT</div>\n            <div bn-style="vel">VEL</div>\n        </div>\n\n    \n    </div>\n    \n    \n    <div class="right">\n        <div class="line">\n            <div class="compActy" bn-style="comp_acty"><span>COMP ACTY</span></div>\n            <div>\n                <div class="label">PROG</div>\n                <div class="digit" bn-html="prog00"></div>\n            </div>\n    \n        </div>\n        <div class="line">\n            <div>\n                <div class="label">VERB</div>\n                <div class="digit" bn-html="verb00"></div>\n            </div>\n            <div>\n                <div class="label">NOUN</div>\n                <div class="digit" bn-html="noun00"></div>\n            </div>\n        </div>\n        <div class="digit big" bn-html="r1"></div>\n        <div class="digit big" bn-html="r2"></div>\n        <div class="digit big" bn-html="r3"></div>\n    \n    </div>\n</div>\n\n<div class="bottom">\n    <div class="keyboard" bn-event="click.key: onKey">\n        <div>\n            <button class="label key">VERB</button>\n            <button class="label key">NOUN</button>\n        </div>\n        <div>\n            <button class="key">+</button>\n            <button class="key">-</button>\n            <button class="key">0</button>\n        </div>\n        <div>\n            <button class="key">1</button>\n            <button class="key">4</button>\n            <button class="key">7</button>\n        </div>\n        <div>\n            <button class="key">8</button>\n            <button class="key">5</button>\n            <button class="key">2</button>\n        </div>\n        <div>\n            <button class="key">9</button>\n            <button class="key">6</button>\n            <button class="key">3</button>\n        </div>\n        <div>\n            <button class="label key">CLR</button>\n            <button class="label key">PRO</button>\n            <button class="label key">KEY REL</button>\n        </div>\n        <div>\n            <button class="label key">ENTR</button>\n            <button class="label key">RSET</button>\n        </div>\n    \n    </div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(t,n,s){var e=Math.floor,a=Math.round;const i={VERB:17,NOUN:31,"+":26,"-":27,0:16,CLR:30,"KEY REL":25,ENTR:28,RSET:18};function l(t){var n="E";switch(t){case 0:n="H";break;case 21:n="0";break;case 3:n="1";break;case 25:n="2";break;case 27:n="3";break;case 15:n="4";break;case 30:n="5";break;case 28:n="6";break;case 19:n="7";break;case 29:n="8";break;case 31:n="9"}return n}let o=0,c=0,r=0,u=0,d=0,b=0;const v="&nbsp;";let p=0;function k(t){return{"background-color":t?"#ffc200":"#888888"}}function m(t){return{"background-color":t?"#ffffff":"#888888"}}const f=$$.viewController(t,{data:{lamps:0,status8:0,digits:"000000+00000+00000+00000",on:0,comp_acty:function(){return k(this.lamps&s.lampMask.COMP_ACTY)},uplink_acty:function(){return m(this.lamps&s.lampMask.UPLINK_ACTY)},temp:function(){return k(this.lamps&s.lampMask.TEMP)},key_rel:function(){return m(this.lamps&s.lampMask.KEY_REL)},opr_err:function(){return m(this.lamps&s.lampMask.OPER_ERR)},stby:function(){return m(this.lamps&s.lampMask.STBY)},vel:function(){return k(this.status8&s.statusMask.VEL)},no_att:function(){return m(this.status8&s.statusMask.NOT_ATT)},alt:function(){return k(this.status8&s.statusMask.ALT)},gimball_lock:function(){return k(this.status8&s.statusMask.GIMBAL_LOCK)},tracker:function(){return k(this.status8&s.statusMask.TRACKER)},prog:function(){return k(this.status8&s.statusMask.PROG)},r1:function(){return this.digits.slice(6,12).replace(/H/g,v)},r2:function(){return this.digits.slice(12,18).replace(/H/g,v)},prog00:function(){return this.digits.slice(0,2).replace(/H/g,v)},r3:function(){return this.digits.slice(18,24).replace(/H/g,v)},verb00:function(){return this.lamps&s.lampMask.VERB_NOUN?v+v:this.digits.slice(2,4).replace(/H/g,v)},noun00:function(){return this.lamps&s.lampMask.VERB_NOUN?v+v:this.digits.slice(4,6).replace(/H/g,v)}},events:{onKey:function(n){const s=$(this).text();let e=i[s];null==e&&(e=parseInt(s)),n.stopPropagation(),t.trigger("key",{val:e})}}});this.tick=function(t){var n,s,i,l,o;return p%10==0&&(s=a(p/10),n=((i=e(s/3600))<10?"0"+i:i)+":"+((l=e(s/60)%60)<10?"0"+l:l)+":"+((o=s%60)<10?"0"+o:o),$("#st").html(n)),p++},this.processLights=function(t){f.setData({lamps:t})},this.process=function(t,n){if(0!=n&&8==t){const t=n>>11,s=n>>10&1,e=l(n>>5&31),a=l(31&n),i=f.model.digits.split("");switch(t){case 12:f.setData({status8:n});break;case 11:i[0]=e,i[1]=a;break;case 10:i[2]=e,i[3]=a;break;case 9:i[4]=e,i[5]=a;break;case 8:i[7]=a;break;case 7:i[8]=e,i[9]=a,o=s;break;case 6:i[10]=e,i[11]=a,c=s;break;case 5:i[13]=e,i[14]=a,r=s;break;case 4:i[15]=e,i[16]=a,u=s;break;case 3:i[17]=e,i[19]=a;break;case 2:i[20]=e,i[21]=a,d=s;break;case 1:i[22]=e,i[23]=a,b=s}if(12!=t){i[6]=o&&!c?"+":o||c?"-":"H",i[12]=r&&!u?"+":r||u?"-":"H",i[18]=d&&!b?"+":d||b?"-":"H";const t=i.join("");f.setData({digits:t})}}}}}),$$.service.registerService("app.emuAgc",{deps:["breizbot.files"],init:function(t){const n=Module.cwrap("set_fixed",null,["number"]),s=Module.cwrap("cpu_reset"),e=Module.cwrap("cpu_step",null,["number"]),a=Module.cwrap("packet_read","number"),i=Module.cwrap("packet_write",null,["number","number"]),l=new EventEmitter2,o=.01172,c={channels:{},lamps:0};let r=0,u=0;function d(){const t=a();return[t>>16,65535&t]}function b(t){return 1<<t-1}const v={COMP_ACTY:b(2),UPLINK_ACTY:b(3),TEMP:b(4),KEY_REL:b(5),VERB_NOUN:b(6),OPER_ERR:b(7),RESTART:b(8),STBY:b(9)},p={PRIO_DISP:b(1),NO_DAP:b(2),VEL:b(3),NOT_ATT:b(4),ALT:b(5),GIMBAL_LOCK:b(6),TRACKER:b(8),PROG:b(9)};return{writeIo:i,readIo:d,loadRom:async function(t){const s=await fetch(t),e=await s.arrayBuffer(),a=new Uint8Array(e);console.log("romArray",a.length);const i=Module._malloc(a.length*a.BYTES_PER_ELEMENT);console.log("romPtr",i),Module.HEAP8.set(a,i),n(i),Module._free(i)},reset:s,stepCpu:e,on:l.on.bind(l),start:function(){r=performance.now(),u=0},loop:function(){const t=Math.floor((performance.now()-r)/o)-u;if(t<0||t>1e5)return r=performance.now(),void(u=0);e(t),u+=t,function(){let t,n;do{[t,n]=d();const s=c.channels[t];if(s!=n&&(c.channels[t]=n,l.emit("channelUpdate",{channel:t,value:n})),9===t){const t=6;c.lamps=c.lamps&~t>>>0|n&t,l.emit("lightsUpdate",c.lamps)}else if(115===t){const t=504;c.lamps=c.lamps&~t>>>0|n&t,l.emit("lightsUpdate",c.lamps)}}while(t||n)}()},lampMask:v,statusMask:p}}});