$$.control.registerControl("rootPage",{template:'<div>\n    <div bn-control="DSKY" bn-event="key: onKey" bn-iface="dsky"></div>\n</div>\n\n<div>\n    <div bn-control="IMU" bn-iface="imu" bn-event="launch: onLaunch"></div>\n\n</div>\n\n<div>\n    <div bn-control="SIMU" bn-iface="simu" bn-event="pipaXYZ: onSimuData"></div>\n\n</div>\n',deps:["breizbot.files","app.emuAgc","brainjs.http"],props:{},init:function(t,n,e,i){window.agc=e;const s=$$.viewController(t,{data:{},events:{onKey:function(t,n){const{val:i}=n;isNaN(i)?(e.writeIo(26,0,e.inputsMask.PROCEED),setTimeout(()=>{e.writeIo(26,e.inputsMask.PROCEED,e.inputsMask.PROCEED)},200)):e.writeIo(13,i)},onLaunch:function(){console.log("onLaunch"),b||_||(e.writeIo(24,0,e.inputsMask.LIFTOFF),d=u,l.setReactor(0),_=!0)},onSimuData:function(t,n){console.log("onSimuData",n)}}}),a=s.scope.dsky,l=s.scope.imu,o=s.scope.simu,r=Math.PI/180;let c=null,u=0,d=-1,b=!1,_=!1;!async function(){c=await i.get(n.assetsUrl("profile.json")),await e.loadRom(n.assetsUrl("Comanche055.bin")),e.reset(),e.on("channelUpdate",t=>{const{channel:n,value:i}=t;switch(n){case 8:a.process(n,i);break;case 10:console.log("channelUpdate",n.toString(8),i.toString(2).padStart(15,0)),i&e.outputsMask.ZERO_IMU&&l.zero();break;case 124:case 125:case 126:l.gyro_coarse_align(n,i);break;case 127:l.gyro_fine_align(n,i)}}),e.on("lightsUpdate",t=>{a.processLights(t)}),e.start(),setInterval(()=>{if(l.setSt(Math.round(u/10)),e.loop(),_){const t=Math.round((u-d)/10);if(l.setMet(t),b||t>=c.length)return b=!0,void(_=!1);if(l.accelerate([1.08*c[t][2],0,0]),l.rotate([-c[t][3]/10*r,-c[t][1]/10*r,0]),u%10==0&&l.update(),c[t][4]){const n=Math.round(c[t][4]);l.setReactor(n)}}u++,e.readAllIo()},100)}(),o.dynamic_simulation()}}),$$.service.registerService("app.emuAgc",{deps:["breizbot.files"],init:function(t){const n=Module.cwrap("set_fixed",null,["number"]),e=Module.cwrap("cpu_reset"),i=Module.cwrap("cpu_step",null,["number"]),s=Module.cwrap("packet_read","number"),a=Module.cwrap("packet_write",null,["number","number"]),l=Module.cwrap("get_erasable_ptr","number"),o=new EventEmitter2,r=.01172,c={channels:{},lamps:0};let u=0,d=0,b=null;function _(t){return 1<<t-1}const p={COMP_ACTY:_(2),UPLINK_ACTY:_(3),TEMP:_(4),KEY_REL:_(5),VERB_NOUN:_(6),OPER_ERR:_(7),RESTART:_(8),STBY:_(9)},v={PRIO_DISP:_(1),NO_DAP:_(2),VEL:_(3),NO_ATT:_(4),ALT:_(5),GIMBAL_LOCK:_(6),TRACKER:_(8),PROG:_(9)},h={LIFTOFF:_(5),ISS_TURN_ON:_(14),PROCEED:_(14)},f={ZERO_IMU:_(5)};return{writeIo:function(t,n,e){null!=e&&a(t+256,e),a(t,n)},loadRom:async function(t){const e=await fetch(t),i=await e.arrayBuffer(),s=new Uint8Array(i);console.log("romArray",s.length);const a=Module._malloc(s.length*s.BYTES_PER_ELEMENT);console.log("romPtr",a),Module.HEAP8.set(s,a),n(a),Module._free(a),b=l(),console.log("erasablePtr",b)},reset:e,stepCpu:i,on:o.on.bind(o),start:function(){u=performance.now(),d=0},loop:function(){const t=Math.floor((performance.now()-u)/r)-d;if(t<0||t>1e5)return u=performance.now(),void(d=0);i(t),d+=t},readAllIo:function(){let t;do{const n=(t=s())>>16,e=65535&t;if(c.channels[n]=e,o.emit("channelUpdate",{channel:n,value:e}),9===n){const t=6;c.lamps=c.lamps&~t>>>0|e&t,o.emit("lightsUpdate",c.lamps)}else if(115===n){const t=504;c.lamps=c.lamps&~t>>>0|e&t,o.emit("lightsUpdate",c.lamps)}}while(t)},peek:function(t){return 32767&Module.getValue(b+2*t,"i16")},poke:function(t,n){Module.setValue(b+2*t,n,"i16")},getChannelState:function(t){return c.channels[t]},getChannelBitState:function(t,n){return e=c.channels[t],i=n,e>>--i&1;var e,i},lampMask:p,statusMask:v,inputsMask:h,outputsMask:f}}}),$$.control.registerControl("DSKY",{template:'\n<div class="top">\n    <div class="left">\n        <div class="col">\n            <div bn-style="uplink_acty"><span>UPLINK ACTY</span></div>\n            <div bn-style="no_att">NO ATT</div>\n            <div bn-style="stby">STBY</div>\n            <div bn-style="key_rel">KEY REL</div>\n            <div bn-style="opr_err">OPR ERR</div>\n            <div></div>\n            <div></div>\n        </div>\n\n        <div class="col">\n            <div bn-style="temp">TEMP</div>\n            <div bn-style="gimball_lock"><span>GIMBALL LOCK</span></div>\n            <div bn-style="prog">PROG</div>\n            <div>RESTART</div>\n            <div bn-style="tracker">TRACKER</div>\n            <div bn-style="alt">ALT</div>\n            <div bn-style="vel">VEL</div>\n        </div>\n\n    \n    </div>\n    \n    \n    <div class="right">\n        <div class="line">\n            <div class="compActy" bn-style="comp_acty"><span>COMP ACTY</span></div>\n            <div>\n                <div class="label">PROG</div>\n                <div class="digit" bn-html="prog00"></div>\n            </div>\n    \n        </div>\n        <div class="line">\n            <div>\n                <div class="label">VERB</div>\n                <div class="digit" bn-html="verb00"></div>\n            </div>\n            <div>\n                <div class="label">NOUN</div>\n                <div class="digit" bn-html="noun00"></div>\n            </div>\n        </div>\n        <div class="digit big" bn-html="r1"></div>\n        <div class="digit big" bn-html="r2"></div>\n        <div class="digit big" bn-html="r3"></div>\n    \n    </div>\n</div>\n\n<div class="bottom">\n    <div class="keyboard" bn-event="click.key: onKey">\n        <div>\n            <button class="label key">VERB</button>\n            <button class="label key">NOUN</button>\n        </div>\n        <div>\n            <button class="key">+</button>\n            <button class="key">-</button>\n            <button class="key">0</button>\n        </div>\n        <div>\n            <button class="key">1</button>\n            <button class="key">4</button>\n            <button class="key">7</button>\n        </div>\n        <div>\n            <button class="key">8</button>\n            <button class="key">5</button>\n            <button class="key">2</button>\n        </div>\n        <div>\n            <button class="key">9</button>\n            <button class="key">6</button>\n            <button class="key">3</button>\n        </div>\n        <div>\n            <button class="label key">CLR</button>\n            <button class="label key">PRO</button>\n            <button class="label key">KEY REL</button>\n        </div>\n        <div>\n            <button class="label key">ENTR</button>\n            <button class="label key">RSET</button>\n        </div>\n    \n    </div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(t,n,e){Math.floor,Math.round;const i={VERB:17,NOUN:31,"+":26,"-":27,0:16,CLR:30,"KEY REL":25,ENTR:28,RSET:18};function s(t){var n="E";switch(t){case 0:n="H";break;case 21:n="0";break;case 3:n="1";break;case 25:n="2";break;case 27:n="3";break;case 15:n="4";break;case 30:n="5";break;case 28:n="6";break;case 19:n="7";break;case 29:n="8";break;case 31:n="9"}return n}let a=0,l=0,o=0,r=0,c=0,u=0;const d="&nbsp;";function b(t){return{"background-color":t?"#ffc200":"#888888"}}function _(t){return{"background-color":t?"#ffffff":"#888888"}}const p=$$.viewController(t,{data:{lamps:0,status8:0,digits:"000000+00000+00000+00000",on:0,comp_acty:function(){return b(this.lamps&e.lampMask.COMP_ACTY)},uplink_acty:function(){return _(this.lamps&e.lampMask.UPLINK_ACTY)},temp:function(){return b(this.lamps&e.lampMask.TEMP)},key_rel:function(){return _(this.lamps&e.lampMask.KEY_REL)},opr_err:function(){return _(this.lamps&e.lampMask.OPER_ERR)},stby:function(){return _(this.lamps&e.lampMask.STBY)},vel:function(){return b(this.status8&e.statusMask.VEL)},no_att:function(){return _(this.status8&e.statusMask.NO_ATT)},alt:function(){return b(this.status8&e.statusMask.ALT)},gimball_lock:function(){return b(this.status8&e.statusMask.GIMBAL_LOCK)},tracker:function(){return b(this.status8&e.statusMask.TRACKER)},prog:function(){return b(this.status8&e.statusMask.PROG)},r1:function(){return this.digits.slice(6,12).replace(/H/g,d)},r2:function(){return this.digits.slice(12,18).replace(/H/g,d)},prog00:function(){return this.digits.slice(0,2).replace(/H/g,d)},r3:function(){return this.digits.slice(18,24).replace(/H/g,d)},verb00:function(){return this.lamps&e.lampMask.VERB_NOUN?d+d:this.digits.slice(2,4).replace(/H/g,d)},noun00:function(){return this.lamps&e.lampMask.VERB_NOUN?d+d:this.digits.slice(4,6).replace(/H/g,d)}},events:{onKey:function(n){const e=$(this).text();let s=i[e];null==s&&(s=parseInt(e)),n.stopPropagation(),t.trigger("key",{val:s})}}});this.processLights=function(t){p.setData({lamps:t})},this.process=function(t,n){if(0==n)return;const e=n>>11,i=n>>10&1,d=s(n>>5&31),b=s(31&n),_=p.model.digits.split("");switch(e){case 12:p.setData({status8:n});break;case 11:_[0]=d,_[1]=b;break;case 10:_[2]=d,_[3]=b;break;case 9:_[4]=d,_[5]=b;break;case 8:_[7]=b;break;case 7:_[8]=d,_[9]=b,a=i;break;case 6:_[10]=d,_[11]=b,l=i;break;case 5:_[13]=d,_[14]=b,o=i;break;case 4:_[15]=d,_[16]=b,r=i;break;case 3:_[17]=d,_[19]=b;break;case 2:_[20]=d,_[21]=b,c=i;break;case 1:_[22]=d,_[23]=b,u=i}if(12!=e){_[6]=a&&!l?"+":a||l?"-":"H",_[12]=o&&!r?"+":o||r?"-":"H",_[18]=c&&!u?"+":c||u?"-":"H";const t=_.join("");p.setData({digits:t})}}}}),$$.control.registerControl("FDAI",{template:'<svg width="350" height="360" bn-bind="svg">\n    <defs>\n      <marker id="triangle" viewBox="0 0 10 10"\n            refX="1" refY="5"\n            markerUnits="strokeWidth"\n            markerWidth="10" markerHeight="10"\n            orient="auto">\n        <path d="M 0 0 L 10 5 L 0 10 z" fill="black"/>\n      </marker>\n      <marker id="triangle2" viewBox="0 0 16 16"\n            refX="1" refY="8"\n            markerUnits="strokeWidth"\n            markerWidth="16" markerHeight="16"\n            orient="auto">\n        <path d="M 0 0 L 16 8 L 0 16 z" fill="black"/>\n      </marker>\n  \n  </defs>\n    \n  </svg>',deps:["breizbot.pager"],props:{},init:function(t,n){const e=$$.viewController(t,{data:{},events:{}}).scope.svg.get(0),i=150,s=180,a=180/Math.PI,l=42.1875/384;let o=0,r=0,c=0;function u(t,n){Object.keys(n).forEach(e=>{t.setAttribute(e,n[e])})}function d(t,n){const i=document.createElementNS("http://www.w3.org/2000/svg",t);return"object"==typeof n&&u(i,n),e.appendChild(i),i}function b(t,n,e,i,s,a){return d("line",Object.assign({x1:t,y1:n,x2:e,y2:i,stroke:s},a))}function _(t,n,e,i,s){const a=d("text",Object.assign({x:t,y:n,fill:i},s));return a.textContent=e,a}function p(t,n,e,i,s){return d("circle",Object.assign({r:e,cx:t,cy:n,fill:i},s))}const v={};function h(t,n){u(v[t],{x1:n,x2:n})}function f(t,n){u(v[t],{y1:n,y2:n})}function m(t,n,e,i,s){u(v[t],{x1:n,y1:e,x2:i,y2:s})}function M(t,n,e){u(v[t],{x:n,y:e})}function g(t,n,e,i,s,a){const l=i*Math.PI/180;return b(t+e*Math.sin(l),n+e*Math.cos(l),t+(e+=s)*Math.sin(l),n+e*Math.cos(l),a)}for(let t=-270;t<=270;t+=30){const n=t>=-180&&t<=0||t>=180&&t<=360?"black":"white";v[`PITCH_${t}`]=b(0,0,0,0,n);const e=t<0?t+360:t;v[`PITCH_TXT_${t}`]=_(0,0,e,n)}v.zAxisLM=b(0,0,0,0,"blue");for(let t=-270;t<=270;t+=30){v[`zAxis_${t}`]=b(0,0,0,0,"blue");const n=t<0?t+360:t;v[`zAxis_TXT_${t}`]=_(0,0,n,"blue")}v.RollMarker=b(0,0,0,0,"black",{"marker-end":"url(#triangle2)"}),v.YawErrorNeedle=b(0,s+10,0,s+100,"orange"),v.PitchErrorNeedle=b(i+10,0,i+100,0,"orange"),v.RollErrorNeedle=b(0,s-10,0,s-100,"orange"),p(i,s,190,"none",{stroke:"darkgrey","stroke-width":180});for(let t=70;t<110;t+=.5)g(i,s,100,t,10,"red");for(let t=250;t<290;t+=.5)g(i,s,100,t,10,"red");for(let t=0;t<360;t+=10){g(i,s,100,t,t%30==0?10:15,"white")}p(i,s,100,"none",{stroke:"black","stroke-width":4}),b(i-10,s,i+10,s,"white"),b(i,s-10,i,s+10,"white");for(let t=-5;t<=5;t++)b(i+10*t,310,i+10*t,315,"white");v.YawRateMarker=b(0,325,0,324,"black",{"marker-end":"url(#triangle)"}),_(i,310,"0","white"),_(i,340,"YAW RATE","white"),v.RollRateMarker=b(0,36,0,37,"black",{"marker-end":"url(#triangle)"}),_(i,62,"0","white"),_(i,30,"ROLL RATE","white");for(let t=-5;t<=5;t++)b(i+10*t,45,i+10*t,50,"white");for(let t=-5;t<=5;t++)b(280,s+10*t,285,s+10*t,"white");function k(t){const n=2*Math.PI;return t<-n?t+n:t>=n?t-n:t}function E(t,n,e){return Math.max(Math.min(e,t),n)}function A(n,e){const[u,d,b]=n,[_,p,v]=e,g=Math.sin(u),A=Math.sin(d),y=Math.sin(b),T=Math.cos(u),R=Math.cos(d),P=Math.cos(b),S=y,w=P*T,x=R*y*g+A*T,L=-P*g,C=-A*y*g+R*T,N=k(Math.atan2(S,w)),I=k(Math.atan2(x,C)),G=k(Math.asin(L)),D=N,F=Math.sin(-1*D),O=Math.cos(-1*D),K=-1*G*a,U=I*a,$=N*a,Y=K>0?360-K:Math.abs(K),H=U<0?U+360:U,z=$<0?$+360:$;t.trigger("data",{fdai:[Y,H,z]}),h("YawRateMarker",i-10*E(c,-5,5)),f("PitchRateMarker",s-10*E(r,-5,5)),h("RollRateMarker",i+10*E(o,-5,5)),h("YawErrorNeedle",i+_*l),f("PitchErrorNeedle",s+p*l),h("RollErrorNeedle",i-v*l);const B=i+85*Math.sin(D+Math.PI),W=i+86*Math.sin(D+Math.PI);function V(t,n){return{x:t*O-n*F+i,y:t*F+n*O+s}}m("RollMarker",B,s+85*Math.cos(D+Math.PI),W,s+86*Math.cos(D+Math.PI));const j=U>180?U-180:U;for(let t=-270;t<=270;t+=30){const n=-50,e=50,i=-t+j,s=0,a=i,{x:l,y:o}=V(s,a),{x:r,y:c}=V(n,i),{x:u,y:d}=V(e,i);M(`PITCH_TXT_${t}`,l,o),m(`PITCH_${t}`,r,c,u,d)}const X=K>180?K-360:K,Z=-280+X,q=280+X,{x:J,y:Q}=V(Z,0),{x:tt,y:nt}=V(q,0);m("zAxisLM",J,Q,tt,nt);for(let t=-270;t<=270;t+=30){const n=t+X,e=-2,i=t+X,s=3,a=t+X,l=10,{x:o,y:r}=V(a,l),{x:c,y:u}=V(n,e),{x:d,y:b}=V(i,s);M(`zAxis_TXT_${t}`,o,r),m(`zAxis_${t}`,c,u,d,b)}}v.PitchRateMarker=b(296,0,295,0,"black",{"marker-end":"url(#triangle)"}),_(i+128-5,s,"0","white",{"alignment-baseline":"middle"}),_(i+155,s-30,"P","white"),_(i+155,s-22,"I","white"),_(i+155,s-14,"T","white"),_(i+155,s-6,"C","white"),_(i+155,s+2,"H","white"),_(i+155,s+18,"R","white"),_(i+155,s+26,"A","white"),_(i+155,s+34,"T","white"),_(i+155,s+42,"E","white"),A([0,0,0],[0,0,0]),this.update=A}}),$$.control.registerControl("IMU",{template:'<div class="top">\n    <div class="left">\n        <div class="imuGroup">\n            <label class="imuLabel">ST</label>\n            <div class="clock" bn-html="getSt"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MET</label>\n            <div class="clock" bn-html="getMet"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">OGA</label>\n            <div class="imu" bn-html="imux"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">IGA</label>\n            <div class="imu" bn-html="imuy"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">MGA</label>\n            <div class="imu" bn-html="imuz"></div>\n        </div>\n    </div>\n\n    <div class="middle">\n        <div class="imuGroup">\n            <label class="imuLabel">YAW</label>\n            <div class="imu" bn-html="yaw"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">PITCH</label>\n            <div class="imu" bn-html="pitch"></div>\n        </div>\n        <div class="imuGroup">\n            <label class="imuLabel">ROLL</label>\n            <div class="imu" bn-html="roll"></div>\n        </div>\n\n    </div>\n\n    <div class="right">\n        <button bn-event="click: enableIMU">Enable IMU</button>\n        <button bn-event="click: launch">Launch</button>\n        <div class="light" bn-style="sic">S-IC</div>\n        <div class="light" bn-style="sii">S-II</div>\n        <div class="light" bn-style="sivb">S-IVB</div>\n    </div>\n</div>\n<div class="bottom">\n    <div bn-control="FDAI" bn-iface="fdai" bn-event="data: onData"></div>\n</div>\n',deps:["breizbot.pager","app.emuAgc"],props:{},init:function(t,n,e){const i=Math.abs,s=Math.floor,a=(Math.round,Math.sqrt,Math.sin),l=Math.cos,o=(Math.atan2,Math.asin,Math.PI),r=o/180,c=180/o,u=.043948*r,d=.617981/3600*r,b=360/32768*r,_=.0585;let p,v,h,f,m,M,g,k,E=0;function A(){x.update(v,p),w.setData({imu_angle:v})}function y(t,n,e){return t-(e-n)*s((t-n)/(e-n))}function T(t){let n=(t*c).toFixed(2);return n="000".substr(0,6-n.length)+n}function R(t){return t.toFixed(1)}function P(t){const n=s(t/3600),e=s(t/60)%60,i=t%60;return(n<10?"0"+n:n)+":"+(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)}function S(t){return{"background-color":t?"#ffc200":"#888888"}}const w=$$.viewController(t,{data:{st:0,met:0,c:-1,sic:function(){return S(0==this.c)},sii:function(){return S(1==this.c)},sivb:function(){return S(2==this.c)},getSt:function(){return P(this.st)},getMet:function(){return P(this.met)},imu_angle:[0,0,0],euler:[0,0,0],imux:function(){return T(this.imu_angle[0])},imuy:function(){return T(this.imu_angle[1])},imuz:function(){return T(this.imu_angle[2])},yaw:function(){return R(this.euler[0])},pitch:function(){return R(this.euler[1])},roll:function(){return R(this.euler[2])}},events:{onData:function(t,n){w.setData({euler:n.fdai})},enableIMU:function(t){console.log("enableIMU"),e.writeIo(24,0,e.inputsMask.ISS_TURN_ON)},launch:function(n){n.stopPropagation(),t.trigger("launch")}}}),x=w.scope.fdai;function L(t){if(k)return;for(let n=0;n<3;n++)if(t[n]){v[n]=y(v[n]+t[n],0,2*o);const a=y(v[n]-f[n],-o,o);E+=i(a);const l=a>0?1:-1;let r=s(i(a)/b);f[n]=y(f[n]+l*b*r,0,2*o);let c=e.peek(26+n);c=16384&c?-(32767^c):c,c+=l*r,e.poke(26+n,c<0?32767^-c:c)}}this.rotate=function(t){const n=a(v[2]),e=l(v[2])*l(v[0]),i=a(v[0]),s=-l(v[2])*a(v[0]),r=l(v[0]),c=r*e-s*i;L([y(t[0]-(t[1]*r*n-t[2]*i*n)/c,-o,o),y((t[1]*r-t[2]*i)/c,-o,o),y((t[2]*e-t[1]*s)/c,-o,o)])},this.update=A,this.accelerate=function(t){const n=a(v[0]),i=a(v[1]),o=a(v[2]),r=l(v[0]),c=l(v[1]),u=l(v[2]),d=[u*c*t[0]+(-r*o*c+n*i)*t[1]+(n*o*c+r*i)*t[2],o*t[0]+r*u*t[1]-n*u*t[2],-u*i*t[0]+(r*o*i+n*c)*t[1]+(-n*o*i+r*c)*t[2]];for(let t=0;t<3;t++){g[t]+=d[t];const n=s((g[t]-M[t]*_)/_);M[t]+=n;let i=e.peek(31+t);i=16384&i?-(32767^i):i,i+=n,e.poke(31+t,i<0?32767^-i:i)}},this.gyro_coarse_align=function(t,n){const i=(16384&n?-1:1)*(16383&n);1==e.getChannelBitState(10,4)?(124===t?L([i*u,0,0]):125===t?L([0,i*u,0]):126===t&&L([0,0,i*u]),A()):p[t-124]+=i},this.zero=function(){console.log("zero"),p=[0,0,0],v=[0,0,0],h=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0],M=[0,0,0],k=!1,E=1,A()},this.gyro_fine_align=function(t,n){const e=8192&n,i=4096&n,s=(16384&n?-1:1)*(2047&n);!e&&i&&L([s*d,0,0]),e&&!i&&L([0,s*d,0]),e&&i&&L([0,0,s*d]),A()},this.setSt=function(t){w.setData({st:t})},this.setMet=function(t){w.setData({met:t})},this.setReactor=function(t){w.setData({c:t})}}}),$$.control.registerControl("SIMU",{template:'<div>\n    <fieldset>\n        <div>\n            <label>SIMULATION TIME:</label>\n            <span bn-text="Simulation_Timer_text"></span>\n        </div>\n        <div>\n            <label>LM WEIGHT:</label>\n            <span bn-text="LM_Weight_KG_text"></span>\n        </div>\n\n    </fieldset>\n    <fieldset>\n        <legend>DESCENT</legend>\n        <div>\n            <label>THRUST:</label>\n            <span bn-text="Descent_Thrust_Procent_text"></span>\n        </div>\n        <div>\n            <label>PROPELLANT:</label>\n            <span bn-text="Descent_Propellant_Mass_KG_text"></span>\n        </div>\n        <div>\n            <label>FUEL FLOW:</label>\n            <span bn-text="Descent_Fuel_Flow_SEC_text"></span>\n        </div>\n        <div>\n            <label>ACCELERATION:</label>\n            <span bn-text="Descent_Acceleration_text"></span>\n        </div>\n        <div bn-show="!isSeparated">\n            <div>\n                <input type="checkbox" bn-val="DESCENT_ENGINE_FLAG" bn-update="click">\n                <label>ENGINE ON/OFF</label>\n            </div>\n            <div>Thrust [N]</div>\n            <div bn-control="brainjs.slider" bn-data="{min: Descent_Propulsion_Min_N, max: Descent_Propulsion_Max_N }"\n                bn-update="input" bn-val="Descent_Propulsion_N"></div>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>Stage</legend>\n        <button bn-event="click: onSeperateStage" bn-prop="{disabled: isSeparated}">SEPARATE STAGE</button>\n    </fieldset>\n    <fieldset>\n        <legend>ASCENT</legend>\n        <div>\n            <label>PROPELLANT:</label>\n            <span bn-text="Ascent_Propellant_Mass_KG_text"></span>\n        </div>\n        <div>\n            <label>FUEL FLOW:</label>\n            <span bn-text="Ascent_Fuel_Flow_SEC_text"></span>\n        </div>\n        <div>\n            <label>ACCELERATION:</label>\n            <span bn-text="Ascent_Acceleration_text"></span>\n        </div>\n        <div bn-show="isSeparated">\n            <input type="checkbox" bn-val="ASCENT_ENGINE_FLAG" bn-update="click">\n            <label>ENGINE ON/OFF</label>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend>RCS</legend>\n        <div>\n            <label>PROPELLANT:</label>\n            <span bn-text="RCS_Propellant_Mass_KG_text"></span>\n        </div>\n\n    </fieldset>\n\n</div>',deps:["breizbot.pager"],props:{},init:function(t,n){const e=Math.PI,i=180/e*(e/4),s=Math.abs;let a=0,l=4670,o=10694,r=287,c=445,u=2840,d=8355,b=45040,_=3050,p=4560,v=0,h=0,f=0,m=!1,M=2353,g=15600,k=3050,E=0,A=0,y=!1,T=0,R=0,P=0,S=0,w=0,x=0,L=0;const C=[],N=[],I=[];for(let t=0;t<2;t++)C[t]=[],N[t]=[],I[t]=[];C[0][0]=.0065443852,N[0][0]=32e-6,I[0][0]=-.006923,C[0][1]=.0035784354,N[0][1]=.162862,I[0][1]=.002588,C[0][2]=.0056946631,N[0][2]=.009312,I[0][2]=-.023608,C[1][0]=.0059347674,N[1][0]=.002989,I[1][0]=.008721,C[1][1]=.0014979264,N[1][1]=.018791,I[1][1]=-.068163,C[1][2]=.0010451889,N[1][2]=.021345,I[1][2]=-.066027;let G=0,D=0,F=0,O=0,K=0,U=0,$=0,Y=0,H=0,z=0,B=0,W=0,V=0,j=0,X=0,Z=0,q=(Date.now(),0),J=0,Q=0;const tt=$$.viewController(t,{data:{Simulation_Timer:q,Descent_Thrust_Procent:h,LM_Weight_KG:a,Descent_Propellant_Mass_KG:d,Descent_Fuel_Flow_SEC:v,Descent_Acceleration:f,RCS_Propellant_Mass_KG:r,Ascent_Propellant_Mass_KG:M,Ascent_Fuel_Flow_SEC:E,Ascent_Acceleration:A,Descent_Propulsion_Min_N:4560,Descent_Propulsion_Max_N:b,Descent_Propulsion_N:p,DESCENT_ENGINE_FLAG:m,ASCENT_ENGINE_FLAG:y,LM_CONFIG:T,Simulation_Timer_text:function(){return this.Simulation_Timer.toFixed(1)+" SEC"},Descent_Thrust_Procent_text:function(){return this.Descent_Thrust_Procent.toFixed(1)},LM_Weight_KG_text:function(){return this.LM_Weight_KG.toFixed(0)+" KG"},Descent_Propellant_Mass_KG_text:function(){return this.Descent_Propellant_Mass_KG.toFixed(0)+" KG"},Descent_Fuel_Flow_SEC_text:function(){return this.Descent_Fuel_Flow_SEC.toFixed(2)+" KG/S"},Descent_Acceleration_text:function(){return this.Descent_Acceleration.toFixed(3)+" M/S²"},RCS_Propellant_Mass_KG_text:function(){return this.RCS_Propellant_Mass_KG.toFixed(1)+" KG"},Ascent_Propellant_Mass_KG_text:function(){return this.Ascent_Propellant_Mass_KG.toFixed(0)+" KG"},Ascent_Fuel_Flow_SEC_text:function(){return this.Ascent_Fuel_Flow_SEC.toFixed(1)+" KG/S"},Ascent_Acceleration_text:function(){return this.Ascent_Acceleration.toFixed(3)+" M/S²"},isSeparated:function(){return 1==this.LM_CONFIG}},events:{onSeperateStage:function(){console.log("onSeperateStage"),T=1,d=0,o=0,tt.setData({LM_CONFIG:T,Descent_Propellant_Mass_KG:d,LM_Weight_Descent_KG:o})}}});function nt(n,e,i){t.trigger("data",{pipaXYZ:[n,e,i]})}window.simu=tt,this.dynamic_simulation=function(){if(console.log("dynamic_simulation"),a=l+o,tt.setData({Simulation_Timer:q,Descent_Thrust_Procent:h,LM_Weight_KG:a,Descent_Propellant_Mass_KG:d,Descent_Fuel_Flow_SEC:v,Descent_Acceleration:f,RCS_Propellant_Mass_KG:r,Ascent_Propellant_Mass_KG:M,Ascent_Fuel_Flow_SEC:E,Ascent_Acceleration:A}),m=tt.model.DESCENT_ENGINE_FLAG,y=tt.model.ASCENT_ENGINE_FLAG,h=tt.model.Descent_Propulsion_N/b,m&&d>0){const t=(v=p/_)/Q;d-=t,o-=t,nt((f=p/a)*Q,0,0)}else m=!1,f=0,v=0;if(y&&M>0){const t=(E=g/k)*Q;M-=t,nt((A=g/(l-=t))*Q,0,0)}else y=!1,A=0,E=0;const t=a/65535,[n,e,s]=C[T],[c,u,w]=N[T],[x,L,G]=I[T];R=i*(c+n/(t+x)),P=i*(u+e/(t+L)),S=i*(w+s/(t+G))},this.update_RCS=function(){const t=1==z||1==G?z+G:0,n=1==H||1==D?-(H+D):0,e=1==V||1==K?V+K:0,i=1==Z||1==U?-(Z+U):0,o=1==j||1==W||1==$||1==O?j+W+$+O:0,d=1==X||1==B||1==Y||1==F?-(X+B+Y+F):0,b=t+n,_=e+i,p=o+d;let v=0;0!=t&&t+n==0&&(v=1==z?z+D:-(H+G)),0!=e&&e+i==0&&(1==V?v+=V+U:v-=Z+K),0!=v&&nt(J*v*c/a,0,0);0!=o&&o+d==0&&(1==X&&nt(0,2*J*c/a,0),1==Y&&nt(0,2*-J*c/a,0),1==B&&nt(0,0,2*J*c/a),1==j&&nt(0,0,2*-J*c/a));if(r>0){L+=R*J*p,x+=P*J*(_-b),w+=S*J*(_+b);const a=(s(t)+s(n)+s(e)+s(i)+s(o)+s(d))*c/u*J;l-=a,r-=a}}}});