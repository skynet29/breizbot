$$.control.registerControl("rootPage",{template:'<div>\n    <div bn-control="DSKY" bn-event="key: onKey" bn-iface="dsky"></div>\n</div>',deps:["breizbot.files","app.emuAgc"],props:{},init:function(n,t,e){const s=$$.viewController(n,{data:{},events:{onKey:function(n,t){const{val:s}=t;isNaN(s)||e.writeIo(13,s)}}}).scope.dsky;let i=0;!async function(){await e.loadRom(t.assetsUrl("Comanche055.bin")),e.reset(),e.on("channelUpdate",n=>{const{channel:t,value:e}=n;switch(t){case 8:case 9:case 11:s.process(t,e)}}),e.on("lightsUpdate",n=>{s.processLights(n)}),e.start(),setInterval(function(){s.tick(),i+=.1,e.loop()},1e3/60)}()}}),$$.control.registerControl("DSKY",{template:'\n<div class="top">\n    <div class="left">\n        <div class="col">\n            <div bn-style="uplink_acty"><span>UPLINK ACTY</span></div>\n            <div bn-style="no_att">NO ATT</div>\n            <div bn-style="stby">STBY</div>\n            <div bn-style="key_rel">KEY REL</div>\n            <div bn-style="opr_err">OPR ERR</div>\n            <div></div>\n            <div></div>\n        </div>\n\n        <div class="col">\n            <div bn-style="temp">TEMP</div>\n            <div bn-style="gimball_lock"><span>GIMBALL LOCK</span></div>\n            <div bn-style="prog">PROG</div>\n            <div>RESTART</div>\n            <div bn-style="tracker">TRACKER</div>\n            <div bn-style="alt">ALT</div>\n            <div bn-style="vel">VEL</div>\n        </div>\n\n    \n    </div>\n    \n    \n    <div class="right">\n        <div class="line">\n            <div class="compActy" bn-style="comp_acty"><span>COMP ACTY</span></div>\n            <div>\n                <div class="label">PROG</div>\n                <div class="digit" bn-html="prog00"></div>\n            </div>\n    \n        </div>\n        <div class="line">\n            <div>\n                <div class="label">VERB</div>\n                <div class="digit" bn-html="verb00"></div>\n            </div>\n            <div>\n                <div class="label">NOUN</div>\n                <div class="digit" bn-html="noun00"></div>\n            </div>\n        </div>\n        <div class="digit big" bn-html="r1"></div>\n        <div class="digit big" bn-html="r2"></div>\n        <div class="digit big" bn-html="r3"></div>\n    \n    </div>\n</div>\n\n<div class="bottom">\n    <div class="keyboard" bn-event="click.key: onKey">\n        <div>\n            <button class="label key">VERB</button>\n            <button class="label key">NOUN</button>\n        </div>\n        <div>\n            <button class="key">+</button>\n            <button class="key">-</button>\n            <button class="key">0</button>\n        </div>\n        <div>\n            <button class="key">1</button>\n            <button class="key">4</button>\n            <button class="key">7</button>\n        </div>\n        <div>\n            <button class="key">8</button>\n            <button class="key">5</button>\n            <button class="key">2</button>\n        </div>\n        <div>\n            <button class="key">9</button>\n            <button class="key">6</button>\n            <button class="key">3</button>\n        </div>\n        <div>\n            <button class="label key">CLR</button>\n            <button class="label key">PRO</button>\n            <button class="label key">KEY REL</button>\n        </div>\n        <div>\n            <button class="label key">ENTR</button>\n            <button class="label key">RSET</button>\n        </div>\n    \n    </div>\n</div>\n',deps:["breizbot.pager"],props:{},init:function(n,t){var e=Math.floor,s=Math.round;const i={VERB:17,NOUN:31,"+":26,"-":27,0:16,CLR:30,"KEY REL":25,ENTR:28,RSET:18};function a(n){var t="E";switch(n){case 0:t="H";break;case 21:t="0";break;case 3:t="1";break;case 25:t="2";break;case 27:t="3";break;case 15:t="4";break;case 30:t="5";break;case 28:t="6";break;case 19:t="7";break;case 29:t="8";break;case 31:t="9"}return t}let o=0,l=0,c=0,r=0,u=0,d=0;const b="&nbsp;";let v=0,p="000000+00000+00000+00000";function f(n){return{"background-color":n?"#ffc200":"#888888"}}function k(n){return{"background-color":n?"#ffffff":"#888888"}}const h=$$.viewController(n,{data:{lamps:0,status8:0,status11:0,digits:"000000+00000+00000+00000",on:0,comp_acty:function(){return f(2&this.lamps)},uplink_acty:function(){return k(4&this.lamps)},temp:function(){return f(8&this.lamps)},key_rel:function(){return k(16&this.lamps)},opr_err:function(){return k(64&this.lamps)},stby:function(){return k(512&this.status11)},vel:function(){return f(4&this.status8)},no_att:function(){return k(8&this.status8)},alt:function(){return f(16&this.status8)},gimball_lock:function(){return f(32&this.status8)},tracker:function(){return f(128&this.status8)},prog:function(){return f(256&this.status8)},r1:function(){return this.digits.slice(6,12).replace(/H/g,b)},r2:function(){return this.digits.slice(12,18).replace(/H/g,b)},prog00:function(){return this.digits.slice(0,2).replace(/H/g,b)},r3:function(){return this.digits.slice(18,24).replace(/H/g,b)},verb00:function(){return 32&this.lamps?b+b:this.digits.slice(2,4).replace(/H/g,b)},noun00:function(){return 32&this.lamps?b+b:this.digits.slice(4,6).replace(/H/g,b)}},events:{onKey:function(t){const e=$(this).text();let s=i[e];null==s&&(s=parseInt(e)),t.stopPropagation(),n.trigger("key",{val:s})}}});this.tick=function(n){var t,i,a,o,l;return v%10==0&&(i=s(v/10),t=((a=e(i/3600))<10?"0"+a:a)+":"+((o=e(i/60)%60)<10?"0"+o:o)+":"+((l=i%60)<10?"0"+l:l),$("#st").html(t)),v++},this.processLights=function(n){h.setData({lamps:n})},this.process=function(n,t){if(0!=t&&8==n){const n=t>>11,e=t>>10&1,s=a(t>>5&31),i=a(31&t),b=h.model.digits.split("");switch(n){case 12:h.setData({status8:t});break;case 11:b[0]=s,b[1]=i;break;case 10:b[2]=s,b[3]=i;break;case 9:b[4]=s,b[5]=i;break;case 8:b[7]=i;break;case 7:b[8]=s,b[9]=i,o=e;break;case 6:b[10]=s,b[11]=i,l=e;break;case 5:b[13]=s,b[14]=i,c=e;break;case 4:b[15]=s,b[16]=i,r=e;break;case 3:b[17]=s,b[19]=i;break;case 2:b[20]=s,b[21]=i,u=e;break;case 1:b[22]=s,b[23]=i,d=e}12!=n&&(b[6]=o&&!l?"+":o||l?"-":"H",b[12]=c&&!r?"+":c||r?"-":"H",b[18]=u&&!d?"+":u||d?"-":"H",p=b.join(""),h.setData({digits:p}))}}}}),$$.service.registerService("app.emuAgc",{deps:["breizbot.files"],init:function(n){const t=Module.cwrap("set_fixed",null,["number"]),e=Module.cwrap("cpu_reset"),s=Module.cwrap("cpu_step",null,["number"]),i=Module.cwrap("packet_read","number"),a=Module.cwrap("packet_write",null,["number","number"]),o=new EventEmitter2,l=.01172,c={channels:{},lamps:0};let r=0,u=0;function d(){const n=i();return[n>>16,65535&n]}return{writeIo:a,readIo:d,loadRom:async function(n){const e=await fetch(n),s=await e.arrayBuffer(),i=new Uint8Array(s);console.log("romArray",i.length);const a=Module._malloc(i.length*i.BYTES_PER_ELEMENT);console.log("romPtr",a),Module.HEAP8.set(i,a),t(a),Module._free(a)},reset:e,stepCpu:s,on:o.on.bind(o),start:function(){r=performance.now(),u=0},loop:function(){const n=Math.floor((performance.now()-r)/l)-u;if(n<0||n>1e5)return r=performance.now(),void(u=0);s(n),u+=n,function(){let n,t;do{[n,t]=d();const e=c.channels[n];if(e!=t&&(c.channels[n]=t,o.emit("channelUpdate",{channel:n,value:t})),9===n){const n=6;c.lamps=c.lamps&~n>>>0|t&n,o.emit("lightsUpdate",c.lamps)}else if(115===n){const n=504;c.lamps=c.lamps&~n>>>0|t&n,o.emit("lightsUpdate",c.lamps)}}while(n||t)}()}}}});