$$.control.registerControl("rootPage",{deps:["breizbot.broker"],template:'<div class="scrollPanel">\n    <table class="w3-table-all w3-centered">\n        <thead>\n            <tr class="w3-green">\n                <th>Alias</th>\n                <th>Type</th>\n                <th>Properties</th>\n                <th>Actions</th>\n            </tr>\n        </thead>\n        <tbody bn-each="devices" bn-iter="dev" bn-event="click.action: onAction">\n            <tr bn-data="{item: dev}">\n                <td bn-text="dev.alias"></td>\n                <td bn-text="dev.type"></td>\n                <td bn-each="dev.props" bn-iter="prop">\n                    <div>\n                        <span bn-text="prop.label"></span>:\n                        <span bn-text="prop.value"></span>\n                    </div>\n                </td>\n                <td bn-each="dev.actions" bn-iter="a">\n                    <button class="action w3-btn w3-blue w3-margin-right" \n                        bn-data="{action: a.cmd}" \n                        bn-text="a.label"></button>\n                </td>\n            </tr>       \n\n        </tbody>\n    </table>\n</div>',init:function(t,e){const n=$$.viewController(t,{data:{devices:[]},events:{onAction:function(){const t=$(this).data("action");console.log("action",t);const{deviceId:n,type:a}=$(this).closest("tr").data("item"),i=o[a].actions,{args:s,label:c}=i[t];console.log("args",s),console.log("deviceId",n),null!=s?$$.ui.showForm({fields:s,title:c},function(o){e.emitTopic("homebox.arduino.cmd",{deviceId:n,cmd:t,args:o})}):e.emitTopic("homebox.arduino.cmd",{deviceId:n,cmd:t})}}});let o={};e.register("homebox.arduino.types",function(t){console.log("msg",t),o=t.data}),e.register("homebox.arduino.status",function(t){console.log("msg",t);const e=t.data.map(t=>{const{properties:e,alias:n,deviceId:a,type:i}=t,s=o[i],c=[];for(let t in e){const n=e[t],o=s.properties[t].label;c.push({value:n,label:o,propName:t})}const l=[],d=s.actions;for(let t in d){const{label:e}=d[t];l.push({label:e,cmd:t})}return{actions:l,props:c,alias:n,deviceId:a,type:i}});console.log("devices",e),n.setData({devices:e})})}});