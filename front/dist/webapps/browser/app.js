$$.control.registerControl("rootPage",{template:'<div bn-control="breizbot.searchbar" \n\tbn-event="searchbarsubmit: onSearch"\n\tdata-placeholder="What are you looking for ?" \n\t></div>\n<div class="toolbar" bn-event="click.menuItem: onItemMenuClick" bn-show="!waiting">\n\t<span class="menuItem selected" data-theme="web"><i class="fa fa-globe"></i>Web</span>\n\t<span class="menuItem" data-theme="images"><i class="fa fa-image"></i>Images</span>\n</div>\t\n<div bn-show="waiting" class="waiting">\n\t<span><i class="fa fa-spinner fa-pulse"></i>&nbsp;Searching...</span>\n</div>\n<div bn-show="isWeb" class="test">\n\t<div class="webResults w3-light-grey" >\n\t\t<div bn-each="results.web" \n\t\t\tbn-event="contextmenuchange.item: onContextMenu, click.linkUrl: onLinkClicked"\n\t\t\tbn-lazzy="getResults">\n\t\t\t<div class="w3-card-2 item" \n\t\t\t\tbn-control="brainjs.contextmenu" \n\t\t\t\tbn-data="{\n\t\t\t\t\titems: {\n\t\t\t\t\t\tadd: {name: \'Add to favorites\', icon: \'fas fa-star\'}\n\t\t\t\t\t}\n\t\t\t\t}">\n\t\t\t\t<div class="link">\n\t\t\t\t\t<a bn-attr="{href: $scope.$i.url}" bn-html="$scope.$i.title" target="_blank" class="linkUrl"></a>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t<div bn-html="$scope.$i.source" class="source"></div>\t\t\n\t\t\t\t<div bn-html="$scope.$i.desc" class="desc"></div>\t\n\t\t\t</div>\n\t\t</div>\n\t\n\t</div>\n\t\n</div>\n\n<div bn-show="isImages" class="test" bn-event="click.item: onImageClick">\n\t<div class="imagesResults" >\n\t\t<div bn-each="results.images" bn-lazzy="getResults" class="items" bn-bind="images">\n\t\t\t<div bn-style="{width: $scope.$i.thumb_width, height: $scope.$i.thumb_height}" class="item w3-card-2">\n\t\t\t\t<img bn-attr="{src: getUrl}" style="display: none;">\n\t\t\t</div>\n\t\t</div>\n\t\n\t</div>\n\t\n</div>\n',deps:["breizbot.http","breizbot.pager","breizbot.files","breizbot.scheduler"],init:function(t,e,n,s,i){const a=$$.ui.progressDialog();let l=0;const o=$$.viewController(t,{data:{getResults:async function(t){return t!=l?c(t):null},results:{web:[],images:[]},theme:"web",query:"",waiting:!1,isWeb:function(){return"web"==this.theme},isImages:function(){return"images"==this.theme},getUrl:function(t){return`https:${t.$i.thumbnail}`}},events:{onLinkClicked:function(t){this.href.startsWith("https://www.youtube.com/watch?v=")&&(t.preventDefault(),i.openApp("youtube",{url:this.href}))},onItemMenuClick:function(){const t=$(this),e=t.data("theme");t.closest(".toolbar").find(".menuItem.selected").removeClass("selected"),t.addClass("selected"),e!=o.model.theme&&(o.setData({theme:e}),c(0))},onContextMenu:async function(t,n){const s=$(this).index(),{title:i,url:a}=o.model.results.web[s],l=await $$.ui.showPrompt({title:"Add link",label:"Name",value:i.replace(/<\/?b>/g,"")});console.log("name",l),null!=l&&await e.post("/addFavorite",{name:l,link:a})},onSearch:function(t,e){o.setData({query:e.value}),c(0)},onImageClick:function(){const t=$(this).index(),i=o.model.results.images[t],l=i.media;n.pushPage("breizbot.viewer",{title:i.title,props:{type:"image",url:l},buttons:{save:{title:"Save",icon:"fa fa-save",onClick:function(){!async function(t){try{a.setPercentage(0),a.show();const n=await e.fetch("/getImage",{url:t}),i=await n.blob(),l=i.type.split("/")[1],o="SNAP"+Date.now()+"."+l;await s.saveFile(i,o,t=>{a.setPercentage(t)}),await $$.util.wait(1e3),a.hide()}catch(t){a.hide(),$$.ui.showAlert({title:"Error",content:t})}}(l)}}}})}}});async function c(t){0==t&&o.setData({results:{web:[],images:[]}});const{theme:n,query:s}=o.model;if(""!=s)try{o.setData({waiting:!0});const i=await e.post("/search",{query:s,theme:n,offset:t,count:10});return l=i.total,o.model.results[n]=o.model.results[n].concat(i.items),o.model.waiting=!1,o.enableNode("images",0==t),o.update(),i.items}catch(t){o.setData({waiting:!1}),$$.ui.showAlert({title:"Error",content:t.responseText})}}document.body.addEventListener("load",function(t){var e=t.target;"IMG"==e.tagName&&(e.style.display="inline")},!0)}});