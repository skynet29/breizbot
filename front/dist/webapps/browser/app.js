$$.control.registerControl("rootPage",{template:'<div bn-control="breizbot.searchbar" \n\tbn-event="searchbarsubmit: onSearch"\n\tdata-placeholder="What are you looking for ?" \n\t></div>\n<div class="toolbar" bn-event="click.menuItem: onItemMenuClick" bn-show="!waiting">\n\t<span class="menuItem selected" data-theme="web"><i class="fa fa-globe"></i>Web</span>\n\t<span class="menuItem" data-theme="images"><i class="fa fa-image"></i>Images</span>\n</div>\t\n<div bn-show="waiting" class="waiting">\n\t<span><i class="fa fa-spinner fa-pulse"></i>&nbsp;Searching...</span>\n</div>\n<div bn-show="isWeb" class="test">\n\t<div class="webResults w3-light-grey" >\n\t\t<div bn-each="results.web" bn-event="contextmenuchange.item: onContextMenu" bn-lazzy="getResults">\n\t\t\t<div class="w3-card-2 item" \n\t\t\t\tbn-control="brainjs.contextmenu" \n\t\t\t\tbn-data="{\n\t\t\t\t\titems: {\n\t\t\t\t\t\tadd: {name: \'Add to favorites\', icon: \'fas fa-star\'}\n\t\t\t\t\t}\n\t\t\t\t}">\n\t\t\t\t<div class="link">\n\t\t\t\t\t<a bn-attr="{href: $scope.$i.url}" bn-html="$scope.$i.title" class="link" target="_blank"></a>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t<div bn-html="$scope.$i.source" class="source"></div>\t\t\n\t\t\t\t<div bn-html="$scope.$i.desc" class="desc"></div>\t\n\t\t\t</div>\n\t\t</div>\n\t\n\t</div>\n\t\n</div>\n\n<div bn-show="isImages" class="test" bn-event="click.item: onImageClick">\n\t<div class="imagesResults" >\n\t\t<div bn-each="results.images" bn-lazzy="getResults" class="items">\n\t\t\t<div bn-style="{width: $scope.$i.thumb_width, height: $scope.$i.thumb_height}" class="item w3-card-2">\n\t\t\t\t<img bn-attr="{src: getUrl}" style="display: none;">\n\t\t\t</div>\n\t\t</div>\n\t\n\t</div>\n\t\n</div>\n',deps:["breizbot.http","breizbot.pager","breizbot.files"],init:function(t,e,n,s){const a=$$.ui.progressDialog();let i=0;const l=$$.viewController(t,{data:{getResults:async function(t){return t!=i?o(t):null},results:{web:[],images:[]},theme:"web",query:"",waiting:!1,isWeb:function(){return"web"==this.theme},isImages:function(){return"images"==this.theme},getUrl:function(t){return`https:${t.$i.thumbnail}`}},events:{onItemMenuClick:function(){const t=$(this),e=t.data("theme");t.closest(".toolbar").find(".menuItem.selected").removeClass("selected"),t.addClass("selected"),e!=l.model.theme&&(l.setData({theme:e}),o(0))},onContextMenu:async function(t,n){const s=$(this).index(),{title:a,url:i}=l.model.results.web[s],o=await $$.ui.showPrompt({title:"Add link",label:"Name",value:a.replace(/<\/?b>/g,"")});console.log("name",o),null!=o&&await e.post("/addFavorite",{name:o,link:i})},onSearch:function(t,e){l.setData({query:e.value}),o(0)},onImageClick:function(){const t=$(this).index(),i=l.model.results.images[t],o=i.media;n.pushPage("breizbot.viewer",{title:i.title,props:{type:"image",url:o},buttons:{save:{title:"Save",icon:"fa fa-save",onClick:function(){!async function(t){try{a.setPercentage(0),a.show();const n=await e.fetch("/getImage",{url:t}),i=await n.blob(),l=i.type.split("/")[1],o="SNAP"+Date.now()+"."+l;await s.uploadFile(i,o,"/apps/browser",t=>{a.setPercentage(t)}),await $$.util.wait(1e3),a.hide()}catch(t){a.hide(),$$.ui.showAlert({title:"Error",content:t})}}(o)}}}})}}});async function o(t){0==t&&l.setData({results:{web:[],images:[]}});const{theme:n,query:s}=l.model;if(""!=s)try{l.setData({waiting:!0});const a=await e.post("/search",{query:s,theme:n,offset:t,count:10});return i=a.total,0==t?(l.model.results[n]=a.items,l.model.waiting=!1,l.update()):l.setData({waiting:!1}),a.items}catch(t){l.setData({waiting:!1}),$$.ui.showAlert({title:"Error",content:t.responseText})}}document.body.addEventListener("load",function(t){var e=t.target;"IMG"==e.tagName&&(e.style.display="inline")},!0)}});