$$.control.registerControl("rootPage",{deps:["breizbot.files","breizbot.pager"],template:'<div class="header" bn-show="recording">\n\t<span class="icon"><i class="fa fa-xs fa-circle blink"></i></span>\n\t<span bn-text="recordingTime" ></span>\n</div>\n<div class="footer">\n\t<button \n\t\ttitle="Start" \n\t\tbn-event="click: onStartRecord" \n\t\tbn-show="canRecord"\n\t\tclass="w3-btn w3-circle w3-blue w3-text-red">\n\t\t\t<i class="fa fa-lg fa-circle"></i>\n\t\t</button>\n\n\t\t<button \n\t\ttitle="Stop" \n\t\tbn-event="click: onStopRecord" \n\t\tbn-show="canStop"\n\t\tclass="w3-btn w3-circle w3-blue">\n\t\t\t<i class="fa fa-lg fa-stop"></i>\n\t\t</button>\n\n\t\t<button \n\t\ttitle="Take picture" \n\t\tbn-event="click: onTakePicture" \n\t\tbn-show="canRecord"\n\t\tbn-icon="fa fa-lg fa-camera"\n\t\tclass="w3-btn w3-circle w3-blue">\n\t\t</button>\t\t\n\n\t\t<button \n\t\ttitle="Start QR code detection" \n\t\tbn-event="click: onStartBarcodeDetection" \n\t\tbn-show="showBarcodeDetection"\n\t\tbn-icon="fa fa-lg fa-barcode"\n\t\tclass="w3-btn w3-circle w3-blue">\n\t\t</button>\t\t\n\n</div>\n\n<div \n\tbn-control="brainjs.combobox" \n\tbn-data="{items: videoDevices}"\n\tbn-event="comboboxchange: onDeviceChange"\n\tbn-show="show1"\n\t>\n\t\t\n</div>\n\n<div\n\tbn-control="brainjs.slider",\n\tdata-orientation=\'vertical\',\n\tclass="slider"\n\tbn-show="hasZoom"\n\tbn-event="slidechange: onZoomChange"\n\tbn-iface="slider"\n></div>\n\n<div class="main w3-pale-blue">\n\t<div bn-show="showMessage">Sorry, no video device found !</div>\n\t<div \n\t\tbn-control="brainjs.camera" \n\t\tbn-event="cameraready: onCameraReady, videorecord: onVideoRecord,  barcode: onBarcode"\n\t\tbn-data="{constraints}"\n\t\tbn-iface="camera">\n\t\t\t\n\t\t</div>\t\n\t\n</div>\n',init:function(t,e,n){let o=null,a=0;const c=new Audio(e.assetsUrl("camera_shutter.mp3"));const i=$$.viewController(t,{data:{ready:!1,recording:!1,barcodeDetectionAvailable:!1,recordingTime:"",videoDevices:[],constraints:{video:!0,audio:!0},showMessage:!1,barcodeDetectionStarted:!1,show1:function(){return this.videoDevices.length>1},canRecord:function(){return this.ready&&!this.recording&&!this.barcodeDetectionStarted},canStop:function(){return this.recording||this.barcodeDetectionStarted},canTakePicture:function(){return!0},showBarcodeDetection:function(){return this.ready&&this.barcodeDetectionAvailable&&!this.recording&&!this.barcodeDetectionStarted},hasZoom:!1},events:{onBarcode:function(t,e){console.log("onBarcode",e);const{format:n,rawValue:o}=e;let a=null;a="qr_code"==n?{link:`<a href="${o}" target="_blank">${o}</a>`}:{format:n,value:o},$$.ui.showAlert({title:"BarCode Detected",content:a},()=>{i.setData({barcodeDetectionStarted:!1})})},onStartBarcodeDetection:function(){i.setData({barcodeDetectionStarted:!0}),r.startBarcodeDetection()},onTakePicture:async function(t){c.play();const o=await r.takePicture(),a=URL.createObjectURL(o);n.pushPage("breizbot.viewer",{title:"Snapshot",props:{url:a,type:"image"},buttons:{save:{title:"Save",icon:"fa fa-save",onClick:function(){!async function(t){const n="SNAP"+Date.now()+".png";await e.saveFile(t,n)}(o)}}},onBack:function(){URL.revokeObjectURL(a)}})},onStartRecord:function(t){r.startRecord(),i.setData({recording:!0,recordingTime:"00:00"}),a=Date.now(),o=setInterval(()=>{const t=Date.now()-a;let e=Math.floor(t/1e3%60),n=Math.floor(t/6e4%60);n=n<10?"0"+n:n,e=e<10?"0"+e:e,i.setData({recordingTime:`${n}:${e}`})},1e3)},onStopRecord:function(t){i.model.recording?(r.stopRecord(),clearInterval(o),o=null,i.setData({recording:!1})):i.model.barcodeDetectionStarted&&(r.stopBarcodeDetection(),i.setData({barcodeDetectionStarted:!1}))},onVideoRecord:function(t,o){console.log("onVideoRecord",o);const{blob:a}=o,c=URL.createObjectURL(a);n.pushPage("breizbot.viewer",{title:"Recorded Video",props:{url:c,type:"video"},buttons:{save:{title:"Save",icon:"fa fa-save",onClick:function(){!async function(t){const n="VIDEO"+Date.now()+".webm";await e.saveFile(t,n)}(a)}}},onBack:function(){URL.revokeObjectURL(c)}})},onCameraReady:async function(){const t=await r.getCapabilities();if(t.zoom){const e=r.getSettings(),{min:n,max:o,step:a}=t.zoom;i.scope.slider.setData({min:n,max:o,step:a}),i.scope.slider.setValue(e.zoom),i.setData({hasZoom:!0})}i.setData({ready:!0})},onDeviceChange:function(t,e){console.log("onDeviceChange",$(this).getValue());const n={audio:!0,video:{deviceId:{exact:$(this).getValue()}}};i.setData({constraints:n})},onZoomChange:function(t){const e=$(this).getValue();console.log("onZoomChange",e),r.setZoom(e)}}}),r=i.scope.camera;i.setData({barcodeDetectionAvailable:r.isBarcodeDetectionAvailable()}),async function(){const t=await $$.media.getVideoDevices();i.setData({videoDevices:t.map(t=>({value:t.id,label:t.label}))}),t.length>0?i.scope.camera.start():i.setData({showMessage:!0})}()}});