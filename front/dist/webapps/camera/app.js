$$.control.registerControl("rootPage",{deps:["breizbot.files","breizbot.pager"],template:'<div class="footer">\n\t<button \n\t\ttitle="Take picture" \n\t\tbn-event="click: onTakePicture" \n\t\tbn-show="ready"\n\t\tclass="w3-button w3-circle w3-blue">\n\t\t\t<i class="fa fa-lg fa-camera"></i>\n\t\t</button>\n\t\n</div>\n\n<div \n\tbn-control="brainjs.combobox" \n\tbn-data="{items: videoDevices}"\n\tbn-event="comboboxchange: onDeviceChange"\n\tbn-show="show1"\n\t>\n\t\t\n</div>\n\n<div\n\tbn-control="brainjs.slider",\n\tdata-orientation=\'vertical\',\n\tclass="slider"\n\tbn-show="hasZoom"\n\tbn-event="slidechange: onZoomChange"\n\tbn-iface="slider"\n></div>\n\n<div class="main w3-pale-blue">\n\t<div bn-show="showMessage">Sorry, no video device found !</div>\n\t<div \n\t\tbn-control="brainjs.camera" \n\t\tbn-event="cameraready: onCameraReady"\n\t\tbn-data="{constraints}"\n\t\tbn-iface="camera">\n\t\t\t\n\t\t</div>\t\n\t\n</div>\n',init:function(e,t,n){const a=$$.ui.savingDialog(),o=new Audio("/webapps/camera/assets/camera_shutter.mp3");const s=$$.viewController(e,{data:{ready:!1,videoDevices:[],constraints:{video:!0},showMessage:!1,show1:function(){return this.videoDevices.length>1},hasZoom:!1},events:{onCameraReady:function(){console.log("onCameraReady");const e=$(this).iface();setTimeout(()=>{const t=e.getCapabilities();if(t.zoom){const n=e.getSettings(),{min:a,max:o,step:i}=t.zoom;s.scope.slider.setData({min:a,max:o,step:i}),s.scope.slider.setValue(n.zoom),s.setData({hasZoom:!0})}},500),s.setData({ready:!0})},onTakePicture:async function(e){o.play();const i=await s.scope.camera.takePicture();n.pushPage("breizbot.viewer",{title:"Snapshot",props:{url:URL.createObjectURL(i),type:"image"},buttons:{save:{title:"Save",icon:"fa fa-save",onClick:function(){!async function(e){const n="SNAP"+Date.now()+".png";console.log("fileName",n);try{a.show();const o=await t.uploadFile(e,n,"/apps/camera",e=>{a.setPercentage(e)});await $$.util.wait(1e3),a.hide(),console.log("resp",o)}catch(e){a.hide(),$$.ui.showAlert({title:"Error",content:e.responseText})}}(i)}}}})},onDeviceChange:function(e,t){console.log("onDeviceChange",$(this).getValue());const n={video:{deviceId:{exact:$(this).getValue()}}};s.setData({constraints:n})},onZoomChange:function(e){const t=$(this).getValue();console.log("onZoomChange",t),s.scope.camera.setZoom(t)}}});!async function(){const e=await $$.util.getVideoDevices();s.setData({videoDevices:e.map(e=>({value:e.id,label:e.label}))}),e.length>0?s.scope.camera.start():s.setData({showMessage:!0})}()}});