$$.control.registerControl("rootPage",{deps:["breizbot.files"],template:'<div class="footer">\n\t<button \n\t\ttitle="Take picture" \n\t\tbn-event="click: onTakePicture" \n\t\tbn-show="ready"\n\t\tclass="w3-button w3-circle w3-blue">\n\t\t\t<i class="fa fa-camera"></i>\n\t\t</button>\n\t\n</div>\n\n<div \n\tbn-control="brainjs.selectmenu" \n\tbn-data="{items: videoDevices}"\n\tbn-event="selectmenuchange: onDeviceChange"\n\tbn-show="videoDevices.length > 1"\n\t>\n\t\t\n</div>\n\n<div class="main w3-pale-blue">\n\t<div \n\t\tbn-control="brainjs.camera" \n\t\tbn-event="cameraready: onCameraReady"\n\t\tbn-data="{constraints}"\n\t\tbn-iface="camera">\n\t\t\t\n\t\t</div>\t\n\t\n</div>\n',props:{$pager:null},init:function(t,e){const n=new Audio("/webapps/camera/assets/camera_shutter.mp3"),{$pager:a}=this.props,o=$$.viewController(t,{data:{ready:!1,videoDevices:[],constraints:{video:!0}},events:{onCameraReady:function(){console.log("onCameraReady"),o.setData({ready:!0})},onTakePicture:function(t){n.play();const e=o.scope.camera.takePicture();a.pushPage("snapPage",{title:"Snapshot",props:{url:e}})},onDeviceChange:function(t,e){console.log("onDeviceChange",$(this).getValue());const n={video:{deviceId:{exact:$(this).getValue()}}};o.setData({constraints:n})}}});$$.util.getVideoDevices().then(t=>{o.setData({videoDevices:t.map(t=>({value:t.id,label:t.label}))})}),o.scope.camera.start()}}),$$.control.registerControl("snapPage",{deps:["breizbot.files"],template:'<div style="text-align: center; height: 100%">\n\t<img bn-attr="{src: url}" style="object-fit: scale-down; height: 100%; width: 100%" >\t\n</div>\n',props:{$pager:null,url:null},buttons:[{label:"Save",icon:"fa fa-save"}],init:function(t,e){const{url:n,$pager:a}=this.props;$$.viewController(t,{data:{url:n}});this.onAction=function(t){console.log("onAction",t);const o="SNAP"+Date.now()+".png";console.log("fileName",o);const i=$$.util.dataURLtoBlob(n);e.uploadFile(i,o,"/apps/camera").then(function(t){console.log("resp",t),a.popPage()}).catch(function(t){$$.ui.showAlert({title:"Error",content:t.responseText})})}}});