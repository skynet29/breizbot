$$.control.registerControl("rootPage",{template:'<div>\n\t<canvas class="visualizer" bn-bind="canvas"></canvas>\n\t<div>\n\t\t<button \n\t\t\tclass="w3-button w3-blue" \n\t\t\tbn-event="click: onRecord"\n\t\t\tbn-show="!recording"\n\t\t><i class="fas fa-circle"></i></button>\n\n\t\t<button \n\t\t\tclass="w3-button w3-red" \n\t\t\tbn-event="click: onStop"\n\t\t\tbn-show="recording"\n\t\t><i class="fa fa-stop"></i></button>\n\n\t</div>\n</div>\n\n<div class="scrollPanel">\n\t<div class="sound-clips" bn-each="clips" bn-event="click.delete: onDeleteClip, click.save: onSaveClip">\n\t\t<div class="clip">\n\t\t\t<audio bn-attr="{src: $scope.$i.url}" controls controlsList=nodownload></audio>\n\t\t\t<div class="clip-info">\n\t\t\t\t<span bn-text="$scope.$i.name"></span>\n\t\t\t\t<div>\n\t\t\t\t\t<button class="w3-button w3-blue save" title="Save clip" bn-show="!$scope.$i.saved"><i class="fa fa-save"></i></button>\n\t\t\t\t\t<button class="w3-button w3-blue delete" title="Delete clip"><i class="fa fa-trash"></i></button>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\t\n</div>\n\n',deps:["breizbot.files"],init:function(t,e){let n=null,o=[];const i=$$.ui.progressDialog(),s=$$.viewController(t,{data:{recording:!1,clips:[]},events:{onRecord:function(t){s.setData({recording:!0}),n.start()},onStop:function(t){s.setData({recording:!1}),n.stop()},onDeleteClip:function(t){const e=$(this).closest(".clip").index(),n=s.model.clips[e];URL.revokeObjectURL(n.url),s.model.clips.splice(e,1),s.update()},onSaveClip:async function(t){const n=$(this).closest(".clip").index(),o=s.model.clips[n];try{const n=await fetch(o.url),a=await n.blob();i.show();await e.saveFile(a,o.name+".ogg",t=>{i.setPercentage(t)});await $$.util.wait(1e3),i.hide(),o.saved=!0,s.update()}catch(e){i.hide(),$$.ui.showAlert({title:"Error",content:t.responseText})}}}}),a=s.scope.canvas.get(0),c=a.getContext("2d"),l=new AudioContext;navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{(n=new MediaRecorder(t)).ondataavailable=function(t){o.push(t.data)},n.onstop=async function(t){const e=await $$.ui.showPrompt({title:"Sound Clip Title",label:"Enter a name:"});if(null!=e){console.log("clipName",e);const t=new Blob(o,{type:"audio/ogg; codecs=opus"});o=[];const n=URL.createObjectURL(t);s.model.clips.push({name:e,url:n,saved:!1}),s.update()}},function(t){const e=l.createMediaStreamSource(t),n=l.createAnalyser();n.fftSize=2048;const o=n.frequencyBinCount,i=new Uint8Array(o);e.connect(n),function t(){const e=a.width,s=a.height;requestAnimationFrame(t),n.getByteTimeDomainData(i),c.fillStyle="rgb(200, 200, 200)",c.fillRect(0,0,e,s),c.lineWidth=2,c.strokeStyle="rgb(0, 0, 0)",c.beginPath();const l=e/o;let r=0;for(let t=0;t<o;t++){const e=i[t]/128,n=e*s/2;0==t?c.moveTo(r,n):c.lineTo(r,n),r+=l}c.lineTo(e,s/2),c.stroke()}()}(t)})}});