$$.control.registerControl("rootPage",{template:'<div>\n\t<canvas class="visualizer" bn-bind="canvas"></canvas>\n\t<div>\n\t\t<button \n\t\t\tclass="w3-button w3-blue" \n\t\t\tbn-event="click: onRecord"\n\t\t\tbn-show="!recording"\n\t\t><i class="fas fa-circle"></i></button>\n\n\t\t<button \n\t\t\tclass="w3-button w3-red" \n\t\t\tbn-event="click: onStop"\n\t\t\tbn-show="recording"\n\t\t><i class="fa fa-stop"></i></button>\n\n\t</div>\n</div>\n\n<div class="scrollPanel">\n\t<div class="sound-clips" bn-each="clips" bn-event="click.delete: onDeleteClip, click.save: onSaveClip">\n\t\t<div class="clip">\n\t\t\t<audio bn-attr="{src: $scope.$i.url}" controls controlsList=nodownload></audio>\n\t\t\t<div class="clip-info">\n\t\t\t\t<span bn-text="$scope.$i.name"></span>\n\t\t\t\t<div>\n\t\t\t\t\t<button class="w3-button w3-blue save" title="Save clip" bn-show="!$scope.$i.saved"><i class="fa fa-save"></i></button>\n\t\t\t\t\t<button class="w3-button w3-blue delete" title="Delete clip"><i class="fa fa-trash"></i></button>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\t\n</div>\n\n',deps:["breizbot.files"],init:function(t,n){let e=null,i=[];const o=$$.ui.savingDialog(),a=$$.viewController(t,{data:{recording:!1,clips:[]},events:{onRecord:function(t){a.setData({recording:!0}),e.start()},onStop:function(t){a.setData({recording:!1}),e.stop()},onDeleteClip:function(t){const n=$(this).closest(".clip").index(),e=a.model.clips[n];URL.revokeObjectURL(e.url),a.model.clips.splice(n,1),a.update()},onSaveClip:async function(t){const e=$(this).closest(".clip").index(),i=a.model.clips[e];try{const e=await fetch(i.url),s=await e.blob();o.show();await n.uploadFile(s,i.name+".ogg","/apps/micro",t=>{o.setPercentage(t)});await $$.util.wait(1e3),o.hide(),i.saved=!0,a.update()}catch(n){o.hide(),$$.ui.showAlert({title:"Error",content:t.responseText})}}}}),s=a.scope.canvas.get(0),c=s.getContext("2d"),l=new AudioContext;navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{(e=new MediaRecorder(t)).ondataavailable=function(t){i.push(t.data)},e.onstop=async function(t){const n=await $$.ui.showPrompt({title:"Sound Clip Title",label:"Enter a name:"});if(null!=n){console.log("clipName",n);const t=new Blob(i,{type:"audio/ogg; codecs=opus"});i=[];const e=URL.createObjectURL(t);a.model.clips.push({name:n,url:e,saved:!1}),a.update()}},function(t){const n=l.createMediaStreamSource(t),e=l.createAnalyser();e.fftSize=2048;const i=e.frequencyBinCount,o=new Uint8Array(i);n.connect(e),function t(){const n=s.width,a=s.height;requestAnimationFrame(t),e.getByteTimeDomainData(o),c.fillStyle="rgb(200, 200, 200)",c.fillRect(0,0,n,a),c.lineWidth=2,c.strokeStyle="rgb(0, 0, 0)",c.beginPath();const l=n/i;let r=0;for(let t=0;t<i;t++){const n=o[t]/128,e=n*a/2;0==t?c.moveTo(r,e):c.lineTo(r,e),r+=l}c.lineTo(n,a/2),c.stroke()}()}(t)})}});