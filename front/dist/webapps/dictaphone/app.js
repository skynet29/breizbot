$$.control.registerControl("rootPage",{template:'<div>\n\t<canvas class="visualizer" bn-bind="canvas"></canvas>\n\t<div>\n\t\t<button \n\t\t\tclass="w3-button" \n\t\t\tbn-event="click: onRecord"\n\t\t\tbn-prop="{disabled: recording}"\n\t\t\tbn-class="{\'w3-red\': recording, \'w3-blue\': !recording}"\n\t\t><i class="fas fa-circle"></i></button>\n\n\t\t<button \n\t\t\tclass="w3-button w3-blue" \n\t\t\tbn-event="click: onStop"\n\t\t\tbn-prop="{disabled: !recording}"\n\t\t><i class="fa fa-stop"></i></button>\n\n\t</div>\n</div>\n\n<div class="scrollPanel">\n\t<div class="sound-clips" bn-each="clips" bn-event="click.delete: onDeleteClip, click.save: onSaveClip">\n\t\t<div class="clip">\n\t\t\t<audio bn-attr="{src: $i.url}" controls=""></audio>\n\t\t\t<div class="clip-info">\n\t\t\t\t<span bn-text="$i.name"></span>\n\t\t\t\t<div>\n\t\t\t\t\t<button class="w3-button w3-blue" title="Save clip" bn-show="!$i.saved"><i class="fa fa-save save"></i></button>\n\t\t\t\t\t<button class="w3-button w3-blue" title="Delete clip"><i class="fa fa-trash delete"></i></button>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\t\n</div>\n\n',deps:["breizbot.files"],init:function(t,n){let e=null,o=[];const i=$$.viewController(t,{data:{recording:!1,clips:[]},events:{onRecord:function(t){console.log("onRecord"),i.setData({recording:!0}),e.start()},onStop:function(t){console.log("onStop"),i.setData({recording:!1}),e.stop()},onDeleteClip:function(t){const n=$(this).closest(".clip").index();i.model.clips.splice(n,1),i.update()},onSaveClip:function(t){console.log("onSaveClip");const e=$(this).closest(".clip").index(),o=i.model.clips[e];console.log("data",o),fetch(o.url).then(t=>t.blob()).then(t=>n.uploadFile(t,o.name+".ogg","/sounds/micro")).then(t=>{console.log("resp",t),o.saved=!0,i.update()}).catch(function(t){$$.ui.showAlert({title:"Error",content:t.responseText})})}}}),l=i.scope.canvas.get(0),s=l.getContext("2d"),c=new AudioContext;navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{(e=new MediaRecorder(t)).ondataavailable=function(t){o.push(t.data)},e.onstop=function(t){$$.ui.showPrompt({title:"Sound Clip Title",label:"Enter a name:"},function(t){console.log("clipName",t);const n=new Blob(o,{type:"audio/ogg; codecs=opus"});o=[];const e=URL.createObjectURL(n);i.model.clips.push({name:t,url:e,saved:!1}),i.update()})},function(t){const n=c.createMediaStreamSource(t),e=c.createAnalyser();e.fftSize=2048;const o=e.frequencyBinCount,i=new Uint8Array(o);n.connect(e),function t(){const n=l.width,c=l.height;requestAnimationFrame(t),e.getByteTimeDomainData(i),s.fillStyle="rgb(200, 200, 200)",s.fillRect(0,0,n,c),s.lineWidth=2,s.strokeStyle="rgb(0, 0, 0)",s.beginPath();const a=n/o;let r=0;for(let t=0;t<o;t++){const n=i[t]/128,e=n*c/2;0==t?s.moveTo(r,e):s.lineTo(r,e),r+=a}s.lineTo(n,c/2),s.stroke()}()}(t)})}});