$$.control.registerControl("rootPage",{template:'<div>\n\t<canvas class="visualizer" bn-bind="canvas"></canvas>\n\t<div>\n\t\t<button \n\t\t\tclass="w3-button w3-blue" \n\t\t\tbn-event="click: onRecord"\n\t\t\tbn-show="!recording"\n\t\t><i class="fas fa-circle"></i></button>\n\n\t\t<button \n\t\t\tclass="w3-button w3-red" \n\t\t\tbn-event="click: onStop"\n\t\t\tbn-show="recording"\n\t\t><i class="fa fa-stop"></i></button>\n\n\t</div>\n</div>\n\n<div class="scrollPanel">\n\t<div class="sound-clips" bn-each="clips" bn-event="click.delete: onDeleteClip, click.save: onSaveClip">\n\t\t<div class="clip">\n\t\t\t<audio bn-attr="{src: $scope.$i.url}" controls controlsList=nodownload></audio>\n\t\t\t<div class="clip-info">\n\t\t\t\t<span bn-text="$scope.$i.name"></span>\n\t\t\t\t<div>\n\t\t\t\t\t<button class="w3-button w3-blue save" title="Save clip" bn-show="!$scope.$i.saved"><i class="fa fa-save"></i></button>\n\t\t\t\t\t<button class="w3-button w3-blue delete" title="Delete clip"><i class="fa fa-trash"></i></button>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\t\n</div>\n\n',deps:["breizbot.files"],init:function(t,n){let e=null,o=[];const i=$$.viewController(t,{data:{recording:!1,clips:[]},events:{onRecord:function(t){i.setData({recording:!0}),e.start()},onStop:function(t){i.setData({recording:!1}),e.stop()},onDeleteClip:function(t){const n=$(this).closest(".clip").index(),e=i.model.clips[n];URL.revokeObjectURL(e.url),i.model.clips.splice(n,1),i.update()},onSaveClip:async function(t){const e=$(this).closest(".clip").index(),o=i.model.clips[e],a=await fetch(o.url),s=await a.blob();await n.saveFile(s,o.name+".ogg"),o.saved=!0,i.update()}}}),a=i.scope.canvas.get(0),s=a.getContext("2d"),c=new AudioContext;navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{(e=new MediaRecorder(t)).ondataavailable=function(t){o.push(t.data)},e.onstop=async function(t){const n=await $$.ui.showPrompt({title:"Sound Clip Title",label:"Enter a name:"});if(null!=n){console.log("clipName",n);const t=new Blob(o,{type:"audio/ogg; codecs=opus"});o=[];const e=URL.createObjectURL(t);i.model.clips.push({name:n,url:e,saved:!1}),i.update()}},function(t){const n=c.createMediaStreamSource(t),e=c.createAnalyser();e.fftSize=2048;const o=e.frequencyBinCount,i=new Uint8Array(o);n.connect(e),function t(){const n=a.width,c=a.height;requestAnimationFrame(t),e.getByteTimeDomainData(i),s.fillStyle="rgb(200, 200, 200)",s.fillRect(0,0,n,c),s.lineWidth=2,s.strokeStyle="rgb(0, 0, 0)",s.beginPath();const l=n/o;let d=0;for(let t=0;t<o;t++){const n=i[t]/128,e=n*c/2;0==t?s.moveTo(d,e):s.lineTo(d,e),d+=l}s.lineTo(n,c/2),s.stroke()}()}(t)})}});