$$.control.registerControl("rootPage",{template:'<div class="midi">\n    <div class="midiIO">\n        <div>MIDI Inputs</div>\n        <div bn-control="brainjs.combobox" bn-data="{items: midiInputs}" bn-event="comboboxchange: onMidiInputChange"></div>\n    </div>\n    <div class="midiIO">\n        <div>MIDI Outputs</div>\n        <div bn-control="brainjs.combobox" bn-data="{items: midiOutputs}"  bn-event="comboboxchange: onMidiOutputChange"></div>\n    </div>\n</div>\n<div class="top">\n    <div>\n        <div class="loadLeft">\n            <button class="w3-button w3-blue" bn-event="click: onLoad" data-audio="audio1">LOAD 1\n                <i class="fa fa-spinner fa-pulse" bn-show="audio1"></i>\n            </button>\n        </div>\n        <div bn-control="audioplayer" bn-data="options" bn-iface="audio1"></div>\n    </div>\n    <div>\n        <div>\n            <button class="w3-button w3-blue" bn-event="click: onLoad" data-audio="audio2">LOAD 2\n                <i class="fa fa-spinner fa-pulse" bn-show="audio2"></i>\n            </button>\n        </div>\n        <div bn-control="audioplayer" bn-data="options" bn-iface="audio2"></div>\n    </div>\n</div>\n<div class="bottom">\n    <div class="balance">\n        <label>Left</label>\n        <div bn-control="brainjs.slider" bn-data="{min: 0, max: 1, step: 0.01}" bn-event="input: onSliderChange" bn-val="crossFader"></div>\n        <label>Right</label>\n    </div>\n    \n</div>\n<div bn-control="breizbot.filelist" bn-data="{selectionEnabled: true, filterExtension: \'mp3\', getMP3Info: true}" bn-iface="filelist"></div>\n',deps:["breizbot.pager"],props:{},init:function(n,t){const e=[{action:"MASTER_LEVEL",cmd:191,note:10},{action:"CUE_LEVEL",cmd:191,note:12},{action:"CROSS_FADER",cmd:191,note:8},{action:"LEVEL",cmd:176,note:22,deck:1},{action:"PITCH",cmd:176,note:25,deck:1},{action:"LEVEL",cmd:177,note:22,deck:2},{action:"PITCH",cmd:177,note:25,deck:2},{action:"SYNC",cmd:144,note:2,deck:1},{action:"CUE",cmd:144,note:1,deck:1},{action:"PLAY",cmd:144,note:0,deck:1},{action:"PFL",cmd:144,note:27,deck:1},{action:"JOGTOUCH",cmd:144,note:6,deck:1},{action:"SYNC",cmd:145,note:2,deck:2},{action:"CUE",cmd:145,note:1,deck:2},{action:"PLAY",cmd:145,note:0,deck:2},{action:"PFL",cmd:145,note:27,deck:2},{action:"JOGTOUCH",cmd:145,note:6,deck:2},{action:"LOAD",cmd:159,note:2,deck:1},{action:"LOAD",cmd:159,note:3,deck:2},{action:"ENTER",cmd:159,note:6},{action:"JOG_WHEEL",cmd:176,note:6,deck:1},{action:"JOG_WHEEL",cmd:177,note:6,deck:2},{action:"SELECT_WHEEL",cmd:191,note:0},{action:"HOT_CUE",cmd:148,note:1,deck:1,key:1},{action:"HOT_CUE",cmd:148,note:2,deck:1,key:2},{action:"HOT_CUE",cmd:148,note:3,deck:1,key:3},{action:"HOT_CUE",cmd:148,note:4,deck:1,key:4},{action:"HOT_CUE",cmd:149,note:1,deck:2,key:1},{action:"HOT_CUE",cmd:149,note:2,deck:2,key:2},{action:"HOT_CUE",cmd:149,note:3,deck:2,key:3},{action:"HOT_CUE",cmd:149,note:4,deck:2,key:4},{action:"LOOP_AUTO",cmd:148,note:17,deck:1,key:1},{action:"LOOP_AUTO",cmd:148,note:18,deck:1,key:2},{action:"LOOP_AUTO",cmd:148,note:19,deck:1,key:3},{action:"LOOP_AUTO",cmd:148,note:20,deck:1,key:4},{action:"LOOP_AUTO",cmd:149,note:17,deck:2,key:1},{action:"LOOP_AUTO",cmd:149,note:18,deck:2,key:2},{action:"LOOP_AUTO",cmd:149,note:19,deck:2,key:3},{action:"LOOP_AUTO",cmd:149,note:20,deck:2,key:4},{action:"LOOP_MANUAL",cmd:148,note:33,deck:1,key:1},{action:"LOOP_MANUAL",cmd:148,note:34,deck:1,key:2},{action:"LOOP_MANUAL",cmd:148,note:35,deck:1,key:3},{action:"LOOP_MANUAL",cmd:148,note:36,deck:1,key:4},{action:"LOOP_MANUAL",cmd:149,note:33,deck:2,key:1},{action:"LOOP_MANUAL",cmd:149,note:34,deck:2,key:2},{action:"LOOP_MANUAL",cmd:149,note:35,deck:2,key:3},{action:"LOOP_MANUAL",cmd:149,note:36,deck:2,key:4},{action:"SAMPLER",cmd:148,note:49,deck:1,key:1},{action:"SAMPLER",cmd:148,note:50,deck:1,key:2},{action:"SAMPLER",cmd:148,note:51,deck:1,key:3},{action:"SAMPLER",cmd:148,note:52,deck:1,key:4},{action:"SAMPLER",cmd:149,note:49,deck:2,key:1},{action:"SAMPLER",cmd:149,note:50,deck:2,key:2},{action:"SAMPLER",cmd:149,note:51,deck:2,key:3},{action:"SAMPLER",cmd:149,note:52,deck:2,key:4}],o=$$.util.mapRange(0,127,0,1);let i=null,a=null,c=null;const d=$$.viewController(n,{data:{audio1:!1,audio2:!1,midiInputs:[],midiOutputs:[],crossFader:.5},events:{onSliderChange:function(){s($(this).getValue())},onLoad:async function(){const n=$(this).data("audio"),t=u.getSelFile();t&&(d.model[n]=!0,d.update(),await d.scope[n].setInfo(t),d.model[n]=!1,d.update())},onMidiInputChange:function(n,t){const e=$(this).getValue();console.log("onMidiInputChange",e),a&&(a.onmidimessage=null);for(const n of i.inputs.values())if(n.id==e)return void((a=n).onmidimessage=l)},onMidiOutputChange:function(n,t){const e=$(this).getValue();console.log("onMidiOutputChange",e);for(const n of i.outputs.values())if(n.id==e)return void(c=n)}}});function s(n){p.gain.value=Math.cos(.5*(1-n)*Math.PI),k.gain.value=Math.cos(.5*n*Math.PI)}async function l(n){const[t,i,a]=n.data,c=function(n){const[t,o]=n;for(const n of e)if(n.cmd==t&&n.note==o)return n;return null}(n.data);if(null==c)return;const{action:l,deck:r}=c;let m=null,v="";if(null!=r&&(v="audio"+r,m=d.scope[v]),"PLAY"==l)m.togglePlay();else if("LOAD"==l){const n=u.getSelFile();n&&(d.model[v]=!0,d.update(),await m.setInfo(n),d.model[v]=!1,d.update())}else if("CROSS_FADER"==l){const n=o(a);d.setData({crossFader:n}),s(n)}else if("LEVEL"==l){const n=o(a);m.setVolume(n)}else"SELECT_WHEEL"==l?1==a?u.selDown():u.selUp():"ENTER"==l&&u.enterSelFolder()}const u=d.scope.filelist,r=d.scope.audio1,m=d.scope.audio2,v=new AudioContext,b=v.createMediaElementSource(r.getAudioElement()),f=v.createMediaElementSource(m.getAudioElement()),k=v.createGain(),p=v.createGain();k.gain.value=.5,p.gain.value=.5,b.connect(k),f.connect(p),k.connect(v.destination),p.connect(v.destination),async function(){i=await navigator.requestMIDIAccess();const n=[];for(const{name:t,id:e}of i.inputs.values())n.push({label:t,value:e});const t=[];for(const{name:n,id:e}of i.outputs.values())t.push({label:n,value:e});d.setData({midiInputs:n,midiOutputs:t})}()}}),function(){function n(n){const t=new Date(1e3*n);return t.getMinutes().toString()+":"+t.getSeconds().toString().padStart(2,"0")}$$.control.registerControl("audioplayer",{template:'<div class="info">\n\t<div class="title" bn-show="!title">\n\t\t<strong>FileName:</strong>\n\t\t<span bn-text="name"></span>\n\t</div>\n\t<div class="title" bn-show="title">\n\t\t<strong>Title:</strong>\n\t\t<span bn-text="title"></span>\n\t</div>\n\t<div class="title" bn-show="artist">\n\t\t<strong>Artist:</strong>\n\t\t<span bn-text="artist"></span>\n\t</div>\n</div>\n<div class="toolbar">\n\t<div></div>\n\n\t<button bn-show="!playing" bn-event="click: onPlay" class="w3-btn w3-blue" title="Play" bn-icon="fa fa-lg fa-play">\n\t</button>\n\n\t<button bn-show="playing" bn-event="click: onPause" class="w3-btn w3-blue" title="Pause"\n\t\tbn-icon="fa fa-lg fa-pause">\n\t</button>\n\n\t<div class="toolbar2">\n\t\t<i class="fas fa-lg fa-volume-down w3-text-blue volume"></i>\n\t\t<div bn-control="brainjs.slider" bn-data="{min: 0, max:1, step: 0.01, orientation: \'vertical\'}"\n\t\t\tbn-event="input: onVolumeChange" bn-val="volume" class="volulmeSlider"></div>\n\t</div>\n\n</div>\n\n<div class="bufferContainer">\n\t<canvas bn-bind="bufferCanvas" class="bufferCanvas" width="470" height="100">\n</div>\n\n<div class="slider">\n\t<span bn-text="getTimeInfo"></span>\n\t<div bn-control="brainjs.slider" bn-data="{max: duration}" bn-event="input: onSliderChange" bn-val="curTime">\n\t</div>\n\n</div>\n\n<audio bn-attr="{src: url}" bn-bind="audio"\n\tbn-event="canplay: onLoad, timeupdate: onTimeUpdate, playing: onPlaying, pause: onPaused, ended: onEnded">\n</audio>',deps:["breizbot.pager"],props:{},init:function(t,e){const o=$$.viewController(t,{data:{url:"#",name:"",title:"",artist:"",volume:.5,duration:0,curTime:0,playing:!1,getTimeInfo:function(){return`${n(this.curTime)} / ${n(this.duration)}`}},events:{onVolumeChange:function(n,t){i.volume=t},onLoad:function(){i.volume=.5,o.setData({duration:Math.floor(i.duration),volume:i.volume})},onTimeUpdate:function(){o.setData({curTime:this.currentTime}),a.update(this.currentTime)},onPlaying:function(){o.setData({playing:!0})},onPaused:function(){o.setData({playing:!1})},onPlay:function(){i.play()},onPause:function(){i.pause()},onSliderChange:function(n,t){i.currentTime=t}}}),i=o.scope.audio.get(0),a=function(n,t){const{width:e,height:o}=n;console.log({width:e,height:o});const i=n.getContext("2d");"function"==typeof t&&(n.onclick=function(n){console.log("onclick",n.offsetX);const o=n.offsetX/e*d.duration;t(o)});const a=document.createElement("canvas");a.width=e,a.height=o;const c=a.getContext("2d");let d=null;function s(n){if(d){i.clearRect(0,0,e,o),i.drawImage(a,0,5);const t=e*n/d.duration;i.fillStyle="rgba(255, 255, 255, 0.33)",i.fillRect(0,0,t,o)}}return{load:async function(n){d=await $$.media.getAudioBuffer(n),console.log("duration",d.duration),$$.media.drawAudioBuffer(e,o-10,c,d,"black"),s(0)},update:s}}(o.scope.bufferCanvas.get(0),n=>{console.log({time:n}),i.currentTime=n});this.setInfo=async function(n){const{mp3:t,name:e,url:i}=n,{artist:c,title:d}=t;o.setData({name:e,url:i,artist:c,title:d}),await a.load(i)},this.getAudioElement=function(){return i},this.isPlaying=function(){return o.model.isPlaying},this.setVolume=function(n){i.volume=n,o.setData({volume:n})},this.togglePlay=function(){o.model.playing?i.pause():i.play()}}})}();