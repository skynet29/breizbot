$$.control.registerControl("rootPage",{template:'<div class="titlebar"><strong bn-text="fileName"></strong></div>\n<div class="toolbar">\n\t<div bn-control="brainjs.controlgroup">\n\t\t<button title="New File" bn-event="click: onNewFile">\n\t\t\t<i class="fa fa-file"></i></button>\n\t\t<button title="Save File" bn-event="click: onSaveFile">\n\t\t\t<i class="fa fa-save"></i></button>\n\t\t<button title="Open File" bn-event="click: onOpenFile">\n\t\t\t<i class="fa fa-folder-open"></i></button>\n\t</div>\n\t<div bn-control="brainjs.controlgroup">\n\t\t<button title="Insert image" bn-event="click: onInsertImage">\n\t\t\t<i class="fa fa-image"></i></button>\n\t</div>\n</div>\n<div bn-control="brainjs.htmleditor" bn-iface="editor"></div>',deps:["breizbot.files"],props:{$pager:null},init:function(e,t){const{$pager:o}=this.props;const n=$$.viewController(e,{data:{fileName:"",rootDir:""},events:{onNewFile:function(e){console.log("onNewFile"),n.scope.editor.html(""),n.setData({fileName:""})},onSaveFile:function(e){console.log("onSaveFile"),""==n.model.fileName?$$.ui.showPrompt({title:"Save File",content:"FileName:"},function(e){e+=".doc",n.setData({fileName:e,rootDir:"/apps/editor"}),i()}):i()},onOpenFile:function(e){console.log("onOpenFile"),o.pushPage("breizbot.files",{title:"Open File",props:{filterExtension:".doc"},onReturn:function(e){console.log("onReturn",e);const{fileName:o,rootDir:i,cmd:l}=e,r=t.fileUrl(i+o);n.setData({fileName:o,rootDir:i}),n.scope.editor.load(r)}})},onInsertImage:function(e){console.log("onInsertImage"),o.pushPage("breizbot.files",{title:"Insert Image",props:{imageOnly:!0,cmd:"insertImage",showThumbnail:!0},onReturn:function(e){console.log("onReturn",e);const{fileName:o,rootDir:i,cmd:l}=e,r=t.fileUrl(i+o);"openFile"==l&&(n.setData({fileName:o,rootDir:i}),n.scope.editor.load(r)),"insertImage"==l&&n.scope.editor.insertImage(r)}})}}});function i(){const{fileName:e,rootDir:o}=n.model,i=n.scope.editor.html(),l=new Blob([i],{type:"text/html"});t.uploadFile(l,e,o).then(function(e){console.log("resp",e)}).catch(function(e){$$.ui.showAlert({title:"Error",content:e.responseText})})}this.onReturn=function(e){if(console.log("onReturn",e),null==e)return;const{fileName:o,rootDir:i,cmd:l}=e,r=t.fileUrl(i+o);"openFile"==l&&(n.setData({fileName:o,rootDir:i}),n.scope.editor.load(r)),"insertImage"==l&&n.scope.editor.insertImage(r)}}});