$$.control.registerControl("rootPage",{template:'<div class="titlebar"><strong bn-text="fileName"></strong></div>\n<div class="toolbar">\n\t<div bn-control="brainjs.controlgroup">\n\t\t<button title="New File" bn-event="click: onNewFile">\n\t\t\t<i class="fa fa-file"></i></button>\n\t\t<button title="Save File" bn-event="click: onSaveFile">\n\t\t\t<i class="fa fa-save"></i></button>\n\t\t<button title="Open File" bn-event="click: onOpenFile">\n\t\t\t<i class="fa fa-folder-open"></i></button>\n\t</div>\n\t<div bn-control="brainjs.controlgroup">\n\t\t<button title="Insert image" bn-event="click: onInsertImage">\n\t\t\t<i class="fa fa-image"></i></button>\n\t</div>\n</div>\n<div bn-control="brainjs.htmleditor" bn-iface="editor"></div>',deps:["breizbot.files","breizbot.pager"],init:function(e,t,o){const n=$$.ui.progressDialog(),i=$$.viewController(e,{data:{fileName:"",rootDir:""},events:{onNewFile:function(e){console.log("onNewFile"),i.scope.editor.html(""),i.setData({fileName:""})},onSaveFile:async function(e){if(console.log("onSaveFile"),""!=i.model.fileName)return void l();let t=await $$.ui.showPrompt({title:"Save File",label:"FileName:"});console.log("fileName",t),null!=t&&(t+=".hdoc",i.setData({fileName:t,rootDir:"/apps/editor"}),l())},onOpenFile:function(e){console.log("onOpenFile"),o.pushPage("breizbot.files",{title:"Open File",props:{filterExtension:".hdoc"},events:{fileclick:function(e,t){o.popPage(t)}},onReturn:function(e){console.log("onReturn",e);const{fileName:o,rootDir:n}=e,l=t.fileUrl(n+o);i.setData({fileName:o,rootDir:n}),i.scope.editor.load(l)}})},onInsertImage:function(e){console.log("onInsertImage"),o.pushPage("breizbot.files",{title:"Insert Image",props:{imageOnly:!0,showThumbnail:!0},events:{fileclick:function(e,t){o.popPage(t)}},onReturn:function(e){console.log("onReturn",e);const{fileName:o,rootDir:n}=e,l=t.fileUrl(n+o);i.scope.editor.insertImage(l)}})}}});async function l(){const{fileName:e,rootDir:o}=i.model,l=i.scope.editor.html(),a=new Blob([l],{type:"text/html"});try{n.show();const i=await t.uploadFile(a,e,o,e=>{n.setPercentage(e)});console.log("resp",i),await $$.util.wait(1e3),n.hide()}catch(e){n.hide(),$$.ui.showAlert({title:"Error",content:e.responseText})}}}});