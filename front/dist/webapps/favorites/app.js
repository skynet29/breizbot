$$.control.registerControl("addLink",{template:'<form bn-event="submit: onSubmit">\n    <label>Name</label>\n    <input type="text" required name="name">\n\n    <label>link</label>\n    <input type="url" required name="link">\n\n    <input type="submit" hidden bn-bind="submit">\n</form>',deps:["breizbot.pager"],init:function(n,t){const e=$$.viewController(n,{events:{onSubmit:function(n){n.preventDefault(),t.popPage($(this).getFormData())}}});this.getButtons=function(){return{apply:{title:"Apply",icon:"fas fa-check",onClick:function(){e.scope.submit.click()}}}}}}),$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n\n    <div class="left" bn-style="{visibility: isVisible}">\n        <button class="w3-button" title="Back" bn-event="click: onBack"><i class="fa fa-arrow-left"></i></button>\n        <span>Edit Favorites</span>\n    </div>\n\n    <div class="right">\n        <button class="w3-button" title="Remove" \n            bn-event="click: onRemove" \n            bn-show="isEdited" \n            bn-prop="{disabled: !canRemove}"><i class="fas fa-trash"></i></button>\n\n        <button class="w3-button" title="Add Folder" \n            bn-event="click: onAddFolder" \n            bn-prop="{disabled: !canAdd}"\n            bn-show="isEdited"><i class="fas fa-folder-plus"></i></button>\n    \n        <button class="w3-button" title="Add Link" \n            bn-event="click: onAddLink" \n            bn-prop="{disabled: !canAdd}"\n            bn-show="isEdited"><i class="fas fa-link"></i></button>\n    \n        <button class="w3-button" title="Edit" bn-event="click: onEdit" bn-show="!isEdited"><i class="fas fa-edit"></i></button>\n    \n    </div>\n\n</div>\n\n<div bn-control="brainjs.tree" \n    bn-data="{source, options}"\n    bn-event="treeactivate: onItemSelected"\n    ></div>\n\n',deps:["breizbot.pager","breizbot.http"],init:function(n,t,e){function i(n,t){return e.post("/addFavorite",{parentId:n,info:t})}const o=$$.viewController(n,{data:{isEdited:!1,selNode:null,isVisible:function(){return this.isEdited?"visible":"hidden"},canRemove:function(){return null!=this.selNode},canAdd:function(){return null!=this.selNode&&!0===this.selNode.folder},source:[{title:"Home",folder:!0,lazy:!0,key:"0"}],options:{renderNode:function(n,t){const{node:e}=t;e.data.icon&&$(e.span).find("> span.fancytree-icon").css({backgroundImage:`url(data:image/x-icon;base64,${e.data.icon})`,backgroundPosition:"0 0"})},lazyLoad:function(n,t){const i=t.node.key;t.result=function(n){return e.post("/getFavorites",{parentId:n})}(i).then(n=>n.map(n=>{const{name:t,type:e,link:i,icon:o}=n.info;return"folder"==e?{title:t,folder:!0,lazy:!0,key:n._id}:{title:t,key:n._id,data:{link:i,icon:o}}}))}}},events:{onItemSelected:function(n,t){if(o.setData({selNode:t}),!o.model.isEdited){const{link:n}=t.data;null!=n&&window.open(n),t.setActive(!1)}},onEdit:function(){o.setData({isEdited:!0})},onBack:function(){o.setData({isEdited:!1})},onAddFolder:async function(){const n=await $$.ui.showPrompt({title:"Add Folder",label:"Name:"});if(null!=n){const{selNode:t}=o.model,e=t.key,d=await i(e,{type:"folder",name:n});t.addNode({title:n,folder:!0,lazy:!0,key:d.id}),t.setExpanded(!0)}},onAddLink:function(){t.pushPage("addLink",{title:"Add Link",onReturn:async function(n){const{name:t,link:e}=n,{selNode:d}=o.model,a=d.key,l=await i(a,{type:"link",name:t,link:e});d.addNode({title:t,key:l._id,data:{link:e,icon:l.info.icon}}),d.setExpanded(!0)}})},onRemove:async function(){const{selNode:n}=o.model;var t;await(t=n.key,e.delete("/removeFavorite/"+t)),n.remove()}}})}});