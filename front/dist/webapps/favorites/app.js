$$.control.registerControl("addLink",{template:'<div>\n    <form bn-event="submit: onSubmit" bn-form="data">\n        <label>Name</label>\n        <input type="text" required name="name">\n    \n        <label>link</label>\n        <input type="url" required name="link">\n    \n        <input type="submit" hidden bn-bind="submit">\n    </form>\n</div>\n',deps:["breizbot.pager"],props:{data:{}},init:function(e,t){const{data:n}=this.props,o=$$.viewController(e,{data:{data:n},events:{onSubmit:function(e){e.preventDefault(),t.popPage($(this).getFormData())}}});this.getButtons=function(){return{apply:{title:"Apply",icon:"fas fa-check",onClick:function(){o.scope.submit.click()}}}}}}),$$.control.registerControl("rootPage",{template:'\n<div class="content">\n    <div bn-control="brainjs.tree" \n    bn-data="{source, options, contextMenu: getContextMenu}"\n    bn-event="treeclick: onItemSelected, treecontextmenu: onTreeContextMenu"\n    bn-iface="tree"\n    ></div>\n\n</div>\n\n',deps:["breizbot.pager","breizbot.http"],init:function(e,t,n){let o=null;const i={renderNode:function(e,t){const{node:n}=t;if(n.data.icon){const e=$(n.span);e.css({display:"flex",alignItems:"center"}),e.find("> span.fancytree-icon").css({backgroundImage:`url(${n.data.icon})`,backgroundPosition:"0 0",backgroundSize:"16px 16px"})}}};$$.util.isTouchDevice()||(i.dnd={autoExpandMS:400,dragStart:function(){return!0},dragEnter:function(e,t){return e.isFolder()||t.otherNode.isFolder()?["before","over"]:["before"]},dragDrop:async function(e,t){const o=t.otherNode.key;if("before"==t.hitMode){const t=e.getIndex();console.log("beforeIdx",t);const i=e.parent.key;await n.post("/insertBefore",{id:o,newParentId:i,beforeIdx:t})}else await n.post("/changeParent",{id:o,newParentId:e.key});t.otherNode.moveTo(e,t.hitMode),e.setExpanded(!0)}});const a=$$.viewController(e,{data:{source:[],options:i,getContextMenu:function(){return function(e){const t={};return(e=a.scope.tree.getActiveNode())!=a.scope.tree.getRootNode().getFirstChild()&&(t.del={name:"Delete",icon:"fas fa-trash-alt"}),e.isFolder()?(t.addFolder={name:"Add Folder",icon:"fas fa-folder-plus"},t.addLink={name:"Add Link",icon:"fas fa-link"}):(t.edit={name:"Edit",icon:"fas fa-edit"},t.setPwd={name:"Set Password",icon:"fas fa-lock"},t.getPwd={name:"View Password",icon:"fas fa-eye"}),t}}},events:{onTreeContextMenu:async function(e,i){const{action:a,node:d}=i;if("addFolder"==a){const e=await $$.ui.showPrompt({title:"Add Folder",label:"Name:"});if(null!=e){const t=d.key,o=await n.post("/addFavorite",{parentId:t,info:{type:"folder",name:e}});d.addNode({title:e,folder:!0,key:o.id}),d.setExpanded(!0)}}else if("addLink"==a)t.pushPage("addLink",{title:"Add Link",onReturn:async function(e){const{name:t,link:o}=e,i=d.key,a=await n.post("/addFavorite",{parentId:i,info:{type:"link",name:t,link:o}});d.addNode({title:t,key:a.id,data:{link:o,icon:a.info.icon}}),d.setExpanded(!0)}});else if("edit"==a)t.pushPage("addLink",{title:"Edit Link",props:{data:{name:d.title,link:d.data.link}},onReturn:async function(e){const{name:t,link:o}=e,i=await n.post("/updateLink",{id:d.key,name:t,link:o});d.setTitle(t),d.data.link=o,d.data.icon=i.icon,d.render()}});else if("del"==a)await n.delete(`/removeFavorite/${d.key}`),d.remove();else if("setPwd"==a){if(null==o&&(o=await $$.ui.showPrompt({title:"Key Password",label:"password"})),null!=o){const e=await $$.ui.showPrompt({title:"Site Password",label:"password"}),t=await $$.crypto.encrypt(o,e);await n.post("/setPwd",{id:d.key,pwd:t})}}else if("getPwd"==a&&(null==o&&(o=await $$.ui.showPrompt({title:"Key Password",label:"password",attrs:{type:"password"}})),null!=o)){const{pwd:e}=await n.post("/getPwd",{id:d.key}),t=await $$.crypto.decrypt(o,e);$$.ui.showAlert({title:"Site Password",content:t})}},onItemSelected:function(e,t){console.log("onItemSelected",t.title);const{link:n}=t.data;null!=n&&window.open(n)}}});!async function(){const e=await n.post("/getFavorites");a.setData({source:[e],selNode:null}),a.scope.tree.getRootNode().getFirstChild().setExpanded(!0)}()}});