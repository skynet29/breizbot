$$.control.registerControl("addLink",{template:'<form bn-event="submit: onSubmit">\n    <label>Name</label>\n    <input type="text" required name="name">\n\n    <label>link</label>\n    <input type="url" required name="link">\n\n    <input type="submit" hidden bn-bind="submit">\n</form>',deps:["breizbot.pager"],init:function(e,n){const t=$$.viewController(e,{events:{onSubmit:function(e){e.preventDefault(),n.popPage($(this).getFormData())}}});this.getButtons=function(){return{apply:{title:"Apply",icon:"fas fa-check",onClick:function(){t.scope.submit.click()}}}}}}),$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n\n    <div class="left" bn-style="{visibility: isVisible}">\n        <button class="w3-button" title="Back" bn-event="click: onBack"><i class="fa fa-arrow-left"></i></button>\n        <span>Edit Favorites</span>\n    </div>\n\n    <div class="right">\n        <button class="w3-button" title="Remove" \n            bn-event="click: onRemove" \n            bn-show="isEdited" \n            bn-prop="{disabled: !canRemove}"><i class="fas fa-trash"></i></button>\n\n        <button class="w3-button" title="Add Folder" \n            bn-event="click: onAddFolder" \n            bn-prop="{disabled: !canAdd}"\n            bn-show="isEdited"><i class="fas fa-folder-plus"></i></button>\n    \n        <button class="w3-button" title="Add Link" \n            bn-event="click: onAddLink" \n            bn-prop="{disabled: !canAdd}"\n            bn-show="isEdited"><i class="fas fa-link"></i></button>\n    \n            <button class="w3-button" title="Update" bn-event="click: onUpdate" bn-show="!isEdited"><i class="fas fa-redo-alt"></i></button>\n            <button class="w3-button" title="Edit" bn-event="click: onEdit" bn-show="!isEdited"><i class="fas fa-edit"></i></button>\n    \n    </div>\n\n</div>\n\n<div class="content">\n    <div bn-control="brainjs.tree" \n    bn-data="{source, options}"\n    bn-event="treeactivate: onItemSelected"\n    bn-iface="tree"\n    ></div>\n\n</div>\n\n',deps:["breizbot.pager","breizbot.http"],init:function(e,n,t){async function o(){const e=await t.post("/getFavorites");console.log("results",e),s.setData({source:[e],selNode:null}),s.scope.tree.getRootNode().getFirstChild().setExpanded(!0)}function i(e,n){return t.post("/addFavorite",{parentId:e,info:n})}const d={renderNode:function(e,n){const{node:t}=n;if(t.data.icon){const e=$(t.span);e.css({display:"flex",alignItems:"center"}),e.find("> span.fancytree-icon").css({backgroundImage:`url(${t.data.icon})`,backgroundPosition:"0 0",backgroundSize:"16px 16px"})}}};$$.util.isTouchDevice()||(d.dnd={autoExpandMS:400,dragStart:function(){return s.model.isEdited},dragEnter:function(e,n){return console.log("dragEnter"),e.isFolder()||n.otherNode.isFolder()?["before","over"]:["before"]},dragDrop:function(e,n){const o=n.otherNode.key;if("before"==n.hitMode){const n=e.getIndex();console.log("beforeIdx",n),function(e,n,o){t.post("/insertBefore",{id:e,newParentId:n,beforeIdx:o})}(o,e.parent.key,n)}else!function(e,n){t.post("/changeParent",{id:e,newParentId:n})}(o,e.key);n.otherNode.moveTo(e,n.hitMode),e.setExpanded(!0)}});const s=$$.viewController(e,{data:{isEdited:!1,selNode:null,isVisible:function(){return this.isEdited?"visible":"hidden"},canRemove:function(){return null!=this.selNode&&"0"!=this.selNode.key},canAdd:function(){return null!=this.selNode&&this.selNode.isFolder()},source:[],options:d},events:{onUpdate:function(){o()},onItemSelected:function(e,n){if(s.setData({selNode:n}),!s.model.isEdited){const{link:e}=n.data;null!=e&&window.open(e),n.setActive(!1)}},onEdit:function(){s.setData({isEdited:!0,selNode:null})},onBack:function(){const{selNode:e}=s.model;null!=e&&e.setActive(!1),s.setData({isEdited:!1,selNode:null})},onAddFolder:async function(){const e=await $$.ui.showPrompt({title:"Add Folder",label:"Name:"});if(null!=e){const{selNode:n}=s.model,t=n.key,o=await i(t,{type:"folder",name:e});n.addNode({title:e,folder:!0,key:o.id}),n.setExpanded(!0)}},onAddLink:function(){n.pushPage("addLink",{title:"Add Link",onReturn:async function(e){const{name:n,link:t}=e,{selNode:o}=s.model,d=o.key,a=await i(d,{type:"link",name:n,link:t});o.addNode({title:n,key:a.id,data:{link:t,icon:a.info.icon}}),o.setExpanded(!0)}})},onRemove:async function(){const{selNode:e}=s.model;var n;await(n=e.key,t.delete("/removeFavorite/"+n)),e.remove(),s.setData({selNode:null})}}});o()}});