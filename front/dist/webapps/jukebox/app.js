$$.control.registerControl("editDlg",{template:'<form bn-event="submit: onSubmit">\n    <label>Title</label>\n    <input type="text" bn-val="title" bn-update="input" required>\n    <label>Artist</label>\n    <input type="text" bn-val="artist" bn-update="input" required>\n\n\n    <input type="submit" hidden bn-bind="submit">\n</form>\n\n<div class="toolbar">\n    <button type="button" title="Find Info" bn-event="click: onFindInfo" class="w3-btn w3-blue w3-circle">\n        <i class="fa fa-search"></i>\n    </button>\n    \n</div>\n',deps:["breizbot.http","breizbot.pager"],props:{data:{},fileName:""},init:function(t,n,e){const{data:i,fileName:o}=this.props,a=$$.viewController(t,{data:{title:i.title,artist:i.artist},events:{onFindInfo:function(){n.post("/search",{query:o.replace(".mp3","")}).then(t=>{console.log(t),t&&t.title?a.setData({title:t.title,artist:t.artist}):$$.ui.showAlert({title:"MP3 Information",content:"No information found !"})})},onSubmit:function(t){t.preventDefault();const{title:n,artist:i}=a.model;e.popPage({title:n,artist:i})}}});this.getButtons=function(){return{ok:{title:"Apply",icon:"fa fa-check",onClick:function(){a.scope.submit.click()}}}}}}),$$.control.registerControl("rootPage",{template:'<p>Select a file system</p>\n\n<ul class="w3-ul w3-border w3-white">\n\t<li class="w3-bar" bn-event="click: onHome">\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-home fa-2x fa-fw w3-text-blue"></i>\n\t\t\t<span>Your home files</span>\n\t\t</div>\n\t</li>\n\n\t<li class="w3-bar" bn-event="click: onShare">\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-share-alt fa-2x fa-fw w3-text-blue"></i>\n\t\t\t<span>Files shared by your friends</span>\n\t\t</div>\n\t</li>\n</ul>\t',deps:["breizbot.pager"],init:function(t,n){function e(t,e){n.pushPage("breizbot.files",{title:t,props:{filterExtension:".mp3",getMP3Info:!0,friendUser:e},events:{fileclick:function(t,i){const{rootDir:o,fileName:a}=i,s=$(this).iface(),l=s.getFiles(),r=l.findIndex(t=>t.name==a);n.pushPage("player",{title:"Player",props:{firstIdx:r,files:l,rootDir:o,friendUser:e},onBack:function(){s.update()}})}}})}$$.viewController(t,{data:{},events:{onHome:function(){e("Home files","")},onShare:function(){n.pushPage("breizbot.friends",{title:"Shared files",props:{showConnectionState:!1},events:{friendclick:function(t,n){const{userName:i}=n;e(i,i)}}})}}})}}),function(){function t(t){const n=new Date(1e3*t);return(n.getMinutes()+n.getSeconds()/100).toFixed(2).replace(".",":")}$$.control.registerControl("player",{template:'<div class="title" bn-show="!title">\n\t<strong>FileName:&nbsp;</strong>\n\t<span bn-text="name"></span>\n</div>\n<div class="title" bn-show="title">\n\t<strong>Title:&nbsp;</strong>\n\t<span bn-text="title"></span>\n</div>\n<div class="title" bn-show="artist">\n\t<strong>Artist:&nbsp;</strong>\n\t<span bn-text="artist"></span>\n</div>\n<div class="toolbar">\n\t\t<button bn-prop="prop1" bn-event="click: onPrev" class="w3-btn w3-blue" title="Previous">\n\t\t\t<i class="fa fa-lg fa-step-backward"></i>\n\t\t</button>\n\t\t\n\t\t<button bn-show="!playing" bn-event="click: onPlay" class="w3-btn w3-blue" title="Play">\n\t\t\t<i class="fa fa-lg fa-play"></i>\n\t\t</button>\n\t\t\n\t\t<button bn-show="playing" bn-event="click: onPause" class="w3-btn w3-blue" title="Pause">\n\t\t\t<i class="fa fa-lg fa-pause"></i>\n\t\t</button>\n\t\t\n\t\t<button bn-prop="prop2" bn-event="click: onNext" class="w3-btn w3-blue" title="Next">\n\t\t\t<i class="fa fa-lg fa-step-forward"></i>\n\t\t</button>\t\n\n\t\t\x3c!-- <button bn-event="click: onEditInfo" class="w3-btn w3-blue" title="Edit Info">\n\t\t\t<i class="fa fa-lg fa-edit"></i>\n\t\t</button>\t\t --\x3e\n\n</div>\n\n<div class="shuffle">\n\t<span>Shuffle</span>\n\t<div \n\t\tbn-control="brainjs.flipswitch"\n\t\tbn-event="flipswitchchange: onShuffleChange"\n\t\tdata-width="100"\n\t\tdata-height="25"\n\t\t>\n\t\t\n\t</div>\t\t\t\n</div>\n\n\n<div class="slider">\n\t<span bn-text="getTimeInfo"></span>\n\t<div bn-control="brainjs.slider" \n\t\tbn-data="{max: duration}"\n\t\tbn-event="input: onSliderChange" \t\t \n\t\tbn-val="curTime">\t\t\n\t</div>\n\t\n</div>\n\n<audio \n\tbn-attr="{src}" \n\tbn-bind="audio"\n\tautoplay="" \n\tbn-event="canplay: onLoad, timeupdate: onTimeUpdate, playing: onPlaying, pause: onPaused, ended: onEnded">\t\t\n</audio>\n',deps:["breizbot.files","breizbot.http","breizbot.pager"],props:{rootDir:"",files:[],firstIdx:0,friendUser:""},init:function(n,e,i,o){const{rootDir:a,files:s,firstIdx:l,friendUser:r}=this.props;let c=null,u=null;navigator.wakeLock&&navigator.wakeLock.request&&navigator.wakeLock.request("screen").then(t=>{console.log("take wakeLock"),(u=t).addEventListener("release",()=>{console.log("Wake Lock was released")})}).catch(t=>{$$.ui.showAlert({title:"WakeLock",content:t})}),this.dispose=function(){null!=u&&(console.log("release wakeLock"),u.release())};const f=$$.viewController(n,{data:{idx:l,nbFiles:s.length,src:v(l),name:h(l),title:g(l),artist:m(l),duration:0,curTime:0,playing:!1,prop1:function(){return{disabled:!(this.idx>0)}},prop2:function(){return{disabled:!(this.idx<this.nbFiles-1)}},getTimeInfo:function(){return`${t(this.curTime)} / ${t(this.duration)}`}},events:{onLoad:function(){f.setData({duration:Math.floor(this.duration)})},onTimeUpdate:function(){f.setData({curTime:this.currentTime})},onPlaying:function(){f.setData({playing:!0})},onPaused:function(){f.setData({playing:!1})},onPlay:function(){b.play()},onPause:function(){b.pause()},onSliderChange:function(t,n){b.currentTime=n},onShuffleChange:function(t,n){c="ON"==n?function(t){let n=[];for(let e=0;e<t;e++)n.push(e);var e,i,o;for(o=n.length-1;o>0;o-=1)e=Math.floor((o+1)*Math.random()),i=n[e],n[e]=n[o],n[o]=i;return n}(f.model.nbFiles):null},onEnded:d,onPrev:function(){let{idx:t}=f.model;t>0&&p(t-1)},onNext:d}});function d(){if(null!=c)return void(c.length>0&&p(c.pop()));let{idx:t,nbFiles:n}=f.model;t<n-1&&p(t+1)}function p(t){f.setData({src:v(t),title:g(t),name:h(t),artist:m(t),idx:t})}const b=f.scope.audio.get(0);function h(t){return s[t].name}function g(t){return s[t].mp3.title||""}function m(t){return s[t].mp3.artist||""}function v(t){return e.fileUrl(a+s[t].name,r)}this.getButtons=function(){return{editInfo:{title:"Edit Info",icon:"fa fa-edit",onClick:function(){const{idx:t,name:n}=f.model;o.pushPage("editDlg",{title:"Edit MP3 Info",props:{data:s[t].mp3,fileName:n},onReturn:function(e){s[t].mp3=e,f.setData(e),i.post("/saveInfo",{filePath:a+n,friendUser:r,tags:e})}})}}}}}})}();