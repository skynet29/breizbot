$$.control.registerControl("rootPage",{template:'<p>Select a file system</p>\n<ul class="w3-ul w3-border w3-white">\n\t<li class="w3-bar" bn-event="click: onHome">\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-home fa-2x fa-fw w3-text-blue"></i>\n\t\t\t<span>Your home files</span>\n\t\t</div>\n\t</li>\n\n\t<li class="w3-bar" bn-event="click: onShare">\n\t\t<div class="w3-bar-item">\n\t\t\t<i class="fa fa-share-alt fa-2x fa-fw w3-text-blue"></i>\n\t\t\t<span>Files shared by your friends</span>\n\t\t</div>\n\t</li>\n</ul>\t',deps:["breizbot.pager","breizbot.files"],init:function(n,t,e){function i(n,i){t.pushPage("breizbot.files",{title:n,props:{filterExtension:"mp4",friendUser:i},events:{fileclick:function(n,o){console.log("fileclick",o);const{rootDir:a,fileName:s}=o,c=e.fileUrl(a+s,i);t.pushPage("VidoCtrl",{title:"Video",props:{url:c}})}}})}$$.viewController(n,{data:{},events:{onHome:function(){i("Home files","")},onShare:function(){t.pushPage("breizbot.friends",{title:"Shared files",props:{showConnectionState:!1},events:{friendclick:function(n,t){const{userName:e}=t;i(e,e)}}})}}})}}),$$.control.registerControl("VidoCtrl",{template:'<div class="header">\n\t<label>Audio Input</label>\n\t<div \n\tbn-control="brainjs.combobox" \n\tbn-data="{items: audioDevices}"\n\tbn-event="comboboxchange: onAudioDeviceChange"\n\t></div>\n\t\t\n</div>\n<div class="top">\n\t<div class="video">\n\t\t<video bn-attr="{src: url}" controls="" controlsList=nodownload bn-bind="video"></video>\n\t</div>\n\t<div class="gain">\n\t\t<div class="gainItem">\n\t\t\t<label>Micro</label>\n\t\t\t<div bn-control="brainjs.slider" bn-data="{min: 0, max: 1, step:0.1, orientation: \'vertical\'}" bn-val="micGain" bn-event="input: onMicGainChange"></div>\n\t\t</div>\n\t\t<div class="gainItem">\n\t\t\t<label>Video</label>\n\t\t\t<div bn-control="brainjs.slider" bn-data="{min: 0, max: 1, step:0.1, orientation: \'vertical\'}" bn-val="videoGain" bn-event="input: onVideoGainChange"></div>\n\t\t</div>\n\t</div>\n\t\n\t</div>\n</div>\n\n\n<canvas class="visualizer" bn-bind="canvas"></canvas>\n\n\n\n',deps:["breizbot.files"],props:{url:"#"},init:function(n,t){const{url:e}=this.props,i=$$.viewController(n,{data:{micGain:.5,videoGain:.5,url:e,audioDevices:[]},events:{onMicGainChange:function(n,t){r.gain.value=t},onVideoGainChange:function(n,t){d.volume=t},onAudioDeviceChange:async function(){const n=$(this).getValue();await u(o(n))}}});function o(n){return{audio:{deviceId:{exact:n}}}}let a=null;const s=i.scope.canvas.get(0),c=s.getContext("2d"),l=new AudioContext,r=l.createGain();r.gain.value=i.model.micGain;const d=i.scope.video.get(0);i.setData({videoGain:d.volume});const v=l.createMediaElementSource(d);async function u(n){console.log("initNodes",n),a=await navigator.mediaDevices.getUserMedia(n);const t=l.createMediaStreamSource(a);t.connect(r);const e=l.createChannelSplitter();v.connect(e);const i=l.createChannelMerger();r.connect(i,0,0),r.connect(i,0,1),e.connect(i,0,0),e.connect(i,1,1),i.connect(l.destination),function(n){const t=l.createAnalyser();t.fftSize=2048;const e=t.frequencyBinCount,i=new Uint8Array(e);n.connect(t),function n(){const o=s.width,a=s.height;requestAnimationFrame(n),t.getByteTimeDomainData(i),c.fillStyle="rgb(200, 200, 200)",c.fillRect(0,0,o,a),c.lineWidth=2,c.strokeStyle="rgb(0, 0, 0)",c.beginPath();const l=o/e;let r=0;for(let n=0;n<e;n++){const t=i[n]/128,e=t*a/2;0==n?c.moveTo(r,e):c.lineTo(r,e),r+=l}c.lineTo(o,a/2),c.stroke()}()}(t)}this.dispose=function(){console.log("dispose"),a&&(a.getTracks().forEach(function(n){n.stop()}),a=null)},async function(){await async function(){const n=await $$.media.getAudioInputDevices();i.setData({audioDevices:n.map(n=>({value:n.id,label:n.label}))})}(),await u(o(i.model.audioDevices[0].value))}()}});