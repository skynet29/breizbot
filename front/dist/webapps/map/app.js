$$.control.registerControl("rootPage",{deps:["breizbot.broker","breizbot.appData"],template:'<div bn-control="brainjs.map" \n\tstyle="height: 100%"\n\tbn-iface="map"\n\tclass="map" \n\tbn-data="{\n\t\tcenter,\n\t\tzoom,\n\t\tscale: true,\n\t\tcoordinates: true\n\t}"\n\t></div>\t\n<div class="toolbar">\n\t<button class="w3-button w3-blue" bn-event="click: onSearch">\n\t\t<i class="fa fa-search"></i>\n\t</button>\n</div>\n',props:{$pager:null},init:function(t,n,e){const{$pager:o}=this.props,{zoom:a,center:s}=e.getData(),i=$$.viewController(t,{data:{center:s||{lat:48.39,lng:-4.486},zoom:a||13},events:{onSearch:function(){console.log("onSearch"),o.pushPage("searchPage",{title:"Search City"})}}});n.register("homebox.map.updateShape.*",t=>{const n=t.topic.split(".").pop(),e=t.data;if(null!=e)try{i.scope.map.updateShape(n,e)}catch(t){i.scope.map.addShape(n,e)}else i.scope.map.removeShape(n)}),this.exitApp=function(){console.log("Exit map app");const{map:t}=i.scope;return e.saveData({zoom:t.getZoom(),center:t.getCenter()})},this.onReturn=function(t){if(console.log("onReturn",t),null!=t){const n={lat:t.lat,lng:t.lon};try{i.scope.map.updateShape("marker",{latlng:n})}catch(t){i.scope.map.addShape("marker",{type:"marker",latlng:n})}i.scope.map.flyTo(n,13)}}}}),$$.control.registerControl("searchPage",{template:'<form bn-event="submit: onSubmit" bn-show="countries.length > 0">\n\t<div class="inputgroup">\n\t\t<label>Country:</label>\n\t\t<select \n\t\t\tbn-control="brainjs.selectmenu"\n\t\t\tbn-data="{items: countries}"\n\t\t\tbn-val="currentCountry"\n\t\t\tbn-update="selectmenuchange"\n\t\t></select>\t\t\t\n\t</div>\n\t<div bn-control="brainjs.inputgroup" class="inputgroup">\n\t\t<label>City</label>\n\t\t<input type="text" name="search" required="">\n\t</div>\n\t<div>\n\t\t<button class="w3-button w3-blue" type="submit">\n\t\t\t<i class="fa fa-search"></i>\n\t\t</button>\n\t</div>\n\n</form>\n\n<div>\n\t<strong bn-text="message"></strong>\n</div>\n\n<div bn-show="running">\n\t<i class="fa fa-spinner fa-pulse"></i> Running...\n</div>\n\n<div class="scrollPanel" bn-show="countries.length > 0 && cities.length > 0">\n\t<ul class="w3-ul w3-border w3-white" \n\t\tbn-event="click.w3-bar: onItemClick"\n\t\tbn-each="cities"\n\t\tbn-show="cities.length > 0"\n\t\t>\n\t\t<li class="w3-bar">\n\n\t\t\t<div class="w3-bar-item">\n\t\t\t\t<span bn-text="$i.name"></span>\n\t\t\t</div>\n\t\t</li>\n\t</ul>\t\n</div>\n\t',deps:["breizbot.cities"],props:{$pager:null},init:function(t,n){const{$pager:e}=this.props,o=$$.viewController(t,{data:{countries:[],currentCountry:"",cities:[],message:"",running:!1},events:{onSubmit:function(t){t.preventDefault(),console.log("onSubmit");const{search:e}=$(this).getFormData();o.setData({message:"",running:!0}),n.getCities(o.model.currentCountry,e).then(t=>{console.log("cities",t);const n=t.length;o.setData({running:!1,cities:t,message:0==n?"No result":`${n} match`})})},onItemClick:function(t){const n=$(this).index(),a=o.model.cities[n];console.log("onItemClick",a),e.popPage(a.coord)}}});n.getCountries().then(t=>{o.setData({countries:t,currentCountry:"FR"})})}});