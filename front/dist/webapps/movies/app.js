$$.control.registerControl("addMovie",{template:'<div>\n    <form bn-event="submit: onSubmit" bn-form="data">\n        <label>Title</label>\n        <input type="text" required name="title">\n\n        <label>Year</label>\n        <input type="number" required name="year">\n\n        <label>Style</label>\n        <input type="text" name="style" bn-control="brainjs.autocomplete" bn-data="{source: styles}">\n        \n        <label>Franchise</label>\n        <input type="text" name="franchise" bn-control="brainjs.autocomplete" bn-data="{source: franchises}">\n\n        <input type="submit" hidden bn-bind="submit">\n    </form>\n</div>\n',deps:["breizbot.pager","breizbot.http"],props:{data:{}},init:function(t,n,e){const{data:o}=this.props,i=$$.viewController(t,{data:{data:o},events:{onSubmit:function(t){t.preventDefault(),n.popPage($(this).getFormData())}}});!async function(){const t=await e.get("/getStyles"),n=await e.get("/getFranchises");i.setData({styles:t,franchises:n})}(),this.getButtons=function(){return{apply:{title:"Apply",icon:"fas fa-check",onClick:function(){i.scope.submit.click()}}}}}}),$$.control.registerControl("filter",{template:'<div>\n    <form bn-event="submit: onSubmit" bn-form="filters">\n        <label>Style</label>\n        <div bn-control="brainjs.combobox" bn-data="{items: styles}" name="style"></div>    \n\n        <label>Franchise</label>\n        <div bn-control="brainjs.combobox" bn-data="{items: franchises}" name="franchise"></div>    \n        \n        <input type="submit" hidden bn-bind="submit">\n    </form>\n</div>\n',deps:["breizbot.pager","breizbot.http"],props:{filters:null},init:function(t,n,e){const o=$.extend({author:"All"},this.props.filters),i=$$.viewController(t,{data:{filters:{},styles:[],franchises:[]},events:{onSubmit:function(t){t.preventDefault(),n.popPage($(this).getFormData())}}});!async function(){const t=await e.get("/getStyles");t.unshift({value:"All",label:"All",style:"font-weight: bold;"});const n=await e.get("/getFranchises");n.unshift({value:"All",label:"All",style:"font-weight: bold;"}),i.setData({styles:t,franchises:n}),i.setData({filters:o})}(),this.getButtons=function(){return{apply:{title:"Apply",icon:"fas fa-check",onClick:function(){i.scope.submit.click()}}}}}}),$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n    <div class="left">\n        <button class="w3-button" title="Import from JSON file" bn-event="click: onImport" bn-icon="fas fa-download">\n        </button>\n\n        <button class="w3-button" title="Add Movie" bn-event="click: onAddMovie" bn-icon="fas fa-plus">\n        </button>\n\n        <button class="w3-button" title="Filter" bn-event="click: onFilter" bn-icon="fas fa-filter">\n        </button>\n\n        \n    </div>\n\n    <div class="right">\n        <span bn-text="getMoviesQty"></span>\n    </div>\n\n\n</div>\n\n<div class="scrollBar">\n    <table class="w3-table-all w3-hoverable w3-small">\n        <thead>\n            <tr>\n                <th>Title</th>\n                <th>Year</th>\n                <th>Style</th>\n                <th>Franchise</th>\n            </tr>\n        </thead>\n            <tbody bn-each="movies" bn-lazzy="getMovies" bn-event="contextmenuchange.item: onItemContextMenu">\n                <tr class="item" bn-control="brainjs.contextmenu" bn-data="{items: {\n                    del: {\n                        name: \'Delete\',\n                        icon: \'fas fa-trash-alt\'\n                    },\n                    edit: {\n                        name: \'Edit\',\n                        icon: \'fas fa-edit\'\n                    }\n                }}">\n    \n                <td bn-text="$scope.$i.title"></td>\n                <td bn-text="$scope.$i.year"></td>\n                <td bn-text="$scope.$i.style"></td>\n                <td bn-text="$scope.$i.franchise"></td>\n            </tr>\n\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager","breizbot.http"],props:{},init:function(t,n,e){let o={};const i=$$.viewController(t,{data:{moviesQty:0,movies:[],getMovies:async function(t){return s(t)},getMoviesQty:function(){return this.moviesQty>0?`${this.moviesQty} movies`:""}},events:{onAddMovie:function(){n.pushPage("addMovie",{title:"Add Movie",onReturn:function(t){console.log("onReturn",t)}})},onItemContextMenu:function(t,o){const a=$(this).index(),{cmd:l}=o,r=i.model.movies[a];console.log("info",r);const c=r._id.toString();"del"==l?$$.ui.showConfirm({title:"Delete Movie",content:"Are you sure ?"},async()=>{await e.post(`/deleteMovie/${c}`),s()}):"edit"==l&&n.pushPage("addMovie",{title:"Edit Movie",props:{data:r},onReturn:async function(t){console.log("formData",t),await e.post(`/updateMovie/${c}`,t),s()}})},onImport:function(){n.pushPage("breizbot.files",{title:"Import Movies",props:{selectionEnabled:!0,filterExtension:"json"},events:{fileclick:function(t,e){n.popPage(e)}},onReturn:async function(t){console.log("onReturn",t),await e.post("/importFile",{filePath:t.rootDir+t.fileName})}})},onFilter:function(){console.log("onFilter"),n.pushPage("filter",{title:"Set Filter",props:{filters:o},onReturn:async function(t){console.log("formData",t),Object.keys(t).forEach(n=>{"All"==t[n]&&delete t[n]}),o=t,s()}})}}});async function s(t){t=t||0;const n=await e.post("/",{offset:t,filters:o});if(0!=t)return i.model.movies=i.model.movies.concat(n),n;{const{moviesQty:t}=await e.post("/moviesQty",{filters:o});i.setData({movies:n,moviesQty:t})}}s()}});