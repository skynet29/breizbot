Blockly.Blocks.object_getfield={init:function(){this.appendValueInput("OBJECT").setCheck(null).appendField("in Object"),this.appendDummyInput().appendField("get field").appendField(new Blockly.FieldTextInput(""),"FIELD"),this.setInputsInline(!0),this.setOutput(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.create_device={init:function(){this.appendDummyInput().appendField("Device").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT").appendField(new Blockly.FieldNumber(0,0,1/0,1),"PORT"),this.setOutput(!0,"Device"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.device_getvalue={init:function(){this.appendValueInput("DEVICE").setCheck(null).appendField("Device"),this.appendDummyInput().appendField("Mode").appendField(new Blockly.FieldNumber(0,0,1/0,1),"MODE").appendField("getValue"),this.appendDummyInput(),this.setInputsInline(!0),this.setOutput(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.wait_until_device={init:function(){this.appendValueInput("DEVICE").setCheck(null).appendField("Wait until Device"),this.appendDummyInput().appendField("Mode").appendField(new Blockly.FieldNumber(0,0,1/0,1),"MODE"),this.appendValueInput("TEST").setCheck("Boolean").appendField(new LexicalVariables.FieldParameterFlydown("value",!0,LexicalVariables.FieldFlydown.DISPLAY_BELOW),"VAR").appendField("Test"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl(""),this.lexicalVarPrefix="counter"},blocksInScope:function(){const e=this.getInputTargetBlock("TEST");return e?[e]:[]},declaredNames:function(){return[this.getFieldValue("VAR")]},withLexicalVarsAndPrefix:function(e,t){this.getInputTargetBlock("TEST")==e&&t(this.getFieldValue("VAR"),this.lexicalVarPrefix)}},Blockly.Blocks.create_tacho_motor={init:function(){this.appendDummyInput().appendField("TachoMotor").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT"),this.setOutput(!0,"Motor"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.create_motor={init:function(){this.appendDummyInput().appendField("Motor").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT"),this.setOutput(!0,"Motor"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.create_pair_motor={init:function(){this.appendDummyInput().appendField("PairMotor").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT1").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT1").appendField("PORT2").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT2"),this.setOutput(!0,"Motor"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.pair_motor_speed={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("Pair Motor"),this.appendValueInput("SPEED1").setCheck("Number").appendField("Speed1"),this.appendValueInput("SPEED2").setCheck("Number").appendField("Speed2"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_color={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Color").appendField(new Blockly.FieldDropdown([["BLACK","BLACK"],["PURPLE","PURPLE"],["BLUE","BLUE"],["LIGHT_BLUE","LIGHT_BLUE"],["CYAN","CYAN"],["GREEN","GREEN"],["PINK","PINK"],["YELLOW","YELLOW"],["ORANGE","ORANGE"],["RED","RED"],["WHITE","WHITE"]]),"COLOR"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_get_tilt={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Tilt").appendField(new Blockly.FieldDropdown([["Pitch","pitch"],["Roll","roll"],["Yaw","yaw"]]),"TYPE"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_get_voltage={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Voltage (mV)"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_get_impact_count={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Impact Count"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_set_impact_count={init:function(){this.appendValueInput("VAR").setCheck("Number").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Impact Count"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_time={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.appendValueInput("TIME").setCheck("Number").appendField("Time (sec)"),this.appendDummyInput().appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_degrees={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.appendValueInput("DEGREES").setCheck("Number").appendField("Degrees"),this.appendDummyInput().appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_position={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.appendValueInput("ANGLE").setCheck("Number").appendField("Angle"),this.appendDummyInput().appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_reset_position={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendDummyInput().appendField("reset position"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_get_speed={init:function(){this.appendValueInput("VAR").appendField("TachoMotor"),this.appendDummyInput().appendField("Speed"),this.setOutput(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_get_position={init:function(){this.appendValueInput("VAR").appendField("TachoMotor"),this.appendDummyInput().appendField("Position"),this.setOutput(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_get_absoluteposition={init:function(){this.appendValueInput("VAR").appendField("TachoMotor"),this.appendDummyInput().appendField("Absolute Position"),this.setOutput(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.sleep={init:function(){this.appendValueInput("TIME").setCheck("Number").appendField("Sleep (sec)"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.color_sensor_brightness={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("ColorSensor"),this.appendValueInput("FIRST_SEG").setCheck("Number").appendField("First Segment"),this.appendValueInput("SEC_SEG").setCheck("Number").appendField("Second Segment"),this.appendValueInput("THIRD_SEG").setCheck("Number").appendField("Third Segment"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.distance_sensor_brightness={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("DistanceSensor"),this.appendValueInput("TOP_LEFT").setCheck("Number").appendField("Top Left"),this.appendValueInput("BOTTOM_LEFT").setCheck("Number").appendField("Bottom Left"),this.appendValueInput("TOP_RIGHT").setCheck("Number").appendField("Top Right"),this.appendValueInput("BOTTOM_RIGHT").setCheck("Number").appendField("Bottom Right"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_power={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("Motor"),this.appendValueInput("POWER").setCheck("Number").appendField("Power"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.device_subscribe={init:function(){this.appendValueInput("DEVICE").setCheck(null).appendField("Device"),this.appendDummyInput().appendField("Mode").appendField(new Blockly.FieldNumber(0,0,1/0,1),"MODE").appendField("delta").appendField(new Blockly.FieldNumber(1,1),"DELTA").appendField("subscribe").appendField(new LexicalVariables.FieldParameterFlydown("value",!0,LexicalVariables.FieldFlydown.DISPLAY_BELOW),"VAR"),this.appendStatementInput("DO").setCheck(null),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl(""),this.lexicalVarPrefix="counter"},blocksInScope:function(){const e=this.getInputTargetBlock("DO");return e?[e]:[]},declaredNames:function(){return[this.getFieldValue("VAR")]},withLexicalVarsAndPrefix:function(e,t){this.getInputTargetBlock("DO")==e&&t(this.getFieldValue("VAR"),this.lexicalVarPrefix)}},$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n\n    <div class="left">\n        <button bn-event="click: onConnect">Connect to HUB</button>\n        \n        <button bn-event="click: onCode">Code</button>\n\n\n    </div>\n</div>\n\n\n<div>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Hub</th>\n                <th>Actions</th>\n                <th>Battery Level</th>\n                <th>Address</th>\n            </tr>\n        </thead>\n        <tbody bn-each="hubDevices" bn-event="click.btnShutdown: onShutDown, click.btnInfo: onInfo, comboboxchange.combo: onHubChange">\n            <tr>\n                <td>\n                    <div bn-control="brainjs.combobox" bn-data="{items: hubs}" bn-val="$scope.$i.hubId" class="combo"></div>\n                </td>\n                <td>\n                    <button class="btnShutdown">Shutdown</button>\n                    <button class="btnInfo">Info</button>\n                </td>\n                <td bn-text="$scope.$i.batteryLevel"></td>\n                <td bn-text="$scope.$i.address"></td>\n            </tr>\n        </tbody>\n    </table>\n\n</div>',deps:["breizbot.pager","hub","breizbot.blocklyinterpretor"],props:{},init:async function(e,t,n,o){e.find("button").addClass("w3-btn w3-blue");const a={};let l=1,i=null;const s=$$.viewController(e,{data:{currentConfig:"",gamepadConnected:!1,hubDevices:[],hubs:["HUB1","HUB2"]},events:{onCode:function(){t.pushPage("code",{title:"Code",props:{hubDevices:Object.values(a),config:i},onBack:function(e){i=e}})},onHubChange:function(){const e=$(this).closest("tr").index(),t=$(this).getValue(),n=a[s.model.hubDevices[e].UUID];console.log("hubDevice",n),n.name=t,s.model.hubDevices[e].hubId=t},onShutDown:function(){const e=$(this).closest("tr").index(),t=s.model.hubDevices[e];a[t.UUID].shutdown()},onInfo:function(){const e=$(this).closest("tr").index(),n=s.model.hubDevices[e],o=a[n.UUID];console.log("hubDevice",o),t.pushPage("hubinfo",{title:n.hubId,props:{hubDevice:o}})},onConnect:async function(){const e=await n.connect(),t=l++;a[t]=e,e.on("error",e=>{console.log(e)});const o=`HUB${s.model.hubDevices.length+1}`;e.name=o,s.model.hubDevices.push({UUID:t,hubId:o,batteryLevel:0,address:"Unknown"}),s.update(),e.on("batteryLevel",e=>{s.model.hubDevices.find(e=>e.UUID==t).batteryLevel=e.batteryLevel,s.update()}),e.on("address",e=>{console.log("address",e),s.model.hubDevices.find(e=>e.UUID==t).address=e.address,s.update()}),await e.startNotification(),e.on("disconnected",()=>{console.log("disconnected");const e=s.model.hubDevices.findIndex(e=>e.UUID==t);s.model.hubDevices.splice(e,1),s.update(),delete a[t]})}}})}}),$$.control.registerControl("code",{template:'<div class="toolbar">\n\n    <div>\n        <button bn-event="click: onExport" title="Export current config">Export</button>\n        <button bn-event="click: onImport" title="Import config">Import</button>\n\n        <button bn-event="click: onNewConfig" bn-icon="fa fa-file" title="Reset Config"></button>\n\n        <button bn-event="click: onConfig" bn-icon="fa fa-folder-open" title="Open Config"></button>\n\n        <button bn-event="click: onSaveConfig" bn-icon="fa fa-save" title="Save current config"></button>\n\n        <button bn-event="click: onRun">Run</button>\n\n        <button bn-event="click: onStop">Stop</button>\n\n        <button bn-event="click: onGamePad" bn-show="gamepadConnected">Gamepad</button>\n    </div>\n\n\n    <div>\n        <div bn-show="currentConfig">\n            <label>Current Config:</label>\n            <span bn-text="currentConfig"></span>\n        </div>\n    </div>\n\n\n\n</div>\n<div id="blocklyDiv"></div>\n<div class="logPanel" bn-html="getLogs" bn-bind="logPanel"></div>\n\n<xml id="toolbox" style="display: none;">\n\n    <category name="Logic" categorystyle="logic_category">\n        <block type="controls_if"></block>\n        <block type="logic_compare"></block>\n        <block type="logic_operation"></block>\n        <block type="logic_negate"></block>\n        <block type="logic_boolean"></block>\n        <block type="logic_ternary"></block>\n    </category>\n    <category name="Loop" categorystyle="loop_category">\n        <block type="controls_repeat_ext">\n            <value name="TIMES">\n                <shadow type="math_number">\n                    <field name="NUM">10</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="controls_whileUntil"></block>\n        <block type="controls_for">\n            <value name="START">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="END">\n                <shadow type="math_number">\n                    <field name="NUM">10</field>\n                </shadow>\n            </value>\n            <value name="STEP">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="controls_forEach"></block>\n        <block type="controls_flow_statements"></block>\n    </category>\n    <category name="Math" categorystyle="math_category">\n        <block type="math_number"></block>\n        <block type="math_arithmetic"></block>\n        <block type="math_round">\n            <field name="OP">ROUND</field>\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">3.1</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_single">\n            <field name="OP">ROOT</field>\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">9</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_trig">\n            <field name="OP">SIN</field>\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">45</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_constant">\n            <field name="CONSTANT">PI</field>\n        </block>\n        <block type="math_random_int">\n            <value name="FROM">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="TO">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_on_list">\n            <mutation op="SUM" />\n            <field name="OP">SUM</field>\n        </block>\n    </category>\n    <category name="Text" categorystyle="text_category">\n        <block type="text"></block>\n        <block type="text_print"></block>\n        <block type="text_length">\n            <value name="VALUE">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="text_changeCase">\n            <field name="CASE">UPPERCASE</field>\n            <value name="TEXT">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="text_join">\n            <mutation items="2" />\n        </block>\n        <block type="text_indexOf"></block>\n        <block type="text_charAt"></block>\n        <block type="text_getSubstring"></block>\n        <block type="text_prompt_ext">\n            <mutation type="TEXT" />\n            <field name="TYPE">TEXT</field>\n            <value name="TEXT">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="Lists" categorystyle="list_category">\n        <block type="lists_create_with">\n            <mutation items="0"></mutation>\n        </block>\n        <block type="lists_create_with"></block>\n        <block type="lists_repeat">\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">5</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="lists_length"></block>\n        <block type="lists_isEmpty"></block>\n        <block type="lists_indexOf">\n            <value name="VALUE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_getIndex">\n            <value name="VALUE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_setIndex">\n            <value name="LIST">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_getSublist">\n            <value name="LIST">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_split">\n            <value name="DELIM">\n                <shadow type="text">\n                    <field name="TEXT">,</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="lists_sort"></block>\n        <block type="lists_reverse"></block>\n    </category>\n    <category id="catVariables" colour="330" name="Variables">\n        <block type="global_declaration"></block>\n        <block type="local_declaration_statement"></block>\n        <block type="lexical_variable_get"></block>\n        <block type="lexical_variable_set"></block>\n    </category>\n    <category name="Functions" custom="PROCEDURE" categorystyle="procedure_category"></category>\n\n\n    <category name="Object" colour="355">\n        <block type="object_getfield">\n            <value name="OBJECT">\n                <block type="lexical_variable_get">\n                    <field name="VAR">object</field>\n                </block>\n            </value>\n        </block>\n    </category>\n    <category name="Device" colour="355">\n        <block type="create_device"></block>\n        <block type="device_getvalue">\n            <value name="DEVICE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">device</field>\n                </block>\n            </value>\n        </block>\n        <block type="wait_until_device">\n            <value name="DEVICE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">device</field>\n                </block>\n            </value>\n        </block>\n        <block type="device_subscribe">\n            <value name="DEVICE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">device</field>\n                </block>\n            </value>\n        </block>\n        <block type="color_sensor_brightness">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">sensor</field>\n                </block>\n            </value>\n            <value name="FIRST_SEG">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="SEC_SEG">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="THIRD_SEG">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="distance_sensor_brightness">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">sensor</field>\n                </block>\n            </value>\n            <value name="TOP_LEFT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="TOP_RIGHT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="BOTTOM_LEFT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="BOTTOM_RIGHT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="Motor" colour="355">\n        <block type="create_motor"></block>\n        <block type="motor_power">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="POWER">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="TachoMotor" colour="355">\n        <block type="create_tacho_motor"></block>\n        <block type="motor_speed">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_speed_time">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="TIME">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_speed_degrees">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="DEGREES">\n                <shadow type="math_number">\n                    <field name="NUM">180</field>\n                </shadow>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_speed_position">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="ANGLE">\n                <shadow type="math_number">\n                    <field name="NUM">0</field>\n                </shadow>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_reset_position">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n        <block type="motor_get_speed">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n        <block type="motor_get_position">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n        <block type="motor_get_absoluteposition">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n\n    </category>\n    <category name="PairMotor" colour="355">\n        <block type="create_pair_motor">\n            <FIELD name="PORT2">B</FIELD>\n        </block>\n        <block type="pair_motor_speed">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="SPEED1">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="SPEED2">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n\n\n    </category>\n    <category name="Hub" colour="355">\n        <block type="hub_color"></block>\n        <block type="hub_get_tilt"></block>\n        <block type="hub_get_impact_count"></block>\n        <block type="hub_set_impact_count">\n            <value name="VAR">\n                <shadow type="math_number">\n                    <field name="NUM">0</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="hub_get_voltage"></block>\n    </category>\n    <category name="System" colour="355">\n        <block type="sleep">\n            <value name="TIME">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n\n</xml>',deps:["breizbot.pager","breizbot.blocklyinterpretor","hub","breizbot.gamepad","breizbot.http","breizbot.files","breizbot.blocklyLexical"],props:{hubDevices:null,config:null},init:function(e,t,n,o,a,l,i,s){console.log("props",this.props);const c=$$.ui.progressDialog("Loading device info"),d=this.props.hubDevices;e.find("button").addClass("w3-btn w3-blue");let{config:p}=this.props;async function u(e,t){try{await n.callFunction(e,t)}catch(e){"string"==typeof e&&$$.ui.showAlert({title:"Error",content:e})}}null==p&&(p={code:null,gamepadId:"",mappings:{},name:""}),console.log("config",p),a.on("connected",e=>{console.log("gamepad connnected",e),p.gamepadId=e.id,p.gamepadMapping=p.mappings[e.id],console.log({gamepadMapping:p.gamepadMapping}),B.setData({gamepadConnected:!0}),a.checkGamePadStatus()}),a.on("disconnected",e=>{console.log("gamepad disconnected"),B.setData({gamepadConnected:!1}),p.gamepadMapping=null,p.gamepadId=""});let r={};async function b(e){if(p.gamepadMapping){const{action:t}=p.gamepadMapping.axes[e.id];let{value:n}=e;"None"!=t&&(n=100*Math.sign(n))!=(r[e.id]||0)&&(r[e.id]=n,await u(t,n))}}async function h(e){if(console.log("buttonDown",e.id),p.gamepadMapping){const{down:t,downValue:n}=p.gamepadMapping.buttons[e.id];"None"!=t&&await u(t,n)}}async function m(e){if(console.log("buttonDown",e.id),p.gamepadMapping){const{up:t,upValue:n}=p.gamepadMapping.buttons[e.id];"None"!=t&&await u(t,n)}}function f(e){e?(a.on("axe",b),a.on("buttonDown",h),a.on("buttonUp",m)):(a.off("axe",b),a.off("buttonDown",h),a.off("buttonUp",m))}function g(e){const t=e.fields.HUB,n=d.find(e=>e.name==t);if(null==n)throw`Hub ${t} is not connected`;return n}async function y(e,t){const a=await n.evalCode(e.inputs.VAR,t);if(!o.isTachoMotor(a))throw"input is not of type TachoMotor";return a}async function v(e,t,n){const o=g(e).getDevice(t);return console.log("getHubValue",{portId:t,mode:n,device:o}),o.getValue(n)}function k(e){const t=Blockly.getMainWorkspace();Blockly.serialization.workspaces.load(e,t)}function w(){return Blockly.serialization.workspaces.save(Blockly.getMainWorkspace())}async function _(){for(const e of d)for(const t of e.getHubDevices())o.isMotor(t)&&await t.setPower(0),await t.unsubscribe()}f(!0),this.dispose=function(){console.log("dispose"),f(!1)},s.inject("blocklyDiv",document.getElementById("toolbox")),n.setLogFunction(e=>{B.model.logs.push(e),B.update(),T.scrollToBottom()}),n.addBlockType("object_getfield",async(e,t)=>{const o=e.fields.FIELD,a=await n.evalCode(e.inputs.OBJECT,t);return console.log({fieldName:o,object:a}),a[o]}),n.addBlockType("create_device",async(e,t)=>{const n=e.fields.PORT,o=g(e).getDevice(n);return console.log({port:n,device:o}),o}),n.addBlockType("device_getvalue",async(e,t)=>{const o=e.fields.MODE,a=await n.evalCode(e.inputs.DEVICE,t);return console.log({mode:o,device:a}),a.getValue(o)}),n.addBlockType("wait_until_device",async(e,t)=>{const o=e.fields.MODE,a=await n.evalCode(e.inputs.DEVICE,t),l=e.fields.VAR;console.log({varName:l,mode:o,device:a}),await a.waitTestValue(o,async o=>{return console.log("waitTestValue",o),t[l]=o,await n.evalCode(e.inputs.TEST,t)}),delete t[l]}),n.addBlockType("device_subscribe",async(e,t)=>{const o=e.fields.MODE,a=e.fields.DELTA,l=await n.evalCode(e.inputs.DEVICE,t),i=e.fields.VAR;console.log({varName:i,mode:o,deltaInterval:a,device:l}),await l.subscribe(o,async o=>{t[i]=o,await n.evalCode(e.inputs.DO,t)},a),delete t[i]}),n.addBlockType("create_pair_motor",async(e,t)=>{const n=e.fields.PORT1,a=e.fields.PORT2,l=g(e);return await l.getDblMotor(o.PortMap[n],o.PortMap[a])}),n.addBlockType("create_tacho_motor",async(e,t)=>{const n=e.fields.PORT,a=g(e).getDevice(o.PortMap[n]);if(!o.isTachoMotor(a))throw`Device connected to port '${n}' is not of a TachoMotor`;return a}),n.addBlockType("create_motor",async(e,t)=>{const n=e.fields.PORT,a=g(e).getDevice(o.PortMap[n]);if(!o.isMotor(a))throw`Device connected to port '${n}' is not of a Motor`;return a}),n.addBlockType("color_sensor_brightness",async(e,t)=>{const a=await n.evalCode(e.inputs.VAR,t);if(!o.isColorSensor(a))throw"input is not of type ColorSensor";const l=await n.evalCode(e.inputs.FIRST_SEG,t),i=await n.evalCode(e.inputs.SEC_SEG,t),s=await n.evalCode(e.inputs.THIRD_SEG,t);console.log({device:a,firstSeg:l,secSeg:i,thirdSeg:s}),await a.setBrightness(l,i,s)}),n.addBlockType("distance_sensor_brightness",async(e,t)=>{const a=await n.evalCode(e.inputs.VAR,t);if(!o.isDistanceSensor(a))throw"input is not of type DistanceSensor";const l=await n.evalCode(e.inputs.TOP_LEFT,t),i=await n.evalCode(e.inputs.TOP_RIGHT,t),s=await n.evalCode(e.inputs.BOTTOM_LEFT,t),c=await n.evalCode(e.inputs.BOTTOM_RIGHT,t);console.log({device:a,topLeft:l,topRight:i,bottomLeft:s,bottomRight:c}),await a.setBrightness(l,s,i,c)}),n.addBlockType("motor_power",async(e,t)=>{const a=await n.evalCode(e.inputs.POWER,t),l=await async function(e,t){const a=await n.evalCode(e.inputs.VAR,t);if(!o.isMotor(a))throw"input is not of type Motor";return a}(e,t);console.log({power:a}),await l.setPower(a)}),n.addBlockType("motor_speed",async(e,t)=>{const o=await n.evalCode(e.inputs.SPEED,t),a=await y(e,t);console.log({speed:o}),await a.setSpeed(o)}),n.addBlockType("pair_motor_speed",async(e,t)=>{const a=await n.evalCode(e.inputs.SPEED1,t),l=await n.evalCode(e.inputs.SPEED2,t),i=await async function(e,t){const a=await n.evalCode(e.inputs.VAR,t);if(console.log("motor",a),!o.isDoubleMotor(a))throw"input is not of type PairMotor";return a}(e,t);console.log({speed1:a,speed2:l,motor:i}),await i.setSpeed(a,l)}),n.addBlockType("motor_speed_time",async(e,t)=>{const a=await n.evalCode(e.inputs.SPEED,t),l=e.fields.WAIT,i=await n.evalCode(e.inputs.TIME,t),s=await y(e,t);console.log({speed:a,time:i,waitEnd:l,motor:s}),await s.setSpeedForTime(a,1e3*i,l,o.BrakingStyle.FLOAT)}),n.addBlockType("motor_speed_degrees",async(e,t)=>{const a=await y(e,t),l=await n.evalCode(e.inputs.SPEED,t),i=e.fields.WAIT,s=await n.evalCode(e.inputs.DEGREES,t);console.log({speed:l,degrees:s,waitEnd:i}),await a.rotateDegrees(s,l,i,o.BrakingStyle.BRAKE)}),n.addBlockType("motor_speed_position",async(e,t)=>{const a=await y(e,t),l=await n.evalCode(e.inputs.SPEED,t),i=e.fields.WAIT,s=await n.evalCode(e.inputs.ANGLE,t);console.log({speed:l,angle:s,waitEnd:i}),await a.gotoAngle(s,l,i,o.BrakingStyle.FLOAT)}),n.addBlockType("motor_reset_position",async(e,t)=>{const n=await y(e,t);await n.resetZero()}),n.addBlockType("motor_get_speed",async(e,t)=>{return(await y(e,t)).getSpeed()}),n.addBlockType("motor_get_position",async(e,t)=>{return(await y(e,t)).getPosition()}),n.addBlockType("motor_get_absoluteposition",async(e,t)=>{return(await y(e,t)).getAbsolutePosition()}),n.addBlockType("hub_color",async(e,t)=>{const n=e.fields.COLOR,a=g(e).getDevice(o.PortMap.HUB_LED);await a.setColor(o.Color[n])}),n.addBlockType("hub_get_voltage",async(e,t)=>v(e,o.PortMap.VOLTAGE_SENSOR,0)),n.addBlockType("hub_get_impact_count",async(e,t)=>v(e,o.PortMap.TILT_SENSOR,1)),n.addBlockType("hub_set_impact_count",async(e,t)=>{const a=await n.evalCode(e.inputs.VAR,t),l=g(e);return console.log({count:a,hubDevice:l}),l.getDevice(o.PortMap.TILT_SENSOR).setImpactCount(a)}),n.addBlockType("hub_get_tilt",async(e,t)=>{const n=e.fields.TYPE;return(await v(e,o.PortMap.TILT_SENSOR,o.DeviceMode.TILT_POS))[n]}),n.addBlockType("sleep",async(e,t)=>{const o=await n.evalCode(e.inputs.TIME,t);console.log({time:o}),await $$.util.wait(1e3*o)}),null!=p.code&&k(p.code),this.onBack=function(){return p.code=w(),p};const B=$$.viewController(e,{data:{currentConfig:p.name,gamepadConnected:""!=p.gamepadId,logs:[],getLogs:function(){return this.logs.join("<br>")}},events:{onExport:async function(){let e=await $$.ui.showPrompt({title:"Export",label:"FileName: "});if(e){const t=JSON.stringify({code:w(),mappings:p.mappings}),n=new Blob([t],{type:"application/json"});e+=".pow",await i.saveFile(n,e),$.notify("Code exported","success")}},onImport:function(){t.pushPage("breizbot.files",{title:"Open File",props:{filterExtension:"pow"},events:{fileclick:function(e,n){t.popPage(n)}},onReturn:async function(e){const t=i.fileUrl(e.rootDir+e.fileName),n=await fetch(t),{code:o,mappings:a}=await n.json();console.log({code:o,mappings:a}),p.code=o,p.name="",p.mappings=a,B.setData({currentConfig:""}),p.gamepadMapping=p.mappings[p.gamepadId],k(p.code)}})},onStop:async function(){await _()},onGamePad:function(){const e=w();console.log("code",e),f(!1),t.pushPage("gamepad",{title:"Gamepad",props:{mapping:p.gamepadMapping,actions:null!=e?n.getFunctionNames(e):[]},onReturn:async e=>{console.log("onReturn",e),p.gamepadMapping=e,p.mappings[e.id]=e,f(!0)},onBack:()=>{f(!0)}})},onNewConfig:function(){p.mappings={},p.gamepadMapping=null,p.name="",Blockly.getMainWorkspace().clear(),B.setData({currentConfig:""})},onSaveConfig:async function(){if(console.log("oncodeSaveConfig",p),""==B.model.currentConfig){const e=await $$.ui.showPrompt({title:"Save Config",label:"Config Name:"});e&&(await l.post("/add",{name:e,code:w(),mappings:p.mappings}),B.setData({currentConfig:e}),p.name=e)}else await l.post("/update",{name:p.name,code:w(),mappings:p.mappings}),$.notify(`Config '${p.name}' updated`,"success")},onConfig:function(){t.pushPage("configCtrl",{title:"Configurations",props:{currentConfig:B.model.currentConfig},onReturn:function(e){console.log("newConfig",e),p.code=e.code,p.name=e.name,p.mappings=e.mappings,B.setData({currentConfig:e.name}),p.gamepadMapping=p.mappings[p.gamepadId],k(p.code)}})},onRun:async function(){console.log("onRun"),await _(),c.setPercentage(0),c.show();let e=0;for(const t of d)e+=t.getHubDevices().length;console.log({nbAccess:e});const t=$$.util.mapRange(0,e,0,1);let o=0;for(const e of d)for(const n of e.getHubDevices())await n.readInfo(),c.setPercentage(t(++o));c.hide();const a=w();r={},B.setData({logs:[]});try{await n.startCode(a)}catch(e){"string"==typeof e&&$$.ui.showAlert({title:"Error",content:e})}}}}),T=B.scope.logPanel}}),$$.control.registerControl("configCtrl",{template:'<div bn-show="!hasConfigs" class="message">\n    No configurations defined\n</div>\n\n<div class="scrollPanel" bn-show="hasConfigs">\n    <div bn-each="configs" class="items" bn-event="click.item: onItemClick, contextmenuchange.item:onItemContextMenu">\n        <div class="w3-card-2 item" bn-control="brainjs.contextmenu" bn-data="{\n                    items: {\n                        delete: {name: \'Remove\', icon: \'fas fa-trash-alt\'}\n                    }\n                }">\n            <div>\n                <strong bn-text="$scope.$i.name"></strong>\n            </div>\n        </div>\n    </div>\n</div>',deps:["breizbot.pager","breizbot.http"],props:{currentConfig:""},init:function(e,t,n){const{currentConfig:o}=this.props,a=$$.viewController(e,{data:{configs:[],hasConfigs:function(){return this.configs.length>0}},events:{onItemContextMenu:async function(e,t){const i=$(this).closest(".item").index(),s=a.model.configs[i];"delete"==t.cmd&&(s.name==o?$$.ui.showAlert({content:"Cannot delete active config",title:"Warning"}):(await n.post("/delete",s),l()))},onItemClick:function(e){const n=$(this).closest(".item").index();console.log("onItemClick",n);const o=a.model.configs[n];t.popPage(o)}}});async function l(){const e=await n.get("/");console.log({configs:e}),a.setData({configs:e})}l()}}),$$.control.registerControl("gamepad",{template:'<div>\n    <h2 bn-text="id"></h2>\n</div>\n\n<h3>Axes</h3>\n<div>\n    <table class="w3-table-all axeTable">\n        <thead>\n            <tr>\n                <th>Axe</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="axes" bn-bind="axes" bn-index="idx">\n            <tr>\n                <td bn-text="getAxeLabel"></td>\n                <td>\n                    <div bn-control="brainjs.combobox" bn-data="{items: actions}" bn-val="$scope.$i.action"\n                        class="item"></div>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n\n<h3>Buttons</h3>\n<div class="commandTable">\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Button</th>\n                <th>Down</th>\n                <th>Up</th>\n            </tr>\n        </thead>\n        <tbody bn-each="buttons" bn-bind="buttons" bn-index="idx">\n            <tr>\n                <td bn-text="getButtonLabel"></td>\n                <td>\n                    <div class="item">\n                        <div bn-control="brainjs.combobox" bn-data="{items: actions}" bn-val="$scope.$i.down"\n                            class="down"></div>\n                        <input bn-val="$scope.$i.downValue" type="number" class="downValue">\n\n                    </div>\n\n                </td>\n                <td>\n                    <div class="item">\n                        <div bn-control="brainjs.combobox" bn-data="{items: actions}" bn-val="$scope.$i.up" class="up">\n                        </div>\n                        <input bn-val="$scope.$i.upValue" type="number" class="upValue">\n                    </div>\n\n\n                </td>\n\n            </tr>\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager","breizbot.gamepad"],props:{mapping:null,actions:null},init:function(e,t,n){console.log("props",this.props);const{mapping:o,actions:a}=this.props;a.unshift("None"),console.log(this.props);let l=[],i=[];const s=n.getGamepads()[0];if(console.log({info:s}),null!=o&&(l=o.axes,i=o.buttons),0==l.length)for(let e=0;e<s.axes.length;e++)l.push({action:"None"});if(0==i.length)for(let e=0;e<s.buttons.length;e++)i.push({up:"None",down:"None",upValue:0,downValue:1});function c(){let e=[],t=[];for(let t=0;t<s.axes.length;t++)e.push({action:"None"});for(let e=0;e<s.buttons.length;e++)t.push({up:"None",down:"None",upValue:0,downValue:1});r.setData({axes:e,buttons:t})}function d(e){const{value:t,id:n}=e;0!=t?b.find("tr").eq(n).find("td").eq(0).addClass("pressed"):b.find("tr").eq(n).find("td").eq(0).removeClass("pressed")}function p(e){h.find("tr").eq(e.id).find("td").eq(0).addClass("pressed")}function u(e){h.find("tr").eq(e.id).find("td").eq(0).removeClass("pressed")}n.on("axe",d),n.on("buttonDown",p),n.on("buttonUp",u),this.dispose=function(){console.log("dispose"),n.off("axe",d),n.off("buttonDown",p),n.off("buttonUp",u)};const r=$$.viewController(e,{data:{id:s.id,axes:l,buttons:i,actions:a,getButtonLabel:function(e){return`Button ${e.idx+1}`},getAxeLabel:function(e){return`Axe ${e.idx+1}`}},events:{}}),b=r.scope.axes,h=r.scope.buttons;this.getButtons=function(){return{check:{icon:"fa fa-check",title:"Apply",onClick:function(){t.popPage(function(){const e={id:s.id,axes:[],buttons:[]};return b.find("tr").each(function(t){const n=$(this).find(".item").getValue();e.axes.push({action:n})}),h.find("tr").each(function(t){const n=$(this).find(".up").getValue(),o=$(this).find(".down").getValue(),a=$(this).find(".upValue").getValue(),l=$(this).find(".downValue").getValue();e.buttons.push({up:n,down:o,upValue:a,downValue:l})}),console.log({ret:e}),e}())}},reset:{icon:"fas fa-sync",title:"Reset value",onClick:c}}}}}),$$.control.registerControl("hubinfo",{template:'<div class="scrollBar">\n    <h1>External Devices</h1>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Port</th>\n                <th>Device Type</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="externalDevices" bn-event="\n            mousedown.motorMouseAction: onMouseUp, \n            mouseup.motorMouseAction:onMouseDown, \n            click.motorAction:onMotorAction, \n            click.ledAction: onLedAction,\n            click.portInfo: onInfo2, \n            click.calibrate:onCalibrate">\n            <tr>\n                <td bn-text="$scope.$i.name"></td>\n                <td bn-text="$scope.$i.type"></td>\n                <td>\n                    <span bn-if="isMotor" class="spanButtons">\n                        <button class="w3-btn w3-green motorMouseAction" data-action="forward">FWD</button>\n                        <button class="w3-btn w3-green motorMouseAction" data-action="backward">BKWD</button>\n                    </span>\n                    <span bn-if="isTachoMotor" class="spanButtons">\n                        <button class="w3-btn w3-green motorAction" data-action="reset">RESET</button>\n                        <button class="w3-btn w3-green motorAction" data-action="gozero">GO ZERO</button>\n                    </span>\n                    <span bn-if="isLed" class="spanButtons">\n                        <button class="w3-btn w3-green ledAction" data-action="on">ON</button>\n                        <button class="w3-btn w3-green ledAction" data-action="off">OFF</button>\n                    </span>\n\n                    <button class="w3-btn w3-blue portInfo">MODE</button>\n                </td>\n\n            </tr>\n\n        </tbody>\n    </table>\n    <h1>Internal Devices</h1>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Port ID</th>\n                <th>Device Type</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="internalDevices" bn-event="click.w3-btn: onInfo">\n            <tr>\n                <td bn-text="$scope.$i.portId"></td>\n                <td bn-text="$scope.$i.type"></td>\n                <td>\n                    <button class="w3-btn w3-blue">MODE</button>\n                </td>\n            </tr>\n\n        </tbody>\n    </table></div>',deps:["breizbot.pager","hub"],props:{hubDevice:null},init:function(e,t,n){const o=this.props.hubDevice;function a(e,n){t.pushPage("info",{title:n,props:{device:o.getDevice(e)}})}function l(e){const t=e.closest("tr").index();return c.model.externalDevices[t].portId}async function i(e){console.log("attach",e);const{portId:t,name:n,type:o}=e,a={portId:t,name:n,type:o};c.model.externalDevices.push(a),c.update()}function s(e){console.log("detach",e);const t=c.model.externalDevices.findIndex(t=>t.portId==e.portId);c.model.externalDevices.splice(t,1),c.update()}o.on("attach",i),o.on("detach",s),this.dispose=async function(){console.log("hubInfo dispose"),o.off("attach",i),o.off("detach",s)};const c=$$.viewController(e,{data:{internalDevices:[],externalDevices:[],isMotor:function(e){return n.isMotor(o.getDevice(e.$i.portId))},isLed:function(e){return n.isLed(o.getDevice(e.$i.portId))},isTachoMotor:function(e){return n.isTachoMotor(o.getDevice(e.$i.portId))}},events:{onMotorAction:async function(){const e=l($(this)),t=$(this).data("action");console.log("onMotorAction",e,t);const n=o.getDevice(e);switch(t){case"reset":n.resetZero();break;case"gozero":n.gotoAngle(0,50,!1)}},onLedAction:async function(){const e=l($(this)),t=$(this).data("action");console.log("onLedAction",e,t),o.getDevice(e).setBrightness("on"==t?100:0)},onCalibrate:async function(){const e=l($(this));console.log("onCalibrate",e);const t=o.getDevice(e);await t.calibrate()},onMouseUp:async function(){const e=$(this).data("action"),t=l($(this)),n=o.getDevice(t);switch(e){case"forward":n.setPower(100);break;case"backward":n.setPower(-100)}},onMouseDown:async function(){const e=l($(this));o.getDevice(e).setPower(0)},onInfo:function(){const e=$(this).closest("tr").index(),{portId:t,deviceTypeName:n}=c.model.internalDevices[e];a(t,n)},onInfo2:function(){const e=$(this).closest("tr").index(),{portId:t,deviceTypeName:n}=c.model.externalDevices[e];a(t,n)}}});!async function(){const e=o.getHubDevices();console.log("devices",e);const t=[],n=[];for(const o of e){const{portId:e,type:a,name:l}=o;if(e<50){const t={name:l,portId:e,type:a};n.push(t)}else t.push({portId:e,type:a})}c.setData({internalDevices:t,externalDevices:n})}()}}),$$.control.registerControl("info",{template:'<div>\n    <div>\n        Capabilities: <span bn-text="capabilities"></span>\n    </div>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>MODE</th>\n                <th>CAPABILITIES</th>\n                <th>UNIT</th>\n                <th>RAW</th>\n                <th>SI</th>\n                <th>VALUE FORMAT</th>\n                <th>Value</th>\n            </tr>\n        </thead>\n        <tbody bn-each="modes" bn-event="click.btnGet: onBtnGet">\n            <tr>\n                <td bn-text="$scope.$i.name"></td>\n                <td bn-text="getCapabilites"></td>\n                <td bn-text="$scope.$i.unit"></td>\n                <td>\n                    <span bn-text="$scope.$i.RAW.min"></span><br>\n                    <span bn-text="$scope.$i.RAW.max"></span>\n                </td>\n                <td>\n                    <span bn-text="$scope.$i.PCT.min"></span><br>\n                    <span bn-text="$scope.$i.PCT.max"></span>\n                </td>\n                <td>\n                    <span bn-text="$scope.$i.SI.min"></span><br>\n                    <span bn-text="$scope.$i.SI.max"></span>\n                </td>\n                <td>\n                    dataType: <span bn-text="$scope.$i.VALUE_FORMAT.dataType"></span><br>\n                    numValues: <span bn-text="$scope.$i.VALUE_FORMAT.numValues"></span>\n                </td>\n                <td>\n                    <div bn-if="isInput">\n                        <button class="w3-btn w3-green btnGet">Get</button>\n                        <span></span>\n                    </div>\n\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager","hub"],props:{device:null},init:function(e,t,n){const o=this.props.device,a=$$.viewController(e,{data:{modes:[],capabilities:"",isInput:function(e){return 0!=(1&e.$i.mode)},getCapabilites:function(e){return 2==e.$i.mode?"OUT":1==e.$i.mode?"IN":3==e.$i.mode?"IN/OUT":void 0}},events:{onBtnGet:async function(e){const t=$(this).closest("tr").index();console.log("onBtnGet",t);const n=await o.getValue(t);console.log("values",n),$(this).closest("td").find("span").text(JSON.stringify(n,null,4))}}});!async function(){const{modes:e,capabilities:t}=await o.readInfo();a.setData({modes:e,capabilities:t})}()}});