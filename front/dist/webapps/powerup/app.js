$$.service.registerService("actionSrv",{deps:["hub"],init:function(n,e){let t={};const o=new EventEmitter2;async function a(n,t,o){if("SLEEP"==t.type)return void await $$.util.wait(t.time);const a=n.find(n=>n.name==t.hub);if(!a)return`Hub ${t.hub} is not connected`;if("POWER"==t.type){const n=await a.getMotor(e.PortMap[t.port]);await n.setPower(t.power*o)}else if("BRIGHTNESS"==t.type){const n=await a.getLed(e.PortMap[t.port]);await n.setBrightness(t.brightness*o)}else if("SPEED"==t.type){const n=await a.getMotor(e.PortMap[t.port]);await n.setSpeed(t.speed*o)}else if("SPEEDTIME"==t.type){const n=await a.getMotor(e.PortMap[t.port]);await n.setSpeedForTime(t.speed,t.time,t.waitFeedback,t.brakeStyle)}else if("ROTATE"==t.type){const n=await a.getMotor(e.PortMap[t.port]);await n.rotateDegrees(t.angle*o,t.speed,t.waitFeedback)}else if("POSITION"==t.type){const n=await a.getMotor(e.PortMap[t.port]);await n.gotoAngle(t.angle*o,t.speed,t.waitFeedback)}else if("ZERO"==t.type){const n=await a.getMotor(e.PortMap[t.port]);await n.resetZero()}else if("COLOR"==t.type){const n=await a.getRgbLed(e.PortMap.HUB_LED);await n.setColor(t.color)}else if("RGB"==t.type){const n=await a.getRgbLed(e.PortMap.HUB_LED);await n.setRGBColor(t.red,t.green,t.blue)}else if("CALIBRATE"==t.type){const n=await a.getMotor(e.PortMap[t.port]);await n.calibrate()}else if("DBLSPEED"==t.type){const n=e.PortMap[t.port1],i=e.PortMap[t.port2],l=await a.getDblMotor(n,i);await l.setSpeed(t.speed1*o,t.speed2*o)}else if("DBLSPEEDTIME"==t.type){const n=e.PortMap[t.port1],o=e.PortMap[t.port2],i=await a.getDblMotor(n,o);await i.setSpeedForTime(t.speed1,t.speed2,t.time,t.waitFeedback,t.brakeStyle)}else if("DBLROTATE"==t.type){const n=e.PortMap[t.port1],i=e.PortMap[t.port2],l=await a.getDblMotor(n,i);await l.rotateDegrees(t.angle,t.speed1*o,t.speed2*o,t.waitFeedback,t.brakeStyle)}else{if("DBLPOSITION"!=t.type)return`type ${t.type} not implemented`;{const n=e.PortMap[t.port1],i=e.PortMap[t.port2],l=await a.getDblMotor(n,i);await l.gotoAngle(t.angle1,t.angle2,t.speed*o,t.waitFeedback,t.brakeStyle)}}return null}return{execAction:async function n(e,i,l,s){console.log("execAction",e,l,s);const c=i.find(n=>n.name==l);let{steps:d}=c;Array.isArray(d)||(d=[c]);for(const l of d)if("SETVAR"==l.type){console.log("SETVAR",l);const{varName:n,varValue:e}=l;t[n]=e,o.emit("varChange",{varName:n,varValue:e})}else if("TESTVAR"==l.type){const{varName:o}=l,a=t[o];a==l.varValue&&"None"!=l.eqAction&&n(e,i,l.eqAction,1),a!=l.varValue&&"None"!=l.neqAction&&n(e,i,l.neqAction,1)}else{const n=await a(e,l,s);if(null!=n){$.notify(n,"error");break}}},on:o.on.bind(o),getVariables:function(){return Object.entries(t).map(([n,e])=>({name:n,value:e}))},resetVariables:function(){t={},o.emit("varChange")}}}}),$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n    <div class="left">\n        \n        <button bn-event="click: onNewConfig" bn-icon="fa fa-file" title="Reset Config"></button>\n\n        <button bn-event="click: onConfig" bn-icon="fa fa-folder-open" title="Open Config"></button>\n\n        <button bn-event="click: onSaveConfig" bn-icon="fa fa-save" title="Save current config"></button>\n\n        <div bn-show="currentConfig">\n            <label>Current Config:</label>\n            <span bn-text="currentConfig"></span>\n        </div>\n\n    </div>\n\n    <div></div>\n</div>\n\n<div class="toolbar">\n\n    <div class="left">\n        <button bn-event="click: onConnect">Connect to HUB</button>\n        \n        <button bn-event="click: onActions">Actions</button>\n\n        <button bn-event="click: onGamePad" bn-show="gamepadConnected">Gamepad</button>\n\n        <button bn-event="click: onCode">Code</button>\n\n\n    </div>\n</div>\n\n<div bn-show="hasVariables" class="variables">\n    <table class="w3-table-all">\n        <thead>\n            <th>Variable Name</th>\n            <th>Value</th>\n        </thead>\n        <tbody bn-each="variables">\n            <tr>\n                <td bn-text="$scope.$i.name"></td>\n                <td bn-text="$scope.$i.value"></td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n\n<div>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Hub</th>\n                <th>Actions</th>\n                <th>Battery Level</th>\n                <th>Address</th>\n            </tr>\n        </thead>\n        <tbody bn-each="hubDevices" bn-event="click.btnShutdown: onShutDown, click.btnInfo: onInfo, comboboxchange.combo: onHubChange">\n            <tr>\n                <td>\n                    <div bn-control="brainjs.combobox" bn-data="{items: hubs}" bn-val="$scope.$i.hubId" class="combo"></div>\n                </td>\n                <td>\n                    <button class="btnShutdown">Shutdown</button>\n                    <button class="btnInfo">Info</button>\n                </td>\n                <td bn-text="$scope.$i.batteryLevel"></td>\n                <td bn-text="$scope.$i.address"></td>\n            </tr>\n        </tbody>\n    </table>\n\n</div>',deps:["breizbot.pager","hub","breizbot.gamepad","actionSrv","breizbot.http"],props:{},init:async function(n,e,t,o,a,i){Blockly.Blocks.create_motor={init:function(){this.appendDummyInput().appendField("Motor").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT"),this.setOutput(!0,"Motor"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_color={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Color").appendField(new Blockly.FieldDropdown([["BLACK","BLACK"],["PURPLE","PURPLE"],["BLUE","BLUE"],["LIGHT_BLUE","LIGHT_BLUE"],["CYAN","CYAN"],["GREEN","GREEN"],["PINK","PINK"],["YELLOW","YELLOW"],["ORANGE","ORANGE"],["RED","RED"],["WHITE","WHITE"]]),"COLOR"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_time={init:function(){this.appendDummyInput().appendField(new Blockly.FieldVariable("item"),"VAR").appendField("Speed").appendField(new Blockly.FieldNumber(100,-100,100,1),"SPEED").appendField("Time").appendField(new Blockly.FieldNumber(1,1,1/0,1),"TIME").appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_degrees={init:function(){this.appendDummyInput().appendField(new Blockly.FieldVariable("item"),"VAR").appendField("Speed").appendField(new Blockly.FieldNumber(100,-100,100,1),"SPEED").appendField("Degrees").appendField(new Blockly.FieldNumber(1,-1/0,1/0,1),"DEGREES").appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_position={init:function(){this.appendDummyInput().appendField(new Blockly.FieldVariable("item"),"VAR").appendField("Speed").appendField(new Blockly.FieldNumber(100,-100,100,1),"SPEED").appendField("Angle").appendField(new Blockly.FieldNumber(1,-180,180,1),"ANGLE").appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_reset_position={init:function(){this.appendDummyInput().appendField(new Blockly.FieldVariable("item"),"VAR").appendField("reset position"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}};let l={actions:[],mappings:{}};n.find("button").addClass("w3-btn w3-blue");const s={};let c=1,d=null,r="";a.on("varChange",n=>{console.log("onVarChange",n);const e=a.getVariables();console.log("variables",e),b.setData({variables:e})});const b=$$.viewController(n,{data:{currentConfig:"",gamepadConnected:!1,hubDevices:[],hubs:["HUB1","HUB2"],variables:[],hasVariables:function(){return this.variables.length>0}},events:{onCode:function(){console.log("onCode"),e.pushPage("code",{title:"Code",props:{hubDevices:Object.values(s)}})},onNewConfig:function(){l={actions:[],mappings:{}},d=null,b.setData({currentConfig:""}),a.resetVariables()},onSaveConfig:async function(){if(""==b.model.currentConfig){const n=await $$.ui.showPrompt({title:"Save Config",label:"Config Name:"});n&&(await i.post("/add",{name:n,actions:l.actions,mappings:l.mappings}),b.setData({currentConfig:n}))}else await i.post("/update",l),$.notify(`Config '${l.name}' updated`,"success")},onConfig:function(){e.pushPage("configCtrl",{title:"Configurations",props:{currentConfig:b.model.currentConfig},onReturn:function(n){l=n,b.setData({currentConfig:n.name}),d=l.mappings[r],a.resetVariables()}})},onHubChange:function(){const n=$(this).closest("tr").index(),e=$(this).getValue(),t=s[b.model.hubDevices[n].UUID];console.log("hubDevice",t),t.name=e,b.model.hubDevices[n].hubId=e},onShutDown:function(){const n=$(this).closest("tr").index(),e=b.model.hubDevices[n];s[e.UUID].shutdown()},onInfo:function(){const n=$(this).closest("tr").index(),t=b.model.hubDevices[n],o=s[t.UUID];console.log("hubDevice",o),e.pushPage("hubinfo",{title:t.hubId,props:{hubDevice:o}})},onActions:function(){e.pushPage("actionsCtrl",{title:"Actions",props:{actions:l.actions,hubDevices:Object.values(s)},onReturn:async function(n){console.log("onReturn",n),l.actions=n}})},onGamePad:function(){o.off("buttonUp",m),o.off("buttonDown",u),o.off("axe",v),e.pushPage("gamepad",{title:"Gamepad",props:{mapping:d,actions:l.actions},onBack:h,onReturn:async n=>{d=n,console.log("onReturn",d),console.log("config",l),l.mappings[n.id]=d,h()}})},onConnect:async function(){const n=await t.connect(),e=c++;s[e]=n,n.on("error",n=>{console.log(n)});const o=`HUB${b.model.hubDevices.length+1}`;n.name=o,b.model.hubDevices.push({UUID:e,hubId:o,batteryLevel:0,address:"Unknown"}),b.update(),n.on("batteryLevel",n=>{b.model.hubDevices.find(n=>n.UUID==e).batteryLevel=n.batteryLevel,b.update()}),n.on("address",n=>{console.log("address",n),b.model.hubDevices.find(n=>n.UUID==e).address=n.address,b.update()}),await n.startNotification(),n.on("disconnected",()=>{console.log("disconnected");const n=b.model.hubDevices.findIndex(n=>n.UUID==e);b.model.hubDevices.splice(n,1),b.update(),delete s[e]})}}});function p(n,e){a.execAction(Object.values(s),l.actions,n,e)}function u(n){if(d){const{down:e}=d.buttons[n.id];"None"!=e&&p(e,1)}}function m(n){if(d){const{up:e,down:t}=d.buttons[n.id];"Zero"==e?"None"!=t&&p(t,0):"None"!=e&&p(e,1)}}function v(n){if(d){const{action:e}=d.axes[n.id];"None"!=e&&p(e,n.value)}}function h(){console.log("initCbk"),o.on("buttonUp",m),o.on("buttonDown",u),o.on("axe",v)}o.on("connected",n=>{console.log("gamepad connnected",n),r=n.id,d=l.mappings[r],console.log({gamepadMapping:d}),b.setData({gamepadConnected:!0}),o.checkGamePadStatus(),h()}),o.on("disconnected",n=>{console.log("gamepad disconnected"),b.setData({gamepadConnected:!1}),d=null})}}),$$.control.registerControl("stepCtrl",{template:'<form bn-event="submit: onSubmit">\n    <div class="group">\n\n        <label>Type</label>\n        <div bn-control="brainjs.combobox" bn-data="{items: actionTypes}" name="type" bn-update="comboboxchange"\n            bn-val="type"></div>\n    </div>\n    \n    <div bn-if="isSleep">\n    \n        <div class="group">\n            <label>Time (ms)</label>\n            <input type="number" required name="time" min="0">\n        </div>\n    \n    </div>\n    \n    \n    <div bn-if="isSpeed">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed</label>\n            <input type="number" required name="speed" min="-100" max="100">\n        </div>\n    </div>\n    \n    <div bn-if="isSpeedtime">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed</label>\n            <input type="number" required name="speed" min="-100" max="100">\n        </div>\n        <div class="group">\n            <label>Time (ms)</label>\n            <input type="number" required name="time" min="0">\n        </div>\n        <div class="group">\n            <label>Wait End</label>\n            <input type="checkbox" name="waitFeedback">\n        </div>\n        <div class="group">\n            <label>Braking Style</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: brakeStyles}" name="brakeStyle" bn-val="brakeStyle"></div>\n        </div>\n    </div>\n    \n    <div bn-if="isDblspeedtime">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port1</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port1" bn-val="port1"></div>\n        </div>\n    \n        <div class="group">\n            <label>Port2</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port2" bn-val="port2"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed1</label>\n            <input type="number" required name="speed1" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Speed2</label>\n            <input type="number" required name="speed2" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Time (ms)</label>\n            <input type="number" required name="time" min="0">\n        </div>\n        <div class="group">\n            <label>Wait End</label>\n            <input type="checkbox" name="waitFeedback">\n        </div>\n        <div class="group">\n            <label>Braking Style</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: brakeStyles}" name="brakeStyle" bn-val="brakeStyle"></div>\n        </div>\n    </div>\n    \n    <div bn-if="isPower">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>\n    \n        <div class="group">\n            <label>Power</label>\n            <input type="number" required name="power" min="-100" max="100">\n        </div>\n    </div>\n    \n    <div bn-if="isRotate">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed</label>\n            <input type="number" required name="speed" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Angle (°)</label>\n            <input type="number" required name="angle" step="1">\n        </div>\n    \n        <div class="group">\n            <label>Wait End</label>\n            <input type="checkbox" name="waitFeedback">\n        </div>\n    \n        <div class="group">\n            <label>Braking Style</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: brakeStyles}" name="brakeStyle" bn-val="brakeStyle"></div>\n        </div>\n    </div>\n    \n    <div bn-if="isDblrotate">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port1</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port1" bn-val="port1"></div>\n        </div>\n    \n        <div class="group">\n            <label>Port2</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port2" bn-val="port2"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed1</label>\n            <input type="number" required name="speed1" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Speed2</label>\n            <input type="number" required name="speed2" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Angle (°)</label>\n            <input type="number" required name="angle" step="1">\n        </div>\n    \n        <div class="group">\n            <label>Wait End</label>\n            <input type="checkbox" name="waitFeedback">\n        </div>\n    \n        <div class="group">\n            <label>Braking Style</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: brakeStyles}" name="brakeStyle" bn-val="brakeStyle"></div>\n        </div>\n    </div>\n    \n    <div bn-if="isPosition">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed</label>\n            <input type="number" required name="speed" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Angle (°)</label>\n            <input type="number" required name="angle" step="1">\n        </div>\n    \n        <div class="group">\n            <label>Wait End</label>\n            <input type="checkbox" name="waitFeedback">\n        </div>\n    \n        <div class="group">\n            <label>Braking Style</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: brakeStyles}" name="brakeStyle" bn-val="brakeStyle"></div>\n        </div>\n    </div>\n    \n    <div bn-if="isDblposition">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port1</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port1" bn-val="port1"></div>\n        </div>\n    \n        <div class="group">\n            <label>Port2</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port2" bn-val="port2"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed</label>\n            <input type="number" required name="speed" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Angle1 (°)</label>\n            <input type="number" required name="angle1" step="1">\n        </div>\n    \n        <div class="group">\n            <label>Angle2 (°)</label>\n            <input type="number" required name="angle2" step="1">\n        </div>\n    \n        <div class="group">\n            <label>Wait End</label>\n            <input type="checkbox" name="waitFeedback">\n        </div>\n    \n        <div class="group">\n            <label>Braking Style</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: brakeStyles}" name="brakeStyle" bn-val="brakeStyle"></div>\n        </div>\n    </div>\n    \n    <div bn-if="isCalibrate">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>\n    \n    </div>\n    \n    \n    <div bn-if="isZero">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>\n    \n    </div>\n    \n    <div bn-if="isColor">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Color</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ledColors}" name="color"></div>\n        </div>\n    \n    </div>\n    \n    <div bn-if="isRgb">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Red</label>\n            <input type="number" min="0" max="255" name="red">\n        </div>\n        <div class="group">\n            <label>Green</label>\n            <input type="number" min="0" max="255" name="green">\n        </div>\n        <div class="group">\n            <label>Blue</label>\n            <input type="number" min="0" max="255" name="blue">\n        </div>\n    </div>\n\n    <div bn-if="isBrightness">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port" bn-val="port"></div>\n        </div>  \n        <div class="group">\n            <label>Brightness</label>\n            <input type="number" min="0" name="brightness">\n        </div>\n\n    </div>\n    \n    <div bn-if="isDblspeed">\n        <div class="group">\n            <label>HUB</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: hubs}" name="hub"  bn-val="hub">\n            </div>\n        </div>\n        <div class="group">\n            <label>Port1</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port1" bn-val="port1"></div>\n        </div>\n    \n        <div class="group">\n            <label>Port2</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: ports}" name="port2" bn-val="port2"></div>\n        </div>\n    \n        <div class="group">\n            <label>Speed1</label>\n            <input type="number" required name="speed1" min="-100" max="100">\n        </div>\n    \n        <div class="group">\n            <label>Speed2</label>\n            <input type="number" required name="speed2" min="-100" max="100">\n        </div>\n    </div>\n\n    <div bn-if="isTestvar">\n        <div class="group">\n            <label>Variable Name</label>\n            <input type="text" name="varName" required>\n        </div>\n        <div class="group">\n            <label>If variable =</label>\n            <input type="text" name="varValue" required>\n        </div>\n        <div class="group">\n            <label>Action</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: availableActions}" name="eqAction" bn-val="eqAction"></div>\n        </div>\n        <div class="group">\n            <label>Else Action</label>\n            <div bn-control="brainjs.combobox" bn-data="{items: availableActions}" name="neqAction" bn-val="neqAction"></div>\n        </div>\n    </div>\n\n    <div bn-if="isSetvar">\n        <div class="group">\n            <label>Variable Name</label>\n            <input type="text" name="varName" required>\n        </div>\n        <div class="group">\n            <label>Value</label>\n            <input type="text" name="varValue" required>\n        </div>\n    </div>\n</form>',deps:["breizbot.pager","hub"],props:{data:null},init:function(n,e,t){let{data:o,availableActions:a}=this.props;o=o||{},a.unshift("None");const i=["SLEEP","POWER","SPEED","DBLSPEED","SPEEDTIME","DBLSPEEDTIME","ROTATE","DBLROTATE","POSITION","DBLPOSITION","CALIBRATE","ZERO","COLOR","RGB","BRIGHTNESS","TESTVAR","SETVAR"],l="ABCD".split(""),s=Object.entries(t.Color).map(([n,e])=>Object.assign({label:n,value:e})),c=Object.entries(t.BrakingStyle).map(([n,e])=>Object.assign({label:n,value:e})),d={port:o.port||"A",port1:o.port1||"A",port2:o.port2||"B",type:o.type||"SPEED",hub:o.hub||"HUB1",brakeStyle:o.brakeStyle||t.BrakingStyle.BRAKE,actionTypes:i,brakeStyles:c,ledColors:s,ports:l,states:["STATE1","STATE2","STATE3"],hubs:["HUB1","HUB2"],availableActions:a,eqAction:o.eqAction||"None",neqAction:o.neqAction||"None",state:o.state||"STATE1"};for(const n of i){d["is"+(n.charAt(0)+n.slice(1).toLowerCase())]=function(){return this.type==n}}$$.viewController(n,{data:d,events:{onSubmit:function(n){console.log("onSubmit"),n.preventDefault()}}});n.setFormData(o)}}),$$.control.registerControl("actionsCtrl",{template:'<div bn-show="!hasActions" class="message">\n    No actions defined\n</div>\n\n<div class="scrollPanel" bn-show="hasActions">\n    <div bn-each="actions" class="items" bn-event="click.item: onItemClick, contextmenuchange.item:onItemContextMenu">\n        <div class="w3-card-2 item" bn-control="brainjs.contextmenu" bn-data="{\n                    items: {\n                        edit: {name: \'Edit\', icon: \'fas fa-edit\'},\n                        delete: {name: \'Remove\', icon: \'fas fa-trash-alt\'},\n                        duplicate: {name: \'Duplicate\', icon: \'fas fa-clone\'}\n                    }\n                }">\n            <div>\n                <strong bn-text="$scope.$i.name"></strong>\n            </div>\n        </div>\n    </div>\n</div>',deps:["breizbot.pager","actionSrv"],props:{actions:null,isEdition:!0,hubDevices:null},init:function(n,e,t){console.log("props",this.props);const{isEdition:o,hubDevices:a}=this.props,i=Array.from(this.props.actions||[]);o||(i.unshift({name:"Zero"}),i.unshift({name:"None"}));const l=$$.viewController(n,{data:{actions:i,hasActions:function(){return this.actions.length>0}},events:{onItemContextMenu:async function(n,t){const o=$(this).closest(".item").index(),a=l.model.actions[o];if("delete"==t.cmd&&(l.model.actions.splice(o,1),l.update()),"duplicate"==t.cmd){const n=await $$.ui.showPrompt({label:"New Name",title:"Add action"});if(null==n)return;const e=Object.assign({},a,{name:n});l.model.actions.push(e),l.update()}if("edit"==t.cmd){let{steps:n}=a;Array.isArray(n)||(n=[a]);const t=l.model.actions.map(n=>n.name);e.pushPage("actionCtrl",{title:a.name,props:{steps:n,availableActions:t},onReturn:function(n){l.model.actions[o]={name:a.name,steps:n}}})}},onItemClick:function(n){const i=$(this).closest(".item").index(),s=l.model.actions[i];o?t.execAction(a,l.model.actions,s.name,1):e.popPage(s.name)}}});o&&(this.getButtons=function(){return{addAction:{title:"Add Action",icon:"fa fa-plus",onClick:async function(){const n=await $$.ui.showPrompt({label:"Name",title:"Add action"});if(null==n)return;const t=l.model.actions.map(n=>n.name);e.pushPage("actionCtrl",{title:n,props:{steps:[{}],availableActions:t},onReturn:function(e){l.model.actions.push({name:n,steps:e}),l.update()}})}},save:{title:"Save",icon:"fa fa-check",onClick:function(){e.popPage(l.model.actions)}}}})}}),$$.control.registerControl("actionCtrl",{template:'<div class="scrollPanel">\n\n    <div bn-each="steps" bn-index="idx" \n        bn-event="click.removeBtn: onRemoveStep, click.upBtn: onMoveUp, click.downBtn: onMoveDown">\n\n        <div class="stepItem">\n            <div class="menubar" >\n                <div>\n                    <button bn-icon="fas fa-level-up-alt" class="upBtn" title="MoveUp"\n                        bn-show="canMoveUp"></button>\n                    <button bn-icon="fas fa-level-down-alt" class="downBtn" title="MoveDown"\n                        bn-show="canMoveDown"></button>\n                    <button bn-icon="fa fa-trash-alt" class="removeBtn" title="Remove" \n                    bn-show="showMenubar"></button>\n\n                </div>\n            </div>\n            <div bn-control="stepCtrl" bn-data="{data: $scope.$i, availableActions}"></div>\n        </div>\n\n    </div>\n</div>',deps:["breizbot.pager"],props:{steps:[],availableActions:[]},init:function(n,e){console.log("actionCtrl props",this.props);const{steps:t,availableActions:o}=this.props,a=$$.viewController(n,{data:{steps:t,availableActions:o,showMenubar:function(n){return n.idx>0},canMoveUp:function(n){return n.idx>0},canMoveDown:function(n){return n.idx<this.steps.length-1}},events:{onMoveUp:function(){const n=$(this).closest(".stepItem").index();a.model.steps=i();const e=a.model.steps[n];a.model.steps[n]=a.model.steps[n-1],a.model.steps[n-1]=e,a.update()},onMoveDown:function(){const n=$(this).closest(".stepItem").index();a.model.steps=i();const e=a.model.steps[n];a.model.steps[n]=a.model.steps[n+1],a.model.steps[n+1]=e,a.update()},onRemoveStep:function(){const n=$(this).closest(".stepItem").index();console.log("onRemoveStep",n),a.model.steps.splice(n,1),a.update()}}});function i(){const e=[];return n.find("form").each(function(){e.push($(this).getFormData())}),e}this.getButtons=function(){return{addStep:{title:"Add Step",icon:"fa fa-plus",onClick:function(){a.model.steps=i(),a.model.steps.push({}),a.update()}},apply:{title:"Apply",icon:"fas fa-check",onClick:function(){let t=!0;n.find("form").each(function(){const n=$(this).get(0);t=t&&n.reportValidity()}),t&&e.popPage(i())}}}}}}),$$.control.registerControl("code",{template:'<div class="toolbar">\n    <button bn-event="click: onRun" class="w3-btn w3-blue">Run</button>\n\n</div>\n<div id="blocklyDiv"></div>\n<div class="logPanel" bn-html="getLogs"></div>\n\n<xml id="toolbox" style="display: none;">\n    <category name="Logic" categorystyle="logic_category">\n        <block type="controls_if"></block>\n        <block type="logic_compare"></block>\n        <block type="logic_operation"></block>\n        <block type="logic_negate"></block>\n        <block type="logic_boolean"></block>\n        <block type="logic_ternary"></block>\n    </category>\n    <category name="Loop" categorystyle="loop_category">\n        <block type="controls_repeat_ext">\n            <value name="TIMES">\n                <shadow type="math_number">\n                    <field name="NUM">10</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="controls_whileUntil"></block>\n        <block type="controls_for">\n            <value name="FROM">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="TO">\n                <shadow type="math_number">\n                    <field name="NUM">10</field>\n                </shadow>\n            </value>\n            <value name="BY">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="controls_forEach"></block>\n        <block type="controls_flow_statements"></block>\n    </category>\n    <category name="Math" categorystyle="math_category">\n        <block type="math_number"></block>\n        <block type="math_arithmetic"></block>\n        <block type="math_random_int">\n            <value name="FROM">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="TO">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="Text" categorystyle="text_category">\n        <block type="text"></block>\n        <block type="text_print"></block>\n        <block type="text_length">\n            <value name="VALUE">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="text_changeCase">\n            <field name="CASE">UPPERCASE</field>\n            <value name="TEXT">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="text_append">\n            <field name="VAR" id="MHveE$^#X7/c|*RA!r{I">item</field>\n            <value name="TEXT">\n                <shadow type="text">\n                    <field name="TEXT" />\n                </shadow>\n            </value>\n        </block>\n        <block type="text_join">\n            <mutation items="2" />\n        </block>\n        <block type="text_indexOf"></block>\n        <block type="text_charAt"></block>\n        <block type="text_getSubstring"></block>\n        <block type="text_prompt_ext">\n            <mutation type="TEXT" />\n            <field name="TYPE">TEXT</field>\n            <value name="TEXT">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="Lists" categorystyle="list_category">\n        <block type="lists_create_with">\n            <mutation items="0"></mutation>\n        </block>\n        <block type="lists_create_with"></block>\n        <block type="lists_repeat">\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">5</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="lists_length"></block>\n        <block type="lists_isEmpty"></block>\n        <block type="lists_indexOf">\n            <value name="VALUE">\n                <block type="variables_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_getIndex">\n            <value name="VALUE">\n                <block type="variables_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_setIndex">\n            <value name="LIST">\n                <block type="variables_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_getSublist">\n            <value name="LIST">\n                <block type="variables_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_split">\n            <value name="DELIM">\n                <shadow type="text">\n                    <field name="TEXT">,</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="lists_sort"></block>\n        <block type="lists_reverse"></block>\n    </category>\n    <category name="Variables" custom="VARIABLE" categorystyle="variable_category"></category>\n    <category name="Functions" custom="PROCEDURE" categorystyle="procedure_category"></category>\n    <category name="Motor" colour="355">\n        <block type="create_motor"></block>\n        <block type="motor_speed_time"></block>\n        <block type="motor_speed_degrees"></block>\n        <block type="motor_speed_position"></block>\n        <block type="motor_reset_position"></block>\n    </category>\n    <category name="HUB" colour="355">\n        <block type="hub_color"></block>\n    </category>\n\n</xml>',deps:["breizbot.pager","breizbot.blocklyinterpretor","hub"],props:{hubDevices:null},init:function(n,e,t,o){const a=this.props.hubDevices;Blockly.inject("blocklyDiv",{media:"../lib/blockly/media/",toolbox:document.getElementById("toolbox")});t.setLlogFunction(n=>{i.model.logs.push(n),i.update()}),t.addBlockType("create_motor",async n=>{const e=n.fields.HUB,t=n.fields.PORT,i=a.find(n=>n.name==e);if(null!=i){return await i.getTachoMotor(o.PortMap[t])}throw`Hub ${e} is not connected`}),t.addBlockType("motor_speed_time",async n=>{const e=n.fields.VAR.id,a=t.getVarValue(e);if("object"!=typeof a||!o.isTachoMotor(a)){throw`variable '${t.getVarName(e)}' is not of type TachoMotor`}const i=n.fields.SPEED,l=n.fields.WAIT,s=n.fields.TIME;console.log({speed:i,time:s,waitFeedback:l}),await a.setSpeedForTime(i,1e3*s,l,o.BrakingStyle.FLOAT)}),t.addBlockType("motor_speed_degrees",async n=>{const e=n.fields.VAR.id,a=t.getVarValue(e);if("object"!=typeof a||!o.isTachoMotor(a)){throw`variable '${t.getVarName(e)}' is not of type TachoMotor`}const i=n.fields.SPEED,l=n.fields.WAIT,s=n.fields.DEGREES;console.log({speed:i,degrees:s,waitFeedback:l}),await a.rotateDegrees(s,i,l,o.BrakingStyle.FLOAT)}),t.addBlockType("motor_speed_position",async n=>{const e=n.fields.VAR.id,a=t.getVarValue(e);if("object"!=typeof a||!o.isTachoMotor(a)){throw`variable '${t.getVarName(e)}' is not of type TachoMotor`}const i=n.fields.SPEED,l=n.fields.WAIT,s=n.fields.ANGLE;console.log({speed:i,angle:s,waitFeedback:l}),await a.gotoAngle(s,i,l,o.BrakingStyle.FLOAT)}),t.addBlockType("motor_reset_position",async n=>{const e=n.fields.VAR.id,a=t.getVarValue(e);if("object"!=typeof a||!o.isTachoMotor(a)){throw`variable '${t.getVarName(e)}' is not of type TachoMotor`}await a.resetZero()}),t.addBlockType("hub_color",async n=>{const e=n.fields.HUB,t=n.fields.COLOR,i=a.find(n=>n.name==e);if(null==i)throw`Hub ${e} is not connected`;{const n=await i.getRgbLed(o.PortMap.HUB_LED);await n.setColor(o.Color[t])}});const i=$$.viewController(n,{data:{logs:[],getLogs:function(){return this.logs.join("<br>")}},events:{onRun:async function(){console.log("onRun");const n=Blockly.serialization.workspaces.save(Blockly.getMainWorkspace());i.setData({logs:[]});try{await t.startCode(n)}catch(n){"string"==typeof n&&$$.ui.showAlert({title:"Error",content:n})}}}})}}),$$.control.registerControl("configCtrl",{template:'<div bn-show="!hasConfigs" class="message">\n    No configurations defined\n</div>\n\n<div class="scrollPanel" bn-show="hasConfigs">\n    <div bn-each="configs" class="items" bn-event="click.item: onItemClick, contextmenuchange.item:onItemContextMenu">\n        <div class="w3-card-2 item" bn-control="brainjs.contextmenu" bn-data="{\n                    items: {\n                        delete: {name: \'Remove\', icon: \'fas fa-trash-alt\'}\n                    }\n                }">\n            <div>\n                <strong bn-text="$scope.$i.name"></strong>\n            </div>\n        </div>\n    </div>\n</div>',deps:["breizbot.pager","breizbot.http"],props:{currentConfig:""},init:function(n,e,t){const{currentConfig:o}=this.props,a=$$.viewController(n,{data:{configs:[],hasConfigs:function(){return this.configs.length>0}},events:{onItemContextMenu:async function(n,e){const l=$(this).closest(".item").index(),s=a.model.configs[l];"delete"==e.cmd&&(s.name==o?$$.ui.showAlert({content:"Cannot delete active config",title:"Warning"}):(await t.post("/delete",s),i()))},onItemClick:function(n){const t=$(this).closest(".item").index();console.log("onItemClick",t);const o=a.model.configs[t];e.popPage(o)}}});async function i(){const n=await t.get("/");console.log({configs:n}),a.setData({configs:n})}i()}}),$$.control.registerControl("gamepad",{template:'<div>\n    <h2 bn-text="id"></h2>\n</div>\n\n<h3>Axes</h3>\n<div>\n    <table class="w3-table-all axeTable">\n        <thead>\n            <tr>\n                <th>Axe</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="axes" bn-bind="axes" bn-index="idx" bn-event="click.item: onAxeClick">\n            <tr>\n                <td bn-text="getAxeLabel"></td>\n                <td>\n                    <div bn-text="$scope.$i.action" class="item"></div>\n                </td>                \n            </tr>\n        </tbody>\n    </table>\n</div>\n\n<h3>Buttons</h3>\n<div class="commandTable">\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Button</th>\n                <th>Down</th>\n                <th>Up</th>\n            </tr>\n        </thead>\n        <tbody bn-each="buttons" bn-bind="buttons" bn-index="idx" bn-event="click.item: onButtonClick">\n            <tr>\n                <td bn-text="getButtonLabel"></td>\n                <td>\n                    <div bn-text="$scope.$i.down" class="item" data-cmd="down">\n                    </div>\n                </td>\n                <td>\n                    <div bn-text="$scope.$i.up" class="item" data-cmd="up">\n                    </div>\n                </td>\n\n            </tr>\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager","breizbot.gamepad"],props:{mapping:null,actions:null},init:function(n,e,t){const{mapping:o,actions:a}=this.props;console.log(this.props);let i=[],l=[];const s=t.getGamepads()[0];if(null!=o&&(i=o.axes,l=o.buttons),0==i.length)for(let n=0;n<s.axes.length;n++)i.push({action:"None"});if(0==l.length)for(let n=0;n<s.buttons.length;n++)l.push({up:"None",down:"None"});function c(n){const{value:e,id:t}=n;0!=e?p.find("tr").eq(t).find("td").eq(0).addClass("pressed"):p.find("tr").eq(t).find("td").eq(0).removeClass("pressed")}function d(n){u.find("tr").eq(n.id).find("td").eq(0).addClass("pressed")}function r(n){u.find("tr").eq(n.id).find("td").eq(0).removeClass("pressed")}t.on("axe",c),t.on("buttonDown",d),t.on("buttonUp",r),this.dispose=function(){console.log("dispose"),t.off("axe",c),t.off("buttonDown",d),t.off("buttonUp",r)};const b=$$.viewController(n,{data:{id:s.id,axes:i,buttons:l,getButtonLabel:function(n){return`Button ${n.idx+1}`},getAxeLabel:function(n){return`Axe ${n.idx+1}`}},events:{onButtonClick:function(){const n=$(this).closest("tr").index(),t=$(this).data("cmd");e.pushPage("actionsCtrl",{title:"Select an action",props:{isEdition:!1,actions:a},onReturn:function(e){b.model.buttons[n][t]=e,b.update()}})},onAxeClick:function(){const n=$(this).closest("tr").index();console.log("onAxeClick",n),e.pushPage("actionsCtrl",{title:"Select an action",props:{isEdition:!1,actions:a},onReturn:function(e){b.model.axes[n].action=e,b.update()}})}}}),p=b.scope.axes,u=b.scope.buttons;this.getButtons=function(){return{check:{icon:"fa fa-check",title:"Apply",onClick:function(){e.popPage(function(){const n={id:s.id,axes:[],buttons:[]};return p.find("tr").each(function(e){const t=$(this).find(".item").text();n.axes.push({action:t})}),u.find("tr").each(function(e){const t=$(this).find('[data-cmd="up"]').text(),o=$(this).find('[data-cmd="down"]').text();n.buttons.push({up:t,down:o})}),console.log({ret:n}),n}())}}}}}}),$$.control.registerControl("hubinfo",{template:'<div class="scrollBar">\n    <h1>External Devices</h1>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Port</th>\n                <th>Device Type</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="externalDevices" bn-event="\n            mousedown.motorMouseAction: onMouseUp, \n            mouseup.motorMouseAction:onMouseDown, \n            click.motorAction:onMotorAction, \n            click.ledAction: onLedAction,\n            click.portInfo: onInfo2, \n            click.calibrate:onCalibrate">\n            <tr>\n                <td bn-text="$scope.$i.name"></td>\n                <td bn-text="$scope.$i.type"></td>\n                <td>\n                    <span bn-if="isMotor" class="spanButtons">\n                        <button class="w3-btn w3-green motorMouseAction" data-action="forward">FWD</button>\n                        <button class="w3-btn w3-green motorMouseAction" data-action="backward">BKWD</button>\n                    </span>\n                    <span bn-if="isTachoMotor" class="spanButtons">\n                        <button class="w3-btn w3-green motorAction" data-action="reset">RESET</button>\n                        <button class="w3-btn w3-green motorAction" data-action="gozero">GO ZERO</button>\n                    </span>\n                    <span bn-if="isLed" class="spanButtons">\n                        <button class="w3-btn w3-green ledAction" data-action="on">ON</button>\n                        <button class="w3-btn w3-green ledAction" data-action="off">OFF</button>\n                    </span>\n\n                    <button class="w3-btn w3-blue portInfo">MODE</button>\n                </td>\n\n            </tr>\n\n        </tbody>\n    </table>\n    <h1>Internal Devices</h1>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Port ID</th>\n                <th>Device Type</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="internalDevices" bn-event="click.w3-btn: onInfo">\n            <tr>\n                <td bn-text="$scope.$i.portId"></td>\n                <td bn-text="$scope.$i.type"></td>\n                <td>\n                    <button class="w3-btn w3-blue">MODE</button>\n                </td>\n            </tr>\n\n        </tbody>\n    </table></div>',deps:["breizbot.pager","hub"],props:{hubDevice:null},init:function(n,e,t){const o=this.props.hubDevice;function a(n,t){e.pushPage("info",{title:t,props:{portId:n,hubDevice:o}})}function i(n){const e=n.closest("tr").index();return c.model.externalDevices[e].portId}async function l(n){console.log("attach",n);const{portId:e,name:t,type:o}=n,a={portId:e,name:t,type:o};c.model.externalDevices.push(a),c.update()}function s(n){console.log("detach",n);const e=c.model.externalDevices.findIndex(e=>e.portId==n.portId);c.model.externalDevices.splice(e,1),c.update()}o.on("attach",l),o.on("detach",s),this.dispose=async function(){console.log("hubInfo dispose"),o.off("attach",l),o.off("detach",s)};const c=$$.viewController(n,{data:{internalDevices:[],externalDevices:[],isMotor:function(n){return t.isMotor(o.getDevice(n.$i.portId))},isLed:function(n){return t.isLed(o.getDevice(n.$i.portId))},isTachoMotor:function(n){return t.isTachoMotor(o.getDevice(n.$i.portId))}},events:{onMotorAction:async function(){const n=i($(this)),e=$(this).data("action");console.log("onMotorAction",n,e);const t=await o.getTachoMotor(n);switch(e){case"reset":t.resetZero();break;case"gozero":t.gotoAngle(0,50,!1)}},onLedAction:async function(){const n=i($(this)),e=$(this).data("action");console.log("onLedAction",n,e),(await o.getLed(n)).setBrightness("on"==e?100:0)},onCalibrate:async function(){const n=i($(this));console.log("onCalibrate",n);const e=await o.getMotor(n);await e.calibrate()},onMouseUp:async function(){const n=$(this).data("action"),e=i($(this)),t=await o.getMotor(e);switch(n){case"forward":t.setPower(100);break;case"backward":t.setPower(-100)}},onMouseDown:async function(){const n=i($(this));(await o.getMotor(n)).setPower(0)},onInfo:function(){const n=$(this).closest("tr").index(),{portId:e,deviceTypeName:t}=c.model.internalDevices[n];a(e,t)},onInfo2:function(){const n=$(this).closest("tr").index(),{portId:e,deviceTypeName:t}=c.model.externalDevices[n];a(e,t)}}});!async function(){const n=o.getHubDevices();console.log("devices",n);const e=[],t=[];for(const o of n){const{portId:n,type:a,name:i}=o;if(n<50){const e={name:i,portId:n,type:a};t.push(e)}else e.push({portId:n,type:a})}c.setData({internalDevices:e,externalDevices:t})}()}}),$$.control.registerControl("info",{template:'<div>\n    <div>\n        Capabilities: <span bn-text="capabilities"></span>\n    </div>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>MODE</th>\n                <th>CAPABILITIES</th>\n                <th>UNIT</th>\n                <th>RAW</th>\n                <th>SI</th>\n                <th>VALUE FORMAT</th>\n                <th>Value</th>\n            </tr>\n        </thead>\n        <tbody bn-each="modes" bn-event="click.btnGet: onBtnGet">\n            <tr>\n                <td bn-text="$scope.$i.name"></td>\n                <td bn-text="getCapabilites"></td>\n                <td bn-text="$scope.$i.unit"></td>\n                <td>\n                    <span bn-text="$scope.$i.RAW.min"></span><br>\n                    <span bn-text="$scope.$i.RAW.max"></span>\n                </td>\n                <td>\n                    <span bn-text="$scope.$i.PCT.min"></span><br>\n                    <span bn-text="$scope.$i.PCT.max"></span>\n                </td>\n                <td>\n                    <span bn-text="$scope.$i.SI.min"></span><br>\n                    <span bn-text="$scope.$i.SI.max"></span>\n                </td>\n                <td>\n                    dataType: <span bn-text="$scope.$i.VALUE_FORMAT.dataType"></span><br>\n                    numValues: <span bn-text="$scope.$i.VALUE_FORMAT.numValues"></span>\n                </td>\n                <td>\n                    <div bn-if="isInput">\n                        <button class="w3-btn w3-green btnGet">Get</button>\n                        <span></span>\n                    </div>\n\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager","hub"],props:{},init:function(n,e,t){const{portId:o}=this.props,a=this.props.hubDevice,i=$$.viewController(n,{data:{modes:[],capabilities:"",isInput:function(n){return 0!=(1&n.$i.mode)},getCapabilites:function(n){return 2==n.$i.mode?"OUT":1==n.$i.mode?"IN":3==n.$i.mode?"IN/OUT":void 0}},events:{onBtnGet:async function(n){const e=$(this).closest("tr").index();console.log("onBtnGet",e);const t=a.getDevice(o),i=await t.getValue(e);console.log("values",i),$(this).closest("td").find("span").text(JSON.stringify(i,null,4))}}});!async function(){const n=await a.getPortInformation(o);console.log("portInfo",n);const{modes:e,capabilities:t}=n;i.setData({modes:e,capabilities:t})}()}});