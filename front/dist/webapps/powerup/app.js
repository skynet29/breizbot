Blockly.Blocks.object_getfield={init:function(){this.appendValueInput("OBJECT").setCheck(null).appendField("in Object"),this.appendDummyInput().appendField("get field").appendField(new Blockly.FieldTextInput(""),"FIELD"),this.setInputsInline(!0),this.setOutput(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.create_device={init:function(){this.appendDummyInput().appendField("Device").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT").appendField(new Blockly.FieldNumber(0,0,1/0,1),"PORT"),this.setOutput(!0,"Device"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.device_getvalue={init:function(){this.appendValueInput("DEVICE").setCheck(null).appendField("Device"),this.appendDummyInput().appendField("Mode").appendField(new Blockly.FieldNumber(0,0,1/0,1),"MODE").appendField("getValue"),this.appendDummyInput(),this.setInputsInline(!0),this.setOutput(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.wait_until_device={init:function(){this.appendValueInput("DEVICE").setCheck(null).appendField("Wait until Device"),this.appendDummyInput().appendField("Mode").appendField(new Blockly.FieldNumber(0,0,1/0,1),"MODE"),this.appendValueInput("TEST").setCheck("Boolean").appendField(new LexicalVariables.FieldParameterFlydown("value",!0,LexicalVariables.FieldFlydown.DISPLAY_BELOW),"VAR").appendField("Test"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl(""),this.lexicalVarPrefix="counter"},blocksInScope:function(){const e=this.getInputTargetBlock("TEST");return e?[e]:[]},declaredNames:function(){return[this.getFieldValue("VAR")]},withLexicalVarsAndPrefix:function(e,n){this.getInputTargetBlock("TEST")==e&&n(this.getFieldValue("VAR"),this.lexicalVarPrefix)}},Blockly.Blocks.create_tacho_motor={init:function(){this.appendDummyInput().appendField("TachoMotor").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT"),this.setOutput(!0,"Motor"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.create_motor={init:function(){this.appendDummyInput().appendField("Motor").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT"),this.setOutput(!0,"Motor"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.create_pair_motor={init:function(){this.appendDummyInput().appendField("PairMotor").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("PORT1").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT1").appendField("PORT2").appendField(new Blockly.FieldDropdown([["A","A"],["B","B"],["C","C"],["D","D"]]),"PORT2"),this.setOutput(!0,"Motor"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.pair_motor_speed={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("Pair Motor"),this.appendValueInput("SPEED1").setCheck("Number").appendField("Speed1"),this.appendValueInput("SPEED2").setCheck("Number").appendField("Speed2"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_color={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Color").appendField(new Blockly.FieldDropdown([["BLACK","BLACK"],["PURPLE","PURPLE"],["BLUE","BLUE"],["LIGHT_BLUE","LIGHT_BLUE"],["CYAN","CYAN"],["GREEN","GREEN"],["PINK","PINK"],["YELLOW","YELLOW"],["ORANGE","ORANGE"],["RED","RED"],["WHITE","WHITE"]]),"COLOR"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_get_tilt={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Tilt").appendField(new Blockly.FieldDropdown([["Pitch","pitch"],["Roll","roll"],["Yaw","yaw"]]),"TYPE"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_get_voltage={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Voltage (mV)"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_get_impact_count={init:function(){this.appendDummyInput().appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Impact Count"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.hub_set_impact_count={init:function(){this.appendValueInput("VAR").setCheck("Number").appendField("HUB").appendField(new Blockly.FieldDropdown([["HUB1","HUB1"],["HUB2","HUB2"]]),"HUB").appendField("Impact Count"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_time={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.appendValueInput("TIME").setCheck("Number").appendField("Time (sec)"),this.appendDummyInput().appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_degrees={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.appendValueInput("DEGREES").setCheck("Number").appendField("Degrees"),this.appendDummyInput().appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_position={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.appendValueInput("ANGLE").setCheck("Number").appendField("Angle"),this.appendDummyInput().appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed_abs_position={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.appendValueInput("ANGLE").setCheck("Number").appendField("Position"),this.appendDummyInput().appendField("Wait").appendField(new Blockly.FieldCheckbox("TRUE"),"WAIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_reset_position={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendDummyInput().appendField("reset position"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_get_speed={init:function(){this.appendValueInput("VAR").appendField("TachoMotor"),this.appendDummyInput().appendField("Speed"),this.setOutput(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_get_position={init:function(){this.appendValueInput("VAR").appendField("TachoMotor"),this.appendDummyInput().appendField("Position"),this.setOutput(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_get_absoluteposition={init:function(){this.appendValueInput("VAR").appendField("TachoMotor"),this.appendDummyInput().appendField("Absolute Position"),this.setOutput(!0,null),this.setInputsInline(!0),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.sleep={init:function(){this.appendValueInput("TIME").setCheck("Number").appendField("Sleep (sec)"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_speed={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("TachoMotor"),this.appendValueInput("SPEED").setCheck("Number").appendField("Speed"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.color_sensor_brightness={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("ColorSensor"),this.appendValueInput("FIRST_SEG").setCheck("Number").appendField("First Segment"),this.appendValueInput("SEC_SEG").setCheck("Number").appendField("Second Segment"),this.appendValueInput("THIRD_SEG").setCheck("Number").appendField("Third Segment"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.distance_sensor_brightness={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("DistanceSensor"),this.appendValueInput("TOP_LEFT").setCheck("Number").appendField("Top Left"),this.appendValueInput("BOTTOM_LEFT").setCheck("Number").appendField("Bottom Left"),this.appendValueInput("TOP_RIGHT").setCheck("Number").appendField("Top Right"),this.appendValueInput("BOTTOM_RIGHT").setCheck("Number").appendField("Bottom Right"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.motor_power={init:function(){this.appendValueInput("VAR").setCheck(null).appendField("Motor"),this.appendValueInput("POWER").setCheck("Number").appendField("Power"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.device_subscribe={init:function(){this.appendValueInput("DEVICE").setCheck(null).appendField("Device"),this.appendDummyInput().appendField("Mode").appendField(new Blockly.FieldNumber(0,0,1/0,1),"MODE").appendField("delta").appendField(new Blockly.FieldNumber(1,1),"DELTA").appendField("subscribe").appendField(new LexicalVariables.FieldParameterFlydown("value",!0,LexicalVariables.FieldFlydown.DISPLAY_BELOW),"VAR"),this.appendStatementInput("DO").setCheck(null),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip(""),this.setHelpUrl(""),this.lexicalVarPrefix="counter"},blocksInScope:function(){const e=this.getInputTargetBlock("DO");return e?[e]:[]},declaredNames:function(){return[this.getFieldValue("VAR")]},withLexicalVarsAndPrefix:function(e,n){this.getInputTargetBlock("DO")==e&&n(this.getFieldValue("VAR"),this.lexicalVarPrefix)}},$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n\n    <div class="left">\n        <button bn-event="click: onConnect">Connect to HUB</button>\n        \n        <button bn-event="click: onCode">Code</button>\n\n        <button bn-event="click: onActions">Actions</button>\n\n    </div>\n</div>\n\n\n<div>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Name</th>\n                <th>Actions</th>\n                <th>Battery Level</th>\n                <th>Address</th>\n            </tr>\n        </thead>\n        <tbody bn-each="hubDevices" bn-event="input-label-change.name: onSetName, click.btnShutdown: onShutDown, click.btnInfo: onInfo">\n            <tr>\n                <td>\n                    <span bn-control="input-label" bn-data="{val: $scope.$i.name}" class="name"></span>\n                </td>\n                <td>\n                    <button class="btnShutdown">Shutdown</button>\n                    <button class="btnInfo">Info</button>\n                </td>\n                <td bn-text="$scope.$i.batteryLevel"></td>\n                <td bn-text="$scope.$i.address"></td>\n            </tr>\n        </tbody>\n    </table>\n\n</div>',deps:["breizbot.pager","hub","breizbot.blocklyinterpretor"],props:{},init:async function(e,n,t,o){e.find("button").addClass("w3-btn w3-blue");const a={};let i=1,l=null;const s=$$.viewController(e,{data:{currentConfig:"",gamepadConnected:!1,hubDevices:[]},events:{onActions:function(){n.pushPage("actions",{title:"Actions",props:{hubDevices:Object.values(a)}})},onSetName:async function(e,n){console.log("onSetName",n);const t=$(this).closest("tr").index(),o=s.model.hubDevices[t],i=a[o.UUID];await i.setName(n),o.name=n,s.update()},onCode:function(){n.pushPage("code",{title:"Code",props:{hubDevices:Object.values(a),config:l},onBack:function(e){l=e}})},onShutDown:function(){const e=$(this).closest("tr").index(),n=s.model.hubDevices[e];a[n.UUID].shutdown()},onInfo:function(){const e=$(this).closest("tr").index(),t=s.model.hubDevices[e],o=a[t.UUID];console.log("hubDevice",o),n.pushPage("hubinfo",{title:o.name,props:{hubDevice:o}})},onConnect:async function(){const e=await t.connect(),n=i++,o=await e.getName(),l=await e.getPrimaryMACAddress();console.log("onConnect",{name:o,address:l}),a[n]=e,e.on("error",e=>{console.log(e)}),s.model.hubDevices.push({UUID:n,batteryLevel:0,address:l,name:o}),s.update(),e.on("batteryLevel",e=>{s.model.hubDevices.find(e=>e.UUID==n).batteryLevel=e.batteryLevel,s.update()}),await e.startNotification(),e.on("disconnected",()=>{console.log("disconnected");const e=s.model.hubDevices.findIndex(e=>e.UUID==n);s.model.hubDevices.splice(e,1),s.update(),delete a[n]})}}})}}),$$.control.registerControl("input-label",{props:{val:10},init:function(e){const{val:n}=this.props,t=$("<span>").appendTo(e).text(n).click(function(){const n=this,t=$(this).text();let o=!1;const a=document.createElement("input");a.type="text",a.value=t,a.className="input-edit",n.replaceWith(a),a.focus(),a.addEventListener("keydown",t=>{"Enter"===t.key&&(n.textContent=a.value,e.trigger("input-label-change",a.value),o=!0,a.replaceWith(n)),"Escape"===t.key&&(o=!0,a.replaceWith(n))}),a.addEventListener("blur",()=>{o||a.replaceWith(n)})});this.getValue=function(){return t.text()}}}),$$.control.registerControl("addAction",{template:'<div>\n    <form bn-event="submit: onSubmit, change.hub: onHubChange, change.port: onPortChange">\n\n        <div>\n            <label>Label</label>\n            <input type="text" required name="label"> \n        </div>\n\n        <div>\n            <label>HUB</label>\n            <select bn-items="hubs" name="hub" class="hub" required></select>\n        </div>\n\n\n        <div bn-show="hasDevice">\n            <label>Port</label>\n            <select bn-items="devices" name="port" class="port" required ></select>\n        </div>\n\n\n        <div bn-show="hasActions">\n            <label>Action</label>\n            <select bn-items="actions" name="action" class="action" required></select>\n        </div>\n\n\n\n        <input type="submit" hidden bn-bind="submit">\n    </form>\n</div>',deps:["breizbot.pager"],props:{hubDevices:[]},init:function(e,n){const t=this.props.hubDevices;let o=null;const a=$$.viewController(e,{data:{hubs:t.map(e=>e.name),devices:[],actions:[],hasDevice:function(){return this.devices.length>0},hasActions:function(){return this.actions.length>0}},events:{onSubmit:function(e){e.preventDefault(),n.popPage($(this).getFormData())},onHubChange:function(n){console.log("onHubChange");const i=$(this).getValue(),l=(o=t.find(e=>e.name==i)).getHubDevices();a.model.devices=l.filter(e=>e.portId<50).map(e=>({label:e.name,value:e.portId})),a.model.actions=[],a.update(),e.find(".port").get(0).selectedIndex=-1},onPortChange:function(){const n=$(this).getValue(),t=o.getDevice(n);a.model.actions=t.availableActions,a.update(),e.find(".action").get(0).selectedIndex=-1}}});e.find(".hub").get(0).selectedIndex=-1,this.getButtons=function(){return{apply:{title:"Apply",icon:"fas fa-check",onClick:function(){a.scope.submit.click()}}}}}}),$$.control.registerControl("actions",{template:'<div>\n\n    <table>\n        <tbody bn-each="actions" bn-event="click.btnAction: onBtnAction">\n            <tr>\n                <td bn-text="$scope.$i.hubName"></td>\n                <td bn-text="$scope.$i.name"></td>\n                <td bn-each="$scope.$i.devActions" bn-iter="devAction">\n                    <button bn-text="$scope.devAction.label" \n                    bn-data="{cmd: $scope.devAction.action}"\n                    bn-prop="{disabled: !$scope.devAction.isActionEnabled}" \n                    class="btnAction w3-btn w3-green"></button>\n                </td>\n\n            </tr>\n\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager"],props:{hubDevices:[]},init:function(e,n){const t=this.props.hubDevices;function o(){const e=[];for(const n of t){const t=n.name,o=n.getHubDevices();for(const n of o){const{portId:o,name:a,actions:i}=n;for(const e of i)e.isActionEnabled=n.isActionEnabled(e.action);i.length>0&&e.push({hubName:t,portId:o,name:a,devActions:i})}}return console.log("actions",e),e}const a=$$.viewController(e,{data:{actions:o()},events:{onBtnAction:async function(){const e=$(this).data("cmd"),n=$(this).closest("tr").index(),t=a.model.actions[n];console.log("onBtnAction",e,t);const o=i(t.hubName,t.portId);o&&("CALIBRATE"==e?($(this).removeClass("w3-green"),$(this).addClass("w3-yellow"),await o.execAction(e),$(this).removeClass("w3-yellow"),$(this).addClass("w3-green")):o.execAction(e))}}});function i(e,n){return console.log("getDevice",{hubName:e,portId:n}),t.find(n=>n.name==e).getDevice(n)}this.getButtons=function(){return{apply:{title:"Add Action",icon:"fas fa-plus",onClick:function(){console.log("addAction"),n.pushPage("addAction",{title:"Add Action",props:{hubDevices:t},onReturn:function(e){console.log("onReturn",e);const{hub:n,port:t,action:l,label:s}=e;i(n,t).actions.push({action:l,label:s}),a.model.actions=o(),a.update()}})}}}}}}),$$.control.registerControl("code",{template:'<div class="toolbar">\n\n    <div>\n        <button bn-event="click: onExport" title="Export current config">Export</button>\n        <button bn-event="click: onImport" title="Import config">Import</button>\n\n        <button bn-event="click: onNewConfig" bn-icon="fa fa-file" title="Reset Config"></button>\n\n        <button bn-event="click: onConfig" bn-icon="fa fa-folder-open" title="Open Config"></button>\n\n        <button bn-event="click: onSaveConfig" bn-icon="fa fa-save" title="Save current config"></button>\n\n        <button bn-event="click: onRun">Run</button>\n\n        <button bn-event="click: onStop">Stop</button>\n\n        <button bn-event="click: onGamePad" bn-show="gamepadConnected">Gamepad</button>\n    </div>\n\n\n    <div>\n        <div bn-show="currentConfig">\n            <label>Current Config:</label>\n            <span bn-text="currentConfig"></span>\n        </div>\n    </div>\n\n\n\n</div>\n<div id="blocklyDiv"></div>\n<div class="logPanel" bn-html="getLogs" bn-bind="logPanel"></div>\n\n<xml id="toolbox" style="display: none;">\n\n    <category name="Logic" categorystyle="logic_category">\n        <block type="controls_if"></block>\n        <block type="logic_compare"></block>\n        <block type="logic_operation"></block>\n        <block type="logic_negate"></block>\n        <block type="logic_boolean"></block>\n        <block type="logic_ternary"></block>\n    </category>\n    <category name="Loop" categorystyle="loop_category">\n        <block type="controls_repeat_ext">\n            <value name="TIMES">\n                <shadow type="math_number">\n                    <field name="NUM">10</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="controls_whileUntil"></block>\n        <block type="controls_for">\n            <value name="START">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="END">\n                <shadow type="math_number">\n                    <field name="NUM">10</field>\n                </shadow>\n            </value>\n            <value name="STEP">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="controls_forEach"></block>\n        <block type="controls_flow_statements"></block>\n    </category>\n    <category name="Math" categorystyle="math_category">\n        <block type="math_number"></block>\n        <block type="math_arithmetic"></block>\n        <block type="math_round">\n            <field name="OP">ROUND</field>\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">3.1</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_single">\n            <field name="OP">ROOT</field>\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">9</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_trig">\n            <field name="OP">SIN</field>\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">45</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_constant">\n            <field name="CONSTANT">PI</field>\n        </block>\n        <block type="math_random_int">\n            <value name="FROM">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="TO">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="math_on_list">\n            <mutation op="SUM" />\n            <field name="OP">SUM</field>\n        </block>\n    </category>\n    <category name="Text" categorystyle="text_category">\n        <block type="text"></block>\n        <block type="text_print"></block>\n        <block type="text_length">\n            <value name="VALUE">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="text_changeCase">\n            <field name="CASE">UPPERCASE</field>\n            <value name="TEXT">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="text_join">\n            <mutation items="2" />\n        </block>\n        <block type="text_indexOf"></block>\n        <block type="text_charAt"></block>\n        <block type="text_getSubstring"></block>\n        <block type="text_prompt_ext">\n            <mutation type="TEXT" />\n            <field name="TYPE">TEXT</field>\n            <value name="TEXT">\n                <shadow type="text">\n                    <field name="TEXT">abc</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="Lists" categorystyle="list_category">\n        <block type="lists_create_with">\n            <mutation items="0"></mutation>\n        </block>\n        <block type="lists_create_with"></block>\n        <block type="lists_repeat">\n            <value name="NUM">\n                <shadow type="math_number">\n                    <field name="NUM">5</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="lists_length"></block>\n        <block type="lists_isEmpty"></block>\n        <block type="lists_indexOf">\n            <value name="VALUE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_getIndex">\n            <value name="VALUE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_setIndex">\n            <value name="LIST">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_getSublist">\n            <value name="LIST">\n                <block type="lexical_variable_get">\n                    <field name="VAR">list</field>\n                </block>\n            </value>\n        </block>\n        <block type="lists_split">\n            <value name="DELIM">\n                <shadow type="text">\n                    <field name="TEXT">,</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="lists_sort"></block>\n        <block type="lists_reverse"></block>\n    </category>\n    <category id="catVariables" colour="330" name="Variables">\n        <block type="global_declaration"></block>\n        <block type="local_declaration_statement"></block>\n        <block type="lexical_variable_get"></block>\n        <block type="lexical_variable_set"></block>\n    </category>\n    <category name="Functions" custom="PROCEDURE" categorystyle="procedure_category"></category>\n\n\n    <category name="Object" colour="355">\n        <block type="object_getfield">\n            <value name="OBJECT">\n                <block type="lexical_variable_get">\n                    <field name="VAR">object</field>\n                </block>\n            </value>\n        </block>\n    </category>\n    <category name="Device" colour="355">\n        <block type="create_device"></block>\n        <block type="device_getvalue">\n            <value name="DEVICE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">device</field>\n                </block>\n            </value>\n        </block>\n        <block type="wait_until_device">\n            <value name="DEVICE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">device</field>\n                </block>\n            </value>\n        </block>\n        <block type="device_subscribe">\n            <value name="DEVICE">\n                <block type="lexical_variable_get">\n                    <field name="VAR">device</field>\n                </block>\n            </value>\n        </block>\n        <block type="color_sensor_brightness">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">sensor</field>\n                </block>\n            </value>\n            <value name="FIRST_SEG">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="SEC_SEG">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="THIRD_SEG">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="distance_sensor_brightness">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">sensor</field>\n                </block>\n            </value>\n            <value name="TOP_LEFT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="TOP_RIGHT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="BOTTOM_LEFT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="BOTTOM_RIGHT">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="Motor" colour="355">\n        <block type="create_motor"></block>\n        <block type="motor_power">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="POWER">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n    <category name="TachoMotor" colour="355">\n        <block type="create_tacho_motor"></block>\n        <block type="motor_speed">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_speed_time">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="TIME">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_speed_degrees">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="DEGREES">\n                <shadow type="math_number">\n                    <field name="NUM">180</field>\n                </shadow>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_speed_position">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="ANGLE">\n                <shadow type="math_number">\n                    <field name="NUM">0</field>\n                </shadow>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_speed_abs_position">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="ANGLE">\n                <shadow type="math_number">\n                    <field name="NUM">0</field>\n                </shadow>\n            </value>\n            <value name="SPEED">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="motor_reset_position">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n        <block type="motor_get_speed">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n        <block type="motor_get_position">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n        <block type="motor_get_absoluteposition">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n        </block>\n\n    </category>\n    <category name="PairMotor" colour="355">\n        <block type="create_pair_motor">\n            <FIELD name="PORT2">B</FIELD>\n        </block>\n        <block type="pair_motor_speed">\n            <value name="VAR">\n                <block type="lexical_variable_get">\n                    <field name="VAR">motor</field>\n                </block>\n            </value>\n            <value name="SPEED1">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n            <value name="SPEED2">\n                <shadow type="math_number">\n                    <field name="NUM">100</field>\n                </shadow>\n            </value>\n        </block>\n\n\n    </category>\n    <category name="Hub" colour="355">\n        <block type="hub_color"></block>\n        <block type="hub_get_tilt"></block>\n        <block type="hub_get_impact_count"></block>\n        <block type="hub_set_impact_count">\n            <value name="VAR">\n                <shadow type="math_number">\n                    <field name="NUM">0</field>\n                </shadow>\n            </value>\n        </block>\n        <block type="hub_get_voltage"></block>\n    </category>\n    <category name="System" colour="355">\n        <block type="sleep">\n            <value name="TIME">\n                <shadow type="math_number">\n                    <field name="NUM">1</field>\n                </shadow>\n            </value>\n        </block>\n    </category>\n\n</xml>',deps:["breizbot.pager","breizbot.blocklyinterpretor","hub","breizbot.gamepad","breizbot.http","breizbot.files","breizbot.blocklyLexical"],props:{hubDevices:null,config:null},init:function(e,n,t,o,a,i,l,s){console.log("props",this.props);const c=$$.ui.progressDialog("Loading device info"),d=this.props.hubDevices;e.find("button").addClass("w3-btn w3-blue");let{config:p}=this.props;async function u(e,n){try{await t.callFunction(e,n)}catch(e){"string"==typeof e&&$$.ui.showAlert({title:"Error",content:e})}}null==p&&(p={code:null,gamepadId:"",mappings:{},name:""}),console.log("config",p),a.on("connected",e=>{console.log("gamepad connnected",e),p.gamepadId=e.id,p.gamepadMapping=p.mappings[e.id],console.log({gamepadMapping:p.gamepadMapping}),C.setData({gamepadConnected:!0}),a.checkGamePadStatus()}),a.on("disconnected",e=>{console.log("gamepad disconnected"),C.setData({gamepadConnected:!1}),p.gamepadMapping=null,p.gamepadId=""});let r={};async function b(e){if(p.gamepadMapping){const{action:n}=p.gamepadMapping.axes[e.id];let{value:t}=e;"None"!=n&&(t=100*Math.sign(t))!=(r[e.id]||0)&&(r[e.id]=t,await u(n,t))}}async function h(e){if(console.log("buttonDown",e.id),p.gamepadMapping){const{down:n,downValue:t}=p.gamepadMapping.buttons[e.id];"None"!=n&&await u(n,t)}}async function m(e){if(console.log("buttonDown",e.id),p.gamepadMapping){const{up:n,upValue:t}=p.gamepadMapping.buttons[e.id];"None"!=n&&await u(n,t)}}function g(e){e?(a.on("axe",b),a.on("buttonDown",h),a.on("buttonUp",m)):(a.off("axe",b),a.off("buttonDown",h),a.off("buttonUp",m))}function f(e){const n=e.fields.HUB,t=d.find(e=>e.name==n);if(null==t)throw`Hub ${n} is not connected`;return t}async function v(e,n){const a=await t.evalCode(e.inputs.VAR,n);if(!o.isTachoMotor(a))throw"input is not of type TachoMotor";return a}async function y(e,n,t){const o=f(e).getDevice(n);return console.log("getHubValue",{portId:n,mode:t,device:o}),o.getValue(t)}function k(e){const n=Blockly.getMainWorkspace();Blockly.serialization.workspaces.load(e,n)}function w(){return Blockly.serialization.workspaces.save(Blockly.getMainWorkspace())}async function _(){for(const e of d)for(const n of e.getHubDevices())o.isMotor(n)&&await n.setPower(0),await n.unsubscribe()}g(!0),this.dispose=function(){console.log("dispose"),g(!1)},s.inject("blocklyDiv",document.getElementById("toolbox")),t.setLogFunction(e=>{C.model.logs.push(e),C.update(),B.scrollToBottom()}),t.addBlockType("object_getfield",async(e,n)=>{const o=e.fields.FIELD,a=await t.evalCode(e.inputs.OBJECT,n);return console.log({fieldName:o,object:a}),a[o]}),t.addBlockType("create_device",async(e,n)=>{const t=e.fields.PORT,o=f(e).getDevice(t);return console.log({port:t,device:o}),o}),t.addBlockType("device_getvalue",async(e,n)=>{const o=e.fields.MODE,a=await t.evalCode(e.inputs.DEVICE,n);return console.log({mode:o,device:a}),a.getValue(o)}),t.addBlockType("wait_until_device",async(e,n)=>{const o=e.fields.MODE,a=await t.evalCode(e.inputs.DEVICE,n),i=e.fields.VAR;console.log({varName:i,mode:o,device:a}),await a.waitTestValue(o,async o=>{return console.log("waitTestValue",o),n[i]=o,await t.evalCode(e.inputs.TEST,n)}),delete n[i]}),t.addBlockType("device_subscribe",async(e,n)=>{const o=e.fields.MODE,a=e.fields.DELTA,i=await t.evalCode(e.inputs.DEVICE,n),l=e.fields.VAR;console.log({varName:l,mode:o,deltaInterval:a,device:i}),await i.subscribe(o,async o=>{n[l]=o,await t.evalCode(e.inputs.DO,n)},a),delete n[l]}),t.addBlockType("create_pair_motor",async(e,n)=>{const t=e.fields.PORT1,a=e.fields.PORT2,i=f(e);return await i.getDblMotor(o.PortMap[t],o.PortMap[a])}),t.addBlockType("create_tacho_motor",async(e,n)=>{const t=e.fields.PORT,a=f(e).getDevice(o.PortMap[t]);if(!o.isTachoMotor(a))throw`Device connected to port '${t}' is not of a TachoMotor`;return a}),t.addBlockType("create_motor",async(e,n)=>{const t=e.fields.PORT,a=f(e).getDevice(o.PortMap[t]);if(!o.isMotor(a))throw`Device connected to port '${t}' is not of a Motor`;return a}),t.addBlockType("color_sensor_brightness",async(e,n)=>{const a=await t.evalCode(e.inputs.VAR,n);if(!o.isColorSensor(a))throw"input is not of type ColorSensor";const i=await t.evalCode(e.inputs.FIRST_SEG,n),l=await t.evalCode(e.inputs.SEC_SEG,n),s=await t.evalCode(e.inputs.THIRD_SEG,n);console.log({device:a,firstSeg:i,secSeg:l,thirdSeg:s}),await a.setBrightness(i,l,s)}),t.addBlockType("distance_sensor_brightness",async(e,n)=>{const a=await t.evalCode(e.inputs.VAR,n);if(!o.isDistanceSensor(a))throw"input is not of type DistanceSensor";const i=await t.evalCode(e.inputs.TOP_LEFT,n),l=await t.evalCode(e.inputs.TOP_RIGHT,n),s=await t.evalCode(e.inputs.BOTTOM_LEFT,n),c=await t.evalCode(e.inputs.BOTTOM_RIGHT,n);console.log({device:a,topLeft:i,topRight:l,bottomLeft:s,bottomRight:c}),await a.setBrightness(i,s,l,c)}),t.addBlockType("motor_power",async(e,n)=>{const a=await t.evalCode(e.inputs.POWER,n),i=await async function(e,n){const a=await t.evalCode(e.inputs.VAR,n);if(!o.isMotor(a))throw"input is not of type Motor";return a}(e,n);console.log({power:a}),await i.setPower(a)}),t.addBlockType("motor_speed",async(e,n)=>{const o=await t.evalCode(e.inputs.SPEED,n),a=await v(e,n);console.log({speed:o}),await a.setSpeed(o)}),t.addBlockType("pair_motor_speed",async(e,n)=>{const a=await t.evalCode(e.inputs.SPEED1,n),i=await t.evalCode(e.inputs.SPEED2,n),l=await async function(e,n){const a=await t.evalCode(e.inputs.VAR,n);if(!o.isDoubleMotor(a))throw"input is not of type PairMotor";return a}(e,n);console.log("setSpeed",{speed1:a,speed2:i}),await l.setSpeed(a,i)}),t.addBlockType("motor_speed_time",async(e,n)=>{const a=await t.evalCode(e.inputs.SPEED,n),i=e.fields.WAIT,l=await t.evalCode(e.inputs.TIME,n),s=await v(e,n);console.log({speed:a,time:l,waitEnd:i,motor:s}),await s.setSpeedForTime(a,1e3*l,i,o.BrakingStyle.FLOAT)}),t.addBlockType("motor_speed_degrees",async(e,n)=>{const a=await v(e,n),i=await t.evalCode(e.inputs.SPEED,n),l=e.fields.WAIT,s=await t.evalCode(e.inputs.DEGREES,n);console.log({speed:i,degrees:s,waitEnd:l}),await a.rotateDegrees(s,i,l,o.BrakingStyle.BRAKE)}),t.addBlockType("motor_speed_position",async(e,n)=>{const a=await v(e,n),i=await t.evalCode(e.inputs.SPEED,n),l=e.fields.WAIT,s=await t.evalCode(e.inputs.ANGLE,n);console.log({speed:i,angle:s,waitEnd:l}),await a.gotoAngle(s,i,l,o.BrakingStyle.BRAKE)}),t.addBlockType("motor_speed_abs_position",async(e,n)=>{const a=await v(e,n),i=await t.evalCode(e.inputs.SPEED,n),l=e.fields.WAIT,s=await t.evalCode(e.inputs.ANGLE,n);console.log({speed:i,angle:s,waitEnd:l}),await a.gotoAbsPosition(s,i,l,o.BrakingStyle.BRAKE)}),t.addBlockType("motor_reset_position",async(e,n)=>{const t=await v(e,n);await t.resetZero()}),t.addBlockType("motor_get_speed",async(e,n)=>{return(await v(e,n)).getSpeed()}),t.addBlockType("motor_get_position",async(e,n)=>{return(await v(e,n)).getPosition()}),t.addBlockType("motor_get_absoluteposition",async(e,n)=>{return(await v(e,n)).getAbsolutePosition()}),t.addBlockType("hub_color",async(e,n)=>{const t=e.fields.COLOR,a=f(e).getDevice(o.PortMap.HUB_LED);await a.setColor(o.Color[t])}),t.addBlockType("hub_get_voltage",async(e,n)=>y(e,o.PortMap.VOLTAGE_SENSOR,0)),t.addBlockType("hub_get_impact_count",async(e,n)=>y(e,o.PortMap.TILT_SENSOR,1)),t.addBlockType("hub_set_impact_count",async(e,n)=>{const a=await t.evalCode(e.inputs.VAR,n),i=f(e);return console.log({count:a,hubDevice:i}),i.getDevice(o.PortMap.TILT_SENSOR).setImpactCount(a)}),t.addBlockType("hub_get_tilt",async(e,n)=>{const t=e.fields.TYPE;return(await y(e,o.PortMap.TILT_SENSOR,o.DeviceMode.TILT_POS))[t]}),t.addBlockType("sleep",async(e,n)=>{const o=await t.evalCode(e.inputs.TIME,n);console.log({time:o}),await $$.util.wait(1e3*o),console.log("Timeout")}),null!=p.code&&k(p.code),this.onBack=function(){return p.code=w(),p};const C=$$.viewController(e,{data:{currentConfig:p.name,gamepadConnected:""!=p.gamepadId,logs:[],getLogs:function(){return this.logs.join("<br>")}},events:{onExport:async function(){let e=await $$.ui.showPrompt({title:"Export",label:"FileName: "});if(e){const n=JSON.stringify({code:w(),mappings:p.mappings}),t=new Blob([n],{type:"application/json"});e+=".pow",await l.saveFile(t,e),$.notify("Code exported","success")}},onImport:function(){l.openFile("Open File","pow",async e=>{const n=await fetch(e.url),{code:t,mappings:o}=await n.json();console.log({code:t,mappings:o}),p.code=t,p.name="",p.mappings=o,C.setData({currentConfig:""}),p.gamepadMapping=p.mappings[p.gamepadId],k(p.code)})},onStop:async function(){await _()},onGamePad:function(){const e=w();console.log("code",e),g(!1),n.pushPage("gamepad",{title:"Gamepad",props:{mapping:p.gamepadMapping,actions:null!=e?t.getFunctionNames(e):[]},onReturn:async e=>{console.log("onReturn",e),p.gamepadMapping=e,p.mappings[e.id]=e,g(!0)},onBack:()=>{g(!0)}})},onNewConfig:function(){p.mappings={},p.gamepadMapping=null,p.name="",Blockly.getMainWorkspace().clear(),C.setData({currentConfig:""})},onSaveConfig:async function(){if(console.log("oncodeSaveConfig",p),""==C.model.currentConfig){const e=await $$.ui.showPrompt({title:"Save Config",label:"Config Name:"});e&&(await i.post("/add",{name:e,code:w(),mappings:p.mappings}),C.setData({currentConfig:e}),p.name=e)}else await i.post("/update",{name:p.name,code:w(),mappings:p.mappings}),$.notify(`Config '${p.name}' updated`,"success")},onConfig:function(){n.pushPage("configCtrl",{title:"Configurations",props:{currentConfig:C.model.currentConfig},onReturn:function(e){console.log("newConfig",e),p.code=e.code,p.name=e.name,p.mappings=e.mappings,C.setData({currentConfig:e.name}),p.gamepadMapping=p.mappings[p.gamepadId],k(p.code)}})},onRun:async function(){console.log("onRun"),await _(),c.setPercentage(0),c.show();let e=0;for(const n of d)e+=n.getHubDevices().length;console.log({nbAccess:e});const n=$$.util.mapRange(0,e,0,1);let o=0;for(const e of d)for(const t of e.getHubDevices())await t.readInfo(),c.setPercentage(n(++o));c.hide();const a=w();r={},C.setData({logs:[]});try{await t.startCode(a)}catch(e){"string"==typeof e&&$$.ui.showAlert({title:"Error",content:e})}}}}),B=C.scope.logPanel}}),$$.control.registerControl("configCtrl",{template:'<div bn-show="!hasConfigs" class="message">\n    No configurations defined\n</div>\n\n<div class="scrollPanel" bn-show="hasConfigs">\n    <div bn-each="configs" class="items" bn-event="click.item: onItemClick, contextmenuchange.item:onItemContextMenu">\n        <div class="w3-card-2 item" bn-control="brainjs.contextmenu" bn-data="{\n                    items: {\n                        delete: {name: \'Remove\', icon: \'fas fa-trash-alt\'}\n                    }\n                }">\n            <div>\n                <strong bn-text="$scope.$i.name"></strong>\n            </div>\n        </div>\n    </div>\n</div>',deps:["breizbot.pager","breizbot.http"],props:{currentConfig:""},init:function(e,n,t){const{currentConfig:o}=this.props,a=$$.viewController(e,{data:{configs:[],hasConfigs:function(){return this.configs.length>0}},events:{onItemContextMenu:async function(e,n){const l=$(this).closest(".item").index(),s=a.model.configs[l];"delete"==n.cmd&&(s.name==o?$$.ui.showAlert({content:"Cannot delete active config",title:"Warning"}):(await t.post("/delete",s),i()))},onItemClick:function(e){const t=$(this).closest(".item").index();console.log("onItemClick",t);const o=a.model.configs[t];n.popPage(o)}}});async function i(){const e=await t.get("/");console.log({configs:e}),a.setData({configs:e})}i()}}),$$.control.registerControl("gamepad",{template:'<div>\n    <h2 bn-text="id"></h2>\n</div>\n\n<h3>Axes</h3>\n<div>\n    <table class="w3-table-all axeTable">\n        <thead>\n            <tr>\n                <th>Axe</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="axes" bn-bind="axes" bn-index="idx">\n            <tr>\n                <td bn-text="getAxeLabel"></td>\n                <td>\n                    <div bn-control="brainjs.combobox" bn-data="{items: actions}" bn-val="$scope.$i.action"\n                        class="item"></div>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n\n<h3>Buttons</h3>\n<div class="commandTable">\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Button</th>\n                <th>Down</th>\n                <th>Up</th>\n            </tr>\n        </thead>\n        <tbody bn-each="buttons" bn-bind="buttons" bn-index="idx">\n            <tr>\n                <td bn-text="getButtonLabel"></td>\n                <td>\n                    <div class="item">\n                        <div bn-control="brainjs.combobox" bn-data="{items: actions}" bn-val="$scope.$i.down"\n                            class="down"></div>\n                        <input bn-val="$scope.$i.downValue" type="number" class="downValue">\n\n                    </div>\n\n                </td>\n                <td>\n                    <div class="item">\n                        <div bn-control="brainjs.combobox" bn-data="{items: actions}" bn-val="$scope.$i.up" class="up">\n                        </div>\n                        <input bn-val="$scope.$i.upValue" type="number" class="upValue">\n                    </div>\n\n\n                </td>\n\n            </tr>\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager","breizbot.gamepad"],props:{mapping:null,actions:null},init:function(e,n,t){console.log("props",this.props);const{mapping:o,actions:a}=this.props;a.unshift("None"),console.log(this.props);let i=[],l=[];const s=t.getGamepads()[0];if(console.log({info:s}),null!=o&&(i=o.axes,l=o.buttons),0==i.length)for(let e=0;e<s.axes.length;e++)i.push({action:"None"});if(0==l.length)for(let e=0;e<s.buttons.length;e++)l.push({up:"None",down:"None",upValue:0,downValue:1});function c(){let e=[],n=[];for(let n=0;n<s.axes.length;n++)e.push({action:"None"});for(let e=0;e<s.buttons.length;e++)n.push({up:"None",down:"None",upValue:0,downValue:1});r.setData({axes:e,buttons:n})}function d(e){const{value:n,id:t}=e;0!=n?b.find("tr").eq(t).find("td").eq(0).addClass("pressed"):b.find("tr").eq(t).find("td").eq(0).removeClass("pressed")}function p(e){h.find("tr").eq(e.id).find("td").eq(0).addClass("pressed")}function u(e){h.find("tr").eq(e.id).find("td").eq(0).removeClass("pressed")}t.on("axe",d),t.on("buttonDown",p),t.on("buttonUp",u),this.dispose=function(){console.log("dispose"),t.off("axe",d),t.off("buttonDown",p),t.off("buttonUp",u)};const r=$$.viewController(e,{data:{id:s.id,axes:i,buttons:l,actions:a,getButtonLabel:function(e){return`Button ${e.idx+1}`},getAxeLabel:function(e){return`Axe ${e.idx+1}`}},events:{}}),b=r.scope.axes,h=r.scope.buttons;this.getButtons=function(){return{check:{icon:"fa fa-check",title:"Apply",onClick:function(){n.popPage(function(){const e={id:s.id,axes:[],buttons:[]};return b.find("tr").each(function(n){const t=$(this).find(".item").getValue();e.axes.push({action:t})}),h.find("tr").each(function(n){const t=$(this).find(".up").getValue(),o=$(this).find(".down").getValue(),a=$(this).find(".upValue").getValue(),i=$(this).find(".downValue").getValue();e.buttons.push({up:t,down:o,upValue:a,downValue:i})}),console.log({ret:e}),e}())}},reset:{icon:"fas fa-sync",title:"Reset value",onClick:c}}}}}),$$.control.registerControl("hubinfo",{template:'<div class="scrollBar">\n    <h1>External Devices</h1>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Port</th>\n                <th>Device Type</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="externalDevices" bn-event="\n            input-label-change.power: onPowerChange,\n            input-label-change.name: onNameChange,\n            mousedown.motorMouseAction: onMouseUp, \n            mouseup.motorMouseAction:onMouseDown, \n            click.motorAction:onMotorAction, \n            click.ledAction: onLedAction,\n            click.portInfo: onInfo2, \n            click.calibrate:onCalibrate">\n            <tr>\n                <td><span bn-control="input-label" bn-data="{val: $scope.$i.name}" class="name"></span></td>\n                <td bn-text="$scope.$i.type"></td>\n                <td>\n                    <span bn-if="isMotor" class="spanButtons">\n                        <button class="w3-btn w3-green motorMouseAction" data-action="forward">FWD</button>\n                        <button class="w3-btn w3-green motorMouseAction" data-action="backward">BKWD</button>\n                        <span>\n                            <label>\n                                Power\n                            </label>\n                            \x3c!-- <input type="number" min="1" max="100" value="20" class="power"> --\x3e\n                            <span bn-control="input-label" bn-data="{val: $scope.$i.power}" class="power"></span>\n                        </span>\n                    </span>\n\n                    <span bn-if="isLed" class="spanButtons">\n                        <button class="w3-btn w3-green ledAction" data-action="on">ON</button>\n                        <button class="w3-btn w3-green ledAction" data-action="off">OFF</button>\n                    </span>\n\n                    <button class="w3-btn w3-blue portInfo">MODE</button>\n                </td>\n\n            </tr>\n\n        </tbody>\n    </table>\n    <h1>Internal Devices</h1>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>Port ID</th>\n                <th>Device Type</th>\n                <th>Action</th>\n            </tr>\n        </thead>\n        <tbody bn-each="internalDevices" bn-event="click.w3-btn: onInfo">\n            <tr>\n                <td bn-text="$scope.$i.portId"></td>\n                <td bn-text="$scope.$i.type"></td>\n                <td>\n                    <button class="w3-btn w3-blue">MODE</button>\n                </td>\n            </tr>\n\n        </tbody>\n    </table></div>',deps:["breizbot.pager","hub"],props:{hubDevice:null},init:function(e,n,t){const o=this.props.hubDevice;function a(e,t){n.pushPage("info",{title:t,props:{device:o.getDevice(e)}})}function i(e){const n=e.closest("tr").index();return c.model.externalDevices[n].portId}async function l(e){console.log("attach",e);const{portId:n,name:t,type:o}=e,a={portId:n,name:t,type:o};c.model.externalDevices.push(a),c.update()}function s(e){console.log("detach",e);const n=c.model.externalDevices.findIndex(n=>n.portId==e.portId);c.model.externalDevices.splice(n,1),c.update()}o.on("attach",l),o.on("detach",s),this.dispose=async function(){console.log("hubInfo dispose"),o.off("attach",l),o.off("detach",s)};const c=$$.viewController(e,{data:{internalDevices:[],externalDevices:[],isMotor:function(e){return t.isMotor(o.getDevice(e.$i.portId))},isLed:function(e){return t.isLed(o.getDevice(e.$i.portId))},isTachoMotor:function(e){return t.isTachoMotor(o.getDevice(e.$i.portId))}},events:{onPowerChange:function(e,n){console.log("onPowerChange",n);const t=i($(this));o.getDevice(t).power=n},onNameChange:function(e,n){console.log("onNameChange",n);const t=i($(this));o.getDevice(t).name=n},onMotorAction:async function(e){const n=i($(this)),t=$(this).data("action");console.log("onMotorAction",n,t);const a=o.getDevice(n);switch(t){case"reset":a.resetZero();break;case"gozero":a.gotoAngle(0,50,!1);break;case"calibrate":$(this).removeClass("w3-grey"),$(this).addClass("w3-yellow"),await a.calibrate(),$(this).removeClass("w3-yellow"),$(this).addClass("w3-green"),$(this).closest("tr").find("button.goto").prop("disabled",!1);break;case"gotoLeft":a.gotoLeft();break;case"gotoRight":a.gotoRight();break;case"gotoCenter":a.gotoCenter();break;case"gotoAngle":{const e=parseInt($(this).closest("tr").find("input.angle").val());console.log({angle:e}),await a.gotoAngle(e,100,!0)}}},onLedAction:async function(){const e=i($(this)),n=$(this).data("action");console.log("onLedAction",e,n),o.getDevice(e).setBrightness("on"==n?100:0)},onMouseUp:async function(){const e=$(this).data("action"),n=i($(this)),t=o.getDevice(n),a=t.power;switch(console.log({power:a}),e){case"forward":t.setPower(a);break;case"backward":t.setPower(-a)}},onMouseDown:async function(){const e=i($(this));o.getDevice(e).setPower(0)},onInfo:function(){const e=$(this).closest("tr").index(),{portId:n,deviceTypeName:t}=c.model.internalDevices[e];a(n,t)},onInfo2:function(){const e=$(this).closest("tr").index(),{portId:n,deviceTypeName:t}=c.model.externalDevices[e];a(n,t)}}});!async function(){const e=o.getHubDevices();console.log("devices",e);const n=[],t=[];for(const o of e){let{portId:e,type:a,name:i,calibrated:l,power:s}=o;if(null==l&&(l=!1),e<50){const n={name:i,portId:e,type:a,calibrated:l,power:s};t.push(n)}else n.push({portId:e,type:a})}c.setData({internalDevices:n,externalDevices:t})}()}}),$$.control.registerControl("info",{template:'<div>\n    <div>\n        Capabilities: <span bn-text="capabilities"></span>\n    </div>\n    <table class="w3-table-all">\n        <thead>\n            <tr>\n                <th>MODE</th>\n                <th>CAPABILITIES</th>\n                <th>UNIT</th>\n                <th>RAW</th>\n                <th>SI</th>\n                <th>VALUE FORMAT</th>\n                <th>Value</th>\n            </tr>\n        </thead>\n        <tbody bn-each="modes" bn-event="click.btnGet: onBtnGet">\n            <tr>\n                <td bn-text="$scope.$i.name"></td>\n                <td bn-text="getCapabilites"></td>\n                <td bn-text="$scope.$i.unit"></td>\n                <td>\n                    <span bn-text="$scope.$i.RAW.min"></span><br>\n                    <span bn-text="$scope.$i.RAW.max"></span>\n                </td>\n                <td>\n                    <span bn-text="$scope.$i.PCT.min"></span><br>\n                    <span bn-text="$scope.$i.PCT.max"></span>\n                </td>\n                <td>\n                    <span bn-text="$scope.$i.SI.min"></span><br>\n                    <span bn-text="$scope.$i.SI.max"></span>\n                </td>\n                <td>\n                    dataType: <span bn-text="$scope.$i.VALUE_FORMAT.dataType"></span><br>\n                    numValues: <span bn-text="$scope.$i.VALUE_FORMAT.numValues"></span>\n                </td>\n                <td>\n                    <div bn-if="isInput">\n                        <button class="w3-btn w3-green btnGet">Get</button>\n                        <span></span>\n                    </div>\n\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>',deps:["breizbot.pager","hub"],props:{device:null},init:function(e,n,t){const o=this.props.device,a=$$.viewController(e,{data:{modes:[],capabilities:"",isInput:function(e){return 0!=(1&e.$i.mode)},getCapabilites:function(e){return 2==e.$i.mode?"OUT":1==e.$i.mode?"IN":3==e.$i.mode?"IN/OUT":void 0}},events:{onBtnGet:async function(e){const n=$(this).closest("tr").index();console.log("onBtnGet",n);const t=await o.getValue(n);console.log("values",t),$(this).closest("td").find("span").text(JSON.stringify(t,null,4))}}});!async function(){const{modes:e,capabilities:n}=await o.readInfo();a.setData({modes:e,capabilities:n})}()}});