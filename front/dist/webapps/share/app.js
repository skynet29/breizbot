$$.control.registerControl("filesPage",{deps:["breizbot.share"],props:{$pager:null,userName:"",showThumbnail:!0,thumbnailSize:"?x100"},template:'<div class="contentPanel">\n\n\t<div class="pathPanel">\n\t\tPath:&nbsp;<span bn-text="rootDir"></span>\n\t</div>\n\n\t<div class="scrollPanel">\n\n\t\t<div bn-each="files" \n\t\t\tbn-iter="f" \n\t\t\tclass="container"\n\t\t\tbn-bind="files" \n\t\t\tbn-event="click.folder: onFolderClick, click.file: onFileClick">\n\t\t\t\n\t\t\t<div class="thumbnail w3-btn" bn-data="{info: f}">\t\n\t\t\t\t\t<div bn-if="f.folder" class="folder">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<i class="fa fa-4x fa-folder-open w3-text-blue-grey"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<span bn-text="f.name"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bn-if="!f.folder && (!f.isImage || !showThumbnail)" bn-attr="{title: f.name + \'\\n\' + getSize(f.size)}" class="file">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<i bn-attr="{class: `fa fa-4x w3-text-blue-grey ${getIconClass(f.name)}`}"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<span bn-text="f.name.slice(0, 20)"></span>\n\t\t\t\t\t</div>\t\t\t\n\n\t\t\t\t\t<div bn-if="!f.folder && f.isImage && showThumbnail" bn-attr="{title: f.name + \'\\n\' + getSize(f.size)}" class="file">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<img bn-attr="{src: f.thumbnailUrl}">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<span bn-text="f.name.slice(0, 20)"></span>\n\t\t\t\t\t</div>\t\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>',buttons:[{name:"reload",icon:"fa fa-sync-alt"}],init:function(t,n){const{$pager:e,userName:i,showThumbnail:l,thumbnailSize:o}=this.props,a=$$.viewController(t,{data:{rootDir:"/",files:[],showThumbnail:l,getSize:function(t){let n="Ko";return(t/=1024)>1024&&(n="Mo",t/=1024),"Size : "+Math.floor(t)+" "+n},getIconClass:function(t){return t.endsWith(".pdf")?"fa-file-pdf":t.endsWith(".doc")?"fa-file-word":t.endsWith(".ogg")||t.endsWith(".mp3")?"fa-file-audio":t.endsWith(".mp4")?"fa-file-video":"fa-file"}},events:{onFileClick:function(t){const n=$(this).closest(".thumbnail").data("info");console.log("onFileClick",n);const l=a.model.rootDir+n.name;null!=$$.util.getFileType(n.name)&&e.pushPage("viewerPage",{title:n.name,props:{fullName:l,userName:i}})},onFolderClick:function(t){const n=$(this).closest(".thumbnail").data("info").name;if(".."==n){const t=a.model.rootDir.split("/");t.pop(),t.pop(),s(t.join("/")+"/")}else s(a.model.rootDir+n+"/")}}});function s(t){null==t&&(t=a.model.rootDir),n.list(i,t).then(function(e){console.log("files",e),e.forEach(e=>{e.isImage&&(e.thumbnailUrl=n.fileThumbnailUrl(i,t+e.name,o))}),"/"!=t&&e.unshift({name:"..",folder:!0}),a.setData({files:e,rootDir:t})})}s(),this.onAction=function(t){"reload"==t&&s()}}}),$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n<p>Click on a user to see the files shared by him</p>\n</div>\n<div \n\tbn-control="breizbot.friends" \n\tbn-iface="friends" \n\tbn-event="friendclick: onSelectFriend"\n\tbn-data="{showConnectionState: false}"\n\t></div>',props:{$pager:null},init:function(t){const{$pager:n}=this.props;$$.viewController(t,{data:{},events:{onSelectFriend:function(t,e){console.log("onSelectFriend",e);const{userName:i}=e;n.pushPage("filesPage",{title:i,props:{userName:i}})}}})}}),$$.control.registerControl("viewerPage",{deps:["breizbot.share"],template:'<div \n\tbn-control="breizbot.viewer" \n\tbn-data="{type, url}" \n\tstyle="height: 100%" \n\tbn-iface="viewer">\n\t\t\n\t</div>',props:{$pager:null,fullName:"",userName:""},init:function(t,n){const{$pager:e,fullName:i,userName:l}=this.props;$$.viewController(t,{data:{type:$$.util.getFileType(i),url:n.fileUrl(l,i)}})}});