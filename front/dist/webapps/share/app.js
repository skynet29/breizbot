$$.control.registerControl("filesPage",{deps:["app.share"],props:{$pager:null,userName:""},template:'<div class="contentPanel">\n\n\t<div class="pathPanel">\n\t\tPath:&nbsp;<span bn-text="rootDir"></span>\n\t</div>\n\n\t<div\n\t\tbn-control="breizbot.fsbase"\n\t\tbn-event="folderclick: onFolderClick, fileclick: onFileClick"\n\t\tbn-data="{files}"\n\t></div>\n\n</div>',buttons:[{name:"reload",icon:"fa fa-sync-alt"}],init:function(e,t){const n="100x?",{$pager:i,userName:l}=this.props,r=$$.viewController(e,{data:{rootDir:"/",files:[]},events:{onFileClick:function(e,t){console.log("onFileClick",t);const n=r.model.rootDir+t.name;null!=$$.util.getFileType(t.name)&&i.pushPage("viewerPage",{title:t.name,props:{fullName:n,userName:l}})},onFolderClick:function(e,t){const n=t.name;if(".."==n){const e=r.model.rootDir.split("/");e.pop(),e.pop(),o(e.join("/")+"/")}else o(r.model.rootDir+n+"/")}}});function o(e){null==e&&(e=r.model.rootDir),t.list(l,e).then(function(i){console.log("files",i),i.forEach(i=>{i.isImage&&(i.thumbnailUrl=t.fileThumbnailUrl(l,e+i.name,n))}),"/"!=e&&i.unshift({name:"..",folder:!0}),r.setData({files:i,rootDir:e})})}o(),this.onAction=function(e){"reload"==e&&o()}}}),$$.control.registerControl("rootPage",{template:'<div class="toolbar">\n<p>Click on a user to see the files shared by him</p>\n</div>\n<div \n\tbn-control="breizbot.friends" \n\tbn-iface="friends" \n\tbn-event="friendclick: onSelectFriend"\n\tbn-data="{showConnectionState: false}"\n\t></div>',props:{$pager:null},init:function(e){const{$pager:t}=this.props;$$.viewController(e,{data:{},events:{onSelectFriend:function(e,n){const{userName:i}=n;t.pushPage("filesPage",{title:i,props:{userName:i}})}}})}}),$$.control.registerControl("viewerPage",{deps:["app.share"],template:'<div \n\tbn-control="breizbot.viewer" \n\tbn-data="{type, url}" \n\tstyle="height: 100%" \n\tbn-iface="viewer">\n\t\t\n\t</div>',props:{$pager:null,fullName:"",userName:""},init:function(e,t){const{$pager:n,fullName:i,userName:l}=this.props;$$.viewController(e,{data:{type:$$.util.getFileType(i),url:t.fileUrl(l,i)}})}}),$$.service.registerService("app.share",{deps:["breizbot.http"],init:function(e,t){return{list:function(e,n){return console.log("[Share] list",n),t.post("/list",{path:n,user:e}).then(e=>(e.forEach(e=>{e.isImage="image"==$$.util.getFileType(e.name)}),e))},fileUrl:function(e,t){return $$.util.getUrlParams("/api/app/share/load",{user:e,fileName:t})},fileThumbnailUrl:function(e,t,n){return $$.util.getUrlParams("/api/app/share/loadThumbnail",{user:e,fileName:t,size:n})}}},$iface:"\n\t\tlist(user, path):Promise;\n\t\tfileUrl(user, fileName):string;\n\t\tfileThumbnailUrl(user, fileName, size):string;\n\t"});