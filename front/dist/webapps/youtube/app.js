$$.control.registerControl("infoPage",{template:'<div class="details">\n\n    <strong>Title: </strong> <span bn-text="title"></span>\n    <strong>Length: </strong><span bn-text="duration"></span>\n\n</div>\n\n<div class="wrapper">\n    <div class="video" bn-style="{padding-bottom: ratio}">\n        <iframe bn-attr="{src: videoUrl, width, height}" frameborder="0" allowfullscreen></iframe>\n\n    </div>\n</div>\n\n\n<div class="description"> \n    <strong>Description:</strong>\n</div>\n\n<div class="scrollPanel">\n    <div bn-text="description"></div>\n</div>',deps:["app.ytdl","breizbot.broker"],props:{info:null},init:function(t,n,e){console.log("props",this.props);const o=$$.ui.progressDialog("Downloading..."),{title:i,thumbnail:r,description:s,length_seconds:a,videoUrl:l,videoId:d}=this.props.info,{width:c,height:p}=r;$$.viewController(t,{data:{duration:new Date(1e3*a).toLocaleTimeString("fr-FR",{timeZone:"UTC"}),title:i,width:c,height:p,ratio:function(){const t=`${p/c*100}%`;return console.log("ratio",t),t},videoUrl:$$.util.getUrlParams(`https://www.youtube-nocookie.com/embed/${d}`,{rel:0,modestbranding:1,showinfo:0}),description:s},events:{}});e.onTopic("breizbot.ytdl.progress",async t=>{if(1==t.hist)return;const{percent:n}=t.data;o.setPercentage(n/100),100==n&&(await $$.util.wait(1e3),o.hide())}),this.getButtons=function(){return{download:{title:"Download",icon:"fa fa-download",onClick:function(){console.log("onDownload",l);const t=i+".mp4";n.download(l,t),o.show()}}}}}}),$$.control.registerControl("rootPage",{template:'<div bn-control="breizbot.searchbar" \n\tbn-bind="searchbar"\n\tbn-event="searchbarsubmit: onStart"\n\tdata-placeholder="Search or paste video link url here"></div>\n\n\n<div class="results w3-light-grey" bn-show="!showInfo">\n\t<div bn-each="results" bn-event="click.item: onItemInfo">\n\t\t<div class="item w3-card-2 w3-hover-shadow">\n\t\t\t<div class="imgWrapper">\n\t\t\t\t<img bn-attr="{src: $scope.$i.thumbnail}">\n\t\t\t</div>\n\n\t\t\t<div class="info">\n\t\t\t\t<div bn-html="$scope.$i.title" ></div>\n\t\t\t\t<div>\n\t\t\t\t\t<i class="far fa-clock"></i>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>',deps:["app.ytdl","breizbot.params","breizbot.pager"],init:function(t,n,e,o){const i=$$.viewController(t,{data:{results:[],showInfo:!0,getDate:function(t){return new Date(1e3*t.$i.date).toLocaleDateString("fr-FR")}},events:{onStart:function(t,e){const o=e.value;o.startsWith("https://youtu.be/")?r(o.replace("https://youtu.be/","")):async function(t){const e=await n.search(t,20);"string"==typeof e?$$.ui.showAlert({title:"Error",content:e}):i.setData({results:e,showInfo:!1})}(o)},onItemInfo:function(t){const n=$(this).index(),e=i.model.results[n].id;console.log("onItemInfo",e),r(e)}}});async function r(t){const e="https://youtu.be/"+t,i=await n.info(e);i.videoUrl=e,i.videoId=t,o.pushPage("infoPage",{title:i.title,props:{info:i}})}null!=e.url&&(i.scope.searchbar.setValue(e.url),r(e.url))}}),$$.service.registerService("app.ytdl",{deps:["breizbot.http","breizbot.broker"],init:function(t,n,e){let o;return e.on("ready",t=>{o=t.clientId}),{info:function(t){return n.get("/info",{url:t})},download:function(t,e){return n.post("/download",{url:t,fileName:e,srcId:o})},search:function(t,e=3){return n.post("/search",{query:t,maxResults:e})}}}});