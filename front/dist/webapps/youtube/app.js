$$.control.registerControl("rootPage",{template:'\n\n<form bn-event="submit: onStart" bn-bind="form">\n\t<input type="text" name="url" placeholder="Search or paste video link url here" required="" bn-event="click: onInputClick" autocomplete="off">\n\t<button class="w3-button w3-blue" type="submit"><i class="fa fa-search"></i></button>\n</form>\n\n<div class="w3-border" bn-show="percent != 0">\n\t<div class="w3-container w3-green w3-center" bn-style="{width: percent + \'%\'}" bn-text="percent"></div>\n</div>\n\n<div bn-show="showInfo && results.length > 0">\n\t<button class="w3-button w3-blue" title="Back to list" bn-event="click: onBackToList">\n\t\t<i class="fa fa-chevron-left"></i>\n\t</button>\n</div>\t\n\n<div class="info" bn-show="showInfo && title != \'\'">\n\t<div class="thumbnail">\n\t\t<img bn-attr="{src: thumbnail_url}">\n\t\t<div class="download" bn-show="percent == 0">\n\t\t\t<button \n\t\t\t\tclass="w3-button w3-green" \n\t\t\t\ttitle="Download"\n\t\t\t\tbn-event="click: onDownload"\n\t\t\t\t><i class="fa fa-download"></i></button>\n\t\t\t\n\t\t</div>\n\t</div>\n\t<div class="details">\n\t\t<div>\n\t\t\t<strong>Title: </strong> <span bn-text="title"></span>\t\t\t\t\n\t\t</div>\n\t\t<div>\n\t\t\t<strong>Length: </strong><span bn-text="new Date(length_seconds*1000).toLocaleTimeString(\'fr-FR\', {timeZone: \'UTC\'})"></span>\t\n\t\t</div>\n\t\t<div class="description">\n\t\t\t<strong>Description: </strong><textarea bn-text="description"></textarea>\t\n\t\t</div>\t\t\n\t\t\n\t</div>\t\n\n\n\n</div>\n\t\n\n<div class="results" bn-show="!showInfo">\n\t<div bn-each="results" bn-event="click.item: onItemInfo">\n\t\t<div class="item">\n\t\t\t<img bn-attr="{src: $i.thumbnail}">\n\t\t\t<strong bn-text="$i.title"></strong>\n\t\t</div>\n\t</div>\n</div>',deps:["app.ytdl","breizbot.broker","breizbot.params"],init:function(t,n,e,o){const s=$$.viewController(t,{data:{title:"",length_seconds:0,thumbnail_url:"#",description:"",percent:0,results:[],showInfo:!0},events:{onStart:function(t){t.preventDefault();const{url:e}=$(this).getFormData();var o;e.startsWith("https://youtu.be/")?i(e):(o=e,n.search(o,10).then(t=>{s.setData({results:t,showInfo:!1})}))},onDownload:function(t){const{url:e}=s.scope.form.getFormData();console.log("onDownload",e);const o=s.model.title+".mp4";n.download(e,o)},onItemInfo:function(t){const n=$(this).index(),e=s.model.results[n].id;console.log("onItemInfo",e),i("https://youtu.be/"+e)},onInputClick:function(){$(this).val("")},onBackToList:function(){s.setData({showInfo:!1})}}});function i(t){n.info(t).then(t=>{t.percent=0,t.showInfo=!0,s.setData(t)})}e.onTopic("breizbot.ytdl.progress",t=>{if(1==t.hist)return;const{percent:n}=t.data;s.setData({percent:n})}),null!=o.url&&(s.scope.form.setFormData({url:o.url}),i(o.url))}}),$$.service.registerService("app.ytdl",{deps:["breizbot.http","breizbot.broker"],init:function(t,n,e){let o;return e.on("ready",t=>{o=t.clientId}),{info:function(t){return n.get("/info",{url:t})},download:function(t,e){return n.post("/download",{url:t,fileName:e,srcId:o})},search:function(t,e=3){return n.post("/search",{query:t,maxResults:e})}}}});