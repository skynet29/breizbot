$$.control.registerControl("infoPage",{template:'<div class="details">\n\n    <strong>Title: </strong> <span bn-text="title"></span>\n    <strong>Length: </strong><span bn-text="duration"></span>\n\n</div>\n\n<div class="wrapper">\n    <div class="video" bn-style="{padding-bottom: ratio}">\n        <iframe bn-attr="{src: videoUrl, width, height}" frameborder="0" allowfullscreen></iframe>\n\n    </div>\n</div>\n\n\n<div class="description"> \n    <strong>Description:</strong>\n</div>\n\n<div class="scrollPanel">\n    <div bn-text="description"></div>\n</div>',deps:["app.ytdl","breizbot.broker"],props:{info:null,videoUrl:"",videoId:""},init:function(t,n,e){const i=this.props,o=$$.ui.progressDialog("Downloading..."),{videoUrl:r,videoId:a}=i,{title:s,thumbnail:l,description:d,length_seconds:c,videoFormat:u,audioFormat:p}=i.info,{width:v,height:b}=l;$$.viewController(t,{data:{duration:new Date(1e3*c).toLocaleTimeString("fr-FR",{timeZone:"UTC"}),title:s,width:v,height:b,ratio:function(){const t=`${b/v*100}%`;return console.log("ratio",t),t},videoUrl:$$.url.getUrlParams(`https://www.youtube-nocookie.com/embed/${a}`,{rel:0,modestbranding:1,showinfo:0}),description:d},events:{}});e.onTopic("breizbot.ytdl.progress",async t=>{if(1==t.hist)return;const{percent:n,error:e,finish:i}=t.data;e?(o.hide(),$$.ui.showAlert({title:"Error",content:e})):1==i?(await $$.util.wait(1e3),o.hide()):o.setPercentage(n/100)}),this.getButtons=function(){return{download:{title:"Download",icon:"fa fa-download",onClick:function(t){console.log("onDownload",r),$$.ui.showForm({title:"Choose Format",fields:{video:{input:"select",label:"Video",value:u[0].idx,items:u.map(t=>({label:t.qualityLabel,value:t.idx}))},audio:{input:"select",label:"Audio",value:p[0].idx,items:p.map(t=>({label:t.label,value:t.idx}))}}},t=>{console.log({data:t});const e=s+".mp4";n.download(r,t.video,t.audio,e),o.show()})}}}}}}),$$.control.registerControl("rootPage",{template:'<div bn-control="breizbot.searchbar" \n\tbn-bind="searchbar"\n\tbn-event="searchbarsubmit: onStart"\n\tdata-placeholder="Search or paste video link url here"></div>\n\n<div bn-show="waiting" class="waiting">\n\t<span><i class="fa fa-spinner fa-pulse"></i>&nbsp;Searching...</span>\n</div>\n\t\n<div class="results w3-light-grey" bn-show="!waiting">\n\t<div bn-each="results" bn-event="click.item: onItemInfo">\n\t\t<div class="item w3-card-2 w3-hover-shadow">\n\t\t\t<div class="imgWrapper">\n\t\t\t\t<img bn-attr="{src: $scope.$i.thumbnail}">\n\t\t\t</div>\n\n\t\t\t<div class="info">\n\t\t\t\t<div bn-html="$scope.$i.title" ></div>\n\t\t\t\t<div>\n\t\t\t\t\t<i class="far fa-clock"></i>\n\t\t\t\t\t<span bn-text="getDate"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>',deps:["app.ytdl","breizbot.params","breizbot.pager"],init:function(t,n,e,i){const o="https://www.youtube.com/watch?v=",r="https://youtu.be/",a=$$.viewController(t,{data:{results:[],waiting:!1,getDate:function(t){return new Date(1e3*t.$i.date).toLocaleDateString("fr-FR")}},events:{onStart:function(t,e){const i=e.value;i.startsWith(o)||i.startsWith(r)?s(i):async function(t){a.setData({waiting:!0});const e=await n.search(t,20);console.log("results",e),"string"==typeof e?$$.ui.showAlert({title:"Error",content:e}):a.setData({results:e,waiting:!1})}(i)},onItemInfo:function(t){const n=$(this).index(),e=a.model.results[n].id;s(r+e)}}});async function s(t){let e;e=t.startsWith(o)?t.replace(o,""):t.replace(r,"");const a=await n.info(t);console.log("info",a),i.pushPage("infoPage",{title:a.title,props:{info:a,videoUrl:t,videoId:e}})}null!=e.url&&(a.scope.searchbar.setValue(e.url),s(e.url))}}),$$.service.registerService("app.ytdl",{deps:["breizbot.http","breizbot.broker"],init:function(t,n,e){let i;return e.on("ready",t=>{i=t.clientId}),{info:function(t){return n.get("/info",{url:t})},download:function(t,e,o,r){return n.post("/download",{url:t,videoIdx:e,audioIdx:o,fileName:r,srcId:i})},search:function(t,e=3){return n.post("/search",{query:t,maxResults:e})}}}});